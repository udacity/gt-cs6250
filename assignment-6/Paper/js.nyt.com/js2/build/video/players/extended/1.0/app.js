var NYTD=NYTD||{};NYTD.video=NYTD.video||{},NYTD.video.players=NYTD.video.players||{},function(e,t){t.Extended=function(t){this.options=e.extend({token:"cE97ArV7TzqBzkmeRVVhJ8O6GWME2iG_bRvjBTlNb4o.",thumbWidth:110,thumbsVisible:3,thumbsDistance:6,thumbsMax:20,videoWidth:368,videoHeight:207,playerType:"homepage",debug:!1},t),this.element=e("#"+this.options.container),this.video=null,this.rendered=!1,this.currentVideo=1,this.initialize()},t.Extended.prototype={initialize:function(){var e=this;this.getData(function(t){e.playlist=t,e.setVideoIds(),e.render(),e.registerEvents(),e.options.onReady&&typeof e.options.onReady=="function"&&e.options.onReady.call(e)})},getStaticDomain:function(){var e=window.location.host,t="http://js.nyt.com/";if(this.options.debug)return"http://static.local.nytimes.com/";switch(e){case"www.dev.nytimes.com":t="http://static.dev.nytimes.com/";break;case"www.stg.nytimes.com":t="http://static.stg.nytimes.com/";break;default:t="http://js.nyt.com/"}return t},videoIds:[],registerEvents:function(){var t=this,n="#"+this.options.container,r=n+" .videoThumbs li";e(n).on("click",r,function(n){var r=e(this);t.selectThumb(r)})},getData:function(t){var n="http://api.brightcove.com/services/library?",r="command=find_playlist_by_reference_id&reference_id="+this.options.referenceId+"&token="+this.options.token+"&page_size="+this.options.thumbsMax+"&custom_fields=videourl&media_delivery=http";e.ajax({url:n,async:!1,type:"get",dataType:"jsonp",data:r,cache:!0,success:t})},selectThumb:function(e){var t=e.index(),n=this.playlist.videos[t];this.element.find(".videoThumbs li").removeClass("thumbSelected"),e.addClass("thumbSelected"),this.currentVideo=t,this.renderVideo(n),this.updateShareTool(n),this.scrollTo(e)},setVideoIds:function(){var e=this.playlist.videos;for(var t=0;t<e.length;t++)this.videoIds.push(e[t].referenceId)},getKicker:function(e){var t=/nyto_([^\s]+)/.exec(e.join(" "))[1];return t||""},render:function(){this.renderThumbs(),this.renderVideo(),this.updateShareTool()},renderVideo:function(e){var t=this,n=e?!1:!0,r=n?!1:!0,i=n?!1:!0,s=e||this.playlist.videos[0],o={backgroundImage:s.videoStillURL,buttonPosition:"bottomLeft",buttonAnimated:!0,buttonExpandBy:80,buttonFontColor:"#FFF",buttonFontSize:"12px",buttonPaddingLeftRight:20,buttonPaddingTopBottom:20,buttonHeight:42,buttonWidth:42},u=this.element.find(".extendedVideoPocketPlayerContainer");u.attr("id","video_"+s.referenceId),this.element.find(".videoDetails .kicker").html(this.getKicker(s.tags)),this.element.find(".videoDetails .shortDescription").attr("href",s.customFields.videourl).html(s.name),this.element.find(".videoDetails .longDescription").html(s.longDescription),this.video&&this.video.getVideoModule()?this.video.getVideoModule().loadVideo(s.referenceId,"referenceId"):(u.empty(),NYTD.Video.Factory.loadDependencies(function(){t.video=NYTD.Video.Factory.create({container:"video_"+s.referenceId,playerId:"2125004161001",publisherId:"1749339200",videoId:s.referenceId,width:t.options.videoWidth,height:t.options.videoHeight,autoStart:i,autoRender:r,playerType:t.options.playerType,adxAdPositions:"VideoPlayerAd,VideoBigAd,ADX_CLIENTSIDE",overlay:e?null:o,adCountdown:!0});var n=t.video.getSubscription();n.subscribe(NYTD.Video.VideoEvents.RENDERED,function(e){var n=t.element.find(".videoThumbs .thumbSelected");n.length===0&&t.element.find(".videoThumbs li:first").addClass("thumbSelected"),t.rendered=!0,t.video&&t.video.poster&&t.video.poster.onDestroyed()}),n.subscribe(NYTD.Video.VideoEvents.VIDEO_COMPLETE,function(){if(t.playlist.videos.length>t.currentVideo+1){var e=t.element.find(".videoThumbs .thumbSelected").next();t.selectThumb(e)}})}))},renderThumbs:function(){var t=this.element.find("ul.videoThumbs"),n=this.playlist.videos;for(var r=0;r<n.length;r++){var i=e("<li></li>").css({width:this.options.thumbWidth+4,"margin-right":this.options.thumbsDistance}),s=e('<img src="'+n[r].videoStillURL+'" />').css({width:this.options.thumbWidth}).appendTo(i),o=e('<p class="shortDescription">'+n[r].name+"</p>").appendTo(i);t.append(i)}"ontouchstart"in window?this.setTouchScroll():this.setRegularScroll()},setThumbsSize:function(){var e=this.element.find("ul.videoThumbs"),t=this.playlist.videos,n=t.length*(this.options.thumbWidth+this.options.thumbsDistance+4);e.css("width",n+"px")},scrollTo:function(e){var t=this.element.find(".videoThumbs"),n=this.currentVideo*(this.element.find(".videoThumbs li:first").outerWidth()+this.options.thumbsDistance)*-1,r={duration:"slow",easing:"swing",complete:function(){animating=!1}};"ontouchstart"in window?this.scroll.scrollToElement(e[0],500):(this.arrowsState(n),t.animate({marginLeft:n},r))},arrowsState:function(e){var t=this.element.find(".videoThumbs"),n=t.find("li:first").outerWidth(),r=(n+this.options.thumbsDistance)*this.options.thumbsVisible,i=this.element.find(".extVidPlayerNav .previousVideo"),s=this.element.find(".extVidPlayerNav .nextVideo"),o=this.element.find(".extVidPlayerThumbsContainer");e>=0?i.addClass("previousVideoInactive"):i.removeClass("previousVideoInactive"),e*-1+r>=t.width()?(s.addClass("nextVideoInactive"),o.removeClass("thumbsShadow")):(s.removeClass("nextVideoInactive"),o.addClass("thumbsShadow"))},setTouchScroll:function(){var e=this,t=this.element.find(".extVidPlayerThumbsContainer"),n=function(){e.scroll=new NYTD.video.iScroll("extVidPlayerThumbsWrapper",{vScrollbar:!1,hScrollbar:!1,snap:"li",onScrollMove:function(n){var r=e.element.find(".videoThumbs"),i=e.element.find(".videoThumbs").offset().left;i*-1+t.width()>r.width()?t.removeClass("thumbsShadow"):t.addClass("thumbsShadow")}}),t.addClass("thumbsShadow"),e.setThumbsSize(),e.scroll.refresh()};window.iScroll?n():this.getScript(this.getStaticDomain()+"js2/build/video/2.0/iscroll.js",n)},setRegularScroll:function(){var t=this,n=this.element.find(".videoThumbs"),r=this.element.find(".extVidPlayerNavContent").show(),i=this.element.find(".videoThumbs li:first").outerWidth(),s=(i+this.options.thumbsDistance)*this.options.thumbsVisible,o=this.playlist.videos.length,u=Math.ceil(o/this.options.thumbsVisible),a=this.playlist.videos.length%this.options.thumbsVisible,f=!1,l={duration:"slow",easing:"swing",complete:function(){f=!1}};this.setThumbsSize(),this.arrowsState(0),e("#"+this.options.container).on("click",".extVidPlayerNav .previousVideo",function(e){e.preventDefault();var r=parseInt(n.css("marginLeft"),10),i=r*-1>s?r+s:r+r*-1;r<0&&!f&&(n.animate({marginLeft:i},l),f=!0),t.arrowsState(i)}),e("#"+this.options.container).on("click",".extVidPlayerNav .nextVideo",function(e){e.preventDefault();var r=parseInt(n.css("marginLeft"),10),i=r-s;r*-1+s<n.width()&&!f&&(n.animate({marginLeft:i},l),f=!0),t.arrowsState(i)})},getScript:function(t,n){e.ajax({url:t,dataType:"script",cache:!0,success:n})},updateShareTool:function(e){var t=e||this.playlist.videos[0],n=this.element.find(".shareTools"),r=function(){n.data("title",t.name),n.data("description",t.longDescription),n.data("url",t.customFields.videourl||"http://www.nytimes.com/video")};NYTD.shareTools?r():this.getScript(this.getStaticDomain()+"js/common/sharetools/2.0/shareTools.js",r)}}}(NYTD.jQuery,NYTD.video.players);