var TimesPeople=TimesPeople||{};var TimesPeople=TimesPeople||{};(function(app){var SERVICE_BASE="/svc/timespeople/toolbar/1.0";var CDN;app.Config={host:"http://timespeople.nytimes.com",css_host:"http://css.nyt.com",image_host:"http://i1.nyt.com",js_host:"http://js.nyt.com",ad_host:"http://www.nytimes.com",user_image_host:"http://pimage.timespeople.nytimes.com",image_path:"/images/apps/timespeople/",css_path:"/css/0.1/screen/timespeople/toolbar/1.6",css_build_path:"/css/0.1/screen/timespeople/toolbar/1.6",image_service:"http://social-api.prd.use1.nytimes.com/svc/community/social/uploadpicture",get_started_uri:"http://timespeople.nytimes.com/getstarted",tunnel_uri:"http://timespeople.nytimes.com/packages/html/timespeople/xmlhttprequest.html",bell_pathname:"/svc/timespeople/bell.html",cookie_domain:window.location.hostname.match(/\.?[^.]+?\.[^.]+$/)[0],service_base:SERVICE_BASE,activity_service_post_url:SERVICE_BASE+"/activity/post",activity_service_hide_url:SERVICE_BASE+"/activity/hide",user_service_get_url:SERVICE_BASE+"/user?page_url="+window.location.href,user_service_add_following_url:SERVICE_BASE+"/following/add",user_service_remove_following_url:SERVICE_BASE+"/following/remove",user_service_create_url:SERVICE_BASE+"/register",user_service_update_url:SERVICE_BASE+"/update",user_service_login_url:SERVICE_BASE+"/login",default_feed_url:"http://timespeople.nytimes.com/tp/stats/mostpopular-recommended.json"};})(TimesPeople);if(typeof Object.create!=="function"){Object.create=function(o){function F(){}F.prototype=o;return new F();};}(function(app){var debug=false;if(typeof console=="undefined"||!debug){app.console={log:function(){}};}else{app.console=console;}app.Object={};app.Object.extend=function(destination,source){for(var property in source){destination[property]=source[property];}return destination;};app.isIE=function(){return !+"\v1";};app.isIE6=function(){return app.isIE()&&!window.XMLHttpRequest;};app.isReady=function(){return(document.body&&document.body.firstChild)?true:false;};app.$=function $(element){if(typeof element=="string"){element=document.getElementById(element);}return element;};app.truncate=function(string,length){length=length||30;return string.length>length?string.slice(0,length-3)+"...":String(string);};app.hasClassName=function(element,className){if(!(element=app.$(element))){return;}var elementClassName=element.className;return(elementClassName.length>0&&(elementClassName==className||new RegExp("(^|\\s)"+className+"(\\s|$)").test(elementClassName)));};app.getElementsByClassName=(function(){var fn,el=document.createElement("div");if(el.getElementsByClassName){fn=function getElementsByClassName(className,element){element=element||document.body;return Array.prototype.slice.call(element.getElementsByClassName(className),0);};}else{fn=function getElementsByClassName(className,element){element=element||document.body;for(var results=[],childNodes=element.getElementsByTagName("*"),re=new RegExp("(?:\\s|^)"+className+"(?:\\s|$)"),length=childNodes.length,i=0;i<length;++i){element=childNodes[i];if(re.test(element.className)){results.push(element);}}return results;};}return fn;})();app.hasNativeShadow=(function(){var is_capable=false;var element=document.documentElement;var style=element.style;var shadow_properties=["boxShadow","MozBoxShadow","WebkitBoxShadow"];for(var i=0,shadow_property;shadow_property=shadow_properties[i];i++){app.console.log(shadow_property,style[shadow_property]);is_capable=typeof style[shadow_property]=="string";if(is_capable){break;}}if(app.isIE()){is_capable=true;}return is_capable;})();})(TimesPeople);(function(app){app.EventPublisher=function EventPublisher(){this.observers=[];};app.EventPublisher.prototype={register:function(observer){this.observers.push(observer);},unregister:function(observer){var current_observers=this.observers;var results=[];for(var i=0,current_observer;current_observer=current_observers[i];i++){if(observer!=current_observer){results.push(current_observer);}}this.observers=results;},notifyObservers:function(event,data){for(var i=0,observers=this.observers;i<observers.length;i++){try{observers[i].update({event:event,data:data});}catch(e){app.console.log(e);}}}};})(TimesPeople);(function(app){var cache=[];app.Event={observe:function(element,eventName,fn){var handler;if(element.addEventListener){if(eventName==="mouseenter"||eventName==="mouseleave"){eventName=eventName==="mouseenter"?"mouseover":"mouseout";handler=function(event){var parent=event.relatedTarget;while(parent&&parent!==element){try{parent=parent.parentNode;}catch(e){parent=element;}}if(parent===element){return;}fn.call(element,event);};}element.addEventListener(eventName,(handler||fn),false);}else{if(element.attachEvent){if(eventName.indexOf(":")>-1){eventName="dataavailable";}handler=function(){return fn.call(element,normalize(window.event));};element.attachEvent("on"+eventName,handler);}}cache.push(handler||fn);if(handler){fn.handler=handler;}return element;},fire:function(element,eventName,memo){element=app.$(element);if(element==document&&document.createEvent&&!element.dispatchEvent){element=document.documentElement;}var event;if(document.createEvent){var event=document.createEvent("HTMLEvents");event.initEvent(eventName,true,true);}else{var event=document.createEventObject();event.eventType=(eventName.indexOf(":")>-1)?"ondataavailable":on+eventName;}event.eventName=eventName;event.memo=memo||{};if(document.createEvent){element.dispatchEvent(event);}else{element.fireEvent(event.eventType,event);}return event;},stopObserving:function(element,eventName,fn){var handler;if(typeof fn.handler=="function"){handler=fn.handler;}else{handler=fn;}if(element.removeEventListener){switch(eventName){case"mouseenter":eventName="mouseover";break;case"mouseleave":eventName="mouseout";break;}element.removeEventListener(eventName,handler,false);}else{if(element.detachEvent){element.detachEvent("on"+eventName,handler);}}},pointer:function(event){var docElement=document.documentElement,body=document.body||{scrollLeft:0,scrollTop:0};return{x:event.pageX||(event.clientX+(docElement.scrollLeft||body.scrollLeft)-(docElement.clientLeft||0)),y:event.pageY||(event.clientY+(docElement.scrollTop||body.scrollTop)-(docElement.clientTop||0))};}};function destroyCache(){for(var i=0,entry;entry=cache[i];i++){entry=null;}}function normalize(event){event.stopPropagation=event.stopPropagation||function(){event.cancelBubble=true;};event.preventDefault=event.preventDefault||function(){this.returnValue=false;};event.target=event.target||event.srcElement;return event;}if(window.attachEvent){window.attachEvent("onunload",destroyCache);}})(TimesPeople);(function(app){app.Cookie={get:function(name){return new RegExp(name+"=([^;]+)").test(unescape(document.cookie))?RegExp.$1:null;},set:function(name,value,options){var newcookie=[escape(name)+"="+escape(value)];if(options){if(options.expires){newcookie.push("expires="+options.expires.toGMTString());}if(options.path){newcookie.push("path="+options.path);}if(options.domain){newcookie.push("domain="+options.domain);}if(options.secure){newcookie.push("secure");}}document.cookie=newcookie.join("; ");}};})(TimesPeople);(function(app){var cache={};app.template=function(str,data){var fn=new Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};"+"with(obj){p.push('"+str.replace(/[\r\t\n]/g," ").split("<%").join("\t").replace(/((^|%>)[^\t]*)'/g,"$1\r").replace(/\t=(.*?)%>/g,"',$1,'").split("\t").join("');").split("%>").join("p.push('").split("\r").join("\\'")+"');}return p.join('');");return data?fn(data):fn;};})(TimesPeople);if(!this.JSON){JSON={};}(function(){function f(n){return n<10?"0"+n:n;}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(key){return this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z";};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(key){return this.valueOf();};}var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;function quote(string){escapable.lastIndex=0;return escapable.test(string)?'"'+string.replace(escapable,function(a){var c=meta[a];return typeof c==="string"?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4);})+'"':'"'+string+'"';}function str(key,holder){var i,k,v,length,mind=gap,partial,value=holder[key];if(value&&typeof value==="object"&&typeof value.toJSON==="function"){value=value.toJSON(key);}if(typeof rep==="function"){value=rep.call(holder,key,value);}switch(typeof value){case"string":return quote(value);case"number":return isFinite(value)?String(value):"null";case"boolean":case"null":return String(value);case"object":if(!value){return"null";}gap+=indent;partial=[];if(Object.prototype.toString.apply(value)==="[object Array]"){length=value.length;for(i=0;i<length;i+=1){partial[i]=str(i,value)||"null";}v=partial.length===0?"[]":gap?"[\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"]":"["+partial.join(",")+"]";gap=mind;return v;}if(rep&&typeof rep==="object"){length=rep.length;for(i=0;i<length;i+=1){k=rep[i];if(typeof k==="string"){v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v);}}}}else{for(k in value){if(Object.hasOwnProperty.call(value,k)){v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v);}}}}v=partial.length===0?"{}":gap?"{\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"}":"{"+partial.join(",")+"}";gap=mind;return v;}}if(typeof JSON.stringify!=="function"){JSON.stringify=function(value,replacer,space){var i;gap="";indent="";if(typeof space==="number"){for(i=0;i<space;i+=1){indent+=" ";}}else{if(typeof space==="string"){indent=space;}}rep=replacer;if(replacer&&typeof replacer!=="function"&&(typeof replacer!=="object"||typeof replacer.length!=="number")){throw new Error("JSON.stringify");}return str("",{"":value});};}if(typeof JSON.parse!=="function"){JSON.parse=function(text,reviver){var j;function walk(holder,key){var k,v,value=holder[key];if(value&&typeof value==="object"){for(k in value){if(Object.hasOwnProperty.call(value,k)){v=walk(value,k);if(v!==undefined){value[k]=v;}else{delete value[k];}}}}return reviver.call(holder,key,value);}cx.lastIndex=0;if(cx.test(text)){text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4);});}if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){j=eval("("+text+")");return typeof reviver==="function"?walk({"":j},""):j;}throw new SyntaxError("JSON.parse");};}})();(function(app){app.Request=(function(){var head=document.getElementsByTagName("head")[0];var scripts=document.getElementsByTagName("script");var bell_pathname=app.Config.bell_pathname;if(!bell_pathname){for(var i=0,script;script=scripts[i];i++){app.console.log(script.src);if(script.src&&(/\?bell=(.*)/).test(script.src)){bell_pathname=RegExp.$1;break;}}}if(bell_pathname==window.location.pathname&&window!=window.top){throw"Aborting: toolbar loading in the tunnel iframe";}if(!bell_pathname){throw'Please supply a root relative path to the "bell" file. (filename.js?bell=/path/to/file)';}var publisher=new app.EventPublisher();function Request(url,options){options=app.Object.extend({method:"get",params:"",onComplete:function(){}},options||{});publisher.notifyObservers("http request initiated");iframeRequest(url,options);}function iframeRequest(url,options){var iframe=document.createElement("iframe");iframe.style.position="absolute";iframe.style.top="-1000px";head.appendChild(iframe);var onComplete=options.onComplete;app.Event.observe(iframe,"load",processResponse);app.console.log("document.domain",document.domain);iframe.src=app.Config.tunnel_uri+"?url="+encodeURIComponent(url)+"&method="+options.method+"&params="+encodeURIComponent(options.params)+"&bell="+window.location.protocol+"//"+window.location.host+bell_pathname;function processResponse(){try{if(iframe.contentWindow.location&&iframe.contentWindow.location.pathname==bell_pathname){app.Event.stopObserving(iframe,"load",processResponse);app.console.log("gained access to iframe: "+iframe.contentWindow.location.pathname);var responseText=iframe.contentWindow.name;if(responseText){var response=JSON.parse(responseText);var innerResponse=JSON.parse(response.responseText);response.status=innerResponse.error_id||response.status;if(response.status&&response.status==200&&typeof options.onSuccess==="function"){options.onSuccess(response);}if(typeof options.onComplete==="function"){options.onComplete(response);}app.Event.stopObserving(iframe,"load",processResponse);window.setTimeout(function(){head.removeChild(iframe);},500);publisher.notifyObservers("http request completed");}}}catch(e){app.console.log(e);}}}app.Object.extend(Request,{register:function(observer){publisher.register(observer);},unregister:function(observer){publisher.unregister(observer);}});return Request;})();app.Ajax={};app.Ajax.Request=app.Request;})(TimesPeople);(function(app){app.User=(function(){var user,member,regi,loaded;var publisher=new app.EventPublisher();function User(){if(this==window){throw"User can only be used as a constructor.";}this.profile=this.profile||{};this.newsfeed=this.newsfeed||[];user=user||this;return user;}User.getInstance=function(){user=new User();if(!user.isLoaded()){user.load();}return user;};User.create=function(attributes){var user=new User();if(user.profile.uid){attributes.uid=user.profile.uid;}new app.Request(app.Config.user_service_create_url,{method:"post",params:"profile="+encodeURIComponent(JSON.stringify(attributes)),onComplete:function(response){switch(response.status){case 200:processResponse(response);publisher.notifyObservers("user created",user);publisher.notifyObservers("user saved",user);publisher.notifyObservers("user logged in",user);break;case 412:case 500:var data=response.responseText&&JSON.parse(response.responseText);if(data){app.console.log(data.error_message);publisher.notifyObservers("user could not be created",data);}break;}}});return user;};User.prototype={attributes:{},register:function(observer){publisher.register(observer);},unregister:function(observer){publisher.unregister(observer);},load:function(){new app.Request(app.Config.user_service_get_url,{onComplete:processResponse});},update:update,save:function(callback){new app.Request(app.Config.user_service_update_url,{method:"post",params:"profile="+JSON.stringify(this.profile),onComplete:processResponse,onSuccess:callback});},login:function(credentials){var instance=this;new app.Request(app.Config.user_service_login_url,{method:"post",params:"username="+credentials.username+"&password="+credentials.password+"&svid="+credentials.svid,onComplete:function(response){switch(response.status){case 200:processResponse(response);publisher.notifyObservers("user logged in",instance);break;case 403:processResponse(response);break;case 500:var data=response.responseText&&JSON.parse(response.responseText);if(data){app.console.log(data.error_message);publisher.notifyObservers("user login failed",data);}break;}loaded=true;}});},updateImage:function(callback){this.profile.picURL=imagePath(this.profile.uid);this.save(callback);window.setTimeout(function(){publisher.notifyObservers("user image updated");},1000);},updateFullSizeImage:function(){this.profile.fullpicURL=imagePath(this.profile.uid,true);this.save();window.setTimeout(function(){publisher.notifyObservers("user full size image updated");},1000);},addToFeed:function(activity){this.newsfeed.unshift(activity);publisher.notifyObservers("feed updated",user);},isLoaded:function(){return loaded;},isMember:function(){return member;},isNYTMember:function(){return regi;},isTimesPeopleMember:function(){return member;},addFollowee:function(userId){new app.Request(app.Config.user_service_add_following_url,{method:"post",params:"ids="+encodeURIComponent("["+userId+"]"),onComplete:function(response){user.load();}});},removeFollowee:function(userId){app.console.log(JSON.stringify({ids:[userId]}));new app.Request(app.Config.user_service_remove_following_url,{method:"post",params:"ids="+encodeURIComponent("["+userId+"]"),onComplete:function(response){user.load();}});},getSearchPageURI:function(){if(!member){return;}return app.Config.host+"/view/user/"+this.profile.uid+"/findpeople.html";},getFollowersPageURI:function(){if(!member){return"";}return app.Config.host+"/view/user/"+this.profile.uid+"/interested_people.html";},invite:function(emails){var instance=this;var url=app.Config.service_base+"/user/invite";new app.Request(url,{method:"post",params:"emails="+encodeURIComponent('["'+emails.join('","')+'"]'),onSuccess:function(response){app.console.log("invitations sent",response);instance.load();publisher.notifyObservers("invitations sent",{});},onComplete:function(response){if(response.status==500){app.console.log("error sending invitations",response.responseText);var data=JSON.parse(response.responseText);instance.load();publisher.notifyObservers("error sending invitations",data);}}});}};function update(attributes){app.Object.extend(user,attributes);publisher.notifyObservers("attributes updated",user);app.console.log(user);}function processResponse(response){switch(response.status){case 200:member=true;var attributes=response.responseText?JSON.parse(response.responseText):response;if(attributes.profile||attributes.newsfeed){update(attributes);}break;case 401:member=false;publisher.notifyObservers("no user info",null);break;case 403:member=false;regi=true;publisher.notifyObservers("user not registered",null);break;case 500:publisher.notifyObservers("service error",null);break;}loaded=true;}function imagePath(id,fullsize){return app.Config.user_image_host+"/"+idToPartitionedPath(id)+"/"+(fullsize?"uncropped-":"cropped-")+id+".jpg?"+Math.random().toString();}function idToPartitionedPath(id){return id.toString().replace(/(\d{4}(?=\d))/g,"$1/");}return User;})();})(TimesPeople);(function(app){app.Activity=(function(){var publisher=new app.EventPublisher();var activity;function Activity(){if(this==window){throw"Activity can only be used as a constructor";}activity=this;Activity.user=Activity.user||new app.User();if(!Activity.user.profile.uid){throw"The current user object is not valid or hasn't loaded yet";}if(typeof arguments[0]=="object"){initializeWithObject.call(this,arguments[0]);}else{initializeWithArguments.apply(this,arguments);}save();}Activity.prototype={makeDisplayReady:function(){return makeDisplayReady(this);}};function initializeWithObject(options){if(this instanceof Activity==false){throw"this function needs to be called with 'apply' and be passed an instance of Activity";}options=app.Object.extend({userid:Activity.user.profile.uid,object_desc:app.Page&&app.Page.description||"",object_type:app.Page&&app.Page.type||"",object_url:getObjectUrl(),object_thumbnail_url:"",object_note:"",visible:1,source:window.location.host},options);app.Object.extend(this,options);}function initializeWithArguments(verb,object,object_desc,object_url,object_thumbnail_url,object_type,object_note){if(this instanceof Activity==false){throw"this function needs to be called with 'apply' and be passed an instance of Activity";}this.userid=Activity.user.profile.uid;this.verb=verb;this.object=object;this.object_desc=object_desc||app.Page&&app.Page.description||"";this.object_type=object_type||app.Page&&app.Page.type;this.object_url=object_url||getObjectUrl();this.object_thumbnail_url=object_thumbnail_url||"";this.object_note=object_note||"";this.visible=1;this.source=window.location.host;}function save(){new app.Request(app.Config.activity_service_post_url,{method:"post",params:"activities="+encodeURIComponent("["+JSON.stringify(activity)+"]"),onComplete:processResponse});}function processResponse(response){switch(response.status){case 200:Activity.user.addToFeed(makeDisplayReady(activity));publisher.notifyObservers("action saved");break;case 401:case 403:break;case 500:publisher.notifyObservers("error saving action");app.console.log(response.responseText);break;}}function makeDisplayReady(activity){var item=app.Object.extend({},activity);item.actorDisplayname="You";item.date_updated=new Date().toString();item.picURL=Activity.user.profile.picURL;return item;}function getObjectUrl(){var preserve_search;switch(window.location.hostname){case"community.nytimes.com":case"query.nytimes.com":case"travel.nytimes.com":case"movies.nytimes.com":preserve_search=true;break;case"www.nytimes.com":default:preserve_search=false;}var search=window.location.search&&preserve_search?window.location.search+"&src=tp":"?src=tp";return[window.location.protocol,"//",window.location.host,window.location.pathname,search,window.location.hash].join("");}app.Object.extend(Activity,{register:function(observer){publisher.register(observer);},unregister:function(observer){publisher.unregister(observer);},hide:function(id){new app.Request(app.Config.activity_service_hide_url,{method:"post",params:"activity_id="+id,onSuccess:function(response){publisher.notifyObservers("action hidden");}});}});return Activity;})();})(TimesPeople);TimesPeople.Config.Page={Group:[{value:"articleid",alias:"article"},{value:"PT"},{value:"WT.z_gpt",alias:"article"}],Type:{"article":{"tom":[{value:"biography"},{value:"editor's note"},{value:"editorial"},{value:"interview"},{value:"recipe"},{value:"special report"},{value:"review"}]},"topic":{"SCG":[{value:"movie pages",alias:"movie guide"},{value:"destinations",alias:"destination"}],"PST":[{value:"movie details",alias:"movie guide"},{value:"health guide"},{value:"travel guide"},{value:"event detail"}]},"community":{"PST":[{value:"comments overflow",alias:"article"},{value:"rate-review",alias:"movie guide"}]},"multimedia":{"SCG":[{value:"election guide"}],"PST":[{value:"interactive",alias:"interactive graphic"},{value:"interactive features",alias:"interactive feature"},{value:"image",alias:"graphic"},{value:"video"}],"tom":[{value:"slideshow",alias:"slide show"}]},"blogs":{"PST":[{value:"blog main",alias:"blog"},{value:"blog post"}]},"venue":{"tom":[{value:"attraction"},{value:"dining",alias:"restaurant"},{value:"accommodation",alias:"hotel"},{value:"shopping",alias:"attraction"},{value:"night life",alias:"attraction"}]}},Title:{"article":{"default":["meta[name='hdl']","div.header h1:not(h1.movie)","div.header h1","#aColumn #article h1","title"],"article":["meta[name='hdl']","div.header h1:not(h1.movie)","div.header h1","#aColumn #article h1"]},"topic":{"default":["meta[name='name']","meta[name='GTN']","#subHdr h1","title"],"topic":["meta[name='name']","meta[name='GTN']","#subHdr h1"],"movie guide":["#header div.title h1","meta[name='MTI']"],"health guide":["meta[name='HGSN']"],"travel guide":["h5.fn","meta[name='name']"]},"multimedia":{"default":["meta[name='hdl']","title"],"interactive graphic":["meta[name='hdl']","title"],"interactive feature":["meta[name='hdl']","title"],"slide show":["meta[name='hdl']","title"],"graphic":["meta[name='dsk']","title"],"election guide":["h1","#masthead h2 a","title"],"video":["#libraryPlayerTitleName h1"]},"blogs":{"default":["h2.entry-title","title"],"blog post":["h2.entry-title"]},"venue":{"default":["meta[name='name']","title"],"hotel":["meta[name='name']"],"restaurant":["meta[name='name']"],"attraction":["meta[name='name']"]},"community":{"default":["#header div.title h1","meta[name='MTI']","title"],"movie guide":["#header div.title h1","meta[name='MTI']"]}},Description:{"article":{"default":["#aColumn #article p:not(p:empty)","meta[name='description']","meta[name='lp']"],"article":["#aColumn #article p:not(p:empty)","meta[name='description']","meta[name='lp']"],"editorial":["#aColumn #article p:not(p:empty)","meta[name='description']","meta[name='lp']"]},"topic":{"default":["meta[name='description']"],"topic":["div.companyInformation","meta[name='description']","meta[name='summary']"],"movie guide":["p[class='review']","meta[name='description']"],"health guide":["#definition p","meta[name='Description']"],"travel guide":["#topStoryHorizontal p","meta[name='description']"]},"multimedia":{"default":["meta[name='description']"],"interactive graphic":["meta[name='description']"],"interactive feature":["meta[name='description']"],"slide show":["div.story","div[class='caption']","meta[name='description']"],"graphic":["td font[size='-1']","meta[name='byl']","meta[name='description']"],"election guide":["meta[name='description']"],"video":["#libraryPlayerDesc p"]},"blogs":{"default":["meta[name='description']"],"blog post":["div.entry-content p","meta[name='description']"]},"venue":{"default":["meta[name='description']"],"hotel":["p.description","span.description","meta[name='description']"],"restaurant":["p.description","span.description","meta[name='description']"],"attraction":["p.description","span.description","meta[name='description']"]},"community":{"default":["meta[name='description']"],"movie guide":["div.result]","meta[name='description']"]}}};TimesPeople.Config.HTML={Recommend:{standard:"<a class='timespeople_recommend_link'><span>__LABEL__</span></a>",uppercase:"<a class='timespeople_recommend_link' style='cursor:pointer;background-image:url(__ICON__); background-repeat:no-repeat; padding:1px 0 3px 20px; font-size:1em; color:#333333; text-transform:uppercase;'>__LABEL__</a>",blog:"<a class='timespeople_recommend_link'>__LABEL__</a>"}};TimesPeople.Config.Style={Recommend:{slideshow:"padding-right:10px;border-right:1px solid #CCCCCC;",standard:"padding-right:10px;border-right:1px solid #CCCCCC;margin-right:10px"}};TimesPeople.Config.Action={Recommend:{"article":{"article":{key:"#toolsList",target:"#toolsList",type:"li",style:{},position:"first",html:TimesPeople.Config.HTML.Recommend.standard},"editorial":{key:"#toolsList",target:"#toolsList",type:"li",style:{},position:"first",html:TimesPeople.Config.HTML.Recommend.standard},"default":{key:"#toolsList",target:"#toolsList",type:"li",style:{},position:"first",html:TimesPeople.Config.HTML.Recommend.standard}},"topic":{"topic":{key:"#tools",target:"#tools",type:"span",style:"padding-right:10px;border-right:1px solid #CCCCCC;margin-right:10px",position:"first",html:TimesPeople.Config.HTML.Recommend.uppercase},"movie guide":{key:"#tools",target:"#menu",type:"span",style:"float: right; margin: 5px 0 0 4px; padding-left: 2px;",position:"last",html:TimesPeople.Config.HTML.Recommend.uppercase},"destination":{key:"#tools",target:"#menu",type:"span",style:"float: right; margin: 5px 0 0 4px; padding-left: 2px;",position:"last",html:TimesPeople.Config.HTML.Recommend.uppercase},"health guide":{key:"#tools",target:"#breadcrumb",type:"span",style:"float:right;",position:"first",html:TimesPeople.Config.HTML.Recommend.uppercase},"travel guide":{key:"#tools",target:"#tools",type:"span",style:TimesPeople.Config.Style.Recommend.standard,position:"first",html:TimesPeople.Config.HTML.Recommend.uppercase},"event detail":{key:"#toolsList",target:"#toolsList",type:"li",style:{},position:"first",html:TimesPeople.Config.HTML.Recommend.standard},"default":{key:"#tools",target:"#tools",type:"span",style:"padding-right:10px;border-right:1px solid #CCCCCC;margin-right:10px",position:"first",html:TimesPeople.Config.HTML.Recommend.uppercase}},"multimedia":{"interactive graphic":{key:"#articleTools, #toolsList",target:"#articleTools, #toolsList",type:"li",style:"",position:"first",html:TimesPeople.Config.HTML.Recommend.standard},"slide show":{key:"#toolsList",target:"#toolsList",type:"li",style:TimesPeople.Config.Style.Recommend.slideshow,position:"first",html:TimesPeople.Config.HTML.Recommend.uppercase},"graphic":{key:"table",target:"font[size='-2']",type:"div",style:"padding-top:4px; font-family:Arial,Helvetica;",position:"last",html:TimesPeople.Config.HTML.Recommend.uppercase},"election guide":{key:"#toolsList",target:"#toolsList",type:"li",style:"",position:"first",html:"<a class='timespeople_recommend_link' style='cursor:pointer;color:#333; background-position:4px; font-size:1em; text-transform:uppercase; background-image:url(__ICON__); background-repeat:no-repeat;'>__LABEL__</a>"},"video":{key:"#toolsList",target:"#toolsList",type:"li",style:TimesPeople.Config.Style.Recommend.standard,position:"first",html:TimesPeople.Config.HTML.Recommend.uppercase},"default":{key:"#toolsList",target:"#toolsList",type:"li",style:TimesPeople.Config.Style.Recommend.standard,position:"first",html:TimesPeople.Config.HTML.Recommend.uppercase}},"blogs":{"blog post":{key:"#content",target:"ul.entry-tools",type:"li",style:"",position:"last",html:TimesPeople.Config.HTML.Recommend.blog},"default":{key:"#content",target:"ul.entry-tools",type:"li",style:"",position:"last",html:TimesPeople.Config.HTML.Recommend.blog}},"venue":{"hotel":{key:"#tools",target:"#tools",type:"span",style:TimesPeople.Config.Style.Recommend.standard,position:"first",html:TimesPeople.Config.HTML.Recommend.uppercase},"restaurant":{key:"#tools",target:"#tools",type:"span",style:TimesPeople.Config.Style.Recommend.standard,position:"first",html:TimesPeople.Config.HTML.Recommend.uppercase},"attraction":{key:"#tools",target:"#tools",type:"span",style:TimesPeople.Config.Style.Recommend.standard,position:"first",html:TimesPeople.Config.HTML.Recommend.uppercase},"default":{key:"#tools",target:"#tools",type:"span",style:TimesPeople.Config.Style.Recommend.standard,position:"first",html:TimesPeople.Config.HTML.Recommend.uppercase}}}};TimesPeople.Config.bitlyApiKey="R_554ad67f3555db8156cc911a4c8e37b0";TimesPeople.Page={initialize:function(){TimesPeople.console.log("Has init. Doing presets");this.getType();this.section=this.getSection();this.subsection=this.getSubSection();this.title=this.getTitle();this.description=this.getDescription();return true;},isRecommendable:function(){if(this.isGetStarted()){return false;}if(!this.group){this.getType();}var recommendableGroups={"article":true,"topic":true,"multimedia":true,"venue":true,"community":true,"blogs":true};return this.group in recommendableGroups;},isGetStarted:(function(){var pattern=new RegExp(TimesPeople.Config.get_started_uri);var result=pattern.test(window.location.href);return function(){return result;};})(),getSection:function(){var section=$$('meta[name="CG"]')[0];if(section){return section.getAttribute("content").toLowerCase();}return"";},getSubSection:function(){if(this.type=="article"||this.type=="multimedia"){var subsection=$$('meta[name="SCG"]')[0];if(subsection){return subsection.getAttribute("content").toLowerCase();}}return"";},getType:function(){var metaSearch,metaExists;var mList,mTagPage;var keepGoing=true;var pos=0;while(keepGoing&&(pos<TimesPeople.Config.Page.Group.length)){metaSearch=TimesPeople.Config.Page.Group[pos];metaExists=$$('meta[name="'+metaSearch.value+'"]')[0];if(metaExists!=undefined){keepGoing=false;this.group=(metaSearch.alias!=undefined)?metaSearch.alias:metaExists.getAttribute("content").toLowerCase();this.type=this.group;mList=TimesPeople.Config.Page.Type[TimesPeople.Page.group];$H(mList).keys().each(function(key){mTagPage=$$('meta[name="'+key+'"]')[0];if(mTagPage!=undefined){mList[key].each(function(mItem,index){if(mItem.value==mTagPage.getAttribute("content").toLowerCase()){TimesPeople.Page.type=(mItem.alias!=undefined)?mItem.alias:mItem.value;return this.type;}});}});}pos++;}this.group=this.group||"article";this.type=this.type||"article";return this.type;},getTitle:function(){if(this.type=="video"){return decodeURIComponent(getShareHeadline());}var title="";if(TimesPeople.Config.Page.Description[this.group]!=undefined){if(TimesPeople.Config.Page.Title[this.group][this.type]!=undefined){title=this.getEmbeddedValue(TimesPeople.Config.Page.Title[this.group][this.type]);}else{title=this.getEmbeddedValue(TimesPeople.Config.Page.Title[this.group]["default"]);}}if(title==undefined||title==""){title=document.title;var removeThese=[" - NYTimes.com"," - The New York Times"," - New York Times"," - NY Times Health Information"," - NY Times Health"];removeThese.all(function(removeThis){title=title.replace(removeThis,"");});}return title;},getDescription:function(){var description="";if(TimesPeople.Config.Page.Description[this.group]!=undefined){if(TimesPeople.Config.Page.Description[this.group][this.type]!=undefined){description=this.getEmbeddedValue(TimesPeople.Config.Page.Description[this.group][this.type]);}else{description=this.getEmbeddedValue(TimesPeople.Config.Page.Description[this.group]["default"]);}description=(description==undefined)?"":description;}return description;},getThumbnail:function(){var thumb="";var meta=$$('meta[name="thumbnail"]')[0]||$$('meta[name="url_thumb"]')[0]||false;if(meta){var content=meta.getAttribute("content");if(content&&!content.startsWith("http")){content=content.replace(/^\//,"");thumb=TimesPeople.Config.image_host+"/"+content;}else{thumb=content;}}return thumb;},getEmbeddedValue:function(cssSelectorList){var result="";if(cssSelectorList){cssSelectorList.each(function(trySelector){var embDesc=$$(trySelector)[0];if(embDesc!=undefined){var embValue;if(trySelector.indexOf("meta")>-1){embValue=embDesc.getAttribute("content");}else{embValue=embDesc.innerHTML;}if(embValue!=""){result=embValue.stripTags().replace(/\n/g,"").strip().truncate(250);throw $break;}}});}return result;},getUrl:function(src){src=src||"tp";if(this.url){return this.url;}if(this.type=="video"&&typeof getShareURL=="function"){return getShareURL();}var canonical=$$("link[rel=canonical]")[0];if(canonical){this.url=canonical.href;return this.url+"?src="+src;}var preserve_search;switch(window.location.hostname){case"community.nytimes.com":case"query.nytimes.com":case"travel.nytimes.com":case"movies.nytimes.com":preserve_search=true;break;case"www.nytimes.com":default:preserve_search=false;}var search=window.location.search&&preserve_search?window.location.search+"&src="+src:"?src="+src;this.url=[window.location.protocol,"//",window.location.host,window.location.pathname,search,window.location.hash].join("");return this.url;}};TimesPeople.TwitterTool={Config:(function(){var width=550,height=340,winWidth=screen.width,winHeight=screen.height,left=Math.round((winWidth/2)-(width/2)),top=(winHeight>height)?Math.round((winHeight/2)-(height/2)):0;return{windowOptions:"scrollbars=yes,resizable=yes,toolbar=no,location=yes,width="+width+",height="+height+",left="+left+",top="+top,windowName:"twitterIntent"};})(),initialize:function(element,position,x,y,asset){this.asset=asset||TimesPeople.Page;this.element=element;this.position=position;this.x=x?x+"px":"";this.y=y?y+"px":"";this.label="Twitter";this.draw();},draw:function(){var html=NYTD.Template(this.toolbar_item_html,{label:this.label});var insertion={};insertion[this.position]=html;this.element.insert(insertion);this.targetElement=$("twitter_button");this.targetElement.observe("click",this.onClick.bind(this));},onClick:function(e){this.url=this.asset.getUrl();this.title=this.asset.getTitle();dcsMultiTrack&&dcsMultiTrack("DCS.dcssip","www.nytimes.com","DCS.dcsuri","/Article-Tool-Share-Twitter.html","WT.ti","Article-Tool-Share-Twitter","WT.z_dcsm","1");if(!this.twitterWindow||this.twitterWindow.closed){this.twitterWindow=window.open("about:blank",this.Config.windowName,this.Config.windowOptions);}this.shortenURL();Event.stop(e);return false;},shortenURL:function(){var self=this;new TimesPeople.Request("/svc/timespeople/toolbar/1.0/url/shorten",{method:"post",params:"long_url="+encodeURIComponent(this.url),onComplete:function(response){self.onShortenURL(response);}});},onShortenURL:function(response){var short_url;var widgetUrl="https://twitter.com/intent/tweet?";switch(response.status){case 200:short_url=JSON.parse(response.responseText).short_url;break;default:short_url=this.url;}widgetUrl+="text="+encodeURIComponent(this.title+":")+"&url="+encodeURIComponent(short_url);this.targetElement.setAttribute("href",widgetUrl);this.twitterWindow.location=widgetUrl;},toolbar_item_html:'        <li id="twitter_item">            <a id="twitter_button">                <span><%= label %></span>            </a>        </li>    '};(function(){Event.observe(window,"load",function(){initialize();});function initialize(){TimesPeople.Page.initialize();if(TimesPeople.Page.type=="blog post"){TimesPeople.TwitterTool.initialize($$(".entry-tools")[0],"bottom",0,25);}}})();
// Fri Sep 16 15:13:09 EDT 2011
