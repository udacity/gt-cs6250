/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dijit._base.manager"]){dojo._hasResource["dijit._base.manager"]=true;dojo.provide("dijit._base.manager");dojo.declare("dijit.WidgetSet",null,{constructor:function(){this._hash={};this.length=0},add:function(b){if(this._hash[b.id])throw Error("Tried to register widget with id=="+b.id+" but that id is already registered");this._hash[b.id]=b;this.length++},remove:function(b){if(this._hash[b]){delete this._hash[b];this.length--}},forEach:function(b,c){c=c||dojo.global;var f=0,e;
for(e in this._hash)b.call(c,this._hash[e],f++,this._hash);return this},filter:function(b,c){c=c||dojo.global;var f=new dijit.WidgetSet,e=0,m;for(m in this._hash){var n=this._hash[m];b.call(c,n,e++,this._hash)&&f.add(n)}return f},byId:function(b){return this._hash[b]},byClass:function(b){var c=new dijit.WidgetSet,f,e;for(f in this._hash){e=this._hash[f];e.declaredClass==b&&c.add(e)}return c},toArray:function(){var b=[],c;for(c in this._hash)b.push(this._hash[c]);return b},map:function(b,c){return dojo.map(this.toArray(),
b,c)},every:function(b,c){c=c||dojo.global;var f=0,e;for(e in this._hash)if(!b.call(c,this._hash[e],f++,this._hash))return false;return true},some:function(b,c){c=c||dojo.global;var f=0,e;for(e in this._hash)if(b.call(c,this._hash[e],f++,this._hash))return true;return false}});(function(){dijit.registry=new dijit.WidgetSet;var b=dijit.registry._hash,c=dojo.attr,f=dojo.hasAttr,e=dojo.style;dijit.byId=function(a){return typeof a=="string"?b[a]:a};var m={};dijit.getUniqueId=function(a){var d;do d=a+
"_"+(a in m?++m[a]:m[a]=0);while(b[d]);return dijit._scopeName=="dijit"?d:dijit._scopeName+"_"+d};dijit.findWidgets=function(a){function d(h){for(h=h.firstChild;h;h=h.nextSibling)if(h.nodeType==1){var j=h.getAttribute("widgetId");if(j)(j=b[j])&&i.push(j);else d(h)}}var i=[];d(a);return i};dijit._destroyAll=function(){dijit._curFocus=null;dijit._prevFocus=null;dijit._activeStack=[];dojo.forEach(dijit.findWidgets(dojo.body()),function(a){if(!a._destroyed)if(a.destroyRecursive)a.destroyRecursive();else a.destroy&&
a.destroy()})};dojo.isIE&&dojo.addOnWindowUnload(function(){dijit._destroyAll()});dijit.byNode=function(a){return b[a.getAttribute("widgetId")]};dijit.getEnclosingWidget=function(a){for(;a;){var d=a.getAttribute&&a.getAttribute("widgetId");if(d)return b[d];a=a.parentNode}return null};var n=dijit._isElementShown=function(a){var d=e(a);return d.visibility!="hidden"&&d.visibility!="collapsed"&&d.display!="none"&&c(a,"type")!="hidden"};dijit.hasDefaultTabStop=function(a){switch(a.nodeName.toLowerCase()){case "a":return f(a,
"href");case "area":case "button":case "input":case "object":case "select":case "textarea":return true;case "iframe":var d;try{var i=a.contentDocument;if("designMode"in i&&i.designMode=="on")return true;d=i.body}catch(h){try{d=a.contentWindow.document.body}catch(j){return false}}return d.contentEditable=="true"||d.firstChild&&d.firstChild.contentEditable=="true";default:return a.contentEditable=="true"}};var t=dijit.isTabNavigable=function(a){return c(a,"disabled")?false:f(a,"tabIndex")?c(a,"tabIndex")>=
0:dijit.hasDefaultTabStop(a)};dijit._getTabNavigable=function(a){function d(l){return l&&l.tagName.toLowerCase()=="input"&&l.type&&l.type.toLowerCase()=="radio"&&l.name&&l.name.toLowerCase()}var i,h,j,q,p,r,o={},s=function(l){dojo.query("> *",l).forEach(function(g){if(!(dojo.isIE&&g.scopeName!=="HTML"||!n(g))){if(t(g)){var k=c(g,"tabIndex");if(!f(g,"tabIndex")||k==0){i||(i=g);h=g}else if(k>0){if(!j||k<q){q=k;j=g}if(!p||k>=r){r=k;p=g}}k=d(g);if(dojo.attr(g,"checked")&&k)o[k]=g}g.nodeName.toUpperCase()!=
"SELECT"&&s(g)}})};n(a)&&s(a);return{first:o[d(i)]||i,last:o[d(h)]||h,lowest:o[d(j)]||j,highest:o[d(p)]||p}};dijit.getFirstInTabbingOrder=function(a){a=dijit._getTabNavigable(dojo.byId(a));return a.lowest?a.lowest:a.first};dijit.getLastInTabbingOrder=function(a){a=dijit._getTabNavigable(dojo.byId(a));return a.last?a.last:a.highest};dijit.defaultDuration=dojo.config.defaultDuration||200})()};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dijit._base.typematic"]){dojo._hasResource["dijit._base.typematic"]=true;dojo.provide("dijit._base.typematic");dijit.typematic={_fireEventAndReload:function(){this._timer=null;this._callback(++this._count,this._node,this._evt);this._currentTimeout=Math.max(this._currentTimeout<0?this._initialDelay:this._subsequentDelay>1?this._subsequentDelay:Math.round(this._currentTimeout*this._subsequentDelay),this._minDelay);this._timer=setTimeout(dojo.hitch(this,"_fireEventAndReload"),
this._currentTimeout)},trigger:function(c,a,h,f,e,g,d,b){if(e!=this._obj){this.stop();this._initialDelay=d||500;this._subsequentDelay=g||0.9;this._minDelay=b||10;this._obj=e;this._evt=c;this._node=h;this._count=this._currentTimeout=-1;this._callback=dojo.hitch(a,f);this._fireEventAndReload();this._evt=dojo.mixin({faux:true},c)}},stop:function(){if(this._timer){clearTimeout(this._timer);this._timer=null}if(this._obj){this._callback(-1,this._node,this._evt);this._obj=null}},addKeyListener:function(c,
a,h,f,e,g,d){if(a.keyCode){a.charOrCode=a.keyCode;dojo.deprecated("keyCode attribute parameter for dijit.typematic.addKeyListener is deprecated. Use charOrCode instead.","","2.0")}else if(a.charCode){a.charOrCode=String.fromCharCode(a.charCode);dojo.deprecated("charCode attribute parameter for dijit.typematic.addKeyListener is deprecated. Use charOrCode instead.","","2.0")}return[dojo.connect(c,"onkeypress",this,function(b){if(b.charOrCode==a.charOrCode&&(a.ctrlKey===undefined||a.ctrlKey==b.ctrlKey)&&
(a.altKey===undefined||a.altKey==b.altKey)&&(a.metaKey===undefined||a.metaKey==(b.metaKey||false))&&(a.shiftKey===undefined||a.shiftKey==b.shiftKey)){dojo.stopEvent(b);dijit.typematic.trigger(b,h,c,f,a,e,g,d)}else dijit.typematic._obj==a&&dijit.typematic.stop()}),dojo.connect(c,"onkeyup",this,function(){dijit.typematic._obj==a&&dijit.typematic.stop()})]},addMouseListener:function(c,a,h,f,e,g){var d=dojo.connect;return[d(c,"mousedown",this,function(b){dojo.stopEvent(b);dijit.typematic.trigger(b,a,
c,h,c,f,e,g)}),d(c,"mouseup",this,function(b){dojo.stopEvent(b);dijit.typematic.stop()}),d(c,"mouseout",this,function(b){dojo.stopEvent(b);dijit.typematic.stop()}),d(c,"mousemove",this,function(b){b.preventDefault()}),d(c,"dblclick",this,function(b){dojo.stopEvent(b);if(dojo.isIE){dijit.typematic.trigger(b,a,c,h,c,f,e,g);setTimeout(dojo.hitch(this,dijit.typematic.stop),50)}})]},addListener:function(c,a,h,f,e,g,d,b){return this.addKeyListener(a,h,f,e,g,d,b).concat(this.addMouseListener(c,f,e,g,d,b))}}};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dijit._base.wai"]){dojo._hasResource["dijit._base.wai"]=true;dojo.provide("dijit._base.wai");dijit.wai={onload:function(){var a=dojo.create("div",{id:"a11yTestNode",style:{cssText:'border: 1px solid;border-color:red green;position: absolute;height: 5px;top: -999px;background-image: url("'+(dojo.config.blankGif||dojo.moduleUrl("dojo","resources/blank.gif"))+'");'}},dojo.body()),b=dojo.getComputedStyle(a);if(b){var c=b.backgroundImage;dojo[b.borderTopColor==b.borderRightColor||
c!=null&&(c=="none"||c=="url(invalid-url:)")?"addClass":"removeClass"](dojo.body(),"dijit_a11y");if(dojo.isIE)a.outerHTML="";else dojo.body().removeChild(a)}}};if(dojo.isIE||dojo.isMoz)dojo._loaders.unshift(dijit.wai.onload);dojo.mixin(dijit,{hasWaiRole:function(a,b){var c=this.getWaiRole(a);return b?c.indexOf(b)>-1:c.length>0},getWaiRole:function(a){return dojo.trim((dojo.attr(a,"role")||"").replace("wairole:",""))},setWaiRole:function(a,b){dojo.attr(a,"role",b)},removeWaiRole:function(a,b){var c=
dojo.attr(a,"role");if(c)if(b){c=dojo.trim((" "+c+" ").replace(" "+b+" "," "));dojo.attr(a,"role",c)}else a.removeAttribute("role")},hasWaiState:function(a,b){return a.hasAttribute?a.hasAttribute("aria-"+b):!!a.getAttribute("aria-"+b)},getWaiState:function(a,b){return a.getAttribute("aria-"+b)||""},setWaiState:function(a,b,c){a.setAttribute("aria-"+b,c)},removeWaiState:function(a,b){a.removeAttribute("aria-"+b)}})};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dijit._Contained"]){dojo._hasResource["dijit._Contained"]=true;dojo.provide("dijit._Contained");dojo.declare("dijit._Contained",null,{getParent:function(){var a=dijit.getEnclosingWidget(this.domNode.parentNode);return a&&a.isContainer?a:null},_getSibling:function(a){var b=this.domNode;do b=b[a+"Sibling"];while(b&&b.nodeType!=1);return b&&dijit.byNode(b)},getPreviousSibling:function(){return this._getSibling("previous")},getNextSibling:function(){return this._getSibling("next")},
getIndexInParent:function(){var a=this.getParent();if(!a||!a.getIndexOfChild)return-1;return a.getIndexOfChild(this)}})};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dijit._Container"]){dojo._hasResource["dijit._Container"]=true;dojo.provide("dijit._Container");dojo.declare("dijit._Container",null,{isContainer:true,buildRendering:function(){this.inherited(arguments);if(!this.containerNode)this.containerNode=this.domNode},addChild:function(a,b){var c=this.containerNode;if(b&&typeof b=="number"){var d=this.getChildren();if(d&&d.length>=b){c=d[b-1].domNode;b="after"}}dojo.place(a.domNode,c,b);this._started&&!a._started&&a.startup()},removeChild:function(a){if(typeof a==
"number")a=this.getChildren()[a];if(a)(a=a.domNode)&&a.parentNode&&a.parentNode.removeChild(a)},hasChildren:function(){return this.getChildren().length>0},destroyDescendants:function(a){dojo.forEach(this.getChildren(),function(b){b.destroyRecursive(a)})},_getSiblingOfChild:function(a,b){var c=a.domNode,d=b>0?"nextSibling":"previousSibling";do c=c[d];while(c&&(c.nodeType!=1||!dijit.byNode(c)));return c&&dijit.byNode(c)},getIndexOfChild:function(a){return dojo.indexOf(this.getChildren(),a)},startup:function(){if(!this._started){dojo.forEach(this.getChildren(),
function(a){a.startup()});this.inherited(arguments)}}})};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dijit._CssStateMixin"]){dojo._hasResource["dijit._CssStateMixin"]=true;dojo.provide("dijit._CssStateMixin");dojo.declare("dijit._CssStateMixin",[],{cssStateNodes:{},hovering:false,active:false,_applyAttributes:function(){this.inherited(arguments);dojo.forEach(["onmouseenter","onmouseleave","onmousedown"],function(b){this.connect(this.domNode,b,"_cssMouseEvent")},this);dojo.forEach(["disabled","readOnly","checked","selected","focused","state","hovering","active"],function(b){this.watch(b,
dojo.hitch(this,"_setStateClass"))},this);for(var a in this.cssStateNodes)this._trackMouseState(this[a],this.cssStateNodes[a]);this._setStateClass()},_cssMouseEvent:function(a){if(!this.disabled)switch(a.type){case "mouseenter":case "mouseover":this._set("hovering",true);this._set("active",this._mouseDown);break;case "mouseleave":case "mouseout":this._set("hovering",false);this._set("active",false);break;case "mousedown":this._set("active",true);this._mouseDown=true;var b=this.connect(dojo.body(),
"onmouseup",function(){this._mouseDown=false;this._set("active",false);this.disconnect(b)})}},_setStateClass:function(){function a(c){b=b.concat(dojo.map(b,function(e){return e+c}),"dijit"+c)}var b=this.baseClass.split(" ");this.isLeftToRight()||a("Rtl");this.checked&&a("Checked");this.state&&a(this.state);this.selected&&a("Selected");if(this.disabled)a("Disabled");else if(this.readOnly)a("ReadOnly");else if(this.active)a("Active");else this.hovering&&a("Hover");this._focused&&a("Focused");var d=
this.stateNode||this.domNode,f={};dojo.forEach(d.className.split(" "),function(c){f[c]=true});"_stateClasses"in this&&dojo.forEach(this._stateClasses,function(c){delete f[c]});dojo.forEach(b,function(c){f[c]=true});var g=[],h;for(h in f)g.push(h);d.className=g.join(" ");this._stateClasses=b},_trackMouseState:function(a,b){function d(){var i="disabled"in c&&c.disabled||"readonly"in c&&c.readonly;dojo.toggleClass(a,b+"Hover",f&&!g&&!i);dojo.toggleClass(a,b+"Active",g&&!i);dojo.toggleClass(a,b+"Focused",
h&&!i)}var f=false,g=false,h=false,c=this,e=dojo.hitch(this,"connect",a);e("onmouseenter",function(){f=true;d()});e("onmouseleave",function(){g=f=false;d()});e("onmousedown",function(){g=true;d()});e("onmouseup",function(){g=false;d()});e("onfocus",function(){h=true;d()});e("onblur",function(){h=false;d()});this.watch("disabled",d);this.watch("readOnly",d)}})};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dojo.AdapterRegistry"]){dojo._hasResource["dojo.AdapterRegistry"]=true;dojo.provide("dojo.AdapterRegistry");dojo.AdapterRegistry=function(b){this.pairs=[];this.returnWrappers=b||false};dojo.extend(dojo.AdapterRegistry,{register:function(b,a,c,d,e){this.pairs[e?"unshift":"push"]([b,a,c,d])},match:function(){for(var b=0;b<this.pairs.length;b++){var a=this.pairs[b];if(a[1].apply(this,arguments))return a[3]||this.returnWrappers?a[2]:a[2].apply(this,arguments)}throw Error("No match found");
},unregister:function(b){for(var a=0;a<this.pairs.length;a++)if(this.pairs[a][0]==b){this.pairs.splice(a,1);return true}return false}})};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dojo.back"]){dojo._hasResource["dojo.back"]=true;dojo.provide("dojo.back");dojo.getObject("back",true,dojo);(function(){function h(){var a=c.pop();if(a){var b=c[c.length-1];if(!b&&c.length==0)b=j;if(b)if(b.kwArgs.back)b.kwArgs.back();else if(b.kwArgs.backButton)b.kwArgs.backButton();else b.kwArgs.handle&&b.kwArgs.handle("back");e.push(a)}}function m(){var a=e.pop();if(a){if(a.kwArgs.forward)a.kwArgs.forward();else if(a.kwArgs.forwardButton)a.kwArgs.forwardButton();else a.kwArgs.handle&&
a.kwArgs.handle("forward");c.push(a)}}function k(a,b,d){return{url:a,kwArgs:b,urlHash:d}}function n(a){a=a.split("?");return a.length<2?null:a[1]}function t(){var a=(dojo.config.dojoIframeHistoryUrl||dojo.moduleUrl("dojo","resources/iframe_history.html"))+"?"+(new Date).getTime();o=true;if(i)dojo.isWebKit?i.location=a:window.frames[i.name].location=a;return a}function y(){if(!p){var a=c.length,b=l();if((b===u||window.location.href==v)&&a==1)h();else{if(e.length>0)if(e[e.length-1].urlHash===b){m();
return}a>=2&&c[a-2]&&c[a-2].urlHash===b&&h()}}}var f=dojo.back,l=f.getHash=function(){var a=window.location.hash;if(a.charAt(0)=="#")a=a.substring(1);return dojo.isMozilla?a:decodeURIComponent(a)},q=f.setHash=function(a){a||(a="");window.location.hash=encodeURIComponent(a)},v=typeof window!=="undefined"?window.location.href:"",u=typeof window!=="undefined"?l():"",j=null,w=null,r=null,i=null,e=[],c=[],o=false,p=false;f.goBack=h;f.goForward=m;f.init=function(){if(!dojo.byId("dj_history")){var a=dojo.config.dojoIframeHistoryUrl||
dojo.moduleUrl("dojo","resources/iframe_history.html");dojo._postLoad?console.error("dojo.back.init() must be called before the DOM has loaded. If using xdomain loading or djConfig.debugAtAllCosts, include dojo.back in a build layer."):document.write('<iframe style="border:0;width:1px;height:1px;position:absolute;visibility:hidden;bottom:0;right:0;" name="dj_history" id="dj_history" src="'+a+'"></iframe>')}};f.setInitialState=function(a){j=k(v,a,u)};f.addToHistory=function(a){e=[];var b=null,d=null;
if(!i){dojo.config.useXDomain&&!dojo.config.dojoIframeHistoryUrl&&console.warn("dojo.back: When using cross-domain Dojo builds, please save iframe_history.html to your domain and set djConfig.dojoIframeHistoryUrl to the path on your domain to iframe_history.html");i=window.frames.dj_history}r||(r=dojo.create("a",{style:{display:"none"}},dojo.body()));if(a.changeUrl){b=""+(a.changeUrl!==true?a.changeUrl:(new Date).getTime());if(c.length==0&&j.urlHash==b){j=k(d,a,b);return}else if(c.length>0&&c[c.length-
1].urlHash==b){c[c.length-1]=k(d,a,b);return}p=true;setTimeout(function(){q(b);p=false},1);r.href=b;if(dojo.isIE){d=t();var z=a.back||a.backButton||a.handle,g=function(s){l()!=""&&setTimeout(function(){q(b)},1);z.apply(this,[s])};if(a.back)a.back=g;else if(a.backButton)a.backButton=g;else if(a.handle)a.handle=g;var x=a.forward||a.forwardButton||a.handle;g=function(s){l()!=""&&q(b);x&&x.apply(this,[s])};if(a.forward)a.forward=g;else if(a.forwardButton)a.forwardButton=g;else if(a.handle)a.handle=g}else dojo.isIE||
w||(w=setInterval(y,200))}else d=t();c.push(k(d,a,b))};f._iframeLoaded=function(a,b){var d=n(b.href);if(d==null)c.length==1&&h();else if(o)o=false;else if(c.length>=2&&d==n(c[c.length-2].url))h();else e.length>0&&d==n(e[e.length-1].url)&&m()}})()};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dojo.cache"]){dojo._hasResource["dojo.cache"]=true;dojo.provide("dojo.cache");var cache={};dojo.cache=function(a,b,c){if(typeof a=="string")a=dojo.moduleUrl(a,b);else{a=a;c=b}b=a.toString();a=c;if(c!=undefined&&!dojo.isString(c))a="value"in c?c.value:undefined;c=c&&c.sanitize?true:false;if(typeof a=="string")a=cache[b]=c?dojo.cache._sanitize(a):a;else if(a===null)delete cache[b];else{if(!(b in cache)){a=dojo._getText(b);cache[b]=c?dojo.cache._sanitize(a):a}a=cache[b]}return a};
dojo.cache._sanitize=function(a){if(a){a=a.replace(/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,"");var b=a.match(/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im);if(b)a=b[1]}else a="";return a}};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dojo.date"]){dojo._hasResource["dojo.date"]=true;dojo.provide("dojo.date");dojo.getObject("date",true,dojo);dojo.date.getDaysInMonth=function(b){var a=b.getMonth();if(a==1&&dojo.date.isLeapYear(b))return 29;return[31,28,31,30,31,30,31,31,30,31,30,31][a]};dojo.date.isLeapYear=function(b){b=b.getFullYear();return!(b%400)||!(b%4)&&!!(b%100)};dojo.date.getTimezoneName=function(b){var a=b.toString(),c="",d=a.indexOf("(");if(d>-1)c=a.substring(++d,a.indexOf(")"));else{d=/([A-Z\/]+) \d{4}$/;
if(a=a.match(d))c=a[1];else{a=b.toLocaleString();d=/ ([A-Z\/]+)$/;if(a=a.match(d))c=a[1]}}return c=="AM"||c=="PM"?"":c};dojo.date.compare=function(b,a,c){b=new Date(+b);a=new Date(+(a||new Date));if(c=="date"){b.setHours(0,0,0,0);a.setHours(0,0,0,0)}else if(c=="time"){b.setFullYear(0,0,0);a.setFullYear(0,0,0)}if(b>a)return 1;if(b<a)return-1;return 0};dojo.date.add=function(b,a,c){var d=new Date(+b),e=false,f="Date";switch(a){case "day":break;case "weekday":var g;if(a=c%5){a=a;g=parseInt(c/5)}else{a=
c>0?5:-5;g=c>0?(c-5)/5:(c+5)/5}var h=b.getDay(),i=0;if(h==6&&c>0)i=1;else if(h==0&&c<0)i=-1;h=h+a;if(h==0||h==6)i=c>0?2:-2;c=7*g+a+i;break;case "year":f="FullYear";e=true;break;case "week":c*=7;break;case "quarter":c*=3;case "month":e=true;f="Month";break;default:f="UTC"+a.charAt(0).toUpperCase()+a.substring(1)+"s"}f&&d["set"+f](d["get"+f]()+c);e&&d.getDate()<b.getDate()&&d.setDate(0);return d};dojo.date.difference=function(b,a,c){a=a||new Date;c=c||"day";var d=a.getFullYear()-b.getFullYear(),e=1;
switch(c){case "quarter":b=b.getMonth();a=a.getMonth();b=Math.floor(b/3)+1;a=Math.floor(a/3)+1;a+=d*4;e=a-b;break;case "weekday":d=Math.round(dojo.date.difference(b,a,"day"));c=parseInt(dojo.date.difference(b,a,"week"));e=d%7;if(e==0)d=c*5;else{var f=0,g=b.getDay();a=a.getDay();c=parseInt(d/7);e=d%7;b=new Date(b);b.setDate(b.getDate()+c*7);b=b.getDay();if(d>0)switch(true){case g==6:f=-1;break;case g==0:f=0;break;case a==6:f=-1;break;case a==0:f=-2;break;case b+e>5:f=-2}else if(d<0)switch(true){case g==
6:f=0;break;case g==0:f=1;break;case a==6:f=2;break;case a==0:f=1;break;case b+e<0:f=2}d+=f;d-=c*2}e=d;break;case "year":e=d;break;case "month":e=a.getMonth()-b.getMonth()+d*12;break;case "week":e=parseInt(dojo.date.difference(b,a,"day")/7);break;case "day":e/=24;case "hour":e/=60;case "minute":e/=60;case "second":e/=1E3;case "millisecond":e*=a.getTime()-b.getTime()}return Math.round(e)}};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dojo.date.stamp"]){dojo._hasResource["dojo.date.stamp"]=true;dojo.provide("dojo.date.stamp");dojo.getObject("date.stamp",true,dojo);dojo.date.stamp.fromISOString=function(e,d){if(!dojo.date.stamp._isoRegExp)dojo.date.stamp._isoRegExp=/^(?:(\d{4})(?:-(\d{2})(?:-(\d{2}))?)?)?(?:T(\d{2}):(\d{2})(?::(\d{2})(.\d+)?)?((?:[+-](\d{2}):(\d{2}))|Z)?)?$/;var a=dojo.date.stamp._isoRegExp.exec(e),f=null;if(a){a.shift();a[1]&&a[1]--;if(a[6])a[6]*=1E3;if(d){d=new Date(d);dojo.forEach(dojo.map(["FullYear",
"Month","Date","Hours","Minutes","Seconds","Milliseconds"],function(g){return d["get"+g]()}),function(g,h){a[h]=a[h]||g})}f=new Date(a[0]||1970,a[1]||0,a[2]||1,a[3]||0,a[4]||0,a[5]||0,a[6]||0);if(a[0]<100)f.setFullYear(a[0]||1970);var b=0,c=a[7]&&a[7].charAt(0);if(c!="Z"){b=(a[8]||0)*60+(Number(a[9])||0);if(c!="-")b*=-1}if(c)b-=f.getTimezoneOffset();b&&f.setTime(f.getTime()+b*6E4)}return f};dojo.date.stamp.toISOString=function(e,d){var a=function(h){return h<10?"0"+h:h};d=d||{};var f=[],b=d.zulu?
"getUTC":"get",c="";if(d.selector!="time"){c=e[b+"FullYear"]();c=["0000".substr((c+"").length)+c,a(e[b+"Month"]()+1),a(e[b+"Date"]())].join("-")}f.push(c);if(d.selector!="date"){c=[a(e[b+"Hours"]()),a(e[b+"Minutes"]()),a(e[b+"Seconds"]())].join(":");b=e[b+"Milliseconds"]();if(d.milliseconds)c+="."+(b<100?"0":"")+a(b);if(d.zulu)c+="Z";else if(d.selector!="time"){b=e.getTimezoneOffset();var g=Math.abs(b);c+=(b>0?"-":"+")+a(Math.floor(g/60))+":"+a(g%60)}f.push(c)}return f.join("T")}};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dojo.dnd.common"]){dojo._hasResource["dojo.dnd.common"]=true;dojo.provide("dojo.dnd.common");dojo.getObject("dnd",true,dojo);dojo.dnd.getCopyKeyState=dojo.isCopyKey;dojo.dnd._uniqueId=0;dojo.dnd.getUniqueId=function(){var a;do a=dojo._scopeName+"Unique"+ ++dojo.dnd._uniqueId;while(dojo.byId(a));return a};dojo.dnd._empty={};dojo.dnd.isFormElement=function(a){a=a.target;if(a.nodeType==3)a=a.parentNode;return" button textarea input select option ".indexOf(" "+a.tagName.toLowerCase()+
" ")>=0}};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dojo.fx.Toggler"]){dojo._hasResource["dojo.fx.Toggler"]=true;dojo.provide("dojo.fx.Toggler");dojo.declare("dojo.fx.Toggler",null,{node:null,showFunc:dojo.fadeIn,hideFunc:dojo.fadeOut,showDuration:200,hideDuration:200,constructor:function(b){var a=this;dojo.mixin(a,b);a.node=b.node;a._showArgs=dojo.mixin({},b);a._showArgs.node=a.node;a._showArgs.duration=a.showDuration;a.showAnim=a.showFunc(a._showArgs);a._hideArgs=dojo.mixin({},b);a._hideArgs.node=a.node;a._hideArgs.duration=
a.hideDuration;a.hideAnim=a.hideFunc(a._hideArgs);dojo.connect(a.showAnim,"beforeBegin",dojo.hitch(a.hideAnim,"stop",true));dojo.connect(a.hideAnim,"beforeBegin",dojo.hitch(a.showAnim,"stop",true))},show:function(b){return this.showAnim.play(b||0)},hide:function(b){return this.hideAnim.play(b||0)}})};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dojo.hash"]){dojo._hasResource["dojo.hash"]=true;dojo.provide("dojo.hash");(function(){function m(a,b){var e=a.indexOf(b);return e>=0?a.substring(e+1):""}function d(){return m(location.href,"#")}function i(){dojo.publish("/dojo/hashchange",[d()])}function o(){if(d()!==c){c=d();i()}}function p(a){if(g)if(g.isTransitioning())setTimeout(dojo.hitch(null,p,a),j);else{var b=g.iframe.location.href,e=b.indexOf("?");g.iframe.location.replace(b.substring(0,e)+"?"+a)}else{location.replace("#"+
a);!q&&o()}}function u(){function a(){c=d();r=f?c:m(n.href,"?");k=false;l=null}var b=document.createElement("iframe"),e=dojo.config.dojoBlankHtmlUrl||dojo.moduleUrl("dojo","resources/blank.html");dojo.config.useXDomain&&!dojo.config.dojoBlankHtmlUrl&&console.warn("dojo.hash: When using cross-domain Dojo builds, please save dojo/resources/blank.html to your domain and set djConfig.dojoBlankHtmlUrl to the path on your domain to blank.html");b.id="dojo-hash-iframe";b.src=e+"?"+d();b.style.display="none";
document.body.appendChild(b);this.iframe=dojo.global["dojo-hash-iframe"];var r,k,l,s,f,n=this.iframe.location;this.isTransitioning=function(){return k};this.pollLocation=function(){if(!f)try{var t=m(n.href,"?");if(document.title!=s)s=this.iframe.document.title=document.title}catch(v){f=true;console.error("dojo.hash: Error adding history entry. Server unreachable.")}var h=d();if(k&&c===h)if(f||t===l){a();i()}else{setTimeout(dojo.hitch(this,this.pollLocation),0);return}else if(!(c===h&&(f||r===t)))if(c!==
h){c=h;k=true;l=h;b.src=e+"?"+l;f=false;setTimeout(dojo.hitch(this,this.pollLocation),0);return}else if(!f){location.href="#"+n.search.substring(1);a();i()}setTimeout(dojo.hitch(this,this.pollLocation),j)};a();setTimeout(dojo.hitch(this,this.pollLocation),j)}dojo.hash=function(a,b){if(!arguments.length)return d();if(a.charAt(0)=="#")a=a.substring(1);if(b)p(a);else location.href="#"+a;return a};var c,g,q,j=dojo.config.hashPollFrequency||100;dojo.addOnLoad(function(){if("onhashchange"in dojo.global&&
(!dojo.isIE||dojo.isIE>=8&&document.compatMode!="BackCompat"))q=dojo.connect(dojo.global,"onhashchange",i);else if(document.addEventListener){c=d();setInterval(o,j)}else if(document.attachEvent)g=new u})})()};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dojo.i18n"]){dojo._hasResource["dojo.i18n"]=true;dojo.provide("dojo.i18n");dojo.getObject("i18n",true,dojo);dojo.i18n.getLocalization=dojo.i18n.getLocalization||function(a,f,d){d=dojo.i18n.normalizeLocale(d);var e=d.split("-"),b=[a,"nls",f].join(".");if(b=dojo._loadedModules[b]){for(var c,h=e.length;h>0;h--){var g=e.slice(0,h).join("_");if(b[g]){c=b[g];break}}if(!c)c=b.ROOT;if(c){a=function(){};a.prototype=c;return new a}}throw Error("Bundle not found: "+f+" in "+a+" , locale="+
d);};dojo.i18n.normalizeLocale=function(a){a=a?a.toLowerCase():dojo.locale;if(a=="root")a="ROOT";return a};dojo.i18n._requireLocalization=function(a,f,d,e){d=dojo.i18n.normalizeLocale(d);var b=[a,"nls",f].join("."),c="";if(e){for(var h=e.split(","),g=0;g<h.length;g++)if(d.indexOf(h[g])==0)if(h[g].length>c.length)c=h[g];c||(c="ROOT")}h=e?c:d;var i=dojo._loadedModules[b];g=null;if(i){if(dojo.config.localizationComplete&&i._built)return;g=h.replace(/-/g,"_");g=dojo._loadedModules[b+"."+g]}if(!g){i=dojo.provide(b);
var r=dojo._getModuleSymbols(a).concat("nls").join("/"),n;dojo.i18n._searchLocalePath(h,e,function(l){var j=l.replace(/-/g,"_"),k=b+"."+j,o=false;if(dojo._loadedModules[k])o=true;else{dojo.provide(k);k=[r];l!="ROOT"&&k.push(l);k.push(f);l=k.join("/")+".js";o=dojo._loadPath(l,null,function(m){m=m.root||m;var p=function(){};p.prototype=n;i[j]=new p;for(var q in m)i[j][q]=m[q]})}if(o&&i[j])n=i[j];else i[j]=n;if(e)return true})}if(e&&d!=c)i[d.replace(/-/g,"_")]=i[c.replace(/-/g,"_")]};(function(){var a=
dojo.config.extraLocale;if(a){if(!a instanceof Array)a=[a];var f=dojo.i18n._requireLocalization;dojo.i18n._requireLocalization=function(d,e,b,c){f(d,e,b,c);if(!b)for(b=0;b<a.length;b++)f(d,e,a[b],c)}}})();dojo.i18n._searchLocalePath=function(a,f,d){a=dojo.i18n.normalizeLocale(a);var e=a.split("-");a=[];for(var b=e.length;b>0;b--)a.push(e.slice(0,b).join("-"));a.push(false);f&&a.reverse();for(f=a.length-1;f>=0;f--)if(d(a[f]||"ROOT"))break};dojo.i18n._preloadLocalizations=function(a,f){function d(c){c=
dojo.i18n.normalizeLocale(c);dojo.i18n._searchLocalePath(c,true,function(h){for(var g=0;g<f.length;g++)if(f[g]==h){dojo.require(a+"_"+h);return true}return false})}d();for(var e=dojo.config.extraLocale||[],b=0;b<e.length;b++)d(e[b])}};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dojo.regexp"]){dojo._hasResource["dojo.regexp"]=true;dojo.provide("dojo.regexp");dojo.getObject("regexp",true,dojo);dojo.regexp.escapeString=function(a,b){return a.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g,function(c){if(b&&b.indexOf(c)!=-1)return c;return"\\"+c})};dojo.regexp.buildGroupRE=function(a,b,c){if(!(a instanceof Array))return b(a);for(var e=[],d=0;d<a.length;d++)e.push(b(a[d]));return dojo.regexp.group(e.join("|"),c)};dojo.regexp.group=function(a,b){return"("+(b?"?:":
"")+a+")"}};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dojo.Stateful"]){dojo._hasResource["dojo.Stateful"]=true;dojo.provide("dojo.Stateful");dojo.declare("dojo.Stateful",null,{postscript:function(a){a&&dojo.mixin(this,a)},get:function(a){return this[a]},set:function(a,c){if(typeof a==="object"){for(var b in a)this.set(b,a[b]);return this}b=this[a];this[a]=c;this._watchCallbacks&&this._watchCallbacks(a,b,c);return this},watch:function(a,c){var b=this._watchCallbacks;if(!b){var i=this;b=this._watchCallbacks=function(g,j,k,l){var h=
function(d){if(d){d=d.slice();for(var f=0,m=d.length;f<m;f++)try{d[f].call(i,g,j,k)}catch(n){console.error(n)}}};h(b["_"+g]);l||h(b["*"])}}if(!c&&typeof a==="function"){c=a;a="*"}else a="_"+a;var e=b[a];if(typeof e!=="object")e=b[a]=[];e.push(c);return{unwatch:function(){e.splice(dojo.indexOf(e,c),1)}}}})};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dojo.store.Observable"]){dojo._hasResource["dojo.store.Observable"]=true;dojo.provide("dojo.store.Observable");dojo.store.Observable=function(a){function p(b,f){var d=a[b];if(d)a[b]=function(g){if(q)return d.apply(this,arguments);q=true;try{return dojo.when(d.apply(this,arguments),function(c){f(typeof c=="object"&&c||g);return c})}finally{q=false}}}var n=[],r=0;a.notify=function(b,f){r++;for(var d=n.slice(),g=0,c=d.length;g<c;g++)d[g](b,f)};var w=a.query;a.query=function(b,
f){f=f||{};var d=w.apply(this,arguments);if(d&&d.forEach){var g=dojo.mixin({},f);delete g.start;delete g.count;var c=a.queryEngine&&a.queryEngine(b,g),x=r,m=[],s;d.observe=function(o,y){if(m.push(o)==1)n.push(s=function(h,t){dojo.when(d,function(e){var z=e.length!=f.count,i;if(++x!=r)throw Error("Query is out of date, you must observe() the query prior to any data modifications");var u,j=-1,k=-1;if(t){i=0;for(l=e.length;i<l;i++){var v=e[i];if(a.getIdentity(v)==t){u=v;j=i;if(c||!h)e.splice(i,1);break}}}if(c){if(h&&
(c.matches?c.matches(h):c([h]).length)){j>-1?e.splice(j,0,h):e.push(h);k=dojo.indexOf(c(e),h);if(f.start&&k==0||!z&&k==e.length-1)k=-1}}else if(h)k=j>=0?j:a.defaultIndex||0;if((j>-1||k>-1)&&(y||!c||j!=k)){e=m.slice();for(i=0;o=e[i];i++)o(h||u,j,k)}})});return{cancel:function(){m.splice(dojo.indexOf(m,o),1);m.length||n.splice(dojo.indexOf(n,s),1)}}}}return d};var q;p("put",function(b){a.notify(b,a.getIdentity(b))});p("add",function(b){a.notify(b)});p("remove",function(b){a.notify(undefined,b)});return a}};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dojo.store.util.QueryResults"]){dojo._hasResource["dojo.store.util.QueryResults"]=true;dojo.provide("dojo.store.util.QueryResults");dojo.getObject("store.util",true,dojo);dojo.store.util.QueryResults=function(a){function c(b){a[b]||(a[b]=function(){var d=arguments;return dojo.when(a,function(e){Array.prototype.unshift.call(d,e);return dojo.store.util.QueryResults(dojo[b].apply(dojo,d))})})}if(!a)return a;if(a.then)a=dojo.delegate(a);c("forEach");c("filter");c("map");if(!a.total)a.total=
dojo.when(a,function(b){return b.length});return a}};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dojo.store.util.SimpleQueryEngine"]){dojo._hasResource["dojo.store.util.SimpleQueryEngine"]=true;dojo.provide("dojo.store.util.SimpleQueryEngine");dojo.getObject("store.util",true,dojo);dojo.store.util.SimpleQueryEngine=function(b,c){function g(a){a=dojo.filter(a,b);c&&c.sort&&a.sort(function(d,l){for(var f,h=0;f=c.sort[h];h++){var i=d[f.attribute],j=l[f.attribute];if(i!=j)return!!f.descending==i>j?-1:1}return 0});if(c&&(c.start||c.count)){var e=a.length;a=a.slice(c.start||
0,(c.start||0)+(c.count||Infinity));a.total=e}return a}switch(typeof b){default:throw Error("Can not query with a "+typeof b);case "object":case "undefined":var k=b;b=function(a){for(var e in k){var d=k[e];if(d&&d.test){if(!d.test(a[e]))return false}else if(d!=a[e])return false}return true};break;case "string":if(!this[b])throw Error("No filter function "+b+" was found in store");b=this[b];case "function":}g.matches=b;return g}};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dojo.string"]){dojo._hasResource["dojo.string"]=true;dojo.provide("dojo.string");dojo.getObject("string",true,dojo);dojo.string.rep=function(a,b){if(b<=0||!a)return"";for(var c=[];;){b&1&&c.push(a);if(!(b>>=1))break;a+=a}return c.join("")};dojo.string.pad=function(a,b,c,d){c||(c="0");a=String(a);b=dojo.string.rep(c,Math.ceil((b-a.length)/c.length));return d?a+b:b+a};dojo.string.substitute=function(a,b,c,d){d=d||dojo.global;c=c?dojo.hitch(d,c):function(e){return e};return a.replace(/\$\{([^\s\:\}]+)(?:\:([^\s\:\}]+))?\}/g,
function(e,f,g){e=dojo.getObject(f,false,b);if(g)e=dojo.getObject(g,false,d).call(d,e,f);return c(e,f).toString()})};dojo.string.trim=String.prototype.trim?dojo.trim:function(a){a=a.replace(/^\s+/,"");for(var b=a.length-1;b>=0;b--)if(/\S/.test(a.charAt(b))){a=a.substring(0,b+1);break}return a}};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dojo.uacss"]){dojo._hasResource["dojo.uacss"]=true;dojo.provide("dojo.uacss");(function(){var a=dojo,d=a.doc.documentElement,b=a.isIE,g=a.isOpera,c=Math.floor,h=a.isFF,i=a.boxModel.replace(/-/,"");b={dj_ie:b,dj_ie6:c(b)==6,dj_ie7:c(b)==7,dj_ie8:c(b)==8,dj_ie9:c(b)==9,dj_quirks:a.isQuirks,dj_iequirks:b&&a.isQuirks,dj_opera:g,dj_khtml:a.isKhtml,dj_webkit:a.isWebKit,dj_safari:a.isSafari,dj_chrome:a.isChrome,dj_gecko:a.isMozilla,dj_ff3:c(h)==3};b["dj_"+i]=true;var e="",f;for(f in b)if(b[f])e+=
f+" ";d.className=a.trim(d.className+" "+e);dojo._loaders.unshift(function(){if(!dojo._isBodyLtr()){var j="dj_rtl dijitRtl "+e.replace(/ /g,"-rtl ");d.className=a.trim(d.className+" "+j)}})})()};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dojo.window"]){dojo._hasResource["dojo.window"]=true;dojo.provide("dojo.window");dojo.getObject("window",true,dojo);dojo.window.getBox=function(){var b=dojo.doc.compatMode=="BackCompat"?dojo.body():dojo.doc.documentElement,i=dojo._docScroll();return{w:b.clientWidth,h:b.clientHeight,l:i.x,t:i.y}};dojo.window.get=function(b){if(dojo.isIE&&window!==document.parentWindow){b.parentWindow.execScript("document._parentWindow = window;","Javascript");var i=b._parentWindow;b._parentWindow=
null;return i}return b.parentWindow||b.defaultView};dojo.window.scrollIntoView=function(b,i){try{b=dojo.byId(b);var d=b.ownerDocument||dojo.doc,j=d.body||dojo.body(),o=d.documentElement||j.parentNode,f=dojo.isIE,e=dojo.isWebKit;if((!(dojo.isMoz||f||e||dojo.isOpera)||b==j||b==o)&&typeof b.scrollIntoView!="undefined")b.scrollIntoView(false);else{var p=d.compatMode=="BackCompat";d=p?j:o;e=e?j:d;var q=d.clientWidth,r=d.clientHeight,s=!dojo._isBodyLtr(),g=i||dojo.position(b),c=b.parentNode;d=function(x){return f<=
6||f&&p?false:dojo.style(x,"position").toLowerCase()=="fixed"};if(!d(b))for(;c;){if(c==j)c=e;var a=dojo.position(c),t=d(c);if(c==e){a.w=q;a.h=r;if(e==o&&f&&s)a.x+=e.offsetWidth-a.w;if(a.x<0||!f)a.x=0;if(a.y<0||!f)a.y=0}else{var k=dojo._getPadBorderExtents(c);a.w-=k.w;a.h-=k.h;a.x+=k.l;a.y+=k.t}if(c!=e){var h=c.clientWidth,l=a.w-h;if(h>0&&l>0){a.w=h;if(f&&s)a.x+=l}h=c.clientHeight;l=a.h-h;if(h>0&&l>0)a.h=h}if(t){if(a.y<0){a.h+=a.y;a.y=0}if(a.x<0){a.w+=a.x;a.x=0}if(a.y+a.h>r)a.h=r-a.y;if(a.x+a.w>q)a.w=
q-a.x}var m=g.x-a.x,n=g.y-Math.max(a.y,0),u=m+g.w-a.w,v=n+g.h-a.h;if(u*m>0){var w=Math[m<0?"max":"min"](m,u);g.x+=c.scrollLeft;c.scrollLeft+=f>=8&&!p&&s?-w:w;g.x-=c.scrollLeft}if(v*n>0){g.y+=c.scrollTop;c.scrollTop+=Math[n<0?"max":"min"](n,v);g.y-=c.scrollTop}c=c!=e&&!t&&c.parentNode}}}catch(y){console.error("scrollIntoView: "+y);b.scrollIntoView(false)}}};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dijit._base.scroll"]){dojo._hasResource["dijit._base.scroll"]=true;dojo.provide("dijit._base.scroll");dojo.require("dojo.window");dijit.scrollIntoView=function(a,b){dojo.window.scrollIntoView(a,b)}};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dijit._base.sniff"]){dojo._hasResource["dijit._base.sniff"]=true;dojo.provide("dijit._base.sniff");dojo.require("dojo.uacss")};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dijit._base.window"]){dojo._hasResource["dijit._base.window"]=true;dojo.provide("dijit._base.window");dojo.require("dojo.window");dijit.getDocumentWindow=function(a){return dojo.window.get(a)}};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dijit._KeyNavContainer"]){dojo._hasResource["dijit._KeyNavContainer"]=true;dojo.provide("dijit._KeyNavContainer");dojo.require("dijit._Container");dojo.declare("dijit._KeyNavContainer",dijit._Container,{tabIndex:"0",_keyNavCodes:{},connectKeyNavHandlers:function(a,b){var c=this._keyNavCodes={},d=dojo.hitch(this,this.focusPrev),f=dojo.hitch(this,this.focusNext);dojo.forEach(a,function(e){c[e]=d});dojo.forEach(b,function(e){c[e]=f});c[dojo.keys.HOME]=dojo.hitch(this,"focusFirstChild");
c[dojo.keys.END]=dojo.hitch(this,"focusLastChild");this.connect(this.domNode,"onkeypress","_onContainerKeypress");this.connect(this.domNode,"onfocus","_onContainerFocus")},startupKeyNavChildren:function(){dojo.forEach(this.getChildren(),dojo.hitch(this,"_startupChild"))},addChild:function(a){dijit._KeyNavContainer.superclass.addChild.apply(this,arguments);this._startupChild(a)},focus:function(){this.focusFirstChild()},focusFirstChild:function(){var a=this._getFirstFocusableChild();a&&this.focusChild(a)},
focusLastChild:function(){var a=this._getLastFocusableChild();a&&this.focusChild(a)},focusNext:function(){this.focusChild(this._getNextFocusableChild(this.focusedChild,1))},focusPrev:function(){this.focusChild(this._getNextFocusableChild(this.focusedChild,-1),true)},focusChild:function(a,b){this.focusedChild&&a!==this.focusedChild&&this._onChildBlur(this.focusedChild);a.focus(b?"end":"start");this._set("focusedChild",a)},_startupChild:function(a){a.set("tabIndex","-1");this.connect(a,"_onFocus",function(){a.set("tabIndex",
this.tabIndex)});this.connect(a,"_onBlur",function(){a.set("tabIndex","-1")})},_onContainerFocus:function(a){if(a.target===this.domNode){this.focusFirstChild();dojo.attr(this.domNode,"tabIndex","-1")}},_onBlur:function(){this.tabIndex&&dojo.attr(this.domNode,"tabIndex",this.tabIndex);this.inherited(arguments)},_onContainerKeypress:function(a){if(!(a.ctrlKey||a.altKey)){var b=this._keyNavCodes[a.charOrCode];if(b){b();dojo.stopEvent(a)}}},_onChildBlur:function(){},_getFirstFocusableChild:function(){return this._getNextFocusableChild(null,
1)},_getLastFocusableChild:function(){return this._getNextFocusableChild(null,-1)},_getNextFocusableChild:function(a,b){if(a)a=this._getSiblingOfChild(a,b);for(var c=this.getChildren(),d=0;d<c.length;d++){a||(a=c[b>0?0:c.length-1]);if(a.isFocusable())return a;a=this._getSiblingOfChild(a,b)}return null}})};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dijit.form._FormMixin"]){dojo._hasResource["dijit.form._FormMixin"]=true;dojo.provide("dijit.form._FormMixin");dojo.require("dojo.window");dojo.declare("dijit.form._FormMixin",null,{state:"",reset:function(){dojo.forEach(this.getDescendants(),function(b){b.reset&&b.reset()})},validate:function(){var b=false;return dojo.every(dojo.map(this.getDescendants(),function(a){a._hasBeenBlurred=true;var c=a.disabled||!a.validate||a.validate();if(!c&&!b){dojo.window.scrollIntoView(a.containerNode||
a.domNode);a.focus();b=true}return c}),function(a){return a})},setValues:function(b){dojo.deprecated(this.declaredClass+"::setValues() is deprecated. Use set('value', val) instead.","","2.0");return this.set("value",b)},_setValueAttr:function(b){var a={};dojo.forEach(this.getDescendants(),function(d){if(d.name)(a[d.name]||(a[d.name]=[])).push(d)});for(var c in a)if(a.hasOwnProperty(c)){var e=a[c],f=dojo.getObject(c,false,b);if(f!==undefined){dojo.isArray(f)||(f=[f]);if(typeof e[0].checked=="boolean")dojo.forEach(e,
function(d){d.set("value",dojo.indexOf(f,d.value)!=-1)});else e[0].multiple?e[0].set("value",f):dojo.forEach(e,function(d,g){d.set("value",f[g])})}}},getValues:function(){dojo.deprecated(this.declaredClass+"::getValues() is deprecated. Use get('value') instead.","","2.0");return this.get("value")},_getValueAttr:function(){var b={};dojo.forEach(this.getDescendants(),function(a){var c=a.name;if(!(!c||a.disabled)){var e=a.get("value");if(typeof a.checked=="boolean")if(/Radio/.test(a.declaredClass))if(e!==
false)dojo.setObject(c,e,b);else{e=dojo.getObject(c,false,b);e===undefined&&dojo.setObject(c,null,b)}else{a=dojo.getObject(c,false,b);if(!a){a=[];dojo.setObject(c,a,b)}e!==false&&a.push(e)}else{a=dojo.getObject(c,false,b);if(typeof a!="undefined")dojo.isArray(a)?a.push(e):dojo.setObject(c,[a,e],b);else dojo.setObject(c,e,b)}}});return b},isValid:function(){return this.state==""},onValidStateChange:function(){},_getState:function(){var b=dojo.map(this._descendants,function(a){return a.get("state")||
""});return dojo.indexOf(b,"Error")>=0?"Error":dojo.indexOf(b,"Incomplete")>=0?"Incomplete":""},disconnectChildren:function(){dojo.forEach(this._childConnections||[],dojo.hitch(this,"disconnect"));dojo.forEach(this._childWatches||[],function(b){b.unwatch()})},connectChildren:function(b){var a=this;this.disconnectChildren();this._descendants=this.getDescendants();b=b?function(d,g){a[d]=g}:dojo.hitch(this,"_set");b("value",this.get("value"));b("state",this._getState());var c=this._childConnections=
[],e=this._childWatches=[];dojo.forEach(dojo.filter(this._descendants,function(d){return d.validate}),function(d){dojo.forEach(["state","disabled"],function(g){e.push(d.watch(g,function(){a.set("state",a._getState())}))})});var f=function(){a._onChangeDelayTimer&&clearTimeout(a._onChangeDelayTimer);a._onChangeDelayTimer=setTimeout(function(){delete a._onChangeDelayTimer;a._set("value",a.get("value"))},10)};dojo.forEach(dojo.filter(this._descendants,function(d){return d.onChange}),function(d){c.push(a.connect(d,
"onChange",f));e.push(d.watch("disabled",f))})},startup:function(){this.inherited(arguments);this.connectChildren(true);this.watch("state",function(b,a,c){this.onValidStateChange(c=="")})},destroy:function(){this.disconnectChildren();this.inherited(arguments)}})};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dijit.layout._ContentPaneResizeMixin"]){dojo._hasResource["dijit.layout._ContentPaneResizeMixin"]=true;dojo.provide("dijit.layout._ContentPaneResizeMixin");dojo.require("dijit._Contained");dojo.declare("dijit.layout._ContentPaneResizeMixin",null,{doLayout:true,isContainer:true,isLayoutContainer:true,_startChildren:function(){dojo.forEach(this.getChildren(),function(a){a.startup();a._started=true})},startup:function(){if(!this._started){var a=dijit._Contained.prototype.getParent.call(this);
this._childOfLayoutWidget=a&&a.isLayoutContainer;this._needLayout=!this._childOfLayoutWidget;this.inherited(arguments);this._startChildren()}},_checkIfSingleChild:function(){var a=dojo.query("> *",this.containerNode).filter(function(b){return b.tagName!=="SCRIPT"}),c=a.filter(function(b){return dojo.hasAttr(b,"data-dojo-type")||dojo.hasAttr(b,"dojoType")||dojo.hasAttr(b,"widgetId")}),d=dojo.filter(c.map(dijit.byNode),function(b){return b&&b.domNode&&b.resize});if(a.length==c.length&&d.length==1)this._singleChild=
d[0];else delete this._singleChild;dojo.toggleClass(this.containerNode,this.baseClass+"SingleChild",!!this._singleChild)},resize:function(a,c){this._layout(a,c)},_layout:function(a,c){a&&dojo.marginBox(this.domNode,a);var d=this.containerNode;if(d===this.domNode){var b=c||{};dojo.mixin(b,a||{});if(!("h"in b)||!("w"in b))b=dojo.mixin(dojo.marginBox(d),b);this._contentBox=dijit.layout.marginBox2contentBox(d,b)}else this._contentBox=dojo.contentBox(d);this._layoutChildren();delete this._needLayout},
_layoutChildren:function(){this.doLayout&&this._checkIfSingleChild();if(this._singleChild&&this._singleChild.resize){var a=this._contentBox||dojo.contentBox(this.containerNode);this._singleChild.resize({w:a.w,h:a.h})}else dojo.forEach(this.getChildren(),function(c){c.resize&&c.resize()})}})};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dojo.cldr.supplemental"]){dojo._hasResource["dojo.cldr.supplemental"]=true;dojo.provide("dojo.cldr.supplemental");dojo.require("dojo.i18n");dojo.getObject("cldr.supplemental",true,dojo);dojo.cldr.supplemental.getFirstDayOfWeek=function(a){a={mv:5,ae:6,af:6,bh:6,dj:6,dz:6,eg:6,er:6,et:6,iq:6,ir:6,jo:6,ke:6,kw:6,ly:6,ma:6,om:6,qa:6,sa:6,sd:6,so:6,sy:6,tn:6,ye:6,ar:0,as:0,az:0,bw:0,ca:0,cn:0,fo:0,ge:0,gl:0,gu:0,hk:0,il:0,"in":0,jm:0,jp:0,kg:0,kr:0,la:0,mh:0,mn:0,mo:0,mp:0,mt:0,
nz:0,ph:0,pk:0,sg:0,th:0,tt:0,tw:0,um:0,us:0,uz:0,vi:0,zw:0}[dojo.cldr.supplemental._region(a)];return a===undefined?1:a};dojo.cldr.supplemental._region=function(a){a=dojo.i18n.normalizeLocale(a);a=a.split("-");var b=a[1];if(b){if(b.length==4)b=a[2]}else b={de:"de",en:"us",es:"es",fi:"fi",fr:"fr",he:"il",hu:"hu",it:"it",ja:"jp",ko:"kr",nl:"nl",pt:"br",sv:"se",zh:"cn"}[a[0]];return b};dojo.cldr.supplemental.getWeekend=function(a){var b=dojo.cldr.supplemental._region(a);a={"in":0,af:4,dz:4,ir:4,om:4,
sa:4,ye:4,ae:5,bh:5,eg:5,il:5,iq:5,jo:5,kw:5,ly:5,ma:5,qa:5,sd:5,sy:5,tn:5}[b];b={af:5,dz:5,ir:5,om:5,sa:5,ye:5,ae:6,bh:5,eg:6,il:6,iq:6,jo:6,kw:6,ly:6,ma:6,qa:6,sd:6,sy:6,tn:6}[b];if(a===undefined)a=6;if(b===undefined)b=0;return{start:a,end:b}}};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dojo.dnd.autoscroll"]){dojo._hasResource["dojo.dnd.autoscroll"]=true;dojo.provide("dojo.dnd.autoscroll");dojo.require("dojo.window");dojo.getObject("dnd",true,dojo);dojo.dnd.getViewport=dojo.window.getBox;dojo.dnd.V_TRIGGER_AUTOSCROLL=32;dojo.dnd.H_TRIGGER_AUTOSCROLL=32;dojo.dnd.V_AUTOSCROLL_VALUE=16;dojo.dnd.H_AUTOSCROLL_VALUE=16;dojo.dnd.autoScroll=function(d){var a=dojo.window.getBox(),b=0,c=0;if(d.clientX<dojo.dnd.H_TRIGGER_AUTOSCROLL)b=-dojo.dnd.H_AUTOSCROLL_VALUE;else if(d.clientX>
a.w-dojo.dnd.H_TRIGGER_AUTOSCROLL)b=dojo.dnd.H_AUTOSCROLL_VALUE;if(d.clientY<dojo.dnd.V_TRIGGER_AUTOSCROLL)c=-dojo.dnd.V_AUTOSCROLL_VALUE;else if(d.clientY>a.h-dojo.dnd.V_TRIGGER_AUTOSCROLL)c=dojo.dnd.V_AUTOSCROLL_VALUE;window.scrollBy(b,c)};dojo.dnd._validNodes={div:1,p:1,td:1};dojo.dnd._validOverflow={auto:1,scroll:1};dojo.dnd.autoScrollNodes=function(d){for(var a=d.target;a;){if(a.nodeType==1&&a.tagName.toLowerCase()in dojo.dnd._validNodes){var b=dojo.getComputedStyle(a);if(b.overflow.toLowerCase()in
dojo.dnd._validOverflow){var c=dojo._getContentBox(a,b);b=dojo.position(a,true);var e=Math.min(dojo.dnd.H_TRIGGER_AUTOSCROLL,c.w/2),h=Math.min(dojo.dnd.V_TRIGGER_AUTOSCROLL,c.h/2),f=d.pageX-b.x,g=d.pageY-b.y,i=b=0;if(dojo.isWebKit||dojo.isOpera){f+=dojo.body().scrollLeft;g+=dojo.body().scrollTop}if(f>0&&f<c.w)if(f<e)b=-e;else if(f>c.w-e)b=e;if(g>0&&g<c.h)if(g<h)i=-h;else if(g>c.h-h)i=h;c=a.scrollLeft;e=a.scrollTop;a.scrollLeft+=b;a.scrollTop+=i;if(c!=a.scrollLeft||e!=a.scrollTop)return}}try{a=a.parentNode}catch(j){a=
null}}dojo.dnd.autoScroll(d)}};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dojo.fx"]){dojo._hasResource["dojo.fx"]=true;dojo.provide("dojo.fx");dojo.require("dojo.fx.Toggler");(function(){var a=dojo,k={_fire:function(b,d){if(this[b])this[b].apply(this,d||[]);return this}},i=function(b){this._index=-1;this._animations=b||[];this._current=this._onAnimateCtx=this._onEndCtx=null;this.duration=0;a.forEach(this._animations,function(d){this.duration+=d.duration;if(d.delay)this.duration+=d.delay},this)};a.extend(i,{_onAnimate:function(){this._fire("onAnimate",
arguments)},_onEnd:function(){a.disconnect(this._onAnimateCtx);a.disconnect(this._onEndCtx);this._onAnimateCtx=this._onEndCtx=null;if(this._index+1==this._animations.length)this._fire("onEnd");else{this._current=this._animations[++this._index];this._onAnimateCtx=a.connect(this._current,"onAnimate",this,"_onAnimate");this._onEndCtx=a.connect(this._current,"onEnd",this,"_onEnd");this._current.play(0,true)}},play:function(b,d){if(!this._current)this._current=this._animations[this._index=0];if(!d&&this._current.status()==
"playing")return this;var c=a.connect(this._current,"beforeBegin",this,function(){this._fire("beforeBegin")}),e=a.connect(this._current,"onBegin",this,function(){this._fire("onBegin",arguments)}),f=a.connect(this._current,"onPlay",this,function(){this._fire("onPlay",arguments);a.disconnect(c);a.disconnect(e);a.disconnect(f)});this._onAnimateCtx&&a.disconnect(this._onAnimateCtx);this._onAnimateCtx=a.connect(this._current,"onAnimate",this,"_onAnimate");this._onEndCtx&&a.disconnect(this._onEndCtx);this._onEndCtx=
a.connect(this._current,"onEnd",this,"_onEnd");this._current.play.apply(this._current,arguments);return this},pause:function(){if(this._current){var b=a.connect(this._current,"onPause",this,function(){this._fire("onPause",arguments);a.disconnect(b)});this._current.pause()}return this},gotoPercent:function(b,d){this.pause();var c=this.duration*b;this._current=null;a.some(this._animations,function(e){if(e.duration<=c){this._current=e;return true}c-=e.duration;return false});this._current&&this._current.gotoPercent(c/
this._current.duration,d);return this},stop:function(b){if(this._current){if(b){for(;this._index+1<this._animations.length;++this._index)this._animations[this._index].stop(true);this._current=this._animations[this._index]}var d=a.connect(this._current,"onStop",this,function(){this._fire("onStop",arguments);a.disconnect(d)});this._current.stop()}return this},status:function(){return this._current?this._current.status():"stopped"},destroy:function(){this._onAnimateCtx&&a.disconnect(this._onAnimateCtx);
this._onEndCtx&&a.disconnect(this._onEndCtx)}});a.extend(i,k);dojo.fx.chain=function(b){return new i(b)};var j=function(b){this._animations=b||[];this._connects=[];this.duration=this._finished=0;a.forEach(b,function(c){var e=c.duration;if(c.delay)e+=c.delay;if(this.duration<e)this.duration=e;this._connects.push(a.connect(c,"onEnd",this,"_onEnd"))},this);this._pseudoAnimation=new a.Animation({curve:[0,1],duration:this.duration});var d=this;a.forEach(["beforeBegin","onBegin","onPlay","onAnimate","onPause",
"onStop","onEnd"],function(c){d._connects.push(a.connect(d._pseudoAnimation,c,function(){d._fire(c,arguments)}))})};a.extend(j,{_doAction:function(b,d){a.forEach(this._animations,function(c){c[b].apply(c,d)});return this},_onEnd:function(){++this._finished>this._animations.length&&this._fire("onEnd")},_call:function(b,d){var c=this._pseudoAnimation;c[b].apply(c,d)},play:function(){this._finished=0;this._doAction("play",arguments);this._call("play",arguments);return this},pause:function(){this._doAction("pause",
arguments);this._call("pause",arguments);return this},gotoPercent:function(b,d){var c=this.duration*b;a.forEach(this._animations,function(e){e.gotoPercent(e.duration<c?1:c/e.duration,d)});this._call("gotoPercent",arguments);return this},stop:function(){this._doAction("stop",arguments);this._call("stop",arguments);return this},status:function(){return this._pseudoAnimation.status()},destroy:function(){a.forEach(this._connects,dojo.disconnect)}});a.extend(j,k);dojo.fx.combine=function(b){return new j(b)};
dojo.fx.wipeIn=function(b){var d=b.node=a.byId(b.node),c=d.style,e;b=a.animateProperty(a.mixin({properties:{height:{start:function(){e=c.overflow;c.overflow="hidden";if(c.visibility=="hidden"||c.display=="none"){c.height="1px";c.display="";c.visibility="";return 1}else{var f=a.style(d,"height");return Math.max(f,1)}},end:function(){return d.scrollHeight}}}},b));a.connect(b,"onEnd",function(){c.height="auto";c.overflow=e});return b};dojo.fx.wipeOut=function(b){var d=(b.node=a.byId(b.node)).style,c;
b=a.animateProperty(a.mixin({properties:{height:{end:1}}},b));a.connect(b,"beforeBegin",function(){c=d.overflow;d.overflow="hidden";d.display=""});a.connect(b,"onEnd",function(){d.overflow=c;d.height="auto";d.display="none"});return b};dojo.fx.slideTo=function(b){var d=null,c=null,e=function(f){return function(){var g=a.getComputedStyle(f),h=g.position;d=h=="absolute"?f.offsetTop:parseInt(g.top)||0;c=h=="absolute"?f.offsetLeft:parseInt(g.left)||0;if(h!="absolute"&&h!="relative"){g=a.position(f,true);
d=g.y;c=g.x;f.style.position="absolute";f.style.top=d+"px";f.style.left=c+"px"}}}(b.node=a.byId(b.node));e();b=a.animateProperty(a.mixin({properties:{top:b.top||0,left:b.left||0}},b));a.connect(b,"beforeBegin",b,e);return b}})()};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dojo.parser"]){dojo._hasResource["dojo.parser"]=true;dojo.provide("dojo.parser");dojo.require("dojo.date.stamp");dojo.parser=new function(){function s(a){if(d.isString(a))return"string";if(typeof a=="number")return"number";if(typeof a=="boolean")return"boolean";if(d.isFunction(a))return"function";if(d.isArray(a))return"array";if(a instanceof Date)return"date";if(a instanceof d._Url)return"url";return"object"}function B(a,b){switch(b){case "string":return a;case "number":return a.length?
Number(a):NaN;case "boolean":return typeof a=="boolean"?a:a.toLowerCase()!="false";case "function":if(d.isFunction(a)){a=a.toString();a=d.trim(a.substring(a.indexOf("{")+1,a.length-1))}try{return a===""||a.search(/[^\w\.]+/i)!=-1?new Function(a):d.getObject(a,false)||new Function(a)}catch(c){return new Function}case "array":return a?a.split(/\s*,\s*/):[];case "date":switch(a){case "":return new Date("");case "now":return new Date;default:return d.date.stamp.fromISOString(a)}case "url":return d.baseUrl+
a;default:return d.fromJson(a)}}function x(a,b){for(var c in a)if(c.charAt(0)!="_")c in C||(b[c]=s(a[c]));return b}function v(a,b){var c=y[a];if(c){if(!b&&!c.params)c.params=x(c.cls.prototype,{})}else{c=d.getObject(a);var k=null;if(!c)return null;b||(k=x(c.prototype,{}));c={cls:c,params:k}}return c}var d=dojo,C={},y={};d.connect(d,"extend",function(){y={}});this._functionFromScript=function(a,b){var c="",k="",o=a.getAttribute(b+"args")||a.getAttribute("args");o&&d.forEach(o.split(/\s*,\s*/),function(n,
f){c+="var "+n+" = arguments["+f+"]; "});(o=a.getAttribute("with"))&&o.length&&d.forEach(o.split(/\s*,\s*/),function(n){c+="with("+n+"){";k+="}"});return new Function(c+a.innerHTML+k)};this.instantiate=function(a,b,c){var k=[];b=b||{};c=c||{};var o=(c.scope||d._scopeName)+"Type",n="data-"+(c.scope||d._scopeName)+"-";d.forEach(a,function(f){if(f){var e,i,g,l,q,j;if(f.node){e=f.node;i=f.type;j=f.fastpath;l=(g=f.clsInfo||i&&v(i,j))&&g.cls;q=f.scripts}else{e=f;q=(l=(g=(i=o in b?b[o]:e.getAttribute(o))&&
v(i))&&g.cls)&&(l._noScript||l.prototype._noScript)?[]:d.query("> script[type^='dojo/']",e)}if(!g)throw Error("Could not load class '"+i);var h={};c.defaults&&d._mixin(h,c.defaults);f.inherited&&d._mixin(h,f.inherited);if(j){if((g=e.getAttribute(n+"props"))&&g.length)try{g=d.fromJson.call(c.propsThis,"{"+g+"}");d._mixin(h,g)}catch(r){throw Error(r.toString()+" in data-dojo-props='"+g+"'");}if(g=e.getAttribute(n+"attach-point"))h.dojoAttachPoint=g;if(g=e.getAttribute(n+"attach-event"))h.dojoAttachEvent=
g;dojo.mixin(h,b)}else{f=e.attributes;for(var p in g.params){i=p in b?{value:b[p],specified:true}:f.getNamedItem(p);if(!(!i||!i.specified&&(!dojo.isIE||p.toLowerCase()!="value"))){i=i.value;switch(p){case "class":i="className"in b?b.className:e.className;break;case "style":i="style"in b?b.style:e.style&&e.style.cssText}var t=g.params[p];h[p]=typeof i=="string"?B(i,t):i}}}var z=[],A=[];d.forEach(q,function(m){e.removeChild(m);var w=m.getAttribute(n+"event")||m.getAttribute("event"),D=m.getAttribute("type");
m=d.parser._functionFromScript(m,n);if(w)if(D=="dojo/connect")z.push({event:w,func:m});else h[w]=m;else A.push(m)});var u=(q=l.markupFactory||l.prototype&&l.prototype.markupFactory)?q(h,e,l):new l(h,e);k.push(u);(l=e.getAttribute(n+"id")||e.getAttribute("jsId"))&&d.setObject(l,u);d.forEach(z,function(m){d.connect(u,m.event,null,m.func)});d.forEach(A,function(m){m.call(u)})}});b._started||d.forEach(k,function(f){if(!c.noStart&&f&&dojo.isFunction(f.startup)&&!f._started&&(!f.getParent||!f.getParent()))f.startup()});
return k};this.parse=function(a,b){function c(e,i){var g=dojo.clone(e.inherited);dojo.forEach(["dir","lang"],function(p){var t=e.node.getAttribute(p);if(t)g[p]=t});for(var l=e.clsInfo&&!e.clsInfo.cls.prototype._noScript?e.scripts:null,q=!e.clsInfo||!e.clsInfo.cls.prototype.stopParser||b&&b.template,j=e.node.firstChild;j;j=j.nextSibling)if(j.nodeType==1){var h,r=q&&j.getAttribute(n+"type");h=r?r:q&&j.getAttribute(o);r=r==h;if(h){h={type:h,fastpath:r,clsInfo:v(h,r),node:j,scripts:[],inherited:g};i.push(h);
c(h,i)}else if(l&&j.nodeName.toLowerCase()=="script")(h=j.getAttribute("type"))&&/^dojo\/\w/i.test(h)&&l.push(j);else q&&c({node:j,inherited:g},i)}}var k;if(!b&&a&&a.rootNode){b=a;k=b.rootNode}else k=a;b=b||{};var o=(b.scope||d._scopeName)+"Type",n="data-"+(b.scope||d._scopeName)+"-",f=[];c({node:k?dojo.byId(k):dojo.body(),inherited:b&&b.inherited||{dir:dojo._isBodyLtr()?"ltr":"rtl"}},f);return this.instantiate(f,b&&b.template?{template:true}:null,b)}};(function(){var s=function(){dojo.config.parseOnLoad&&
dojo.parser.parse()};dojo.getObject("dijit.wai.onload")===dojo._loaders[0]?dojo._loaders.splice(1,0,s):dojo._loaders.unshift(s)})()};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dojo.store.JsonRest"]){dojo._hasResource["dojo.store.JsonRest"]=true;dojo.provide("dojo.store.JsonRest");dojo.require("dojo.store.util.QueryResults");dojo.declare("dojo.store.JsonRest",null,{constructor:function(b){dojo.mixin(this,b)},target:"",idProperty:"id",get:function(b,a){var c=a||{};c.Accept="application/javascript, application/json";return dojo.xhrGet({url:this.target+b,handleAs:"json",headers:c})},getIdentity:function(b){return b[this.idProperty]},put:function(b,a){a=
a||{};var c="id"in a?a.id:this.getIdentity(b),d=typeof c!="undefined";return dojo.xhr(d&&!a.incremental?"PUT":"POST",{url:d?this.target+c:this.target,postData:dojo.toJson(b),handleAs:"json",headers:{"Content-Type":"application/json","If-Match":a.overwrite===true?"*":null,"If-None-Match":a.overwrite===false?"*":null}})},add:function(b,a){a=a||{};a.overwrite=false;return this.put(b,a)},remove:function(b){return dojo.xhrDelete({url:this.target+b})},query:function(b,a){var c={Accept:"application/javascript, application/json"};
a=a||{};if(a.start>=0||a.count>=0)c.Range="items="+(a.start||"0")+"-"+("count"in a&&a.count!=Infinity?a.count+(a.start||0)-1:"");if(dojo.isObject(b))b=(b=dojo.objectToQuery(b))?"?"+b:"";if(a&&a.sort){b+=(b?"&":"?")+"sort(";for(var d=0;d<a.sort.length;d++){var g=a.sort[d];b+=(d>0?",":"")+(g.descending?"-":"+")+encodeURIComponent(g.attribute)}b+=")"}var e=dojo.xhrGet({url:this.target+(b||""),handleAs:"json",headers:c});e.total=e.then(function(){var f=e.ioArgs.xhr.getResponseHeader("Content-Range");
return f&&(f=f.match(/\/(.*)/))&&+f[1]});return dojo.store.util.QueryResults(e)}})};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dojo.html"]){dojo._hasResource["dojo.html"]=true;dojo.provide("dojo.html");dojo.require("dojo.parser");dojo.getObject("html",true,dojo);(function(){var f=0,e=dojo;dojo.html._secureForInnerHtml=function(a){return a.replace(/(?:\s*<!DOCTYPE\s[^>]+>|<title[^>]*>[\s\S]*?<\/title>)/ig,"")};dojo.html._emptyNode=dojo.empty;dojo.html._setNodeContent=function(a,b){e.empty(a);if(b){if(typeof b=="string")b=e._toDom(b,a.ownerDocument);if(!b.nodeType&&e.isArrayLike(b))for(var c=b.length,
d=0;d<b.length;d=c==b.length?d+1:0)e.place(b[d],a,"last");else e.place(b,a,"last")}return a};dojo.declare("dojo.html._ContentSetter",null,{node:"",content:"",id:"",cleanContent:false,extractContent:false,parseContent:false,parserScope:dojo._scopeName,startup:true,constructor:function(a,b){dojo.mixin(this,a||{});b=this.node=dojo.byId(this.node||b);if(!this.id)this.id=["Setter",b?b.id||b.tagName:"",f++].join("_")},set:function(a,b){if(undefined!==a)this.content=a;b&&this._mixin(b);this.onBegin();this.setContent();
this.onEnd();return this.node},setContent:function(){var a=this.node;if(!a)throw Error(this.declaredClass+": setContent given no node");try{a=dojo.html._setNodeContent(a,this.content)}catch(b){var c=this.onContentError(b);try{a.innerHTML=c}catch(d){console.error("Fatal "+this.declaredClass+".setContent could not change content due to "+d.message,d)}}this.node=a},empty:function(){if(this.parseResults&&this.parseResults.length){dojo.forEach(this.parseResults,function(a){a.destroy&&a.destroy()});delete this.parseResults}dojo.html._emptyNode(this.node)},
onBegin:function(){var a=this.content;if(dojo.isString(a)){if(this.cleanContent)a=dojo.html._secureForInnerHtml(a);if(this.extractContent){var b=a.match(/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im);if(b)a=b[1]}}this.empty();this.content=a;return this.node},onEnd:function(){this.parseContent&&this._parse();return this.node},tearDown:function(){delete this.parseResults;delete this.node;delete this.content},onContentError:function(a){return"Error occured setting content: "+a},_mixin:function(a){var b={},
c;for(c in a)c in b||(this[c]=a[c])},_parse:function(){var a=this.node;try{this.parseResults=dojo.parser.parse({rootNode:a,noStart:!this.startup,inherited:{dir:this.dir,lang:this.lang},scope:this.parserScope})}catch(b){this._onError("Content",b,"Error parsing in _ContentSetter#"+this.id)}},_onError:function(a,b,c){a=this["on"+a+"Error"].call(this,b);if(c)console.error(c,b);else a&&dojo.html._setNodeContent(this.node,a,true)}});dojo.html.set=function(a,b,c){if(undefined==b){console.warn("dojo.html.set: no cont argument provided, using empty string");
b=""}return c?(new dojo.html._ContentSetter(dojo.mixin(c,{content:b,node:a}))).set():dojo.html._setNodeContent(a,b,true)}})()};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dijit._base.focus"]){dojo._hasResource["dijit._base.focus"]=true;dojo.provide("dijit._base.focus");dojo.require("dojo.window");dojo.require("dijit._base.manager");dojo.mixin(dijit,{_curFocus:null,_prevFocus:null,isCollapsed:function(){return dijit.getBookmark().isCollapsed},getBookmark:function(){var a,d,b=dojo.doc.selection,c=dijit._curFocus;if(dojo.global.getSelection){if(b=dojo.global.getSelection())if(b.isCollapsed){if(a=c?c.tagName:""){a=a.toLowerCase();if(a=="textarea"||
a=="input"&&(!c.type||c.type.toLowerCase()=="text")){b={start:c.selectionStart,end:c.selectionEnd,node:c,pRange:true};return{isCollapsed:b.end<=b.start,mark:b}}}a={isCollapsed:true}}else{d=b.getRangeAt(0);a={isCollapsed:false,mark:d.cloneRange()}}}else if(b){a=c?c.tagName:"";a=a.toLowerCase();if(c&&a&&(a=="button"||a=="textarea"||a=="input"))if(b.type&&b.type.toLowerCase()=="none")return{isCollapsed:true,mark:null};else{d=b.createRange();return{isCollapsed:d.text&&d.text.length?false:true,mark:{range:d,
pRange:true}}}a={};try{d=b.createRange();a.isCollapsed=!(b.type=="Text"?d.htmlText.length:d.length)}catch(e){a.isCollapsed=true;return a}if(b.type.toUpperCase()=="CONTROL")if(d.length){a.mark=[];b=0;for(c=d.length;b<c;)a.mark.push(d.item(b++))}else{a.isCollapsed=true;a.mark=null}else a.mark=d.getBookmark()}else console.warn("No idea how to store the current selection for this browser!");return a},moveToBookmark:function(a){var d=dojo.doc;if(a=a.mark)if(dojo.global.getSelection){var b=dojo.global.getSelection();
if(b&&b.removeAllRanges)if(a.pRange){b=a.node;b.selectionStart=a.start;b.selectionEnd=a.end}else{b.removeAllRanges();b.addRange(a)}else console.warn("No idea how to restore selection for this browser!")}else if(d.selection&&a){var c;if(a.pRange)c=a.range;else if(dojo.isArray(a)){c=d.body.createControlRange();dojo.forEach(a,function(e){c.addElement(e)})}else{c=d.body.createTextRange();c.moveToBookmark(a)}c.select()}},getFocus:function(a,d){var b=!dijit._curFocus||a&&dojo.isDescendant(dijit._curFocus,
a.domNode)?dijit._prevFocus:dijit._curFocus;return{node:b,bookmark:b==dijit._curFocus&&dojo.withGlobal(d||dojo.global,dijit.getBookmark),openedForWindow:d}},focus:function(a){if(a){var d="node"in a?a.node:a,b=a.bookmark;a=a.openedForWindow;var c=b?b.isCollapsed:false;if(d){var e=d.tagName.toLowerCase()=="iframe"?d.contentWindow:d;if(e&&e.focus)try{e.focus()}catch(g){}dijit._onFocusNode(d)}if(b&&dojo.withGlobal(a||dojo.global,dijit.isCollapsed)&&!c){a&&a.focus();try{dojo.withGlobal(a||dojo.global,
dijit.moveToBookmark,null,[b])}catch(h){}}}},_activeStack:[],registerIframe:function(a){return dijit.registerWin(a.contentWindow,a)},unregisterIframe:function(a){dijit.unregisterWin(a)},registerWin:function(a,d){var b=function(f){dijit._justMouseDowned=true;setTimeout(function(){dijit._justMouseDowned=false},0);dojo.isIE&&f&&f.srcElement&&f.srcElement.parentNode==null||dijit._onTouchNode(d||f.target||f.srcElement,"mouse")},c=dojo.isIE?a.document.documentElement:a.document;if(c)if(dojo.isIE){a.document.body.attachEvent("onmousedown",
b);var e=function(f){f.srcElement.tagName.toLowerCase()!="#document"&&dijit.isTabNavigable(f.srcElement)?dijit._onFocusNode(d||f.srcElement):dijit._onTouchNode(d||f.srcElement)};c.attachEvent("onactivate",e);var g=function(f){dijit._onBlurNode(d||f.srcElement)};c.attachEvent("ondeactivate",g);return function(){a.document.detachEvent("onmousedown",b);c.detachEvent("onactivate",e);c.detachEvent("ondeactivate",g);c=null}}else{c.body.addEventListener("mousedown",b,true);var h=function(f){dijit._onFocusNode(d||
f.target)};c.addEventListener("focus",h,true);var i=function(f){dijit._onBlurNode(d||f.target)};c.addEventListener("blur",i,true);return function(){c.body.removeEventListener("mousedown",b,true);c.removeEventListener("focus",h,true);c.removeEventListener("blur",i,true);c=null}}},unregisterWin:function(a){a&&a()},_onBlurNode:function(){dijit._prevFocus=dijit._curFocus;dijit._curFocus=null;if(!dijit._justMouseDowned){dijit._clearActiveWidgetsTimer&&clearTimeout(dijit._clearActiveWidgetsTimer);dijit._clearActiveWidgetsTimer=
setTimeout(function(){delete dijit._clearActiveWidgetsTimer;dijit._setStack([]);dijit._prevFocus=null},100)}},_onTouchNode:function(a,d){if(dijit._clearActiveWidgetsTimer){clearTimeout(dijit._clearActiveWidgetsTimer);delete dijit._clearActiveWidgetsTimer}var b=[];try{for(;a;){var c=dojo.attr(a,"dijitPopupParent");if(c)a=dijit.byId(c).domNode;else if(a.tagName&&a.tagName.toLowerCase()=="body"){if(a===dojo.body())break;a=dojo.window.get(a.ownerDocument).frameElement}else{var e=a.getAttribute&&a.getAttribute("widgetId"),
g=e&&dijit.byId(e);g&&!(d=="mouse"&&g.get("disabled"))&&b.unshift(e);a=a.parentNode}}}catch(h){}dijit._setStack(b,d)},_onFocusNode:function(a){if(a)if(a.nodeType!=9){dijit._onTouchNode(a);if(a!=dijit._curFocus){if(dijit._curFocus)dijit._prevFocus=dijit._curFocus;dijit._curFocus=a;dojo.publish("focusNode",[a])}}},_setStack:function(a,d){var b=dijit._activeStack;dijit._activeStack=a;for(var c=0;c<Math.min(b.length,a.length);c++)if(b[c]!=a[c])break;for(var e,g=b.length-1;g>=c;g--)if(e=dijit.byId(b[g])){e._focused=
false;e.set("focused",false);e._hasBeenBlurred=true;e._onBlur&&e._onBlur(d);dojo.publish("widgetBlur",[e,d])}for(g=c;g<a.length;g++)if(e=dijit.byId(a[g])){e._focused=true;e.set("focused",true);e._onFocus&&e._onFocus(d);dojo.publish("widgetFocus",[e,d])}}});dojo.addOnLoad(function(){var a=dijit.registerWin(window);dojo.isIE&&dojo.addOnWindowUnload(function(){dijit.unregisterWin(a);a=null})})};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dijit._base.place"]){dojo._hasResource["dijit._base.place"]=true;dojo.provide("dijit._base.place");dojo.require("dojo.window");dojo.require("dojo.AdapterRegistry");dijit.getViewport=function(){return dojo.window.getBox()};dijit.placeOnScreen=function(c,a,b,f){b=dojo.map(b,function(d){var e={corner:d,pos:{x:a.x,y:a.y}};if(f){e.pos.x+=d.charAt(1)=="L"?f.x:-f.x;e.pos.y+=d.charAt(0)=="T"?f.y:-f.y}return e});return dijit._place(c,b)};dijit._place=function(c,a,b,f){var d=dojo.window.getBox();
if(!c.parentNode||String(c.parentNode.tagName).toLowerCase()!="body")dojo.body().appendChild(c);var e=null;dojo.some(a,function(k){var h=k.corner,g=k.pos,j=0,p={w:h.charAt(1)=="L"?d.l+d.w-g.x:g.x-d.l,h:h.charAt(1)=="T"?d.t+d.h-g.y:g.y-d.t};if(b){j=b(c,k.aroundCorner,h,p,f);j=typeof j=="undefined"?0:j}var i=c.style,n=i.display,l=i.visibility;i.visibility="hidden";i.display="";var m=dojo.marginBox(c);i.display=n;i.visibility=l;i=Math.max(d.l,h.charAt(1)=="L"?g.x:g.x-m.w);n=Math.max(d.t,h.charAt(0)==
"T"?g.y:g.y-m.h);l=Math.min(d.l+d.w,h.charAt(1)=="L"?i+m.w:g.x);g=Math.min(d.t+d.h,h.charAt(0)=="T"?n+m.h:g.y);l=l-i;g=g-n;j+=m.w-l+(m.h-g);if(e==null||j<e.overflow)e={corner:h,aroundCorner:k.aroundCorner,x:i,y:n,w:l,h:g,overflow:j,spaceAvailable:p};return!j});e.overflow&&b&&b(c,e.aroundCorner,e.corner,e.spaceAvailable,f);a=dojo._isBodyLtr();var o=c.style;o.top=e.y+"px";o[a?"left":"right"]=(a?e.x:d.w-e.x-e.w)+"px";return e};dijit.placeOnScreenAroundNode=function(c,a,b,f){a=dojo.byId(a);a=dojo.position(a,
true);return dijit._placeOnScreenAroundRect(c,a.x,a.y,a.w,a.h,b,f)};dijit.placeOnScreenAroundRectangle=function(c,a,b,f){return dijit._placeOnScreenAroundRect(c,a.x,a.y,a.width,a.height,b,f)};dijit._placeOnScreenAroundRect=function(c,a,b,f,d,e,o){var k=[],h;for(h in e)k.push({aroundCorner:h,corner:e[h],pos:{x:a+(h.charAt(1)=="L"?0:f),y:b+(h.charAt(0)=="T"?0:d)}});return dijit._place(c,k,o,{w:f,h:d})};dijit.placementRegistry=new dojo.AdapterRegistry;dijit.placementRegistry.register("node",function(c,
a){return typeof a=="object"&&typeof a.offsetWidth!="undefined"&&typeof a.offsetHeight!="undefined"},dijit.placeOnScreenAroundNode);dijit.placementRegistry.register("rect",function(c,a){return typeof a=="object"&&"x"in a&&"y"in a&&"width"in a&&"height"in a},dijit.placeOnScreenAroundRectangle);dijit.placeOnScreenAroundElement=function(){return dijit.placementRegistry.match.apply(dijit.placementRegistry,arguments)};dijit.getPopupAroundAlignment=function(c,a){var b={};dojo.forEach(c,function(f){switch(f){case "after":b[a?
"BR":"BL"]=a?"BL":"BR";break;case "before":b[a?"BL":"BR"]=a?"BR":"BL";break;case "below-alt":a=!a;case "below":b[a?"BL":"BR"]=a?"TL":"TR";b[a?"BR":"BL"]=a?"TR":"TL";break;case "above-alt":a=!a;default:b[a?"TL":"TR"]=a?"BL":"BR";b[a?"TR":"TL"]=a?"BR":"BL"}});return b}};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dijit._WidgetBase"]){dojo._hasResource["dijit._WidgetBase"]=true;dojo.provide("dijit._WidgetBase");dojo.require("dijit._base.manager");dojo.require("dojo.Stateful");(function(){dojo.declare("dijit._WidgetBase",dojo.Stateful,{id:"",lang:"",dir:"","class":"",style:"",title:"",tooltip:"",baseClass:"",srcNodeRef:null,domNode:null,containerNode:null,attributeMap:{id:"",dir:"",lang:"","class":"",style:"",title:""},_blankGif:(dojo.config.blankGif||dojo.moduleUrl("dojo","resources/blank.gif")).toString(),
postscript:function(a,b){this.create(a,b)},create:function(a,b){this.srcNodeRef=dojo.byId(b);this._connects=[];this._subscribes=[];if(this.srcNodeRef&&typeof this.srcNodeRef.id=="string")this.id=this.srcNodeRef.id;if(a){this.params=a;dojo._mixin(this,a)}this.postMixInProperties();if(!this.id)this.id=dijit.getUniqueId(this.declaredClass.replace(/\./g,"_"));dijit.registry.add(this);this.buildRendering();if(this.domNode){this._applyAttributes();var c=this.srcNodeRef;c&&c.parentNode&&this.domNode!==c&&
c.parentNode.replaceChild(this.domNode,c)}this.domNode&&this.domNode.setAttribute("widgetId",this.id);this.postCreate();this.srcNodeRef&&!this.srcNodeRef.parentNode&&delete this.srcNodeRef;this._created=true},_applyAttributes:function(){var a=function(c,d){if(d.params&&c in d.params||d[c])d.set(c,d[c])},b;for(b in this.attributeMap)a(b,this);dojo.forEach(this._getSetterAttributes(),function(c){c in this.attributeMap||a(c,this)},this)},_getSetterAttributes:function(){var a=this.constructor;if(!a._setterAttrs){var b=
a._setterAttrs=[],c,d=a.prototype,e;for(e in d)if(dojo.isFunction(d[e])&&(c=e.match(/^_set([a-zA-Z]*)Attr$/))&&c[1])b.push(c[1].charAt(0).toLowerCase()+c[1].substr(1))}return a._setterAttrs},postMixInProperties:function(){},buildRendering:function(){if(!this.domNode)this.domNode=this.srcNodeRef||dojo.create("div");if(this.baseClass){var a=this.baseClass.split(" ");this.isLeftToRight()||(a=a.concat(dojo.map(a,function(b){return b+"Rtl"})));dojo.addClass(this.domNode,a)}},postCreate:function(){},startup:function(){this._started=
true},destroyRecursive:function(a){this._beingDestroyed=true;this.destroyDescendants(a);this.destroy(a)},destroy:function(a){this._beingDestroyed=true;this.uninitialize();var b=dojo,c=b.forEach,d=b.unsubscribe;c(this._connects,function(e){c(e,b.disconnect)});c(this._subscribes,function(e){d(e)});c(this._supportingWidgets||[],function(e){if(e.destroyRecursive)e.destroyRecursive();else e.destroy&&e.destroy()});this.destroyRendering(a);dijit.registry.remove(this.id);this._destroyed=true},destroyRendering:function(a){if(this.bgIframe){this.bgIframe.destroy(a);
delete this.bgIframe}if(this.domNode){a?dojo.removeAttr(this.domNode,"widgetId"):dojo.destroy(this.domNode);delete this.domNode}if(this.srcNodeRef){a||dojo.destroy(this.srcNodeRef);delete this.srcNodeRef}},destroyDescendants:function(a){dojo.forEach(this.getChildren(),function(b){b.destroyRecursive&&b.destroyRecursive(a)})},uninitialize:function(){return false},_setClassAttr:function(a){dojo.replaceClass(this[this.attributeMap["class"]||"domNode"],a,this["class"]);this._set("class",a)},_setStyleAttr:function(a){var b=
this[this.attributeMap.style||"domNode"];if(dojo.isObject(a))dojo.style(b,a);else if(b.style.cssText)b.style.cssText+="; "+a;else b.style.cssText=a;this._set("style",a)},_attrToDom:function(a,b){var c=this.attributeMap[a];dojo.forEach(dojo.isArray(c)?c:[c],function(d){var e=this[d.node||d||"domNode"];switch(d.type||"attribute"){case "attribute":if(dojo.isFunction(b))b=dojo.hitch(this,b);d=d.attribute?d.attribute:/^on[A-Z][a-zA-Z]*$/.test(a)?a.toLowerCase():a;dojo.attr(e,d,b);break;case "innerText":e.innerHTML=
"";e.appendChild(dojo.doc.createTextNode(b));break;case "innerHTML":e.innerHTML=b;break;case "class":dojo.replaceClass(e,b,this[a])}},this)},get:function(a){var b=this._getAttrNames(a);return this[b.g]?this[b.g]():this[a]},set:function(a,b){if(typeof a==="object"){for(var c in a)this.set(c,a[c]);return this}c=this._getAttrNames(a);if(this[c.s])var d=this[c.s].apply(this,Array.prototype.slice.call(arguments,1));else{a in this.attributeMap&&this._attrToDom(a,b);this._set(a,b)}return d||this},_attrPairNames:{},
_getAttrNames:function(a){var b=this._attrPairNames;if(b[a])return b[a];var c=a.charAt(0).toUpperCase()+a.substr(1);return b[a]={n:a+"Node",s:"_set"+c+"Attr",g:"_get"+c+"Attr"}},_set:function(a,b){var c=this[a];this[a]=b;this._watchCallbacks&&this._created&&b!==c&&this._watchCallbacks(a,c,b)},toString:function(){return"[Widget "+this.declaredClass+", "+(this.id||"NO ID")+"]"},getDescendants:function(){return this.containerNode?dojo.query("[widgetId]",this.containerNode).map(dijit.byNode):[]},getChildren:function(){return this.containerNode?
dijit.findWidgets(this.containerNode):[]},connect:function(a,b,c){a=[dojo._connect(a,b,this,c)];this._connects.push(a);return a},disconnect:function(a){for(var b=0;b<this._connects.length;b++)if(this._connects[b]==a){dojo.forEach(a,dojo.disconnect);this._connects.splice(b,1);break}},subscribe:function(a,b){var c=dojo.subscribe(a,this,b);this._subscribes.push(c);return c},unsubscribe:function(a){for(var b=0;b<this._subscribes.length;b++)if(this._subscribes[b]==a){dojo.unsubscribe(a);this._subscribes.splice(b,
1);break}},isLeftToRight:function(){return this.dir?this.dir=="ltr":dojo._isBodyLtr()},placeAt:function(a,b){a.declaredClass&&a.addChild?a.addChild(this,b):dojo.place(this.domNode,a,b);return this}})})()};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dojo.store.Memory"]){dojo._hasResource["dojo.store.Memory"]=true;dojo.provide("dojo.store.Memory");dojo.require("dojo.store.util.QueryResults");dojo.require("dojo.store.util.SimpleQueryEngine");dojo.declare("dojo.store.Memory",null,{constructor:function(a){this.index={};dojo.mixin(this,a);this.setData(this.data||[])},data:null,idProperty:"id",index:null,queryEngine:dojo.store.util.SimpleQueryEngine,get:function(a){return this.index[a]},getIdentity:function(a){return a[this.idProperty]},
put:function(a,b){var d=b&&b.id||a[this.idProperty]||Math.random();this.index[d]=a;for(var c=this.data,f=this.idProperty,e=0,g=c.length;e<g;e++)if(c[e][f]==d){c[e]=a;return d}this.data.push(a);return d},add:function(a,b){if(this.index[b&&b.id||a[this.idProperty]])throw Error("Object already exists");return this.put(a,b)},remove:function(a){delete this.index[a];for(var b=this.data,d=this.idProperty,c=0,f=b.length;c<f;c++)if(b[c][d]==a){b.splice(c,1);break}},query:function(a,b){return dojo.store.util.QueryResults(this.queryEngine(a,
b)(this.data))},setData:function(a){if(a.items){this.idProperty=a.identifier;a=this.data=a.items}else this.data=a;for(var b=0,d=a.length;b<d;b++){var c=a[b];this.index[c[this.idProperty]]=c}}})};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dojo.dnd.Mover"]){dojo._hasResource["dojo.dnd.Mover"]=true;dojo.provide("dojo.dnd.Mover");dojo.require("dojo.dnd.common");dojo.require("dojo.dnd.autoscroll");dojo.declare("dojo.dnd.Mover",null,{constructor:function(a,b,c){this.node=dojo.byId(a);var d=b.touches?b.touches[0]:b;this.marginBox={l:d.pageX,t:d.pageY};this.mouseButton=b.button;b=this.host=c;a=a.ownerDocument;this.events=[dojo.connect(a,"onmousemove",this,"onFirstMove"),dojo.connect(a,"ontouchmove",this,"onFirstMove"),
dojo.connect(a,"onmousemove",this,"onMouseMove"),dojo.connect(a,"ontouchmove",this,"onMouseMove"),dojo.connect(a,"onmouseup",this,"onMouseUp"),dojo.connect(a,"ontouchend",this,"onMouseUp"),dojo.connect(a,"ondragstart",dojo.stopEvent),dojo.connect(a.body,"onselectstart",dojo.stopEvent)];b&&b.onMoveStart&&b.onMoveStart(this)},onMouseMove:function(a){dojo.dnd.autoScroll(a);var b=this.marginBox,c=a.touches?a.touches[0]:a;this.host.onMove(this,{l:b.l+c.pageX,t:b.t+c.pageY},a);dojo.stopEvent(a)},onMouseUp:function(a){if(dojo.isWebKit&&
dojo.isMac&&this.mouseButton==2?a.button==0:this.mouseButton==a.button)this.destroy();dojo.stopEvent(a)},onFirstMove:function(a){var b=this.node.style,c,d=this.host;switch(b.position){case "relative":case "absolute":c=Math.round(parseFloat(b.left))||0;b=Math.round(parseFloat(b.top))||0;break;default:b.position="absolute";b=dojo.marginBox(this.node);c=dojo.doc.body;var e=dojo.getComputedStyle(c),f=dojo._getMarginBox(c,e);e=dojo._getContentBox(c,e);c=b.l-(e.l-f.l);b=b.t-(e.t-f.t)}this.marginBox.l=c-
this.marginBox.l;this.marginBox.t=b-this.marginBox.t;d&&d.onFirstMove&&d.onFirstMove(this,a);dojo.disconnect(this.events.shift());dojo.disconnect(this.events.shift())},destroy:function(){dojo.forEach(this.events,dojo.disconnect);var a=this.host;a&&a.onMoveStop&&a.onMoveStop(this);this.events=this.node=this.host=null}})};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dojo.dnd.Moveable"]){dojo._hasResource["dojo.dnd.Moveable"]=true;dojo.provide("dojo.dnd.Moveable");dojo.require("dojo.dnd.Mover");dojo.declare("dojo.dnd.Moveable",null,{handle:"",delay:0,skip:false,constructor:function(a,b){this.node=dojo.byId(a);b||(b={});this.handle=b.handle?dojo.byId(b.handle):null;if(!this.handle)this.handle=this.node;this.delay=b.delay>0?b.delay:0;this.skip=b.skip;this.mover=b.mover?b.mover:dojo.dnd.Mover;this.events=[dojo.connect(this.handle,"onmousedown",
this,"onMouseDown"),dojo.connect(this.handle,"ontouchstart",this,"onMouseDown"),dojo.connect(this.handle,"ondragstart",this,"onSelectStart"),dojo.connect(this.handle,"onselectstart",this,"onSelectStart")]},markupFactory:function(a,b){return new dojo.dnd.Moveable(b,a)},destroy:function(){dojo.forEach(this.events,dojo.disconnect);this.events=this.node=this.handle=null},onMouseDown:function(a){if(!(this.skip&&dojo.dnd.isFormElement(a))){if(this.delay){this.events.push(dojo.connect(this.handle,"onmousemove",
this,"onMouseMove"),dojo.connect(this.handle,"ontouchmove",this,"onMouseMove"),dojo.connect(this.handle,"onmouseup",this,"onMouseUp"),dojo.connect(this.handle,"ontouchend",this,"onMouseUp"));var b=a.touches?a.touches[0]:a;this._lastX=b.pageX;this._lastY=b.pageY}else this.onDragDetected(a);dojo.stopEvent(a)}},onMouseMove:function(a){var b=a.touches?a.touches[0]:a;if(Math.abs(b.pageX-this._lastX)>this.delay||Math.abs(b.pageY-this._lastY)>this.delay){this.onMouseUp(a);this.onDragDetected(a)}dojo.stopEvent(a)},
onMouseUp:function(a){for(var b=0;b<2;++b)dojo.disconnect(this.events.pop());dojo.stopEvent(a)},onSelectStart:function(a){if(!this.skip||!dojo.dnd.isFormElement(a))dojo.stopEvent(a)},onDragDetected:function(a){new this.mover(this.node,a,this)},onMoveStart:function(a){dojo.publish("/dnd/move/start",[a]);dojo.addClass(dojo.body(),"dojoMove");dojo.addClass(this.node,"dojoMoveItem")},onMoveStop:function(a){dojo.publish("/dnd/move/stop",[a]);dojo.removeClass(dojo.body(),"dojoMove");dojo.removeClass(this.node,
"dojoMoveItem")},onFirstMove:function(){},onMove:function(a,b){this.onMoving(a,b);var c=a.node.style;c.left=b.l+"px";c.top=b.t+"px";this.onMoved(a,b)},onMoving:function(){},onMoved:function(){}})};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dojo.dnd.TimedMoveable"]){dojo._hasResource["dojo.dnd.TimedMoveable"]=true;dojo.provide("dojo.dnd.TimedMoveable");dojo.require("dojo.dnd.Moveable");(function(){var c=dojo.dnd.Moveable.prototype.onMove;dojo.declare("dojo.dnd.TimedMoveable",dojo.dnd.Moveable,{timeout:40,constructor:function(a,b){b||(b={});if(b.timeout&&typeof b.timeout=="number"&&b.timeout>=0)this.timeout=b.timeout},markupFactory:function(a,b){return new dojo.dnd.TimedMoveable(b,a)},onMoveStop:function(a){if(a._timer){clearTimeout(a._timer);
c.call(this,a,a._leftTop)}dojo.dnd.Moveable.prototype.onMoveStop.apply(this,arguments)},onMove:function(a,b){a._leftTop=b;if(!a._timer){var d=this;a._timer=setTimeout(function(){a._timer=null;c.call(d,a,a._leftTop)},this.timeout)}}})})()};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dojo.dnd.move"]){dojo._hasResource["dojo.dnd.move"]=true;dojo.provide("dojo.dnd.move");dojo.require("dojo.dnd.Mover");dojo.require("dojo.dnd.Moveable");dojo.declare("dojo.dnd.move.constrainedMoveable",dojo.dnd.Moveable,{constraints:function(){},within:false,markupFactory:function(b,a){return new dojo.dnd.move.constrainedMoveable(a,b)},constructor:function(b,a){a||(a={});this.constraints=a.constraints;this.within=a.within},onFirstMove:function(b){var a=this.constraintBox=this.constraints.call(this,
b);a.r=a.l+a.w;a.b=a.t+a.h;if(this.within){b=dojo._getMarginSize(b.node);a.r-=b.w;a.b-=b.h}},onMove:function(b,a){var d=this.constraintBox,f=b.node.style;this.onMoving(b,a);a.l=a.l<d.l?d.l:d.r<a.l?d.r:a.l;a.t=a.t<d.t?d.t:d.b<a.t?d.b:a.t;f.left=a.l+"px";f.top=a.t+"px";this.onMoved(b,a)}});dojo.declare("dojo.dnd.move.boxConstrainedMoveable",dojo.dnd.move.constrainedMoveable,{box:{},markupFactory:function(b,a){return new dojo.dnd.move.boxConstrainedMoveable(a,b)},constructor:function(b,a){var d=a&&a.box;
this.constraints=function(){return d}}});dojo.declare("dojo.dnd.move.parentConstrainedMoveable",dojo.dnd.move.constrainedMoveable,{area:"content",markupFactory:function(b,a){return new dojo.dnd.move.parentConstrainedMoveable(a,b)},constructor:function(b,a){var d=a&&a.area;this.constraints=function(){var f=this.node.parentNode,g=dojo.getComputedStyle(f),c=dojo._getMarginBox(f,g);if(d=="margin")return c;var e=dojo._getMarginExtents(f,g);c.l+=e.l;c.t+=e.t;c.w-=e.w;c.h-=e.h;if(d=="border")return c;e=
dojo._getBorderExtents(f,g);c.l+=e.l;c.t+=e.t;c.w-=e.w;c.h-=e.h;if(d=="padding")return c;e=dojo._getPadExtents(f,g);c.l+=e.l;c.t+=e.t;c.w-=e.w;c.h-=e.h;return c}}});dojo.dnd.constrainedMover=dojo.dnd.move.constrainedMover;dojo.dnd.boxConstrainedMover=dojo.dnd.move.boxConstrainedMover;dojo.dnd.parentConstrainedMover=dojo.dnd.move.parentConstrainedMover};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dojo.date.locale"]){dojo._hasResource["dojo.date.locale"]=true;dojo.provide("dojo.date.locale");dojo.require("dojo.date");dojo.require("dojo.cldr.supplemental");dojo.require("dojo.regexp");dojo.require("dojo.string");dojo.require("dojo.i18n");dojo.requireLocalization("dojo.cldr","gregorian",null,"ROOT,ar,ca,cs,da,de,el,en,en-au,en-ca,en-gb,es,fi,fr,fr-ch,he,hu,it,ja,ko,nb,nl,pl,pt,pt-pt,ro,ru,sk,sl,sv,th,tr,zh,zh-hant,zh-hk,zh-tw");dojo.getObject("date.locale",true,dojo);(function(){function k(b,
d,g,f){return f.replace(/([a-z])\1*/ig,function(i){var a,e,c=i.charAt(0);i=i.length;var n=["abbr","wide","narrow"];switch(c){case "G":a=d[i<4?"eraAbbr":"eraNames"][b.getFullYear()<0?0:1];break;case "y":a=b.getFullYear();switch(i){case 1:break;case 2:if(!g.fullYear){a=String(a);a=a.substr(a.length-2);break}default:e=true}break;case "Q":case "q":a=Math.ceil((b.getMonth()+1)/3);e=true;break;case "M":a=b.getMonth();if(i<3){a=a+1;e=true}else{c=["months-format",n[i-3]].join("-");a=d[c][a]}break;case "w":a=
dojo.date.locale._getWeekOfYear(b,0);e=true;break;case "d":a=b.getDate();e=true;break;case "D":a=dojo.date.locale._getDayOfYear(b);e=true;break;case "E":a=b.getDay();if(i<3){a=a+1;e=true}else{c=["days-format",n[i-3]].join("-");a=d[c][a]}break;case "a":a=b.getHours()<12?"am":"pm";a=g[a]||d["dayPeriods-format-wide-"+a];break;case "h":case "H":case "K":case "k":e=b.getHours();switch(c){case "h":a=e%12||12;break;case "H":a=e;break;case "K":a=e%12;break;case "k":a=e||24}e=true;break;case "m":a=b.getMinutes();
e=true;break;case "s":a=b.getSeconds();e=true;break;case "S":a=Math.round(b.getMilliseconds()*Math.pow(10,i-3));e=true;break;case "v":case "z":if(a=dojo.date.locale._getZone(b,true,g))break;i=4;case "Z":a=dojo.date.locale._getZone(b,false,g);a=[a<=0?"+":"-",dojo.string.pad(Math.floor(Math.abs(a)/60),2),dojo.string.pad(Math.abs(a)%60,2)];if(i==4){a.splice(0,0,"GMT");a.splice(3,0,":")}a=a.join("");break;default:throw Error("dojo.date.locale.format: invalid pattern char: "+f);}if(e)a=dojo.string.pad(a,
i);return a})}function m(b,d,g,f){var i=function(c){return c};d=d||i;g=g||i;f=f||i;var a=b.match(/(''|[^'])+/g),e=b.charAt(0)=="'";dojo.forEach(a,function(c,n){if(c){a[n]=(e?g:d)(c.replace(/''/g,"'"));e=!e}else a[n]=""});return f(a.join(""))}function j(b,d,g,f){f=dojo.regexp.escapeString(f);g.strict||(f=f.replace(" a"," ?a"));return f.replace(/([a-z])\1*/ig,function(i){var a;a=i.charAt(0);var e=i.length,c="",n="";if(g.strict){if(e>1)c="0{"+(e-1)+"}";if(e>2)n="0{"+(e-2)+"}"}else{c="0?";n="0{0,2}"}switch(a){case "y":a=
"\\d{2,4}";break;case "M":a=e>2?"\\S+?":c+"[1-9]|1[0-2]";break;case "D":a=c+"[1-9]|"+n+"[1-9][0-9]|[12][0-9][0-9]|3[0-5][0-9]|36[0-6]";break;case "d":a="3[01]|[12]\\d|"+c+"[1-9]";break;case "w":a=c+"[1-9]|[1-4][0-9]|5[0-3]";break;case "E":a="\\S+";break;case "h":a=c+"[1-9]|1[0-2]";break;case "k":a=c+"\\d|1[01]";break;case "H":a=c+"\\d|1\\d|2[0-3]";break;case "K":a=c+"[1-9]|1\\d|2[0-4]";break;case "m":case "s":a="[0-5]\\d";break;case "S":a="\\d{"+e+"}";break;case "a":e=g.am||d["dayPeriods-format-wide-am"];
c=g.pm||d["dayPeriods-format-wide-pm"];if(g.strict)a=e+"|"+c;else{a=e+"|"+c;if(e!=e.toLowerCase())a+="|"+e.toLowerCase();if(c!=c.toLowerCase())a+="|"+c.toLowerCase();if(a.indexOf(".")!=-1)a+="|"+a.replace(/\./g,"")}a=a.replace(/\./g,"\\.");break;default:a=".*"}b&&b.push(i);return"("+a+")"}).replace(/[\xa0 ]/g,"[\\s\\xa0]")}dojo.date.locale._getZone=function(b,d){return d?dojo.date.getTimezoneName(b):b.getTimezoneOffset()};dojo.date.locale.format=function(b,d){d=d||{};var g=dojo.i18n.normalizeLocale(d.locale),
f=d.formatLength||"short";g=dojo.date.locale._getGregorianBundle(g);var i=[],a=dojo.hitch(this,k,b,g,d);if(d.selector=="year")return m(g["dateFormatItem-yyyy"]||"yyyy",a);var e;if(d.selector!="date")(e=d.timePattern||g["timeFormat-"+f])&&i.push(m(e,a));if(d.selector!="time")(e=d.datePattern||g["dateFormat-"+f])&&i.push(m(e,a));return i.length==1?i[0]:g["dateTimeFormat-"+f].replace(/\{(\d+)\}/g,function(c,n){return i[n]})};dojo.date.locale.regexp=function(b){return dojo.date.locale._parseInfo(b).regexp};
dojo.date.locale._parseInfo=function(b){b=b||{};var d=dojo.i18n.normalizeLocale(b.locale);d=dojo.date.locale._getGregorianBundle(d);var g=b.formatLength||"short",f=b.datePattern||d["dateFormat-"+g],i=b.timePattern||d["timeFormat-"+g];g=b.selector=="date"?f:b.selector=="time"?i:d["dateTimeFormat-"+g].replace(/\{(\d+)\}/g,function(e,c){return[i,f][c]});var a=[];return{regexp:m(g,dojo.hitch(this,j,a,d,b)),tokens:a,bundle:d}};dojo.date.locale.parse=function(b,d){var g=/[\u200E\u200F\u202A\u202E]/g,f=
dojo.date.locale._parseInfo(d),i=f.tokens,a=f.bundle;g=RegExp("^"+f.regexp.replace(g,"")+"$",f.strict?"":"i").exec(b&&b.replace(g,""));if(!g)return null;var e=["abbr","wide","narrow"],c=[1970,0,1,0,0,0,0],n="";g=dojo.every(g,function(h,s){if(!s)return true;var l=i[s-1],o=l.length;switch(l.charAt(0)){case "y":if(o!=2&&d.strict)c[0]=h;else if(h<100){h=Number(h);o=""+(new Date).getFullYear();l=o.substring(0,2)*100;o=Math.min(Number(o.substring(2,4))+20,99);c[0]=h<o?l+h:l-100+h}else{if(d.strict)return false;
c[0]=h}break;case "M":if(o>2){l=a["months-format-"+e[o-3]].concat();if(!d.strict){h=h.replace(".","").toLowerCase();l=dojo.map(l,function(q){return q.replace(".","").toLowerCase()})}h=dojo.indexOf(l,h);if(h==-1)return false}else h--;c[1]=h;break;case "E":case "e":l=a["days-format-"+e[o-3]].concat();if(!d.strict){h=h.toLowerCase();l=dojo.map(l,function(q){return q.toLowerCase()})}h=dojo.indexOf(l,h);if(h==-1)return false;break;case "D":c[1]=0;case "d":c[2]=h;break;case "a":l=d.am||a["dayPeriods-format-wide-am"];
o=d.pm||a["dayPeriods-format-wide-pm"];if(!d.strict){var r=/\./g;h=h.replace(r,"").toLowerCase();l=l.replace(r,"").toLowerCase();o=o.replace(r,"").toLowerCase()}if(d.strict&&h!=l&&h!=o)return false;n=h==o?"p":h==l?"a":"";break;case "K":if(h==24)h=0;case "h":case "H":case "k":if(h>23)return false;c[3]=h;break;case "m":c[4]=h;break;case "s":c[5]=h;break;case "S":c[6]=h}return true});f=+c[3];if(n==="p"&&f<12)c[3]=f+12;else if(n==="a"&&f==12)c[3]=0;f=new Date(c[0],c[1],c[2],c[3],c[4],c[5],c[6]);d.strict&&
f.setFullYear(c[0]);var p=i.join(""),t=p.indexOf("d")!=-1;p=p.indexOf("M")!=-1;if(!g||p&&f.getMonth()>c[1]||t&&f.getDate()>c[2])return null;if(p&&f.getMonth()<c[1]||t&&f.getDate()<c[2])f=dojo.date.add(f,"hour",1);return f}})();(function(){var k=[];dojo.date.locale.addCustomFormats=function(m,j){k.push({pkg:m,name:j})};dojo.date.locale._getGregorianBundle=function(m){var j={};dojo.forEach(k,function(b){b=dojo.i18n.getLocalization(b.pkg,b.name,m);j=dojo.mixin(j,b)},this);return j}})();dojo.date.locale.addCustomFormats("dojo.cldr",
"gregorian");dojo.date.locale.getNames=function(k,m,j,b){var d;b=dojo.date.locale._getGregorianBundle(b);k=[k,j,m];if(j=="standAlone"){j=k.join("-");d=b[j];if(d[0]==1)d=undefined}k[1]="format";return(d||b[k.join("-")]).concat()};dojo.date.locale.isWeekend=function(k,m){var j=dojo.cldr.supplemental.getWeekend(m),b=(k||new Date).getDay();if(j.end<j.start){j.end+=7;if(b<j.start)b+=7}return b>=j.start&&b<=j.end};dojo.date.locale._getDayOfYear=function(k){return dojo.date.difference(new Date(k.getFullYear(),
0,1,k.getHours()),k)+1};dojo.date.locale._getWeekOfYear=function(k,m){if(arguments.length==1)m=0;var j=(new Date(k.getFullYear(),0,1)).getDay(),b=(j-m+7)%7;b=Math.floor((dojo.date.locale._getDayOfYear(k)+b-1)/7);j==m&&b++;return b}};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dijit._base.popup"]){dojo._hasResource["dijit._base.popup"]=true;dojo.provide("dijit._base.popup");dojo.require("dijit._base.focus");dojo.require("dijit._base.place");dojo.require("dijit._base.window");dijit.popup={_stack:[],_beginZIndex:1E3,_idGen:1,_createWrapper:function(a){var b=a.declaredClass?a._popupWrapper:dojo.hasClass(a.parentNode,"dijitPopup")&&a.parentNode,c=a.domNode||a;if(!b){b=dojo.create("div",{"class":"dijitPopup",style:{display:"none"},role:"presentation"},
dojo.body());b.appendChild(c);c=c.style;c.display="";c.visibility="";c.position="";c.top="0px";if(a.declaredClass){a._popupWrapper=b;dojo.connect(a,"destroy",function(){dojo.destroy(b);delete a._popupWrapper})}}return b},moveOffScreen:function(a){a=this._createWrapper(a);dojo.style(a,{visibility:"hidden",top:"-9999px",display:""})},hide:function(a){a=this._createWrapper(a);dojo.style(a,"display","none")},getTopPopup:function(){for(var a=this._stack,b=a.length-1;b>0&&a[b].parent===a[b-1].widget;b--);
return a[b]},open:function(a){for(var b=this._stack,c=a.popup,d=a.orient||((a.parent?a.parent.isLeftToRight():dojo._isBodyLtr())?{BL:"TL",BR:"TR",TL:"BL",TR:"BR"}:{BR:"TR",BL:"TL",TR:"BR",TL:"BL"}),f=a.around,h=a.around&&a.around.id?a.around.id+"_dropdown":"popup_"+this._idGen++;b.length&&(!a.parent||!dojo.isDescendant(a.parent.domNode,b[b.length-1].widget.domNode));)dijit.popup.close(b[b.length-1].widget);var g=this._createWrapper(c);dojo.attr(g,{id:h,style:{zIndex:this._beginZIndex+b.length},"class":"dijitPopup "+
(c.baseClass||c["class"]||"").split(" ")[0]+"Popup",dijitPopupParent:a.parent?a.parent.id:""});if(dojo.isIE||dojo.isMoz)if(!c.bgIframe)c.bgIframe=new dijit.BackgroundIframe(g);d=f?dijit.placeOnScreenAroundElement(g,f,d,c.orient?dojo.hitch(c,"orient"):null):dijit.placeOnScreen(g,a,d=="R"?["TR","BR","TL","BL"]:["TL","BL","TR","BR"],a.padding);g.style.display="";g.style.visibility="visible";c.domNode.style.visibility="visible";f=[];f.push(dojo.connect(g,"onkeypress",this,function(e){if(e.charOrCode==
dojo.keys.ESCAPE&&a.onCancel){dojo.stopEvent(e);a.onCancel()}else if(e.charOrCode===dojo.keys.TAB){dojo.stopEvent(e);(e=this.getTopPopup())&&e.onCancel&&e.onCancel()}}));c.onCancel&&f.push(dojo.connect(c,"onCancel",a.onCancel));f.push(dojo.connect(c,c.onExecute?"onExecute":"onChange",this,function(){var e=this.getTopPopup();e&&e.onExecute&&e.onExecute()}));b.push({widget:c,parent:a.parent,onExecute:a.onExecute,onCancel:a.onCancel,onClose:a.onClose,handlers:f});c.onOpen&&c.onOpen(d);return d},close:function(a){for(var b=
this._stack;a&&dojo.some(b,function(h){return h.widget==a})||!a&&b.length;){var c=b.pop(),d=c.widget,f=c.onClose;d.onClose&&d.onClose();dojo.forEach(c.handlers,dojo.disconnect);d&&d.domNode&&this.hide(d);f&&f()}}};dijit._frames=new function(){var a=[];this.pop=function(){var b;if(a.length){b=a.pop();b.style.display=""}else{if(dojo.isIE<9){b="<iframe src='"+(dojo.config.dojoBlankHtmlUrl||dojo.moduleUrl("dojo","resources/blank.html")+""||'javascript:""')+"' style='position: absolute; left: 0px; top: 0px;z-index: -1; filter:Alpha(Opacity=\"0\");'>";
b=dojo.doc.createElement(b)}else{b=dojo.create("iframe");b.src='javascript:""';b.className="dijitBackgroundIframe";dojo.style(b,"opacity",0.1)}b.tabIndex=-1;dijit.setWaiRole(b,"presentation")}return b};this.push=function(b){b.style.display="none";a.push(b)}};dijit.BackgroundIframe=function(a){if(!a.id)throw Error("no id");if(dojo.isIE||dojo.isMoz){var b=this.iframe=dijit._frames.pop();a.appendChild(b);if(dojo.isIE<7||dojo.isQuirks){this.resize(a);this._conn=dojo.connect(a,"onresize",this,function(){this.resize(a)})}else dojo.style(b,
{width:"100%",height:"100%"})}};dojo.extend(dijit.BackgroundIframe,{resize:function(a){this.iframe&&dojo.style(this.iframe,{width:a.offsetWidth+"px",height:a.offsetHeight+"px"})},destroy:function(){if(this._conn){dojo.disconnect(this._conn);this._conn=null}if(this.iframe){dijit._frames.push(this.iframe);delete this.iframe}}})};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dijit._base"]){dojo._hasResource["dijit._base"]=true;dojo.provide("dijit._base");dojo.require("dijit._base.focus");dojo.require("dijit._base.manager");dojo.require("dijit._base.place");dojo.require("dijit._base.popup");dojo.require("dijit._base.scroll");dojo.require("dijit._base.sniff");dojo.require("dijit._base.typematic");dojo.require("dijit._base.wai");dojo.require("dijit._base.window")};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dijit._Widget"]){dojo._hasResource["dijit._Widget"]=true;dojo.provide("dijit._Widget");dojo.require("dijit._WidgetBase");dojo.require("dijit._base");dojo.connect(dojo,"_connect",function(a,c){a&&dojo.isFunction(a._onConnect)&&a._onConnect(c)});dijit._connectOnUseEventHandler=function(){};dijit._lastKeyDownNode=null;dojo.isIE?function(){var a=function(c){dijit._lastKeyDownNode=c.srcElement};dojo.doc.attachEvent("onkeydown",a);dojo.addOnWindowUnload(function(){dojo.doc.detachEvent("onkeydown",
a)})}():dojo.doc.addEventListener("keydown",function(a){dijit._lastKeyDownNode=a.target},true);(function(){dojo.declare("dijit._Widget",dijit._WidgetBase,{_deferredConnects:{onClick:"",onDblClick:"",onKeyDown:"",onKeyPress:"",onKeyUp:"",onMouseMove:"",onMouseDown:"",onMouseOut:"",onMouseOver:"",onMouseLeave:"",onMouseEnter:"",onMouseUp:""},onClick:dijit._connectOnUseEventHandler,onDblClick:dijit._connectOnUseEventHandler,onKeyDown:dijit._connectOnUseEventHandler,onKeyPress:dijit._connectOnUseEventHandler,
onKeyUp:dijit._connectOnUseEventHandler,onMouseDown:dijit._connectOnUseEventHandler,onMouseMove:dijit._connectOnUseEventHandler,onMouseOut:dijit._connectOnUseEventHandler,onMouseOver:dijit._connectOnUseEventHandler,onMouseLeave:dijit._connectOnUseEventHandler,onMouseEnter:dijit._connectOnUseEventHandler,onMouseUp:dijit._connectOnUseEventHandler,create:function(){this._deferredConnects=dojo.clone(this._deferredConnects);for(var a in this.attributeMap)delete this._deferredConnects[a];for(a in this._deferredConnects)this[a]!==
dijit._connectOnUseEventHandler&&delete this._deferredConnects[a];this.inherited(arguments);if(this.domNode)for(a in this.params)this._onConnect(a)},_onConnect:function(a){if(a in this._deferredConnects){this.connect(this[this._deferredConnects[a]||"domNode"],a.toLowerCase(),a);delete this._deferredConnects[a]}},focused:false,isFocusable:function(){return this.focus&&dojo.style(this.domNode,"display")!="none"},onFocus:function(){},onBlur:function(){},_onFocus:function(){this.onFocus()},_onBlur:function(){this.onBlur()},
setAttribute:function(a,c){dojo.deprecated(this.declaredClass+"::setAttribute(attr, value) is deprecated. Use set() instead.","","2.0");this.set(a,c)},attr:function(a){if(dojo.config.isDebug){var c=arguments.callee._ach||(arguments.callee._ach={}),e=(arguments.callee.caller||"unknown caller").toString();if(!c[e]){dojo.deprecated(this.declaredClass+"::attr() is deprecated. Use get() or set() instead, called from "+e,"","2.0");c[e]=true}}return arguments.length>=2||typeof a==="object"?this.set.apply(this,
arguments):this.get(a)},nodesWithKeyClick:["input","button"],connect:function(a,c,e){var d=dojo,f=d._connect,g=this.inherited(arguments,[a,c=="ondijitclick"?"onclick":c,e]);if(c=="ondijitclick")if(d.indexOf(this.nodesWithKeyClick,a.nodeName.toLowerCase())==-1){var h=d.hitch(this,e);g.push(f(a,"onkeydown",this,function(b){if((b.keyCode==d.keys.ENTER||b.keyCode==d.keys.SPACE)&&!b.ctrlKey&&!b.shiftKey&&!b.altKey&&!b.metaKey){dijit._lastKeyDownNode=b.target;"openDropDown"in this&&a==this._buttonNode||
b.preventDefault()}}),f(a,"onkeyup",this,function(b){if((b.keyCode==d.keys.ENTER||b.keyCode==d.keys.SPACE)&&b.target==dijit._lastKeyDownNode&&!b.ctrlKey&&!b.shiftKey&&!b.altKey&&!b.metaKey){dijit._lastKeyDownNode=null;return h(b)}}))}return g},_onShow:function(){this.onShow()},onShow:function(){},onHide:function(){},onClose:function(){return true}})})()};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dijit._DialogMixin"]){dojo._hasResource["dijit._DialogMixin"]=true;dojo.provide("dijit._DialogMixin");dojo.require("dijit._Widget");dojo.declare("dijit._DialogMixin",null,{attributeMap:dijit._Widget.prototype.attributeMap,execute:function(){},onCancel:function(){},onExecute:function(){},_onSubmit:function(){this.onExecute();this.execute(this.get("value"))},_getFocusItems:function(){var a=dijit._getTabNavigable(this.containerNode);this._firstFocusItem=a.lowest||a.first||this.closeButtonNode||
this.domNode;this._lastFocusItem=a.last||a.highest||this._firstFocusItem}})};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dijit._HasDropDown"]){dojo._hasResource["dijit._HasDropDown"]=true;dojo.provide("dijit._HasDropDown");dojo.require("dijit._Widget");dojo.declare("dijit._HasDropDown",null,{_buttonNode:null,_arrowWrapperNode:null,_popupStateNode:null,_aroundNode:null,dropDown:null,autoWidth:true,forceWidth:false,maxHeight:0,dropDownPosition:["below","above"],_stopClickEvents:true,_onDropDownMouseDown:function(){if(!(this.disabled||this.readOnly)){this._docHandler=this.connect(dojo.doc,"onmouseup",
"_onDropDownMouseUp");this.toggleDropDown()}},_onDropDownMouseUp:function(a){a&&this._docHandler&&this.disconnect(this._docHandler);var c=this.dropDown,f=false;if(a&&this._opened){var b=dojo.position(this._buttonNode,true);if(!(a.pageX>=b.x&&a.pageX<=b.x+b.w)||!(a.pageY>=b.y&&a.pageY<=b.y+b.h)){for(b=a.target;b&&!f;)if(dojo.hasClass(b,"dijitPopup"))f=true;else b=b.parentNode;if(f){b=a.target;if(c.onItemClick){for(var d;b&&!(d=dijit.byNode(b));)b=b.parentNode;d&&d.onClick&&d.getParent&&d.getParent().onItemClick(d,
a)}return}}}this._opened&&c.focus&&c.autoFocus!==false&&window.setTimeout(dojo.hitch(c,"focus"),1)},_onDropDownClick:function(a){this._stopClickEvents&&dojo.stopEvent(a)},buildRendering:function(){this.inherited(arguments);this._buttonNode=this._buttonNode||this.focusNode||this.domNode;this._popupStateNode=this._popupStateNode||this.focusNode||this._buttonNode;var a={after:this.isLeftToRight()?"Right":"Left",before:this.isLeftToRight()?"Left":"Right",above:"Up",below:"Down",left:"Left",right:"Right"}[this.dropDownPosition[0]]||
this.dropDownPosition[0]||"Down";dojo.addClass(this._arrowWrapperNode||this._buttonNode,"dijit"+a+"ArrowButton")},postCreate:function(){this.inherited(arguments);this.connect(this._buttonNode,"onmousedown","_onDropDownMouseDown");this.connect(this._buttonNode,"onclick","_onDropDownClick");this.connect(this.focusNode,"onkeypress","_onKey")},destroy:function(){if(this.dropDown){this.dropDown._destroyed||this.dropDown.destroyRecursive();delete this.dropDown}this.inherited(arguments)},_onKey:function(a){if(!(this.disabled||
this.readOnly)){var c=this.dropDown,f=a.target;if(c&&this._opened&&c.handleKey)if(c.handleKey(a)===false){dojo.stopEvent(a);return}if(c&&this._opened&&a.charOrCode==dojo.keys.ESCAPE){this.closeDropDown();dojo.stopEvent(a)}else if(!this._opened&&(a.charOrCode==dojo.keys.DOWN_ARROW||(a.charOrCode==dojo.keys.ENTER||a.charOrCode==" ")&&((f.tagName||"").toLowerCase()!=="input"||f.type&&f.type.toLowerCase()!=="text"))){this.toggleDropDown();(c=this.dropDown)&&c.focus&&setTimeout(dojo.hitch(c,"focus"),1);
dojo.stopEvent(a)}}},_onBlur:function(){this.closeDropDown(dijit._curFocus&&this.dropDown&&dojo.isDescendant(dijit._curFocus,this.dropDown.domNode));this.inherited(arguments)},isLoaded:function(){return true},loadDropDown:function(a){a()},toggleDropDown:function(){if(!(this.disabled||this.readOnly))if(this._opened)this.closeDropDown();else this.isLoaded()?this.openDropDown():this.loadDropDown(dojo.hitch(this,"openDropDown"))},openDropDown:function(){var a=this.dropDown,c=a.domNode,f=this._aroundNode||
this.domNode,b=this;if(!this._preparedNode){this._preparedNode=true;if(c.style.width)this._explicitDDWidth=true;if(c.style.height)this._explicitDDHeight=true}if(this.maxHeight||this.forceWidth||this.autoWidth){var d={display:"",visibility:"hidden"};if(!this._explicitDDWidth)d.width="";if(!this._explicitDDHeight)d.height="";dojo.style(c,d);d=this.maxHeight;if(d==-1){d=dojo.window.getBox();var e=dojo.position(f,false);d=Math.floor(Math.max(e.y,d.h-(e.y+e.h)))}a.startup&&!a._started&&a.startup();dijit.popup.moveOffScreen(a);
e=dojo._getMarginSize(c);var g=d&&e.h>d;dojo.style(c,{overflowX:"hidden",overflowY:g?"auto":"hidden"});if(g){e.h=d;if("w"in e)e.w+=16}else delete e.h;if(this.forceWidth)e.w=f.offsetWidth;else if(this.autoWidth)e.w=Math.max(e.w,f.offsetWidth);else delete e.w;dojo.isFunction(a.resize)?a.resize(e):dojo.marginBox(c,e)}a=dijit.popup.open({parent:this,popup:a,around:f,orient:dijit.getPopupAroundAlignment(this.dropDownPosition&&this.dropDownPosition.length?this.dropDownPosition:["below"],this.isLeftToRight()),
onExecute:function(){b.closeDropDown(true)},onCancel:function(){b.closeDropDown(true)},onClose:function(){dojo.attr(b._popupStateNode,"popupActive",false);dojo.removeClass(b._popupStateNode,"dijitHasDropDownOpen");b._opened=false}});dojo.attr(this._popupStateNode,"popupActive","true");dojo.addClass(b._popupStateNode,"dijitHasDropDownOpen");this._opened=true;return a},closeDropDown:function(a){if(this._opened){a&&this.focus();dijit.popup.close(this.dropDown);this._opened=false}}})};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dijit.layout._LayoutWidget"]){dojo._hasResource["dijit.layout._LayoutWidget"]=true;dojo.provide("dijit.layout._LayoutWidget");dojo.require("dijit._Widget");dojo.require("dijit._Container");dojo.require("dijit._Contained");dojo.declare("dijit.layout._LayoutWidget",[dijit._Widget,dijit._Container,dijit._Contained],{baseClass:"dijitLayoutContainer",isLayoutContainer:true,buildRendering:function(){this.inherited(arguments);dojo.addClass(this.domNode,"dijitContainer")},startup:function(){if(!this._started){this.inherited(arguments);
var b=this.getParent&&this.getParent();if(!(b&&b.isLayoutContainer)){this.resize();this.connect(dojo.isIE?this.domNode:dojo.global,"onresize",function(){this.resize()})}}},resize:function(b,e){var a=this.domNode;if(b){dojo.marginBox(a,b);if(b.t)a.style.top=b.t+"px";if(b.l)a.style.left=b.l+"px"}var d=e||{};dojo.mixin(d,b||{});if(!("h"in d)||!("w"in d))d=dojo.mixin(dojo.marginBox(a),d);var f=dojo.getComputedStyle(a),i=dojo._getMarginExtents(a,f),c=dojo._getBorderExtents(a,f);d=this._borderBox={w:d.w-
(i.w+c.w),h:d.h-(i.h+c.h)};i=dojo._getPadExtents(a,f);this._contentBox={l:dojo._toPixelValue(a,f.paddingLeft),t:dojo._toPixelValue(a,f.paddingTop),w:d.w-i.w,h:d.h-i.h};this.layout()},layout:function(){},_setupChild:function(b){dojo.addClass(b.domNode,this.baseClass+"-child "+(b.baseClass?this.baseClass+"-"+b.baseClass:""))},addChild:function(b){this.inherited(arguments);this._started&&this._setupChild(b)},removeChild:function(b){dojo.removeClass(b.domNode,this.baseClass+"-child"+(b.baseClass?" "+
this.baseClass+"-"+b.baseClass:""));this.inherited(arguments)}});dijit.layout.marginBox2contentBox=function(b,e){var a=dojo.getComputedStyle(b),d=dojo._getMarginExtents(b,a),f=dojo._getPadBorderExtents(b,a);return{l:dojo._toPixelValue(b,a.paddingLeft),t:dojo._toPixelValue(b,a.paddingTop),w:e.w-(d.w+f.w),h:e.h-(d.h+f.h)}};(function(){var b=function(e,a){e.resize?e.resize(a):dojo.marginBox(e.domNode,a);dojo.mixin(e,dojo.marginBox(e.domNode));dojo.mixin(e,a)};dijit.layout.layoutChildren=function(e,a,
d,f,i){a=dojo.mixin({},a);dojo.addClass(e,"dijitLayoutContainer");d=dojo.filter(d,function(c){return c.region!="center"&&c.layoutAlign!="client"}).concat(dojo.filter(d,function(c){return c.region=="center"||c.layoutAlign=="client"}));dojo.forEach(d,function(c){var h=c.domNode,g=c.region||c.layoutAlign,j=h.style;j.left=a.l+"px";j.top=a.t+"px";j.bottom=j.right="auto";dojo.addClass(h,"dijitAlign"+(g.substring(0,1).toUpperCase()+g.substring(1)));h={};if(f&&f==c.id)h[c.region=="top"||c.region=="bottom"?
"h":"w"]=i;if(g=="top"||g=="bottom"){h.w=a.w;b(c,h);a.h-=c.h;if(g=="top")a.t+=c.h;else j.top=a.t+a.h+"px"}else if(g=="left"||g=="right"){h.h=a.h;b(c,h);a.w-=c.w;if(g=="left")a.l+=c.w;else j.left=a.l+a.w+"px"}else if(g=="client"||g=="center")b(c,a)})}})()};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dijit._Templated"]){dojo._hasResource["dijit._Templated"]=true;dojo.provide("dijit._Templated");dojo.require("dijit._Widget");dojo.require("dojo.string");dojo.require("dojo.parser");dojo.require("dojo.cache");dojo.declare("dijit._Templated",null,{templateString:null,templatePath:null,widgetsInTemplate:false,_skipNodeCache:false,_earlyTemplatedStartup:false,constructor:function(){this._attachPoints=[];this._attachEvents=[]},_stringRepl:function(b){var a=this.declaredClass,f=
this;return dojo.string.substitute(b,this,function(e,d){if(d.charAt(0)=="!")e=dojo.getObject(d.substr(1),false,f);if(typeof e=="undefined")throw Error(a+" template:"+d);if(e==null)return"";return d.charAt(0)=="!"?e:e.toString().replace(/"/g,"&quot;")},this)},buildRendering:function(){var b=dijit._Templated.getCachedTemplate(this.templatePath,this.templateString,this._skipNodeCache),a;if(dojo.isString(b)){a=dojo._toDom(this._stringRepl(b));if(a.nodeType!=1)throw Error("Invalid template: "+b);}else a=
b.cloneNode(true);this.domNode=a;this.inherited(arguments);this._attachTemplateNodes(a);if(this.widgetsInTemplate){b=this._startupWidgets=dojo.parser.parse(a,{noStart:!this._earlyTemplatedStartup,template:true,inherited:{dir:this.dir,lang:this.lang},propsThis:this,scope:"dojo"});this._supportingWidgets=dijit.findWidgets(a);this._attachTemplateNodes(b,function(f,e){return f[e]})}this._fillContent(this.srcNodeRef)},_fillContent:function(b){var a=this.containerNode;if(b&&a)for(;b.hasChildNodes();)a.appendChild(b.firstChild)},
_attachTemplateNodes:function(b,a){a=a||function(g,k){return g.getAttribute(k)};for(var f=dojo.isArray(b)?b:b.all||b.getElementsByTagName("*"),e=dojo.isArray(b)?0:-1;e<f.length;e++){var d=e==-1?b:f[e];if(!(this.widgetsInTemplate&&(a(d,"dojoType")||a(d,"data-dojo-type")))){var c=a(d,"dojoAttachPoint")||a(d,"data-dojo-attach-point");if(c)for(var i=c.split(/\s*,\s*/);c=i.shift();){if(dojo.isArray(this[c]))this[c].push(d);else this[c]=d;this._attachPoints.push(c)}if(c=a(d,"dojoAttachEvent")||a(d,"data-dojo-attach-event")){i=
c.split(/\s*,\s*/);for(var j=dojo.trim;c=i.shift();)if(c){var h=null;if(c.indexOf(":")!=-1){h=c.split(":");c=j(h[0]);h=j(h[1])}else c=j(c);h||(h=c);this._attachEvents.push(this.connect(d,c,h))}}(c=a(d,"waiRole"))&&dijit.setWaiRole(d,c);(c=a(d,"waiState"))&&dojo.forEach(c.split(/\s*,\s*/),function(g){if(g.indexOf("-")!=-1){g=g.split("-");dijit.setWaiState(d,g[0],g[1])}})}}},startup:function(){dojo.forEach(this._startupWidgets,function(b){b&&!b._started&&b.startup&&b.startup()});this.inherited(arguments)},
destroyRendering:function(){dojo.forEach(this._attachPoints,function(b){delete this[b]},this);this._attachPoints=[];dojo.forEach(this._attachEvents,this.disconnect,this);this._attachEvents=[];this.inherited(arguments)}});dijit._Templated._templateCache={};dijit._Templated.getCachedTemplate=function(b,a,f){var e=dijit._Templated._templateCache,d=a||b,c=e[d];if(c){try{if(!c.ownerDocument||c.ownerDocument==dojo.doc)return c}catch(i){}dojo.destroy(c)}a||(a=dojo.cache(b,{sanitize:true}));a=dojo.string.trim(a);
if(f||a.match(/\$\{([^\}]+)\}/g))return e[d]=a;else{b=dojo._toDom(a);if(b.nodeType!=1)throw Error("Invalid template: "+a);return e[d]=b}};dojo.isIE&&dojo.addOnWindowUnload(function(){var b=dijit._Templated._templateCache,a;for(a in b){var f=b[a];typeof f=="object"&&dojo.destroy(f);delete b[a]}});dojo.extend(dijit._Widget,{dojoAttachEvent:"",dojoAttachPoint:"",waiRole:"",waiState:""})};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dijit.DialogUnderlay"]){dojo._hasResource["dijit.DialogUnderlay"]=true;dojo.provide("dijit.DialogUnderlay");dojo.require("dojo.window");dojo.require("dijit._Widget");dojo.require("dijit._Templated");dojo.declare("dijit.DialogUnderlay",[dijit._Widget,dijit._Templated],{templateString:"<div class='dijitDialogUnderlayWrapper'><div class='dijitDialogUnderlay' dojoAttachPoint='node'></div></div>",dialogId:"","class":"",attributeMap:{id:"domNode"},_setDialogIdAttr:function(a){dojo.attr(this.node,
"id",a+"_underlay");this._set("dialogId",a)},_setClassAttr:function(a){this.node.className="dijitDialogUnderlay "+a;this._set("class",a)},postCreate:function(){dojo.body().appendChild(this.domNode)},layout:function(){var a=this.node.style,b=this.domNode.style;b.display="none";var c=dojo.window.getBox();b.top=c.t+"px";b.left=c.l+"px";a.width=c.w+"px";a.height=c.h+"px";b.display="block"},show:function(){this.domNode.style.display="block";this.layout();this.bgIframe=new dijit.BackgroundIframe(this.domNode)},
hide:function(){this.bgIframe.destroy();delete this.bgIframe;this.domNode.style.display="none"}})};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dijit.MenuSeparator"]){dojo._hasResource["dijit.MenuSeparator"]=true;dojo.provide("dijit.MenuSeparator");dojo.require("dijit._Widget");dojo.require("dijit._Templated");dojo.require("dijit._Contained");dojo.declare("dijit.MenuSeparator",[dijit._Widget,dijit._Templated,dijit._Contained],{templateString:dojo.cache("dijit","templates/MenuSeparator.html",'<tr class="dijitMenuSeparator">\n\t<td class="dijitMenuSeparatorIconCell">\n\t\t<div class="dijitMenuSeparatorTop"></div>\n\t\t<div class="dijitMenuSeparatorBottom"></div>\n\t</td>\n\t<td colspan="3" class="dijitMenuSeparatorLabelCell">\n\t\t<div class="dijitMenuSeparatorTop dijitMenuSeparatorLabel"></div>\n\t\t<div class="dijitMenuSeparatorBottom"></div>\n\t</td>\n</tr>\n'),
buildRendering:function(){this.inherited(arguments);dojo.setSelectable(this.domNode,false)},isFocusable:function(){return false}})};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dijit.form._FormWidget"]){dojo._hasResource["dijit.form._FormWidget"]=true;dojo.provide("dijit.form._FormWidget");dojo.require("dojo.window");dojo.require("dijit._Widget");dojo.require("dijit._Templated");dojo.require("dijit._CssStateMixin");dojo.declare("dijit.form._FormWidget",[dijit._Widget,dijit._Templated,dijit._CssStateMixin],{name:"",alt:"",value:"",type:"text",tabIndex:"0",disabled:false,intermediateChanges:false,scrollOnFocus:true,attributeMap:dojo.delegate(dijit._Widget.prototype.attributeMap,
{value:"focusNode",id:"focusNode",tabIndex:"focusNode",alt:"focusNode",title:"focusNode"}),postMixInProperties:function(){this.nameAttrSetting=this.name?'name="'+this.name.replace(/'/g,"&quot;")+'"':"";this.inherited(arguments)},postCreate:function(){this.inherited(arguments);this.connect(this.domNode,"onmousedown","_onMouseDown")},_setDisabledAttr:function(a){this._set("disabled",a);dojo.attr(this.focusNode,"disabled",a);this.valueNode&&dojo.attr(this.valueNode,"disabled",a);dijit.setWaiState(this.focusNode,
"disabled",a);if(a){this._set("hovering",false);this._set("active",false);a="tabIndex"in this.attributeMap?this.attributeMap.tabIndex:"focusNode";dojo.forEach(dojo.isArray(a)?a:[a],function(b){b=this[b];dojo.isWebKit||dijit.hasDefaultTabStop(b)?b.setAttribute("tabIndex","-1"):b.removeAttribute("tabIndex")},this)}else this.tabIndex!=""&&this.focusNode.setAttribute("tabIndex",this.tabIndex)},setDisabled:function(a){dojo.deprecated("setDisabled("+a+") is deprecated. Use set('disabled',"+a+") instead.",
"","2.0");this.set("disabled",a)},_onFocus:function(){this.scrollOnFocus&&dojo.window.scrollIntoView(this.domNode);this.inherited(arguments)},isFocusable:function(){return!this.disabled&&this.focusNode&&dojo.style(this.domNode,"display")!="none"},focus:function(){this.disabled||dijit.focus(this.focusNode)},compare:function(a,b){return typeof a=="number"&&typeof b=="number"?isNaN(a)&&isNaN(b)?0:a-b:a>b?1:a<b?-1:0},onChange:function(){},_onChangeActive:false,_handleOnChange:function(a,b){if(this._lastValueReported==
undefined&&(b===null||!this._onChangeActive))this._resetValue=this._lastValueReported=a;this._pendingOnChange=this._pendingOnChange||typeof a!=typeof this._lastValueReported||this.compare(a,this._lastValueReported)!=0;if((this.intermediateChanges||b||b===undefined)&&this._pendingOnChange){this._lastValueReported=a;this._pendingOnChange=false;if(this._onChangeActive){this._onChangeHandle&&clearTimeout(this._onChangeHandle);this._onChangeHandle=setTimeout(dojo.hitch(this,function(){this._onChangeHandle=
null;this.onChange(a)}),0)}}},create:function(){this.inherited(arguments);this._onChangeActive=true},destroy:function(){if(this._onChangeHandle){clearTimeout(this._onChangeHandle);this.onChange(this._lastValueReported)}this.inherited(arguments)},setValue:function(a){dojo.deprecated("dijit.form._FormWidget:setValue("+a+") is deprecated.  Use set('value',"+a+") instead.","","2.0");this.set("value",a)},getValue:function(){dojo.deprecated(this.declaredClass+"::getValue() is deprecated. Use get('value') instead.",
"","2.0");return this.get("value")},_onMouseDown:function(a){if(!a.ctrlKey&&dojo.mouseButtons.isLeft(a)&&this.isFocusable())var b=this.connect(dojo.body(),"onmouseup",function(){this.isFocusable()&&this.focus();this.disconnect(b)})}});dojo.declare("dijit.form._FormValueWidget",dijit.form._FormWidget,{readOnly:false,attributeMap:dojo.delegate(dijit.form._FormWidget.prototype.attributeMap,{value:"",readOnly:"focusNode"}),_setReadOnlyAttr:function(a){dojo.attr(this.focusNode,"readOnly",a);dijit.setWaiState(this.focusNode,
"readonly",a);this._set("readOnly",a)},postCreate:function(){this.inherited(arguments);if(dojo.isIE)this.connect(this.focusNode||this.domNode,"onkeydown",this._onKeyDown);if(this._resetValue===undefined)this._lastValueReported=this._resetValue=this.value},_setValueAttr:function(a,b){this._handleOnChange(a,b)},_handleOnChange:function(a){this._set("value",a);this.inherited(arguments)},undo:function(){this._setValueAttr(this._lastValueReported,false)},reset:function(){this._hasBeenBlurred=false;this._setValueAttr(this._resetValue,
true)},_onKeyDown:function(a){if(a.keyCode==dojo.keys.ESCAPE&&!(a.ctrlKey||a.altKey||a.metaKey)){var b;if(dojo.isIE){a.preventDefault();b=document.createEventObject();b.keyCode=dojo.keys.ESCAPE;b.shiftKey=a.shiftKey;a.srcElement.fireEvent("onkeypress",b)}}},_layoutHackIE7:function(){if(dojo.isIE==7)for(var a=this.domNode,b=a.parentNode,c=a.firstChild||a,e=c.style.filter,d=this;b&&b.clientHeight==0;){(function(){var f=d.connect(b,"onscroll",function(){d.disconnect(f);c.style.filter=(new Date).getMilliseconds();
setTimeout(function(){c.style.filter=e},0)})})();b=b.parentNode}}})};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dijit.MenuItem"]){dojo._hasResource["dijit.MenuItem"]=true;dojo.provide("dijit.MenuItem");dojo.require("dijit._Widget");dojo.require("dijit._Templated");dojo.require("dijit._Contained");dojo.require("dijit._CssStateMixin");dojo.declare("dijit.MenuItem",[dijit._Widget,dijit._Templated,dijit._Contained,dijit._CssStateMixin],{templateString:dojo.cache("dijit","templates/MenuItem.html",'<tr class="dijitReset dijitMenuItem" dojoAttachPoint="focusNode" role="menuitem" tabIndex="-1"\n\t\tdojoAttachEvent="onmouseenter:_onHover,onmouseleave:_onUnhover,ondijitclick:_onClick">\n\t<td class="dijitReset dijitMenuItemIconCell" role="presentation">\n\t\t<img src="${_blankGif}" alt="" class="dijitIcon dijitMenuItemIcon" dojoAttachPoint="iconNode"/>\n\t</td>\n\t<td class="dijitReset dijitMenuItemLabel" colspan="2" dojoAttachPoint="containerNode"></td>\n\t<td class="dijitReset dijitMenuItemAccelKey" style="display: none" dojoAttachPoint="accelKeyNode"></td>\n\t<td class="dijitReset dijitMenuArrowCell" role="presentation">\n\t\t<div dojoAttachPoint="arrowWrapper" style="visibility: hidden">\n\t\t\t<img src="${_blankGif}" alt="" class="dijitMenuExpand"/>\n\t\t\t<span class="dijitMenuExpandA11y">+</span>\n\t\t</div>\n\t</td>\n</tr>\n'),
attributeMap:dojo.delegate(dijit._Widget.prototype.attributeMap,{label:{node:"containerNode",type:"innerHTML"},iconClass:{node:"iconNode",type:"class"}}),baseClass:"dijitMenuItem",label:"",iconClass:"",accelKey:"",disabled:false,_fillContent:function(a){a&&!("label"in this.params)&&this.set("label",a.innerHTML)},buildRendering:function(){this.inherited(arguments);var a=this.id+"_text";dojo.attr(this.containerNode,"id",a);if(this.accelKeyNode){dojo.attr(this.accelKeyNode,"id",this.id+"_accel");a+=
" "+this.id+"_accel"}dijit.setWaiState(this.domNode,"labelledby",a);dojo.setSelectable(this.domNode,false)},_onHover:function(){this.getParent().onItemHover(this)},_onUnhover:function(){this.getParent().onItemUnhover(this);this._set("hovering",false)},_onClick:function(a){this.getParent().onItemClick(this,a);dojo.stopEvent(a)},onClick:function(){},focus:function(){try{dojo.isIE==8&&this.containerNode.focus();dijit.focus(this.focusNode)}catch(a){}},_onFocus:function(){this._setSelected(true);this.getParent()._onItemFocus(this);
this.inherited(arguments)},_setSelected:function(a){dojo.toggleClass(this.domNode,"dijitMenuItemSelected",a)},setLabel:function(a){dojo.deprecated("dijit.MenuItem.setLabel() is deprecated.  Use set('label', ...) instead.","","2.0");this.set("label",a)},setDisabled:function(a){dojo.deprecated("dijit.Menu.setDisabled() is deprecated.  Use set('disabled', bool) instead.","","2.0");this.set("disabled",a)},_setDisabledAttr:function(a){dijit.setWaiState(this.focusNode,"disabled",a?"true":"false");this._set("disabled",
a)},_setAccelKeyAttr:function(a){this.accelKeyNode.style.display=a?"":"none";this.accelKeyNode.innerHTML=a;dojo.attr(this.containerNode,"colSpan",a?"1":"2");this._set("accelKey",a)}})};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dijit.CheckedMenuItem"]){dojo._hasResource["dijit.CheckedMenuItem"]=true;dojo.provide("dijit.CheckedMenuItem");dojo.require("dijit.MenuItem");dojo.declare("dijit.CheckedMenuItem",dijit.MenuItem,{templateString:dojo.cache("dijit","templates/CheckedMenuItem.html",'<tr class="dijitReset dijitMenuItem" dojoAttachPoint="focusNode" role="menuitemcheckbox" tabIndex="-1"\n\t\tdojoAttachEvent="onmouseenter:_onHover,onmouseleave:_onUnhover,ondijitclick:_onClick">\n\t<td class="dijitReset dijitMenuItemIconCell" role="presentation">\n\t\t<img src="${_blankGif}" alt="" class="dijitMenuItemIcon dijitCheckedMenuItemIcon" dojoAttachPoint="iconNode"/>\n\t\t<span class="dijitCheckedMenuItemIconChar">&#10003;</span>\n\t</td>\n\t<td class="dijitReset dijitMenuItemLabel" colspan="2" dojoAttachPoint="containerNode,labelNode"></td>\n\t<td class="dijitReset dijitMenuItemAccelKey" style="display: none" dojoAttachPoint="accelKeyNode"></td>\n\t<td class="dijitReset dijitMenuArrowCell" role="presentation">&nbsp;</td>\n</tr>\n'),
checked:false,_setCheckedAttr:function(a){dojo.toggleClass(this.domNode,"dijitCheckedMenuItemChecked",a);dijit.setWaiState(this.domNode,"checked",a);this._set("checked",a)},onChange:function(){},_onClick:function(){if(!this.disabled){this.set("checked",!this.checked);this.onChange(this.checked)}this.inherited(arguments)}})};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dijit.PopupMenuItem"]){dojo._hasResource["dijit.PopupMenuItem"]=true;dojo.provide("dijit.PopupMenuItem");dojo.require("dijit.MenuItem");dojo.declare("dijit.PopupMenuItem",dijit.MenuItem,{_fillContent:function(){if(this.srcNodeRef){var a=dojo.query("*",this.srcNodeRef);dijit.PopupMenuItem.superclass._fillContent.call(this,a[0]);this.dropDownContainer=this.srcNodeRef}},startup:function(){if(!this._started){this.inherited(arguments);if(!this.popup){var a=dojo.query("[widgetId]",
this.dropDownContainer)[0];this.popup=dijit.byNode(a)}dojo.body().appendChild(this.popup.domNode);this.popup.startup();this.popup.domNode.style.display="none";this.arrowWrapper&&dojo.style(this.arrowWrapper,"visibility","");dijit.setWaiState(this.focusNode,"haspopup","true")}},destroyDescendants:function(){if(this.popup){this.popup._destroyed||this.popup.destroyRecursive();delete this.popup}this.inherited(arguments)}})};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dijit.layout.ContentPane"]){dojo._hasResource["dijit.layout.ContentPane"]=true;dojo.provide("dijit.layout.ContentPane");dojo.require("dijit._Widget");dojo.require("dijit.layout._LayoutWidget");dojo.require("dijit.layout._ContentPaneResizeMixin");dojo.require("dojo.string");dojo.require("dojo.html");dojo.requireLocalization("dijit","loading",null,"ROOT,ar,ca,cs,da,de,el,es,fi,fr,he,hu,it,ja,kk,ko,nb,nl,pl,pt,pt-pt,ro,ru,sk,sl,sv,th,tr,zh,zh-tw");dojo.declare("dijit.layout.ContentPane",
[dijit._Widget,dijit.layout._ContentPaneResizeMixin],{href:"",extractContent:false,parseOnLoad:true,parserScope:dojo._scopeName,preventCache:false,preload:false,refreshOnShow:false,loadingMessage:"<span class='dijitContentPaneLoading'>${loadingState}</span>",errorMessage:"<span class='dijitContentPaneError'>${errorState}</span>",isLoaded:false,baseClass:"dijitContentPane",ioArgs:{},onLoadDeferred:null,attributeMap:dojo.delegate(dijit._Widget.prototype.attributeMap,{title:[]}),stopParser:true,template:false,
create:function(a,b){if((!a||!a.template)&&b&&!("href"in a)&&!("content"in a)){var c=dojo.doc.createDocumentFragment();for(b=dojo.byId(b);b.firstChild;)c.appendChild(b.firstChild);a=dojo.delegate(a,{content:c})}this.inherited(arguments,[a,b])},postMixInProperties:function(){this.inherited(arguments);var a=dojo.i18n.getLocalization("dijit","loading",this.lang);this.loadingMessage=dojo.string.substitute(this.loadingMessage,a);this.errorMessage=dojo.string.substitute(this.errorMessage,a)},buildRendering:function(){this.inherited(arguments);
if(!this.containerNode)this.containerNode=this.domNode;this.domNode.title="";dojo.attr(this.domNode,"role")||dijit.setWaiRole(this.domNode,"group")},_startChildren:function(){this.inherited(arguments);this._contentSetter&&dojo.forEach(this._contentSetter.parseResults,function(a){if(!a._started&&!a._destroyed&&dojo.isFunction(a.startup)){a.startup();a._started=true}},this)},startup:function(){if(!this._started){this.inherited(arguments);this._isShown()&&this._onShow()}},setHref:function(a){dojo.deprecated("dijit.layout.ContentPane.setHref() is deprecated. Use set('href', ...) instead.",
"","2.0");return this.set("href",a)},_setHrefAttr:function(a){this.cancel();this.onLoadDeferred=new dojo.Deferred(dojo.hitch(this,"cancel"));this.onLoadDeferred.addCallback(dojo.hitch(this,"onLoad"));this._set("href",a);if(this.preload||this._created&&this._isShown())this._load();else this._hrefChanged=true;return this.onLoadDeferred},setContent:function(a){dojo.deprecated("dijit.layout.ContentPane.setContent() is deprecated.  Use set('content', ...) instead.","","2.0");this.set("content",a)},_setContentAttr:function(a){this._set("href",
"");this.cancel();this.onLoadDeferred=new dojo.Deferred(dojo.hitch(this,"cancel"));this._created&&this.onLoadDeferred.addCallback(dojo.hitch(this,"onLoad"));this._setContent(a||"");this._isDownloaded=false;return this.onLoadDeferred},_getContentAttr:function(){return this.containerNode.innerHTML},cancel:function(){this._xhrDfd&&this._xhrDfd.fired==-1&&this._xhrDfd.cancel();delete this._xhrDfd;this.onLoadDeferred=null},uninitialize:function(){this._beingDestroyed&&this.cancel();this.inherited(arguments)},
destroyRecursive:function(){this._beingDestroyed||this.inherited(arguments)},resize:function(a,b){!this._wasShown&&this.open!==false&&this._onShow();this._resizeCalled=true;this._scheduleLayout(a,b)},_isShown:function(){if(this._childOfLayoutWidget){if(this._resizeCalled&&"open"in this)return this.open;return this._resizeCalled}else if("open"in this)return this.open;else{var a=this.domNode,b=this.domNode.parentNode;return a.style.display!="none"&&a.style.visibility!="hidden"&&!dojo.hasClass(a,"dijitHidden")&&
b&&b.style&&b.style.display!="none"}},_onShow:function(){if(this.href){if(!this._xhrDfd&&(!this.isLoaded||this._hrefChanged||this.refreshOnShow))var a=this.refresh()}else this._needLayout&&this._layout(this._changeSize,this._resultSize);this.inherited(arguments);this._wasShown=true;return a},refresh:function(){this.cancel();this.onLoadDeferred=new dojo.Deferred(dojo.hitch(this,"cancel"));this.onLoadDeferred.addCallback(dojo.hitch(this,"onLoad"));this._load();return this.onLoadDeferred},_load:function(){this._setContent(this.onDownloadStart(),
true);var a=this,b={preventCache:this.preventCache||this.refreshOnShow,url:this.href,handleAs:"text"};dojo.isObject(this.ioArgs)&&dojo.mixin(b,this.ioArgs);var c=this._xhrDfd=(this.ioMethod||dojo.xhrGet)(b);c.addCallback(function(d){try{a._isDownloaded=true;a._setContent(d,false);a.onDownloadEnd()}catch(e){a._onError("Content",e)}delete a._xhrDfd;return d});c.addErrback(function(d){c.canceled||a._onError("Download",d);delete a._xhrDfd;return d});delete this._hrefChanged},_onLoadHandler:function(a){this._set("isLoaded",
true);try{this.onLoadDeferred.callback(a)}catch(b){console.error("Error "+this.widgetId+" running custom onLoad code: "+b.message)}},_onUnloadHandler:function(){this._set("isLoaded",false);try{this.onUnload()}catch(a){console.error("Error "+this.widgetId+" running custom onUnload code: "+a.message)}},destroyDescendants:function(){this.isLoaded&&this._onUnloadHandler();var a=this._contentSetter;dojo.forEach(this.getChildren(),function(b){b.destroyRecursive&&b.destroyRecursive()});if(a){dojo.forEach(a.parseResults,
function(b){b.destroyRecursive&&b.domNode&&b.domNode.parentNode==dojo.body()&&b.destroyRecursive()});delete a.parseResults}dojo.html._emptyNode(this.containerNode);delete this._singleChild},_setContent:function(a,b){this.destroyDescendants();var c=this._contentSetter;if(!(c&&c instanceof dojo.html._ContentSetter))c=this._contentSetter=new dojo.html._ContentSetter({node:this.containerNode,_onError:dojo.hitch(this,this._onError),onContentError:dojo.hitch(this,function(e){e=this.onContentError(e);try{this.containerNode.innerHTML=
e}catch(f){console.error("Fatal "+this.id+" could not change content due to "+f.message,f)}})});var d=dojo.mixin({cleanContent:this.cleanContent,extractContent:this.extractContent,parseContent:this.parseOnLoad,parserScope:this.parserScope,startup:false,dir:this.dir,lang:this.lang},this._contentSetterParams||{});c.set(dojo.isObject(a)&&a.domNode?a.domNode:a,d);delete this._contentSetterParams;this.doLayout&&this._checkIfSingleChild();if(!b){if(this._started){this._startChildren();this._scheduleLayout()}this._onLoadHandler(a)}},
_onError:function(a,b,c){this.onLoadDeferred.errback(b);a=this["on"+a+"Error"].call(this,b);if(c)console.error(c,b);else a&&this._setContent(a,true)},_scheduleLayout:function(a,b){if(this._isShown())this._layout(a,b);else{this._needLayout=true;this._changeSize=a;this._resultSize=b}},onLoad:function(){},onUnload:function(){},onDownloadStart:function(){return this.loadingMessage},onContentError:function(){},onDownloadError:function(){return this.errorMessage},onDownloadEnd:function(){}})};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dijit.form.Button"]){dojo._hasResource["dijit.form.Button"]=true;dojo.provide("dijit.form.Button");dojo.require("dijit.form._FormWidget");dojo.require("dijit._Container");dojo.require("dijit._HasDropDown");dojo.declare("dijit.form.Button",dijit.form._FormWidget,{label:"",showLabel:true,iconClass:"",type:"button",baseClass:"dijitButton",templateString:dojo.cache("dijit.form","templates/Button.html",'<span class="dijit dijitReset dijitInline"\n\t><span class="dijitReset dijitInline dijitButtonNode"\n\t\tdojoAttachEvent="ondijitclick:_onButtonClick"\n\t\t><span class="dijitReset dijitStretch dijitButtonContents"\n\t\t\tdojoAttachPoint="titleNode,focusNode"\n\t\t\trole="button" aria-labelledby="${id}_label"\n\t\t\t><span class="dijitReset dijitInline dijitIcon" dojoAttachPoint="iconNode"></span\n\t\t\t><span class="dijitReset dijitToggleButtonIconChar">&#x25CF;</span\n\t\t\t><span class="dijitReset dijitInline dijitButtonText"\n\t\t\t\tid="${id}_label"\n\t\t\t\tdojoAttachPoint="containerNode"\n\t\t\t></span\n\t\t></span\n\t></span\n\t><input ${!nameAttrSetting} type="${type}" value="${value}" class="dijitOffScreen"\n\t\tdojoAttachPoint="valueNode"\n/></span>\n'),
attributeMap:dojo.delegate(dijit.form._FormWidget.prototype.attributeMap,{value:"valueNode"}),_onClick:function(a){if(this.disabled)return false;this._clicked();return this.onClick(a)},_onButtonClick:function(a){if(this._onClick(a)===false)a.preventDefault();else if(this.type=="submit"&&!(this.valueNode||this.focusNode).form)for(var b=this.domNode;b.parentNode;b=b.parentNode){var c=dijit.byNode(b);if(c&&typeof c._onSubmit=="function"){c._onSubmit(a);break}}else if(this.valueNode){this.valueNode.click();
a.preventDefault()}},buildRendering:function(){this.inherited(arguments);dojo.setSelectable(this.focusNode,false)},_fillContent:function(a){if(a&&(!this.params||!("label"in this.params)))this.set("label",a.innerHTML)},_setShowLabelAttr:function(a){this.containerNode&&dojo.toggleClass(this.containerNode,"dijitDisplayNone",!a);this._set("showLabel",a)},onClick:function(){return true},_clicked:function(){},setLabel:function(a){dojo.deprecated("dijit.form.Button.setLabel() is deprecated.  Use set('label', ...) instead.",
"","2.0");this.set("label",a)},_setLabelAttr:function(a){this._set("label",a);this.containerNode.innerHTML=a;if(this.showLabel==false&&!this.params.title)this.titleNode.title=dojo.trim(this.containerNode.innerText||this.containerNode.textContent||"")},_setIconClassAttr:function(a){dojo.replaceClass(this.iconNode,a||"dijitNoIcon",this.iconClass||"dijitNoIcon");this._set("iconClass",a)}});dojo.declare("dijit.form.DropDownButton",[dijit.form.Button,dijit._Container,dijit._HasDropDown],{baseClass:"dijitDropDownButton",
templateString:dojo.cache("dijit.form","templates/DropDownButton.html",'<span class="dijit dijitReset dijitInline"\n\t><span class=\'dijitReset dijitInline dijitButtonNode\'\n\t\tdojoAttachEvent="ondijitclick:_onButtonClick" dojoAttachPoint="_buttonNode"\n\t\t><span class="dijitReset dijitStretch dijitButtonContents"\n\t\t\tdojoAttachPoint="focusNode,titleNode,_arrowWrapperNode"\n\t\t\trole="button" aria-haspopup="true" aria-labelledby="${id}_label"\n\t\t\t><span class="dijitReset dijitInline dijitIcon"\n\t\t\t\tdojoAttachPoint="iconNode"\n\t\t\t></span\n\t\t\t><span class="dijitReset dijitInline dijitButtonText"\n\t\t\t\tdojoAttachPoint="containerNode,_popupStateNode"\n\t\t\t\tid="${id}_label"\n\t\t\t></span\n\t\t\t><span class="dijitReset dijitInline dijitArrowButtonInner"></span\n\t\t\t><span class="dijitReset dijitInline dijitArrowButtonChar">&#9660;</span\n\t\t></span\n\t></span\n\t><input ${!nameAttrSetting} type="${type}" value="${value}" class="dijitOffScreen"\n\t\tdojoAttachPoint="valueNode"\n/></span>\n'),
_fillContent:function(){if(this.srcNodeRef){var a=dojo.query("*",this.srcNodeRef);dijit.form.DropDownButton.superclass._fillContent.call(this,a[0]);this.dropDownContainer=this.srcNodeRef}},startup:function(){if(!this._started){if(!this.dropDown&&this.dropDownContainer){var a=dojo.query("[widgetId]",this.dropDownContainer)[0];this.dropDown=dijit.byNode(a);delete this.dropDownContainer}this.dropDown&&dijit.popup.hide(this.dropDown);this.inherited(arguments)}},isLoaded:function(){var a=this.dropDown;
return!!a&&(!a.href||a.isLoaded)},loadDropDown:function(){var a=this.dropDown;if(a)if(this.isLoaded())this.openDropDown();else{var b=dojo.connect(a,"onLoad",this,function(){dojo.disconnect(b);this.openDropDown()});a.refresh()}},isFocusable:function(){return this.inherited(arguments)&&!this._mouseDown}});dojo.declare("dijit.form.ComboButton",dijit.form.DropDownButton,{templateString:dojo.cache("dijit.form","templates/ComboButton.html",'<table class="dijit dijitReset dijitInline dijitLeft"\n\tcellspacing=\'0\' cellpadding=\'0\' role="presentation"\n\t><tbody role="presentation"><tr role="presentation"\n\t\t><td class="dijitReset dijitStretch dijitButtonNode" dojoAttachPoint="buttonNode" dojoAttachEvent="ondijitclick:_onButtonClick,onkeypress:_onButtonKeyPress"\n\t\t><div id="${id}_button" class="dijitReset dijitButtonContents"\n\t\t\tdojoAttachPoint="titleNode"\n\t\t\trole="button" aria-labelledby="${id}_label"\n\t\t\t><div class="dijitReset dijitInline dijitIcon" dojoAttachPoint="iconNode" role="presentation"></div\n\t\t\t><div class="dijitReset dijitInline dijitButtonText" id="${id}_label" dojoAttachPoint="containerNode" role="presentation"></div\n\t\t></div\n\t\t></td\n\t\t><td id="${id}_arrow" class=\'dijitReset dijitRight dijitButtonNode dijitArrowButton\'\n\t\t\tdojoAttachPoint="_popupStateNode,focusNode,_buttonNode"\n\t\t\tdojoAttachEvent="onkeypress:_onArrowKeyPress"\n\t\t\ttitle="${optionsTitle}"\n\t\t\trole="button" aria-haspopup="true"\n\t\t\t><div class="dijitReset dijitArrowButtonInner" role="presentation"></div\n\t\t\t><div class="dijitReset dijitArrowButtonChar" role="presentation">&#9660;</div\n\t\t></td\n\t\t><td style="display:none !important;"\n\t\t\t><input ${!nameAttrSetting} type="${type}" value="${value}" dojoAttachPoint="valueNode"\n\t\t/></td></tr></tbody\n></table>\n'),
attributeMap:dojo.mixin(dojo.clone(dijit.form.Button.prototype.attributeMap),{id:"",tabIndex:["focusNode","titleNode"],title:"titleNode"}),optionsTitle:"",baseClass:"dijitComboButton",cssStateNodes:{buttonNode:"dijitButtonNode",titleNode:"dijitButtonContents",_popupStateNode:"dijitDownArrowButton"},_focusedNode:null,_onButtonKeyPress:function(a){if(a.charOrCode==dojo.keys[this.isLeftToRight()?"RIGHT_ARROW":"LEFT_ARROW"]){dijit.focus(this._popupStateNode);dojo.stopEvent(a)}},_onArrowKeyPress:function(a){if(a.charOrCode==
dojo.keys[this.isLeftToRight()?"LEFT_ARROW":"RIGHT_ARROW"]){dijit.focus(this.titleNode);dojo.stopEvent(a)}},focus:function(a){this.disabled||dijit.focus(a=="start"?this.titleNode:this._popupStateNode)}});dojo.declare("dijit.form.ToggleButton",dijit.form.Button,{baseClass:"dijitToggleButton",checked:false,attributeMap:dojo.mixin(dojo.clone(dijit.form.Button.prototype.attributeMap),{checked:"focusNode"}),_clicked:function(){this.set("checked",!this.checked)},_setCheckedAttr:function(a,b){this._set("checked",
a);dojo.attr(this.focusNode||this.domNode,"checked",a);dijit.setWaiState(this.focusNode||this.domNode,"pressed",a);this._handleOnChange(a,b)},setChecked:function(a){dojo.deprecated("setChecked("+a+") is deprecated. Use set('checked',"+a+") instead.","","2.0");this.set("checked",a)},reset:function(){this._hasBeenBlurred=false;this.set("checked",this.params.checked||false)}})};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dijit.form.DropDownButton"]){dojo._hasResource["dijit.form.DropDownButton"]=true;dojo.provide("dijit.form.DropDownButton");dojo.require("dijit.form.Button")};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dijit.form.ToggleButton"]){dojo._hasResource["dijit.form.ToggleButton"]=true;dojo.provide("dijit.form.ToggleButton");dojo.require("dijit.form.Button")};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dijit.TooltipDialog"]){dojo._hasResource["dijit.TooltipDialog"]=true;dojo.provide("dijit.TooltipDialog");dojo.require("dijit.layout.ContentPane");dojo.require("dijit._Templated");dojo.require("dijit.form._FormMixin");dojo.require("dijit._DialogMixin");dojo.declare("dijit.TooltipDialog",[dijit.layout.ContentPane,dijit._Templated,dijit.form._FormMixin,dijit._DialogMixin],{title:"",doLayout:false,autofocus:true,baseClass:"dijitTooltipDialog",_firstFocusItem:null,_lastFocusItem:null,
templateString:dojo.cache("dijit","templates/TooltipDialog.html",'<div role="presentation" tabIndex="-1">\n\t<div class="dijitTooltipContainer" role="presentation">\n\t\t<div class ="dijitTooltipContents dijitTooltipFocusNode" dojoAttachPoint="containerNode" role="dialog"></div>\n\t</div>\n\t<div class="dijitTooltipConnector" role="presentation"></div>\n</div>\n'),_setTitleAttr:function(a){this.containerNode.title=a;this._set("title",a)},postCreate:function(){this.inherited(arguments);this.connect(this.containerNode,
"onkeypress","_onKey")},orient:function(a,c,b){a="dijitTooltipAB"+(b.charAt(1)=="L"?"Left":"Right")+" dijitTooltip"+(b.charAt(0)=="T"?"Below":"Above");dojo.replaceClass(this.domNode,a,this._currentOrientClass||"");this._currentOrientClass=a},focus:function(){this._getFocusItems(this.containerNode);dijit.focus(this._firstFocusItem)},onOpen:function(a){this.orient(this.domNode,a.aroundCorner,a.corner);this._onShow()},onClose:function(){this.onHide()},_onKey:function(a){var c=a.target,b=dojo.keys;a.charOrCode===
b.TAB&&this._getFocusItems(this.containerNode);var d=this._firstFocusItem==this._lastFocusItem;if(a.charOrCode==b.ESCAPE){setTimeout(dojo.hitch(this,"onCancel"),0);dojo.stopEvent(a)}else if(c==this._firstFocusItem&&a.shiftKey&&a.charOrCode===b.TAB){d||dijit.focus(this._lastFocusItem);dojo.stopEvent(a)}else if(c==this._lastFocusItem&&a.charOrCode===b.TAB&&!a.shiftKey){d||dijit.focus(this._firstFocusItem);dojo.stopEvent(a)}else a.charOrCode===b.TAB&&a.stopPropagation()}})};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dijit.Menu"]){dojo._hasResource["dijit.Menu"]=true;dojo.provide("dijit.Menu");dojo.require("dojo.window");dojo.require("dijit._Widget");dojo.require("dijit._KeyNavContainer");dojo.require("dijit._Templated");dojo.require("dijit.MenuItem");dojo.require("dijit.PopupMenuItem");dojo.require("dijit.CheckedMenuItem");dojo.require("dijit.MenuSeparator");dojo.declare("dijit._MenuBase",[dijit._Widget,dijit._Templated,dijit._KeyNavContainer],{parentMenu:null,popupDelay:500,startup:function(){if(!this._started){dojo.forEach(this.getChildren(),
function(a){a.startup()});this.startupKeyNavChildren();this.inherited(arguments)}},onExecute:function(){},onCancel:function(){},_moveToPopup:function(a){if(this.focusedChild&&this.focusedChild.popup&&!this.focusedChild.disabled)this.focusedChild._onClick(a);else(a=this._getTopMenu())&&a._isMenuBar&&a.focusNext()},_onPopupHover:function(){if(this.currentPopup&&this.currentPopup._pendingClose_timer){var a=this.currentPopup.parentMenu;a.focusedChild&&a.focusedChild._setSelected(false);a.focusedChild=
this.currentPopup.from_item;a.focusedChild._setSelected(true);this._stopPendingCloseTimer(this.currentPopup)}},onItemHover:function(a){if(this.isActive){this.focusChild(a);if(this.focusedChild.popup&&!this.focusedChild.disabled&&!this.hover_timer)this.hover_timer=setTimeout(dojo.hitch(this,"_openPopup"),this.popupDelay)}this.focusedChild&&this.focusChild(a);this._hoveredChild=a},_onChildBlur:function(a){this._stopPopupTimer();a._setSelected(false);var b=a.popup;if(b){this._stopPendingCloseTimer(b);
b._pendingClose_timer=setTimeout(function(){b._pendingClose_timer=null;if(b.parentMenu)b.parentMenu.currentPopup=null;dijit.popup.close(b)},this.popupDelay)}},onItemUnhover:function(a){this.isActive&&this._stopPopupTimer();if(this._hoveredChild==a)this._hoveredChild=null},_stopPopupTimer:function(){if(this.hover_timer){clearTimeout(this.hover_timer);this.hover_timer=null}},_stopPendingCloseTimer:function(a){if(a._pendingClose_timer){clearTimeout(a._pendingClose_timer);a._pendingClose_timer=null}},
_stopFocusTimer:function(){if(this._focus_timer){clearTimeout(this._focus_timer);this._focus_timer=null}},_getTopMenu:function(){for(var a=this;a.parentMenu;a=a.parentMenu);return a},onItemClick:function(a,b){typeof this.isShowingNow=="undefined"&&this._markActive();this.focusChild(a);if(a.disabled)return false;if(a.popup)this._openPopup();else{this.onExecute();a.onClick(b)}},_openPopup:function(){this._stopPopupTimer();var a=this.focusedChild;if(a){var b=a.popup;if(!b.isShowingNow){if(this.currentPopup){this._stopPendingCloseTimer(this.currentPopup);
dijit.popup.close(this.currentPopup)}b.parentMenu=this;b.from_item=a;var c=this;dijit.popup.open({parent:this,popup:b,around:a.domNode,orient:this._orient||(this.isLeftToRight()?{TR:"TL",TL:"TR",BR:"BL",BL:"BR"}:{TL:"TR",TR:"TL",BL:"BR",BR:"BL"}),onCancel:function(){c.focusChild(a);c._cleanUp();a._setSelected(true);c.focusedChild=a},onExecute:dojo.hitch(this,"_cleanUp")});this.currentPopup=b;b.connect(b.domNode,"onmouseenter",dojo.hitch(c,"_onPopupHover"));if(b.focus)b._focus_timer=setTimeout(dojo.hitch(b,
function(){this._focus_timer=null;this.focus()}),0)}}},_markActive:function(){this.isActive=true;dojo.replaceClass(this.domNode,"dijitMenuActive","dijitMenuPassive")},onOpen:function(){this.isShowingNow=true;this._markActive()},_markInactive:function(){this.isActive=false;dojo.replaceClass(this.domNode,"dijitMenuPassive","dijitMenuActive")},onClose:function(){this._stopFocusTimer();this._markInactive();this.isShowingNow=false;this.parentMenu=null},_closeChild:function(){this._stopPopupTimer();if(this.currentPopup){dijit._curFocus&&
dojo.isDescendant(dijit._curFocus,this.currentPopup.domNode)&&this.focusedChild.focusNode.focus();dijit.popup.close(this.currentPopup);this.currentPopup=null}if(this.focusedChild){this.focusedChild._setSelected(false);this.focusedChild._onUnhover();this.focusedChild=null}},_onItemFocus:function(a){this._hoveredChild&&this._hoveredChild!=a&&this._hoveredChild._onUnhover()},_onBlur:function(){this._cleanUp();this.inherited(arguments)},_cleanUp:function(){this._closeChild();typeof this.isShowingNow==
"undefined"&&this._markInactive()}});dojo.declare("dijit.Menu",dijit._MenuBase,{constructor:function(){this._bindings=[]},templateString:dojo.cache("dijit","templates/Menu.html",'<table class="dijit dijitMenu dijitMenuPassive dijitReset dijitMenuTable" role="menu" tabIndex="${tabIndex}" dojoAttachEvent="onkeypress:_onKeyPress" cellspacing="0">\n\t<tbody class="dijitReset" dojoAttachPoint="containerNode"></tbody>\n</table>\n'),baseClass:"dijitMenu",targetNodeIds:[],contextMenuForWindow:false,leftClickToOpen:false,
refocus:true,postCreate:function(){this.contextMenuForWindow?this.bindDomNode(dojo.body()):dojo.forEach(this.targetNodeIds,this.bindDomNode,this);var a=dojo.keys,b=this.isLeftToRight();this._openSubMenuKey=b?a.RIGHT_ARROW:a.LEFT_ARROW;this._closeSubMenuKey=b?a.LEFT_ARROW:a.RIGHT_ARROW;this.connectKeyNavHandlers([a.UP_ARROW],[a.DOWN_ARROW])},_onKeyPress:function(a){if(!(a.ctrlKey||a.altKey))switch(a.charOrCode){case this._openSubMenuKey:this._moveToPopup(a);dojo.stopEvent(a);break;case this._closeSubMenuKey:if(this.parentMenu)this.parentMenu._isMenuBar?
this.parentMenu.focusPrev():this.onCancel(false);else dojo.stopEvent(a)}},_iframeContentWindow:function(a){return dojo.window.get(this._iframeContentDocument(a))||this._iframeContentDocument(a).__parent__||a.name&&dojo.doc.frames[a.name]||null},_iframeContentDocument:function(a){return a.contentDocument||a.contentWindow&&a.contentWindow.document||a.name&&dojo.doc.frames[a.name]&&dojo.doc.frames[a.name].document||null},bindDomNode:function(a){a=dojo.byId(a);var b;if(a.tagName.toLowerCase()=="iframe"){var c=
a,e=this._iframeContentWindow(c);b=dojo.withGlobal(e,dojo.body)}else b=a==dojo.body()?dojo.doc.documentElement:a;var d={node:a,iframe:c};dojo.attr(a,"_dijitMenu"+this.id,this._bindings.push(d));var f=dojo.hitch(this,function(h){return[dojo.connect(h,this.leftClickToOpen?"onclick":"oncontextmenu",this,function(g){dojo.stopEvent(g);this._scheduleOpen(g.target,c,{x:g.pageX,y:g.pageY})}),dojo.connect(h,"onkeydown",this,function(g){if(g.shiftKey&&g.keyCode==dojo.keys.F10){dojo.stopEvent(g);this._scheduleOpen(g.target,
c)}})]});d.connects=b?f(b):[];if(c){d.onloadHandler=dojo.hitch(this,function(){var h=this._iframeContentWindow(c);b=dojo.withGlobal(h,dojo.body);d.connects=f(b)});c.addEventListener?c.addEventListener("load",d.onloadHandler,false):c.attachEvent("onload",d.onloadHandler)}},unBindDomNode:function(a){var b;try{b=dojo.byId(a)}catch(c){return}a="_dijitMenu"+this.id;if(b&&dojo.hasAttr(b,a)){var e=dojo.attr(b,a)-1,d=this._bindings[e];dojo.forEach(d.connects,dojo.disconnect);var f=d.iframe;if(f)f.removeEventListener?
f.removeEventListener("load",d.onloadHandler,false):f.detachEvent("onload",d.onloadHandler);dojo.removeAttr(b,a);delete this._bindings[e]}},_scheduleOpen:function(a,b,c){if(!this._openTimer)this._openTimer=setTimeout(dojo.hitch(this,function(){delete this._openTimer;this._openMyself({target:a,iframe:b,coords:c})}),1)},_openMyself:function(a){function b(){i.refocus&&dijit.focus(j);dijit.popup.close(i)}var c=a.target,e=a.iframe;if(a=a.coords){if(e){c=dojo.position(e,true);var d=this._iframeContentWindow(e);
d=dojo.withGlobal(d,"_docScroll",dojo);var f=dojo.getComputedStyle(e),h=dojo._toPixelValue,g=(dojo.isIE&&dojo.isQuirks?0:h(e,f.paddingLeft))+(dojo.isIE&&dojo.isQuirks?h(e,f.borderLeftWidth):0);e=(dojo.isIE&&dojo.isQuirks?0:h(e,f.paddingTop))+(dojo.isIE&&dojo.isQuirks?h(e,f.borderTopWidth):0);a.x+=c.x+g-d.x;a.y+=c.y+e-d.y}}else{a=dojo.position(c,true);a.x+=10;a.y+=10}var i=this,j=dijit.getFocus(this);dijit.popup.open({popup:this,x:a.x,y:a.y,onExecute:b,onCancel:b,orient:this.isLeftToRight()?"L":"R"});
this.focus();this._onBlur=function(){this.inherited("_onBlur",arguments);dijit.popup.close(this)}},uninitialize:function(){dojo.forEach(this._bindings,function(a){a&&this.unBindDomNode(a.node)},this);this.inherited(arguments)}})};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dijit.Dialog"]){dojo._hasResource["dijit.Dialog"]=true;dojo.provide("dijit.Dialog");dojo.require("dojo.dnd.move");dojo.require("dojo.dnd.TimedMoveable");dojo.require("dojo.fx");dojo.require("dojo.window");dojo.require("dijit._Widget");dojo.require("dijit._Templated");dojo.require("dijit._CssStateMixin");dojo.require("dijit.form._FormMixin");dojo.require("dijit._DialogMixin");dojo.require("dijit.DialogUnderlay");dojo.require("dijit.layout.ContentPane");dojo.requireLocalization("dijit",
"common",null,"ROOT,ar,ca,cs,da,de,el,es,fi,fr,he,hu,it,ja,kk,ko,nb,nl,pl,pt,pt-pt,ro,ru,sk,sl,sv,th,tr,zh,zh-tw");dojo.require("dijit.TooltipDialog");dojo.declare("dijit._DialogBase",[dijit._Templated,dijit.form._FormMixin,dijit._DialogMixin,dijit._CssStateMixin],{templateString:dojo.cache("dijit","templates/Dialog.html",'<div class="dijitDialog" role="dialog" aria-labelledby="${id}_title">\n\t<div dojoAttachPoint="titleBar" class="dijitDialogTitleBar">\n\t<span dojoAttachPoint="titleNode" class="dijitDialogTitle" id="${id}_title"></span>\n\t<span dojoAttachPoint="closeButtonNode" class="dijitDialogCloseIcon" dojoAttachEvent="ondijitclick: onCancel" title="${buttonCancel}" role="button" tabIndex="-1">\n\t\t<span dojoAttachPoint="closeText" class="closeText" title="${buttonCancel}">x</span>\n\t</span>\n\t</div>\n\t\t<div dojoAttachPoint="containerNode" class="dijitDialogPaneContent"></div>\n</div>\n'),
baseClass:"dijitDialog",cssStateNodes:{closeButtonNode:"dijitDialogCloseIcon"},attributeMap:dojo.delegate(dijit._Widget.prototype.attributeMap,{title:[{node:"titleNode",type:"innerHTML"},{node:"titleBar",type:"attribute"}],"aria-describedby":""}),open:false,duration:dijit.defaultDuration,refocus:true,autofocus:true,_firstFocusItem:null,_lastFocusItem:null,doLayout:false,draggable:true,"aria-describedby":"",postMixInProperties:function(){var a=dojo.i18n.getLocalization("dijit","common");dojo.mixin(this,
a);this.inherited(arguments)},postCreate:function(){dojo.style(this.domNode,{display:"none",position:"absolute"});dojo.body().appendChild(this.domNode);this.inherited(arguments);this.connect(this,"onExecute","hide");this.connect(this,"onCancel","hide");this._modalconnects=[]},onLoad:function(){this._position();if(this.autofocus&&dijit._DialogLevelManager.isTop(this)){this._getFocusItems(this.domNode);dijit.focus(this._firstFocusItem)}this.inherited(arguments)},_endDrag:function(a){if(a&&a.node&&a.node===
this.domNode)this._relativePosition=dojo.position(a.node)},_setup:function(){var a=this.domNode;if(this.titleBar&&this.draggable){this._moveable=dojo.isIE==6?new dojo.dnd.TimedMoveable(a,{handle:this.titleBar}):new dojo.dnd.Moveable(a,{handle:this.titleBar,timeout:0});this._dndListener=dojo.subscribe("/dnd/move/stop",this,"_endDrag")}else dojo.addClass(a,"dijitDialogFixed");this.underlayAttrs={dialogId:this.id,"class":dojo.map(this["class"].split(/\s/),function(b){return b+"_underlay"}).join(" ")}},
_size:function(){this._checkIfSingleChild();if(this._singleChild){if(this._singleChildOriginalStyle)this._singleChild.domNode.style.cssText=this._singleChildOriginalStyle;delete this._singleChildOriginalStyle}else dojo.style(this.containerNode,{width:"auto",height:"auto"});var a=dojo._getMarginSize(this.domNode),b=dojo.window.getBox();if(a.w>=b.w||a.h>=b.h){var c=Math.min(a.w,Math.floor(b.w*0.75));a=Math.min(a.h,Math.floor(b.h*0.75));if(this._singleChild&&this._singleChild.resize){this._singleChildOriginalStyle=
this._singleChild.domNode.style.cssText;this._singleChild.resize({w:c,h:a})}else dojo.style(this.containerNode,{width:c+"px",height:a+"px",overflow:"auto",position:"relative"})}else this._singleChild&&this._singleChild.resize&&this._singleChild.resize()},_position:function(){if(!dojo.hasClass(dojo.body(),"dojoMove")){var a=this.domNode,b=dojo.window.getBox(),c=this._relativePosition,d=c?null:dojo._getBorderBox(a);dojo.style(a,{left:Math.floor(b.l+(c?c.x:(b.w-d.w)/2))+"px",top:Math.floor(b.t+(c?c.y:
(b.h-d.h)/2))+"px"})}},_onKey:function(a){if(a.charOrCode){var b=dojo.keys,c=a.target;a.charOrCode===b.TAB&&this._getFocusItems(this.domNode);var d=this._firstFocusItem==this._lastFocusItem;if(c==this._firstFocusItem&&a.shiftKey&&a.charOrCode===b.TAB){d||dijit.focus(this._lastFocusItem);dojo.stopEvent(a)}else if(c==this._lastFocusItem&&a.charOrCode===b.TAB&&!a.shiftKey){d||dijit.focus(this._firstFocusItem);dojo.stopEvent(a)}else{for(;c;){if(c==this.domNode||dojo.hasClass(c,"dijitPopup"))if(a.charOrCode==
b.ESCAPE)this.onCancel();else return;c=c.parentNode}if(a.charOrCode!==b.TAB)dojo.stopEvent(a);else if(!dojo.isOpera)try{this._firstFocusItem.focus()}catch(e){}}}},show:function(){if(!this.open){this._started||this.startup();if(!this._alreadyInitialized){this._setup();this._alreadyInitialized=true}this._fadeOutDeferred&&this._fadeOutDeferred.cancel();this._modalconnects.push(dojo.connect(window,"onscroll",this,"layout"));this._modalconnects.push(dojo.connect(window,"onresize",this,function(){var b=
dojo.window.getBox();if(!this._oldViewport||b.h!=this._oldViewport.h||b.w!=this._oldViewport.w){this.layout();this._oldViewport=b}}));this._modalconnects.push(dojo.connect(this.domNode,"onkeypress",this,"_onKey"));dojo.style(this.domNode,{opacity:0,display:""});this._set("open",true);this._onShow();this._size();this._position();var a;this._fadeInDeferred=new dojo.Deferred(dojo.hitch(this,function(){a.stop();delete this._fadeInDeferred}));a=dojo.fadeIn({node:this.domNode,duration:this.duration,beforeBegin:dojo.hitch(this,
function(){dijit._DialogLevelManager.show(this,this.underlayAttrs)}),onEnd:dojo.hitch(this,function(){if(this.autofocus&&dijit._DialogLevelManager.isTop(this)){this._getFocusItems(this.domNode);dijit.focus(this._firstFocusItem)}this._fadeInDeferred.callback(true);delete this._fadeInDeferred})}).play();return this._fadeInDeferred}},hide:function(){if(this._alreadyInitialized){this._fadeInDeferred&&this._fadeInDeferred.cancel();var a;this._fadeOutDeferred=new dojo.Deferred(dojo.hitch(this,function(){a.stop();
delete this._fadeOutDeferred}));a=dojo.fadeOut({node:this.domNode,duration:this.duration,onEnd:dojo.hitch(this,function(){this.domNode.style.display="none";dijit._DialogLevelManager.hide(this);this.onHide();this._fadeOutDeferred.callback(true);delete this._fadeOutDeferred})}).play();if(this._scrollConnected)this._scrollConnected=false;dojo.forEach(this._modalconnects,dojo.disconnect);this._modalconnects=[];this._relativePosition&&delete this._relativePosition;this._set("open",false);return this._fadeOutDeferred}},
layout:function(){if(this.domNode.style.display!="none"){dijit._underlay&&dijit._underlay.layout();this._position()}},destroy:function(){this._fadeInDeferred&&this._fadeInDeferred.cancel();this._fadeOutDeferred&&this._fadeOutDeferred.cancel();this._moveable&&this._moveable.destroy();this._dndListener&&dojo.unsubscribe(this._dndListener);dojo.forEach(this._modalconnects,dojo.disconnect);dijit._DialogLevelManager.hide(this);this.inherited(arguments)}});dojo.declare("dijit.Dialog",[dijit.layout.ContentPane,
dijit._DialogBase],{});dijit._DialogLevelManager={show:function(a,b){var c=dijit._dialogStack;c[c.length-1].focus=dijit.getFocus(a);var d=dijit._underlay;if(!d||d._destroyed)d=dijit._underlay=new dijit.DialogUnderlay(b);else d.set(a.underlayAttrs);var e=c[c.length-1].dialog?c[c.length-1].zIndex+2:950;c.length==1&&d.show();dojo.style(dijit._underlay.domNode,"zIndex",e-1);dojo.style(a.domNode,"zIndex",e);c.push({dialog:a,underlayAttrs:b,zIndex:e})},hide:function(a){var b=dijit._dialogStack;if(b[b.length-
1].dialog==a){b.pop();var c=b[b.length-1];if(b.length==1)dijit._underlay._destroyed||dijit._underlay.hide();else{dojo.style(dijit._underlay.domNode,"zIndex",c.zIndex-1);dijit._underlay.set(c.underlayAttrs)}if(a.refocus){b=c.focus;if(!b||c.dialog&&!dojo.isDescendant(b.node,c.dialog.domNode)){c.dialog._getFocusItems(c.dialog.domNode);b=c.dialog._firstFocusItem}try{dijit.focus(b)}catch(d){}}}else{c=dojo.indexOf(dojo.map(b,function(e){return e.dialog}),a);c!=-1&&b.splice(c,1)}},isTop:function(a){var b=
dijit._dialogStack;return b[b.length-1].dialog==a}};dijit._dialogStack=[{dialog:null,focus:null,underlayAttrs:null}]};
if (typeof dojo !== "undefined") {
  dojo.provide("blueKai.blueKai");
}

/* global blueKai document unescape */
if (typeof blueKai === "undefined") {
	blueKai = {};
}
var KRUXSetup = {
	pubid:"1c6ac852-8938-481a-84b8-4806affc8c13", 
    async: true

};
blueKai.blueKai = {
	dataJson :{},
	timercounter:0,	
	adDivs:[],
	bk_track:function(check, data){
		if(check && document.location.protocol.indexOf('https')==-1){
			if(data){
				this.dataJson = data;
				this.sendBlueKai();
			}else{
				this.adDivs = this.getbyclass();	
				if(!this.getData()){
					return;
				}
			}
		}
	},
	sendBlueKai: function(){
		/* 2.4.0-31349 */ 
		if(typeof BKTAG=="undefined"||!BKTAG){var BKTAG=(function(){var params=[];var doTagged=false;var _={getKwds:function(){var meta=document.getElementsByTagName('meta');var kwds=[];var ii=meta.length;for(var i=0;i<ii;i++){if(meta[i].name&&meta[i].name.toLowerCase()=='keywords'){kwds.push(meta[i].content)}}return kwds.join(',')},addBkParam:function(k,v){self.addParam('phint','__bk_'+k,v)}};var self={_dest:null,createHidden:function(k,v){var myInput=document.createElement("input");myInput.setAttribute('type','hidden');myInput.setAttribute("name",k);myInput.setAttribute("value",v);return myInput},doTag:function(site,limit,excludeBkParams,allowMultipleCalls){var bkFrame=null;if(doTagged&&!(allowMultipleCalls===true)){return}doTagged=true;params.unshift('r='+parseInt(Math.random()*99999));params.unshift('limit='+limit);params.unshift('ret=html');if(!excludeBkParams){self.addParam('phint','__bk_k',document.title);self.addParam('phint','__bk_k',_.getKwds())}self._dest=('https:'==document.location.protocol?'https://stags':'http://tags')+'.bluekai.com/site/'+site+'?'+params.join('&');self._dest=self._dest.substr(0,2000);var isOpera=false,isIE=false;if(typeof(window.opera)!='undefined'){isOpera=true}var ieIndex=navigator.userAgent.indexOf('Internet Explorer');if(!isOpera&&ieIndex>-1){isIE=true};if(!isIE){bkFrame=document.createElement("iframe");bkFrame.setAttribute('height','1');bkFrame.setAttribute('width','1');bkFrame.setAttribute("name","__bkframe");bkFrame.setAttribute("frameborder","0");bkFrame.setAttribute("src",self._dest);document.body.appendChild(bkFrame)}else{bkFrame=document.createElement("div");bkFrame.innerHTML='<iframe name="__bkframe" height="1" width="1" frameborder="0" src="'+self._dest+'" />';document.body.appendChild(bkFrame)}params=[]},addParam:function(type,k,v){if(v){var val=k+'='+v;val=encodeURIComponent(val);params.push(type+'='+val)}},addValue:function(k,v){if(v){var val=encodeURIComponent(v);params.push(k+'='+val)}}};return self})();function bk_addPageCtx(k,v){BKTAG.addParam('phint',k,v)}function bk_addVar(k,v){BKTAG.addValue(k,v)}function bk_doJSTag(site,limit,allowMultipleCalls){BKTAG.doTag(site,limit,false,allowMultipleCalls)}function bk_doSendData(site,limit,excludeBkParams,allowMultipleCalls){BKTAG.doTag(site,limit,excludeBkParams,allowMultipleCalls)}}		
		
		for(var key in this.dataJson ) {
			if(key && this.dataJson[key] != "" ) {
				bk_addPageCtx(key, this.dataJson[key]);
			}
		}
		
		var siteIds = { 
				"wsj.com" : "4454", 
				"barrons.com" : "4457", 
				"marketwatch.com":"4455", 
				"smartmoney.com":"4458", 
				"allthingsd.com":"4459", 
				"fins.com":"4456", 
				"wsjwine.com":"4461",	
				"efinancialnews.com":"4460"
					};
		var limit = 10;  //( we can tune it later )
		var site = document.location.href;
		var siteId = this.getSiteId(siteIds);
		this.makeFrame();
		bk_doSendData(siteId, limit, false);
//		this.sendKrux();
		var url = document.URL.toLowerCase();
		if(url.indexOf('bluekaidebug=yes')>0) this.showData();
	},
	sendKrux: function(){

		KRUXSetup['site'] = this.dataJson['primaryProduct'];
		KRUXSetup['section'] = this.dataJson['section'];
		KRUXSetup['subSection'] = this.dataJson['articleType'];

		this.include("http://sj.wsj.net/internal/krux.js");
		
	},
	getSiteId:function(siteIds){
		var site = document.location.href;
		var defaultKey ="";
		for( key in siteIds ) {
			if(site.indexOf(key)>-1){
				return siteIds[key];
			}else if(".wsj.com".indexOf(key)>-1){
				defaultKey = siteIds[key];
			} 
		}		
		return defaultKey;
	},
	getData:function(){

		 this.dataJson = { 
			"serverDomain" : s?s.server:"",
			"primaryProduct" : s?s.channel:"",
			"pageName" : s?s.pageName:"",
			"section" : s?s.prop2:"",
			"articleType" : s?s.prop3:"",
			"subSection" : s?s.prop26:"",
			"contentType" : s?s.prop19:"",
			"encryptedUUID" : s?s.prop25:"",
			"contentChannel" : s?s.prop1:"",
			"isSub" : s?s.prop27:"",
			"edition" : s?s.prop24:"",
			"referrer" : document.referrer!=""?document.referrer.split('/')[2]:""
				};
		 if(typeof this.dataJson.subsection=="undefined" || this.dataJson.subsection=="")this.dataJson.subsection=this.dataJson.section;
		return this.getAdsData();
	},
	getAdsData:function(){
		if(this.adDivs.length>0){		
			var countSize=1;
			var countZone=1;
			var countSection=1;						
			var strSection = ",";
			var strZone = ",";
			var strSize = ",";
			for(i=0;i<this.adDivs.length;i++){
				if((this.adDivs[i].innerHTML.replace(/^\s+|\s+$/g,"")!='' && this.adDivs[i].getElementsByTagName('iframe')[0]!=undefined)|| this.timercounter>5){
					var ad=this.adDivs[i].getElementsByTagName('iframe')[0];
					if(ad){
						var ind=ad.src.indexOf('doubleclick.net');
						var height=ad.height;
						var width=ad.width;	
						if(ind>1 && height >2 && width >2){
							var str=ad.src.substring(ind);
							if(strSize.indexOf(","+str+",")==-1){
								strSize = strSize+width+"x"+height + ",";
								this.dataJson['adSize'+(countSize++)] = width+"x"+height;
								if(countSize>10)break;
							}
							if(str.split('/')[3]){
								var zone = str.split('/')[3].split(';')[0];
								if(strZone.indexOf(","+zone+",")==-1){
									strZone = strZone + zone+",";
									this.dataJson['adZone'+(countZone++)] = zone;
								}
								var section = str.split('/')[2];
								if(strSection.indexOf(","+section+",")==-1){
									strSection = strSection + section+",";
									this.dataJson['adSection'+(countSection++)] = section;
								}
	
							}
						}
					}
				}else{
					this.timercounter++;
					window.setTimeout('blueKai.blueKai.getAdsData()',1000);
					return false;
				}
				
				
			}
			
		}
		this.sendBlueKai();
	},
	makeFrame:function () {
	   var ifrm = document.createElement("IFRAME");
	   ifrm.setAttribute("src", "javascript:void(0)");
	   ifrm.setAttribute("name", "__bkframe");
	   ifrm.setAttribute("frameborder", 0);
	   ifrm.style.width = 0+"px";
	   ifrm.style.height = 0+"px";
	   document.body.appendChild(ifrm);
	},
	include: function(file){
		var script  = document.createElement('script');
		script.src  = file;
		script.type = 'text/javascript';
		script.defer = true;
		document.getElementsByTagName('head').item(0).appendChild(script);
	},
	showData:function(){
		var out = '';
		for (var data in blueKai.blueKai.dataJson) {
			if(blueKai.blueKai.dataJson[data]!=null && blueKai.blueKai.dataJson[data].replace(/^\s+|\s+$/g,"")!=""){
				out += data + ': ' + blueKai.blueKai.dataJson[data] + '\n';
			}
		}
		alert(out);		
	},
	getbyclass: function(){
	  var elements = document.getElementsByTagName("div");
	  var result = [];
	  var attName= "class";
	  if(elements[0].getAttribute("className")!=null){
		  attName= "className";
	  }
	  for(z=0;z<elements.length;z++){
		  if(elements[z].getAttribute(attName) && elements[z].getAttribute(attName).match(/adSummary/)){
	      result.push(elements[z]);
	    }
	  }
	  return result;
	}

};
dojo.provide("nielsenTracking");

nielsenTracking = {
      init: function() {
//  if(dj.util.Region.getViewByRegion() === "na,us") {
            var d = new Image(1, 1);
            d.onerror = d.onload = function () {
              d.onerror = d.onload = null;
            };
            d.src = ["//secure-us.imrworldwide.com/cgi-bin/m?ci=us-403743h&cg=0&cc=1&si=", escape(window.location.href), "&rp=", escape(document.referrer), "&ts=compact&rnd=", (new Date()).getTime()].join('');
//        }
      }

};
dojo.provide("swfobject.swfobject_1_5.swfobject");
/**
 * SWFObject v1.5: Flash Player detection and embed - http://blog.deconcept.com/swfobject/
 *
 * SWFObject is (c) 2007 Geoff Stearns and is released under the MIT License:
 * http://www.opensource.org/licenses/mit-license.php
 *
 */
if(typeof deconcept=="undefined"){var deconcept=new Object();}if(typeof deconcept.util=="undefined"){deconcept.util=new Object();}if(typeof deconcept.SWFObjectUtil=="undefined"){deconcept.SWFObjectUtil=new Object();}deconcept.SWFObject=function(_1,id,w,h,_5,c,_7,_8,_9,_a){if(!document.getElementById){return;}this.DETECT_KEY=_a?_a:"detectflash";this.skipDetect=deconcept.util.getRequestParameter(this.DETECT_KEY);this.params=new Object();this.variables=new Object();this.attributes=new Array();if(_1){this.setAttribute("swf",_1);}if(id){this.setAttribute("id",id);}if(w){this.setAttribute("width",w);}if(h){this.setAttribute("height",h);}if(_5){this.setAttribute("version",new deconcept.PlayerVersion(_5.toString().split(".")));}this.installedVer=deconcept.SWFObjectUtil.getPlayerVersion();if(!window.opera&&document.all&&this.installedVer.major>7){deconcept.SWFObject.doPrepUnload=true;}if(c){this.addParam("bgcolor",c);}var q=_7?_7:"high";this.addParam("quality",q);this.setAttribute("useExpressInstall",false);this.setAttribute("doExpressInstall",false);var _c=(_8)?_8:window.location;this.setAttribute("xiRedirectUrl",_c);this.setAttribute("redirectUrl","");if(_9){this.setAttribute("redirectUrl",_9);}};deconcept.SWFObject.prototype={useExpressInstall:function(_d){this.xiSWFPath=!_d?"expressinstall.swf":_d;this.setAttribute("useExpressInstall",true);},setAttribute:function(_e,_f){this.attributes[_e]=_f;},getAttribute:function(_10){return this.attributes[_10];},addParam:function(_11,_12){this.params[_11]=_12;},getParams:function(){return this.params;},addVariable:function(_13,_14){this.variables[_13]=_14;},getVariable:function(_15){return this.variables[_15];},getVariables:function(){return this.variables;},getVariablePairs:function(){var _16=new Array();var key;var _18=this.getVariables();for(key in _18){_16[_16.length]=key+"="+_18[key];}return _16;},getSWFHTML:function(){var _19="";if(navigator.plugins&&navigator.mimeTypes&&navigator.mimeTypes.length){if(this.getAttribute("doExpressInstall")){this.addVariable("MMplayerType","PlugIn");this.setAttribute("swf",this.xiSWFPath);}_19="<embed type=\"application/x-shockwave-flash\" src=\""+this.getAttribute("swf")+"\" width=\""+this.getAttribute("width")+"\" height=\""+this.getAttribute("height")+"\" style=\""+this.getAttribute("style")+"\"";_19+=" id=\""+this.getAttribute("id")+"\" name=\""+this.getAttribute("id")+"\" ";var _1a=this.getParams();for(var key in _1a){_19+=[key]+"=\""+_1a[key]+"\" ";}var _1c=this.getVariablePairs().join("&");if(_1c.length>0){_19+="flashvars=\""+_1c+"\"";}_19+="/>";}else{if(this.getAttribute("doExpressInstall")){this.addVariable("MMplayerType","ActiveX");this.setAttribute("swf",this.xiSWFPath);}_19="<object id=\""+this.getAttribute("id")+"\" classid=\"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000\" width=\""+this.getAttribute("width")+"\" height=\""+this.getAttribute("height")+"\" style=\""+this.getAttribute("style")+"\">";_19+="<param name=\"movie\" value=\""+this.getAttribute("swf")+"\" />";var _1d=this.getParams();for(var key in _1d){_19+="<param name=\""+key+"\" value=\""+_1d[key]+"\" />";}var _1f=this.getVariablePairs().join("&");if(_1f.length>0){_19+="<param name=\"flashvars\" value=\""+_1f+"\" />";}_19+="</object>";}return _19;},write:function(_20){if(this.getAttribute("useExpressInstall")){var _21=new deconcept.PlayerVersion([6,0,65]);if(this.installedVer.versionIsValid(_21)&&!this.installedVer.versionIsValid(this.getAttribute("version"))){this.setAttribute("doExpressInstall",true);this.addVariable("MMredirectURL",escape(this.getAttribute("xiRedirectUrl")));document.title=document.title.slice(0,47)+" - Flash Player Installation";this.addVariable("MMdoctitle",document.title);}}if(this.skipDetect||this.getAttribute("doExpressInstall")||this.installedVer.versionIsValid(this.getAttribute("version"))){var n=(typeof _20=="string")?document.getElementById(_20):_20;n.innerHTML=this.getSWFHTML();return true;}else{if(this.getAttribute("redirectUrl")!=""){document.location.replace(this.getAttribute("redirectUrl"));}}return false;}};deconcept.SWFObjectUtil.getPlayerVersion=function(){var _23=new deconcept.PlayerVersion([0,0,0]);if(navigator.plugins&&navigator.mimeTypes.length){var x=navigator.plugins["Shockwave Flash"];if(x&&x.description){_23=new deconcept.PlayerVersion(x.description.replace(/([a-zA-Z]|\s)+/,"").replace(/(\s+r|\s+b[0-9]+)/,".").split("."));}}else{if(navigator.userAgent&&navigator.userAgent.indexOf("Windows CE")>=0){var axo=1;var _26=3;while(axo){try{_26++;axo=new ActiveXObject("ShockwaveFlash.ShockwaveFlash."+_26);_23=new deconcept.PlayerVersion([_26,0,0]);}catch(e){axo=null;}}}else{try{var axo=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.7");}catch(e){try{var axo=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.6");_23=new deconcept.PlayerVersion([6,0,21]);axo.AllowScriptAccess="always";}catch(e){if(_23.major==6){return _23;}}try{axo=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");}catch(e){}}if(axo!=null){_23=new deconcept.PlayerVersion(axo.GetVariable("$version").split(" ")[1].split(","));}}}return _23;};deconcept.PlayerVersion=function(_29){this.major=_29[0]!=null?parseInt(_29[0]):0;this.minor=_29[1]!=null?parseInt(_29[1]):0;this.rev=_29[2]!=null?parseInt(_29[2]):0;};deconcept.PlayerVersion.prototype.versionIsValid=function(fv){if(this.major<fv.major){return false;}if(this.major>fv.major){return true;}if(this.minor<fv.minor){return false;}if(this.minor>fv.minor){return true;}if(this.rev<fv.rev){return false;}return true;};deconcept.util={getRequestParameter:function(_2b){var q=document.location.search||document.location.hash;if(_2b==null){return q;}if(q){var _2d=q.substring(1).split("&");for(var i=0;i<_2d.length;i++){if(_2d[i].substring(0,_2d[i].indexOf("="))==_2b){return _2d[i].substring((_2d[i].indexOf("=")+1));}}}return "";}};deconcept.SWFObjectUtil.cleanupSWFs=function(){var _2f=document.getElementsByTagName("OBJECT");for(var i=_2f.length-1;i>=0;i--){_2f[i].style.display="none";for(var x in _2f[i]){if(typeof _2f[i][x]=="function"){_2f[i][x]=function(){};}}}};if(deconcept.SWFObject.doPrepUnload){if(!deconcept.unloadSet){deconcept.SWFObjectUtil.prepUnload=function(){__flash_unloadHandler=function(){};__flash_savedUnloadHandler=function(){};window.attachEvent("onunload",deconcept.SWFObjectUtil.cleanupSWFs);};window.attachEvent("onbeforeunload",deconcept.SWFObjectUtil.prepUnload);deconcept.unloadSet=true;}}if(!document.getElementById&&document.all){document.getElementById=function(id){return document.all[id];};}var getQueryParamValue=deconcept.util.getRequestParameter;var FlashObject=deconcept.SWFObject;var SWFObject=deconcept.SWFObject;
/*  SWFObject v2.2 <http://code.google.com/p/swfobject/>
  is released under the MIT License <http://www.opensource.org/licenses/mit-license.php>
*/
dojo.provide("swfobject.swfobject_2_2.swfobject");

swfobject = function() {
	
	var UNDEF = "undefined",
		OBJECT = "object",
		SHOCKWAVE_FLASH = "Shockwave Flash",
		SHOCKWAVE_FLASH_AX = "ShockwaveFlash.ShockwaveFlash",
		FLASH_MIME_TYPE = "application/x-shockwave-flash",
		EXPRESS_INSTALL_ID = "SWFObjectExprInst",
		ON_READY_STATE_CHANGE = "onreadystatechange",
		
		win = window,
		doc = document,
		nav = navigator,
		
		plugin = false,
		domLoadFnArr = [main],
		regObjArr = [],
		objIdArr = [],
		listenersArr = [],
		storedAltContent,
		storedAltContentId,
		storedCallbackFn,
		storedCallbackObj,
    isInitDelayed = true,
		isDomLoaded = isInitDelayed,
		isExpressInstallActive = false,
		dynamicStylesheet,
		dynamicStylesheetMedia,
		autoHideShow = true,
	
	/* Centralized function for browser feature detection
		- User agent string detection is only used when no good alternative is possible
		- Is executed directly for optimal performance
	*/	
	ua = function() {
		var w3cdom = typeof doc.getElementById != UNDEF && typeof doc.getElementsByTagName != UNDEF && typeof doc.createElement != UNDEF,
			u = nav.userAgent.toLowerCase(),
			p = nav.platform.toLowerCase(),
			windows = p ? /win/.test(p) : /win/.test(u),
			mac = p ? /mac/.test(p) : /mac/.test(u),
			webkit = /webkit/.test(u) ? parseFloat(u.replace(/^.*webkit\/(\d+(\.\d+)?).*$/, "$1")) : false, // returns either the webkit version or false if not webkit
			ie = !+"\v1", // feature detection based on Andrea Giammarchi's solution: http://webreflection.blogspot.com/2009/01/32-bytes-to-know-if-your-browser-is-ie.html
			playerVersion = [0,0,0],
			d = null;
		if (typeof nav.plugins != UNDEF && typeof nav.plugins[SHOCKWAVE_FLASH] == OBJECT) {
			d = nav.plugins[SHOCKWAVE_FLASH].description;
			if (d && !(typeof nav.mimeTypes != UNDEF && nav.mimeTypes[FLASH_MIME_TYPE] && !nav.mimeTypes[FLASH_MIME_TYPE].enabledPlugin)) { // navigator.mimeTypes["application/x-shockwave-flash"].enabledPlugin indicates whether plug-ins are enabled or disabled in Safari 3+
				plugin = true;
				ie = false; // cascaded feature detection for Internet Explorer
				d = d.replace(/^.*\s+(\S+\s+\S+$)/, "$1");
				playerVersion[0] = parseInt(d.replace(/^(.*)\..*$/, "$1"), 10);
				playerVersion[1] = parseInt(d.replace(/^.*\.(.*)\s.*$/, "$1"), 10);
				playerVersion[2] = /[a-zA-Z]/.test(d) ? parseInt(d.replace(/^.*[a-zA-Z]+(.*)$/, "$1"), 10) : 0;
			}
		}
		else if (typeof win.ActiveXObject != UNDEF) {
			try {
				var a = new ActiveXObject(SHOCKWAVE_FLASH_AX);
				if (a) { // a will return null when ActiveX is disabled
					d = a.GetVariable("$version");
					if (d) {
						ie = true; // cascaded feature detection for Internet Explorer
						d = d.split(" ")[1].split(",");
						playerVersion = [parseInt(d[0], 10), parseInt(d[1], 10), parseInt(d[2], 10)];
					}
				}
			}
			catch(e) {}
		}
		return { w3:w3cdom, pv:playerVersion, wk:webkit, ie:ie, win:windows, mac:mac };
	}(),
	
	/* Cross-browser onDomLoad
		- Will fire an event as soon as the DOM of a web page is loaded
		- Internet Explorer workaround based on Diego Perini's solution: http://javascript.nwbox.com/IEContentLoaded/
		- Regular onload serves as fallback
	*/ 
	onDomLoad = function() {
		if (!ua.w3) { return; }
		if ((typeof doc.readyState != UNDEF && doc.readyState == "complete") || (typeof doc.readyState == UNDEF && (doc.getElementsByTagName("body")[0] || doc.body))) { // function is fired after onload, e.g. when script is inserted dynamically 
			callDomLoadFunctions();
		}
		if (!isDomLoaded) {
			if (typeof doc.addEventListener != UNDEF) {
				doc.addEventListener("DOMContentLoaded", callDomLoadFunctions, false);
			}		
			if (ua.ie && ua.win) {
				doc.attachEvent(ON_READY_STATE_CHANGE, function() {
					if (doc.readyState == "complete") {
						doc.detachEvent(ON_READY_STATE_CHANGE, arguments.callee);
						callDomLoadFunctions();
					}
				});
				if (win == top) { // if not inside an iframe
					(function(){
						if (isDomLoaded) { return; }
						try {
							doc.documentElement.doScroll("left");
						}
						catch(e) {
							setTimeout(arguments.callee, 0);
							return;
						}
						callDomLoadFunctions();
					})();
				}
			}
			if (ua.wk) {
				(function(){
					if (isDomLoaded) { return; }
					if (!/loaded|complete/.test(doc.readyState)) {
						setTimeout(arguments.callee, 0);
						return;
					}
					callDomLoadFunctions();
				})();
			}
			addLoadEvent(callDomLoadFunctions);
		}
	}();
	
	function callDomLoadFunctions() {
		if (isDomLoaded) { return; }
		try { // test if we can really add/remove elements to/from the DOM; we don't want to fire it too early
			var t = doc.getElementsByTagName("body")[0].appendChild(createElement("span"));
			t.parentNode.removeChild(t);
		}
		catch (e) { return; }
		isDomLoaded = true;
		var dl = domLoadFnArr.length;
		for (var i = 0; i < dl; i++) {
			domLoadFnArr[i]();
		}
	}
	
	function addDomLoadEvent(fn) {
		if (isDomLoaded) {
			fn();
		}
		else { 
			domLoadFnArr[domLoadFnArr.length] = fn; // Array.push() is only available in IE5.5+
		}
	}
	
	/* Cross-browser onload
		- Based on James Edwards' solution: http://brothercake.com/site/resources/scripts/onload/
		- Will fire an event as soon as a web page including all of its assets are loaded 
	 */
	function addLoadEvent(fn) {
		if (typeof win.addEventListener != UNDEF) {
			win.addEventListener("load", fn, false);
		}
		else if (typeof doc.addEventListener != UNDEF) {
			doc.addEventListener("load", fn, false);
		}
		else if (typeof win.attachEvent != UNDEF) {
			addListener(win, "onload", fn);
		}
		else if (typeof win.onload == "function") {
			var fnOld = win.onload;
			win.onload = function() {
				fnOld();
				fn();
			};
		}
		else {
			win.onload = fn;
		}
	}
	
	/* Main function
		- Will preferably execute onDomLoad, otherwise onload (as a fallback)
	*/
	function main() { 
		if (plugin) {
			testPlayerVersion();
		}
		else {
			matchVersions();
		}
	}
	
	/* Detect the Flash Player version for non-Internet Explorer browsers
		- Detecting the plug-in version via the object element is more precise than using the plugins collection item's description:
		  a. Both release and build numbers can be detected
		  b. Avoid wrong descriptions by corrupt installers provided by Adobe
		  c. Avoid wrong descriptions by multiple Flash Player entries in the plugin Array, caused by incorrect browser imports
		- Disadvantage of this method is that it depends on the availability of the DOM, while the plugins collection is immediately available
	*/
	function testPlayerVersion() {
		var b = doc.getElementsByTagName("body")[0];
		var o = createElement(OBJECT);
		o.setAttribute("type", FLASH_MIME_TYPE);
		var t = b.appendChild(o);
		if (t) {
			var counter = 0;
			(function(){
				if (typeof t.GetVariable != UNDEF) {
					var d = t.GetVariable("$version");
					if (d) {
						d = d.split(" ")[1].split(",");
						ua.pv = [parseInt(d[0], 10), parseInt(d[1], 10), parseInt(d[2], 10)];
					}
				}
				else if (counter < 10) {
					counter++;
					setTimeout(arguments.callee, 10);
					return;
				}
				b.removeChild(o);
				t = null;
				matchVersions();
			})();
		}
		else {
			matchVersions();
		}
	}
	
	/* Perform Flash Player and SWF version matching; static publishing only
	*/
	function matchVersions() {
		var rl = regObjArr.length;
		if (rl > 0) {
			for (var i = 0; i < rl; i++) { // for each registered object element
				var id = regObjArr[i].id;
				var cb = regObjArr[i].callbackFn;
				var cbObj = {success:false, id:id};
				if (ua.pv[0] > 0) {
					var obj = getElementById(id);
					if (obj) {
						if (hasPlayerVersion(regObjArr[i].swfVersion) && !(ua.wk && ua.wk < 312)) { // Flash Player version >= published SWF version: Houston, we have a match!
							setVisibility(id, true);
							if (cb) {
								cbObj.success = true;
								cbObj.ref = getObjectById(id);
								cb(cbObj);
							}
						}
						else if (regObjArr[i].expressInstall && canExpressInstall()) { // show the Adobe Express Install dialog if set by the web page author and if supported
							var att = {};
							att.data = regObjArr[i].expressInstall;
							att.width = obj.getAttribute("width") || "0";
							att.height = obj.getAttribute("height") || "0";
							if (obj.getAttribute("class")) { att.styleclass = obj.getAttribute("class"); }
							if (obj.getAttribute("align")) { att.align = obj.getAttribute("align"); }
							// parse HTML object param element's name-value pairs
							var par = {};
							var p = obj.getElementsByTagName("param");
							var pl = p.length;
							for (var j = 0; j < pl; j++) {
								if (p[j].getAttribute("name").toLowerCase() != "movie") {
									par[p[j].getAttribute("name")] = p[j].getAttribute("value");
								}
							}
							showExpressInstall(att, par, id, cb);
						}
						else { // Flash Player and SWF version mismatch or an older Webkit engine that ignores the HTML object element's nested param elements: display alternative content instead of SWF
							displayAltContent(obj);
							if (cb) { cb(cbObj); }
						}
					}
				}
				else {	// if no Flash Player is installed or the fp version cannot be detected we let the HTML object element do its job (either show a SWF or alternative content)
					setVisibility(id, true);
					if (cb) {
						var o = getObjectById(id); // test whether there is an HTML object element or not
						if (o && typeof o.SetVariable != UNDEF) { 
							cbObj.success = true;
							cbObj.ref = o;
						}
						cb(cbObj);
					}
				}
			}
		}
	}
	
	function getObjectById(objectIdStr) {
		var r = null;
		var o = getElementById(objectIdStr);
		if (o && o.nodeName == "OBJECT") {
			if (typeof o.SetVariable != UNDEF) {
				r = o;
			}
			else {
				var n = o.getElementsByTagName(OBJECT)[0];
				if (n) {
					r = n;
				}
			}
		}
		return r;
	}
	
	/* Requirements for Adobe Express Install
		- only one instance can be active at a time
		- fp 6.0.65 or higher
		- Win/Mac OS only
		- no Webkit engines older than version 312
	*/
	function canExpressInstall() {
		return !isExpressInstallActive && hasPlayerVersion("6.0.65") && (ua.win || ua.mac) && !(ua.wk && ua.wk < 312);
	}
	
	/* Show the Adobe Express Install dialog
		- Reference: http://www.adobe.com/cfusion/knowledgebase/index.cfm?id=6a253b75
	*/
	function showExpressInstall(att, par, replaceElemIdStr, callbackFn) {
		isExpressInstallActive = true;
		storedCallbackFn = callbackFn || null;
		storedCallbackObj = {success:false, id:replaceElemIdStr};
		var obj = getElementById(replaceElemIdStr);
		if (obj) {
			if (obj.nodeName == "OBJECT") { // static publishing
				storedAltContent = abstractAltContent(obj);
				storedAltContentId = null;
			}
			else { // dynamic publishing
				storedAltContent = obj;
				storedAltContentId = replaceElemIdStr;
			}
			att.id = EXPRESS_INSTALL_ID;
			if (typeof att.width == UNDEF || (!/%$/.test(att.width) && parseInt(att.width, 10) < 310)) { att.width = "310"; }
			if (typeof att.height == UNDEF || (!/%$/.test(att.height) && parseInt(att.height, 10) < 137)) { att.height = "137"; }
			doc.title = doc.title.slice(0, 47) + " - Flash Player Installation";
			var pt = ua.ie && ua.win ? "ActiveX" : "PlugIn",
				fv = "MMredirectURL=" + win.location.toString().replace(/&/g,"%26") + "&MMplayerType=" + pt + "&MMdoctitle=" + doc.title;
			if (typeof par.flashvars != UNDEF) {
				par.flashvars += "&" + fv;
			}
			else {
				par.flashvars = fv;
			}
			// IE only: when a SWF is loading (AND: not available in cache) wait for the readyState of the object element to become 4 before removing it,
			// because you cannot properly cancel a loading SWF file without breaking browser load references, also obj.onreadystatechange doesn't work
			if (ua.ie && ua.win && obj.readyState != 4) {
				var newObj = createElement("div");
				replaceElemIdStr += "SWFObjectNew";
				newObj.setAttribute("id", replaceElemIdStr);
				obj.parentNode.insertBefore(newObj, obj); // insert placeholder div that will be replaced by the object element that loads expressinstall.swf
				obj.style.display = "none";
				(function(){
					if (obj.readyState == 4) {
						obj.parentNode.removeChild(obj);
					}
					else {
						setTimeout(arguments.callee, 10);
					}
				})();
			}
			createSWF(att, par, replaceElemIdStr);
		}
	}
	
	/* Functions to abstract and display alternative content
	*/
	function displayAltContent(obj) {
		if (ua.ie && ua.win && obj.readyState != 4) {
			// IE only: when a SWF is loading (AND: not available in cache) wait for the readyState of the object element to become 4 before removing it,
			// because you cannot properly cancel a loading SWF file without breaking browser load references, also obj.onreadystatechange doesn't work
			var el = createElement("div");
			obj.parentNode.insertBefore(el, obj); // insert placeholder div that will be replaced by the alternative content
			el.parentNode.replaceChild(abstractAltContent(obj), el);
			obj.style.display = "none";
			(function(){
				if (obj.readyState == 4) {
					obj.parentNode.removeChild(obj);
				}
				else {
					setTimeout(arguments.callee, 10);
				}
			})();
		}
		else {
			obj.parentNode.replaceChild(abstractAltContent(obj), obj);
		}
	} 

	function abstractAltContent(obj) {
		var ac = createElement("div");
		if (ua.win && ua.ie) {
			ac.innerHTML = obj.innerHTML;
		}
		else {
			var nestedObj = obj.getElementsByTagName(OBJECT)[0];
			if (nestedObj) {
				var c = nestedObj.childNodes;
				if (c) {
					var cl = c.length;
					for (var i = 0; i < cl; i++) {
						if (!(c[i].nodeType == 1 && c[i].nodeName == "PARAM") && !(c[i].nodeType == 8)) {
							ac.appendChild(c[i].cloneNode(true));
						}
					}
				}
			}
		}
		return ac;
	}
	
	/* Cross-browser dynamic SWF creation
	*/
	function createSWF(attObj, parObj, id) {
		var r, el = getElementById(id);
		if (ua.wk && ua.wk < 312) { return r; }
		if (el) {
			if (typeof attObj.id == UNDEF) { // if no 'id' is defined for the object element, it will inherit the 'id' from the alternative content
				attObj.id = id;
			}
			if (ua.ie && ua.win) { // Internet Explorer + the HTML object element + W3C DOM methods do not combine: fall back to outerHTML
				var att = "";
				for (var i in attObj) {
					if (attObj[i] != Object.prototype[i]) { // filter out prototype additions from other potential libraries
						if (i.toLowerCase() == "data") {
							parObj.movie = attObj[i];
						}
						else if (i.toLowerCase() == "styleclass") { // 'class' is an ECMA4 reserved keyword
							att += ' class="' + attObj[i] + '"';
						}
						else if (i.toLowerCase() != "classid") {
							att += ' ' + i + '="' + attObj[i] + '"';
						}
					}
				}
				var par = "";
				for (var j in parObj) {
					if (parObj[j] != Object.prototype[j]) { // filter out prototype additions from other potential libraries
						par += '<param name="' + j + '" value="' + parObj[j] + '" />';
					}
				}
				el.outerHTML = '<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"' + att + '>' + par + '</object>';
				objIdArr[objIdArr.length] = attObj.id; // stored to fix object 'leaks' on unload (dynamic publishing only)
				r = getElementById(attObj.id);	
			}
			else { // well-behaving browsers
				var o = createElement(OBJECT);
				o.setAttribute("type", FLASH_MIME_TYPE);
				for (var m in attObj) {
					if (attObj[m] != Object.prototype[m]) { // filter out prototype additions from other potential libraries
						if (m.toLowerCase() == "styleclass") { // 'class' is an ECMA4 reserved keyword
							o.setAttribute("class", attObj[m]);
						}
						else if (m.toLowerCase() != "classid") { // filter out IE specific attribute
							o.setAttribute(m, attObj[m]);
						}
					}
				}
				for (var n in parObj) {
					if (parObj[n] != Object.prototype[n] && n.toLowerCase() != "movie") { // filter out prototype additions from other potential libraries and IE specific param element
						createObjParam(o, n, parObj[n]);
					}
				}
				el.parentNode.replaceChild(o, el);
				r = o;
			}
		}
		return r;
	}
	
	function createObjParam(el, pName, pValue) {
		var p = createElement("param");
		p.setAttribute("name", pName);	
		p.setAttribute("value", pValue);
		el.appendChild(p);
	}
	
	/* Cross-browser SWF removal
		- Especially needed to safely and completely remove a SWF in Internet Explorer
	*/
	function removeSWF(id) {
		var obj = getElementById(id);
		if (obj && obj.nodeName == "OBJECT") {
			if (ua.ie && ua.win) {
				obj.style.display = "none";
				(function(){
					if (obj.readyState == 4) {
						removeObjectInIE(id);
					}
					else {
						setTimeout(arguments.callee, 10);
					}
				})();
			}
			else {
				obj.parentNode.removeChild(obj);
			}
		}
	}
	
	function removeObjectInIE(id) {
		var obj = getElementById(id);
		if (obj) {
			for (var i in obj) {
				if (typeof obj[i] == "function") {
					obj[i] = null;
				}
			}
			obj.parentNode.removeChild(obj);
		}
	}
	
	/* Functions to optimize JavaScript compression
	*/
	function getElementById(id) {
		var el = null;
		try {
			el = doc.getElementById(id);
		}
		catch (e) {}
		return el;
	}
	
	function createElement(el) {
		return doc.createElement(el);
	}
	
	/* Updated attachEvent function for Internet Explorer
		- Stores attachEvent information in an Array, so on unload the detachEvent functions can be called to avoid memory leaks
	*/	
	function addListener(target, eventType, fn) {
		target.attachEvent(eventType, fn);
		listenersArr[listenersArr.length] = [target, eventType, fn];
	}
	
	/* Flash Player and SWF content version matching
	*/
	function hasPlayerVersion(rv) {
		var pv = ua.pv, v = rv.split(".");
		v[0] = parseInt(v[0], 10);
		v[1] = parseInt(v[1], 10) || 0; // supports short notation, e.g. "9" instead of "9.0.0"
		v[2] = parseInt(v[2], 10) || 0;
		return (pv[0] > v[0] || (pv[0] == v[0] && pv[1] > v[1]) || (pv[0] == v[0] && pv[1] == v[1] && pv[2] >= v[2])) ? true : false;
	}
	
	/* Cross-browser dynamic CSS creation
		- Based on Bobby van der Sluis' solution: http://www.bobbyvandersluis.com/articles/dynamicCSS.php
	*/	
	function createCSS(sel, decl, media, newStyle) {
		if (ua.ie && ua.mac) { return; }
		var h = doc.getElementsByTagName("head")[0];
		if (!h) { return; } // to also support badly authored HTML pages that lack a head element
		var m = (media && typeof media == "string") ? media : "screen";
		if (newStyle) {
			dynamicStylesheet = null;
			dynamicStylesheetMedia = null;
		}
		if (!dynamicStylesheet || dynamicStylesheetMedia != m) { 
			// create dynamic stylesheet + get a global reference to it
			var s = createElement("style");
			s.setAttribute("type", "text/css");
			s.setAttribute("media", m);
			dynamicStylesheet = h.appendChild(s);
			if (ua.ie && ua.win && typeof doc.styleSheets != UNDEF && doc.styleSheets.length > 0) {
				dynamicStylesheet = doc.styleSheets[doc.styleSheets.length - 1];
			}
			dynamicStylesheetMedia = m;
		}
		// add style rule
		if (ua.ie && ua.win) {
			if (dynamicStylesheet && typeof dynamicStylesheet.addRule == OBJECT) {
				dynamicStylesheet.addRule(sel, decl);
			}
		}
		else {
			if (dynamicStylesheet && typeof doc.createTextNode != UNDEF) {
				dynamicStylesheet.appendChild(doc.createTextNode(sel + " {" + decl + "}"));
			}
		}
	}
	
	function setVisibility(id, isVisible) {
		if (!autoHideShow) { return; }
		var v = isVisible ? "visible" : "hidden";
		if (isDomLoaded && getElementById(id)) {
			getElementById(id).style.visibility = v;
		}
		else {
			createCSS("#" + id, "visibility:" + v);
		}
	}

	/* Filter to avoid XSS attacks
	*/
	function urlEncodeIfNecessary(s) {
		var regex = /[\\\"<>\.;]/;
		var hasBadChars = regex.exec(s) != null;
		return hasBadChars && typeof encodeURIComponent != UNDEF ? encodeURIComponent(s) : s;
	}
	
	/* Release memory to avoid memory leaks caused by closures, fix hanging audio/video threads and force open sockets/NetConnections to disconnect (Internet Explorer only)
	*/
	var cleanup = function() {
		if (ua.ie && ua.win) {
			window.attachEvent("onunload", function() {
				// remove listeners to avoid memory leaks
				var ll = listenersArr.length;
				for (var i = 0; i < ll; i++) {
					listenersArr[i][0].detachEvent(listenersArr[i][1], listenersArr[i][2]);
				}
				// cleanup dynamically embedded objects to fix audio/video threads and force open sockets and NetConnections to disconnect
				var il = objIdArr.length;
				for (var j = 0; j < il; j++) {
					removeSWF(objIdArr[j]);
				}
				// cleanup library's main closures to avoid memory leaks
				for (var k in ua) {
					ua[k] = null;
				}
				ua = null;
				for (var l in swfobject) {
					swfobject[l] = null;
				}
				swfobject = null;
			});
		}
	}();
	
	var publicApi = {
		/* Public API
			- Reference: http://code.google.com/p/swfobject/wiki/documentation
		*/ 
		registerObject: function(objectIdStr, swfVersionStr, xiSwfUrlStr, callbackFn) {
			if (ua.w3 && objectIdStr && swfVersionStr) {
				var regObj = {};
				regObj.id = objectIdStr;
				regObj.swfVersion = swfVersionStr;
				regObj.expressInstall = xiSwfUrlStr;
				regObj.callbackFn = callbackFn;
				regObjArr[regObjArr.length] = regObj;
				setVisibility(objectIdStr, false);
			}
			else if (callbackFn) {
				callbackFn({success:false, id:objectIdStr});
			}
		},
		
		getObjectById: function(objectIdStr) {
			if (ua.w3) {
				return getObjectById(objectIdStr);
			}
		},
		
		embedSWF: function(swfUrlStr, replaceElemIdStr, widthStr, heightStr, swfVersionStr, xiSwfUrlStr, flashvarsObj, parObj, attObj, callbackFn) {
			var callbackObj = {success:false, id:replaceElemIdStr};
			if (ua.w3 && !(ua.wk && ua.wk < 312) && swfUrlStr && replaceElemIdStr && widthStr && heightStr && swfVersionStr) {
				setVisibility(replaceElemIdStr, false);
				addDomLoadEvent(function() {
					widthStr += ""; // auto-convert to string
					heightStr += "";
					var att = {};
					if (attObj && typeof attObj === OBJECT) {
						for (var i in attObj) { // copy object to avoid the use of references, because web authors often reuse attObj for multiple SWFs
							att[i] = attObj[i];
						}
					}
					att.data = swfUrlStr;
					att.width = widthStr;
					att.height = heightStr;
					var par = {}; 
					if (parObj && typeof parObj === OBJECT) {
						for (var j in parObj) { // copy object to avoid the use of references, because web authors often reuse parObj for multiple SWFs
							par[j] = parObj[j];
						}
					}
					if (flashvarsObj && typeof flashvarsObj === OBJECT) {
						for (var k in flashvarsObj) { // copy object to avoid the use of references, because web authors often reuse flashvarsObj for multiple SWFs
							if (typeof par.flashvars != UNDEF) {
								par.flashvars += "&" + k + "=" + flashvarsObj[k];
							}
							else {
								par.flashvars = k + "=" + flashvarsObj[k];
							}
						}
					}
					if (hasPlayerVersion(swfVersionStr)) { // create SWF
						var obj = createSWF(att, par, replaceElemIdStr);
						if (att.id == replaceElemIdStr) {
							setVisibility(replaceElemIdStr, true);
						}
						callbackObj.success = true;
						callbackObj.ref = obj;
					}
					else if (xiSwfUrlStr && canExpressInstall()) { // show Adobe Express Install
						att.data = xiSwfUrlStr;
						showExpressInstall(att, par, replaceElemIdStr, callbackFn);
						return;
					}
					else { // show alternative content
						setVisibility(replaceElemIdStr, true);
					}
					if (callbackFn) { callbackFn(callbackObj); }
				});
			}
			else if (callbackFn) { callbackFn(callbackObj);	}
		},
		
		switchOffAutoHideShow: function() {
			autoHideShow = false;
		},
		
		ua: ua,
		
		getFlashPlayerVersion: function() {
			return { major:ua.pv[0], minor:ua.pv[1], release:ua.pv[2] };
		},
		
		hasFlashPlayerVersion: hasPlayerVersion,
		
		createSWF: function(attObj, parObj, replaceElemIdStr) {
			if (ua.w3) {
				return createSWF(attObj, parObj, replaceElemIdStr);
			}
			else {
				return undefined;
			}
		},
		
		showExpressInstall: function(att, par, replaceElemIdStr, callbackFn) {
			if (ua.w3 && canExpressInstall()) {
				showExpressInstall(att, par, replaceElemIdStr, callbackFn);
			}
		},
		
		removeSWF: function(objElemIdStr) {
			if (ua.w3) {
				removeSWF(objElemIdStr);
			}
		},
		
		createCSS: function(selStr, declStr, mediaStr, newStyleBoolean) {
			if (ua.w3) {
				createCSS(selStr, declStr, mediaStr, newStyleBoolean);
			}
		},
		
		addDomLoadEvent: addDomLoadEvent,
		
		addLoadEvent: addLoadEvent,
		
		getQueryParamValue: function(param) {
			var q = doc.location.search || doc.location.hash;
			if (q) {
				if (/\?/.test(q)) { q = q.split("?")[1]; } // strip question mark
				if (param == null) {
					return urlEncodeIfNecessary(q);
				}
				var pairs = q.split("&");
				for (var i = 0; i < pairs.length; i++) {
					if (pairs[i].substring(0, pairs[i].indexOf("=")) == param) {
						return urlEncodeIfNecessary(pairs[i].substring((pairs[i].indexOf("=") + 1)));
					}
				}
			}
			return "";
		},
		
		// For internal usage only
		expressInstallCallback: function() {
			if (isExpressInstallActive) {
				var obj = getElementById(EXPRESS_INSTALL_ID);
				if (obj && storedAltContent) {
					obj.parentNode.replaceChild(storedAltContent, obj);
					if (storedAltContentId) {
						setVisibility(storedAltContentId, true);
						if (ua.ie && ua.win) { storedAltContent.style.display = "block"; }
					}
					if (storedCallbackFn) { storedCallbackFn(storedCallbackObj); }
				}
				isExpressInstallActive = false;
			} 
		}
	};

  if (isInitDelayed) {
    var that = this,
        isInitialized = false;
    for (var fn in publicApi) {
      (function(oldFn) {
        if (typeof oldFn === "function") {
          publicApi[fn] = function() {
            if (!isInitialized) { 
              main();
              isInitialized = true;
            }
            return oldFn.apply(that, arguments);
          };
        }
      }(publicApi[fn]));
    }
  }

  return publicApi;
}();

dojo.provide('trimpath.TrimPath');
/**
 * TrimPath Template. Release 1.1.2.
 * Copyright (C) 2004 - 2007 TrimPath.
 *
 * TrimPath Template is licensed under the GNU General Public License
 * and the Apache License, Version 2.0, as follows:
 *
 * This program is free software; you can redistribute it and/or
 * modify it under the terms of the GNU General Public License
 * as published by the Free Software Foundation; either version 2
 * of the License, or (at your option) any later version.
 *
 * This program is distributed WITHOUT ANY WARRANTY; without even the
 * implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
 * See the GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program; if not, write to the Free Software
 * Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
if (typeof(TrimPath) == 'undefined'){TrimPath = {};}

// TODO: Debugging mode vs stop-on-error mode - runtime flag.
// TODO: Handle || (or) characters and backslashes.
// TODO: Add more modifiers.

(function() {               // Using a closure to keep global namespace clean.
    if (TrimPath.evalEx == null){TrimPath.evalEx = function(src) { return eval(src); };}

    var UNDEFINED;
    if (Array.prototype.pop == null){Array.prototype.pop = function() {
        if (this.length === 0) {return UNDEFINED;}
        return this[--this.length];
    };}
    if (Array.prototype.push == null){Array.prototype.push = function() {
        for (var i = 0; i < arguments.length; ++i) {this[this.length] = arguments[i];}
        return this.length;
    };}

    TrimPath.parseTemplate = function(tmplContent, optTmplName, optEtc) {
        if (optEtc == null){optEtc = TrimPath.parseTemplate_etc;}
        var funcSrc = parse(tmplContent, optTmplName, optEtc);
        var func = TrimPath.evalEx(funcSrc, optTmplName, 1);
        if (func != null) {
          return new optEtc.Template(optTmplName, tmplContent, funcSrc, func, optEtc);
        }
        return null;
    }

    var exceptionDetails = function(e) {
        return (e.toString()) + ";\n " +
               (e.message) + ";\n " +
               (e.name) + ";\n " +
               (e.stack       || 'no stack trace') + ";\n " +
               (e.description || 'no further description') + ";\n " +
               (e.fileName    || 'no file name') + ";\n " +
               (e.lineNumber  || 'no line number');
    }

    try {
        String.prototype.process = function(context, optFlags) {
            var template = TrimPath.parseTemplate(this, null);
            if (template != null) {
              return template.process(context, optFlags);
            }
            return this;
        }
    } catch (e) { // Swallow exception, such as when String.prototype is sealed.
    }

    TrimPath.parseTemplate_etc = {};            // Exposed for extensibility.
    TrimPath.parseTemplate_etc.statementTag = "forelse|for|if|elseif|else|var|macro";
    TrimPath.parseTemplate_etc.statementDef = { // Lookup table for statement tags.
        "if"     : { delta:  1, prefix: "if (", suffix: ") {", paramMin: 1 },
        "else"   : { delta:  0, prefix: "} else {" },
        "elseif" : { delta:  0, prefix: "} else if (", suffix: ") {", paramDefault: "true" },
        "/if"    : { delta: -1, prefix: "}" },
        "for"    : { delta:  1, paramMin: 3,
                     prefixFunc : function(stmtParts, state, tmplName, etc) {
                        if (stmtParts[2] != "in") {
                          throw new etc.ParseError(tmplName, state.line, "bad for loop statement: " + stmtParts.join(' '));
                        }
                        var iterVar = stmtParts[1];
                        var listVar = "__LIST__" + iterVar;
                        return [ "var ", listVar, " = ", stmtParts[3], ";",
                             // Fix from Ross Shaull for hash looping, make sure that we have an array of loop lengths to treat like a stack.
                             "var __LENGTH_STACK__;",
                             "if (typeof(__LENGTH_STACK__) == 'undefined' || !__LENGTH_STACK__.length) __LENGTH_STACK__ = new Array();",
                             "__LENGTH_STACK__[__LENGTH_STACK__.length] = 0;", // Push a new for-loop onto the stack of loop lengths.
                             "if ((", listVar, ") != null) { ",
                             "var ", iterVar, "_ct = 0;",       // iterVar_ct variable, added by B. Bittman
                             "for (var ", iterVar, "_index in ", listVar, ") { ",
                             iterVar, "_ct++;",
                             "if (typeof(", listVar, "[", iterVar, "_index]) == 'function') {continue;}", // IE 5.x fix from Igor Poteryaev.
                             "__LENGTH_STACK__[__LENGTH_STACK__.length - 1]++;",
                             "var ", iterVar, " = ", listVar, "[", iterVar, "_index];" ].join("");
                     } },
        "forelse" : { delta:  0, prefix: "} } if (__LENGTH_STACK__[__LENGTH_STACK__.length - 1] == 0) { if (", suffix: ") {", paramDefault: "true" },
        "/for"    : { delta: -1, prefix: "} }; delete __LENGTH_STACK__[__LENGTH_STACK__.length - 1];" }, // Remove the just-finished for-loop from the stack of loop lengths.
        "var"     : { delta:  0, prefix: "var ", suffix: ";" },
        "macro"   : { delta:  1,
                      prefixFunc : function(stmtParts, state, tmplName, etc) {
                          var macroName = stmtParts[1].split('(')[0];
                          return [ "var ", macroName, " = function",
                                   stmtParts.slice(1).join(' ').substring(macroName.length),
                                   "{ var _OUT_arr = []; var _OUT = { write: function(m) { if (m) _OUT_arr.push(m); } }; " ].join('');
                     } },
        "/macro"  : { delta: -1, prefix: " return _OUT_arr.join(''); };" }
    }
    TrimPath.parseTemplate_etc.modifierDef = {
        "eat"        : function(v)    { return ""; },
        "escape"     : function(s)    { return String(s).replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;"); },
        "capitalize" : function(s)    { return String(s).toUpperCase(); },
        "default"    : function(s, d) { return s != null ? s : d; }
    }
    TrimPath.parseTemplate_etc.modifierDef.h = TrimPath.parseTemplate_etc.modifierDef.escape;

    TrimPath.parseTemplate_etc.Template = function(tmplName, tmplContent, funcSrc, func, etc) {
        this.process = function(context, flags) {
            if (context == null){context = {};}
            if (context._MODIFIERS == null){context._MODIFIERS = {};}
            if (context.defined == null){context.defined = function(str) { return (context[str] != undefined); };}
            for (var k in etc.modifierDef) {
                if (context._MODIFIERS[k] == null){context._MODIFIERS[k] = etc.modifierDef[k];}
            }
            if (flags == null){flags = {};}
            var resultArr = [];
            var resultOut = { write: function(m) { resultArr.push(m); } };
            try {
                func(resultOut, context, flags);
            } catch (e) {
                if (flags.throwExceptions == true) {
                  throw e;
                }
                var result = new String(resultArr.join("") +
                    "[ERROR: template: <pre>" + exceptionDetails(e) + "</pre>]");
                result["exception"] = e;
                return result;
            }
            return resultArr.join("");
        }
        this.name       = tmplName;
        this.source     = tmplContent;
        this.sourceFunc = funcSrc;
        this.toString   = function() { return "TrimPath.Template [" + tmplName + "]"; }
    }
    TrimPath.parseTemplate_etc.ParseError = function(name, line, message) {
        this.name    = name;
        this.line    = line;
        this.message = message;
    }
    TrimPath.parseTemplate_etc.ParseError.prototype.toString = function() {
        return ("TrimPath template ParseError in " + this.name + ": line " + this.line + ", " + this.message);
    }

    var parse = function(body, tmplName, etc) {
        body = cleanWhiteSpace(body);
        var funcText = [ "var TrimPath_Template_TEMP = function(_OUT, _CONTEXT, _FLAGS) { with (_CONTEXT) {" ];
        var state    = { stack: [], line: 1 };                              // TODO: Fix line number counting.
        var endStmtPrev = -1;
        while (endStmtPrev + 1 < body.length) {
            var begStmt = endStmtPrev;
            // Scan until we find some statement markup.
            begStmt = body.indexOf("{", begStmt + 1);
            while (begStmt >= 0) {
                var endStmt = body.indexOf('}', begStmt + 1);
                var stmt = body.substring(begStmt, endStmt);
                var blockrx = stmt.match(/^\{(cdata|minify|eval)/); // From B. Bittman, minify/eval/cdata implementation.
                if (blockrx) {
                    var blockType = blockrx[1];
                    var blockMarkerBeg = begStmt + blockType.length + 1;
                    var blockMarkerEnd = body.indexOf('}', blockMarkerBeg);
                    if (blockMarkerEnd >= 0) {
                        var blockMarker;
                        if( blockMarkerEnd - blockMarkerBeg <= 0 ) {
                            blockMarker = "{/" + blockType + "}";
                        } else {
                            blockMarker = body.substring(blockMarkerBeg + 1, blockMarkerEnd);
                        }

                        var blockEnd = body.indexOf(blockMarker, blockMarkerEnd + 1);
                        if (blockEnd >= 0) {
                            emitSectionText(body.substring(endStmtPrev + 1, begStmt), funcText);

                            var blockText = body.substring(blockMarkerEnd + 1, blockEnd);
                            if (blockType == 'cdata') {
                                emitText(blockText, funcText);
                            } else if (blockType == 'minify') {
                                emitText(scrubWhiteSpace(blockText), funcText);
                            } else if (blockType == 'eval') {
                                if (blockText != null && blockText.length > 0){funcText.push('_OUT.write( (function() { ' + blockText + ' })() );');}
                            }
                            begStmt = endStmtPrev = blockEnd + blockMarker.length - 1;
                        }
                    }
                } else if (body.charAt(begStmt - 1) != '$' &&               // Not an expression or backslashed,
                           body.charAt(begStmt - 1) != '\\') {              // so check if it is a statement tag.
                    var offset = (body.charAt(begStmt + 1) == '/' ? 2 : 1); // Close tags offset of 2 skips '/'.
                                                                            // 10 is larger than maximum statement tag length.
                    if (body.substring(begStmt + offset, begStmt + 10 + offset).search(TrimPath.parseTemplate_etc.statementTag) == 0) {
                      break;                                              // Found a match.
                    }
                }
                begStmt = body.indexOf("{", begStmt + 1);
            }
            if (begStmt < 0) {
              break;
            }
            var endStmt = body.indexOf("}", begStmt + 1); // In "a{for}c", endStmt will be 5.
            if (endStmt < 0) {
              break;
            }
            emitSectionText(body.substring(endStmtPrev + 1, begStmt), funcText);
            emitStatement(body.substring(begStmt, endStmt + 1), state, funcText, tmplName, etc);
            endStmtPrev = endStmt;
        }
        emitSectionText(body.substring(endStmtPrev + 1), funcText);
        if (state.stack.length != 0) {
          throw new etc.ParseError(tmplName, state.line, "unclosed, unmatched statement(s): " + state.stack.join(","));
        }
        funcText.push("}}; TrimPath_Template_TEMP");
        return funcText.join("");
    }

    var emitStatement = function(stmtStr, state, funcText, tmplName, etc) {
        var parts = stmtStr.slice(1, -1).split(' ');
        var stmt = etc.statementDef[parts[0]]; // Here, parts[0] == for/if/else/...
        if (stmt == null) {                    // Not a real statement.
            emitSectionText(stmtStr, funcText);
            return;
        }
        if (stmt.delta < 0) {
            if (state.stack.length <= 0) {
              throw new etc.ParseError(tmplName, state.line, "close tag does not match any previous statement: " + stmtStr);
            }
            state.stack.pop();
        }
        if (stmt.delta > 0){state.stack.push(stmtStr);}

        if (stmt.paramMin != null &&
            stmt.paramMin >= parts.length) {
          throw new etc.ParseError(tmplName, state.line, "statement needs more parameters: " + stmtStr);
        }
        if (stmt.prefixFunc != null){funcText.push(stmt.prefixFunc(parts, state, tmplName, etc));} else {funcText.push(stmt.prefix);}
        if (stmt.suffix != null) {
            if (parts.length <= 1) {
                if (stmt.paramDefault != null){funcText.push(stmt.paramDefault);}
            } else {
                for (var i = 1; i < parts.length; i++) {
                    if (i > 1){funcText.push(' ');}
                    funcText.push(parts[i]);
                }
            }
            funcText.push(stmt.suffix);
        }
    }

    var emitSectionText = function(text, funcText) {
        if (text.length <= 0) {
          return;
        }
        var nlPrefix = 0;               // Index to first non-newline in prefix.
        var nlSuffix = text.length - 1; // Index to first non-space/tab in suffix.
        while (nlPrefix < text.length && (text.charAt(nlPrefix) == '\n')){nlPrefix++;}
        while (nlSuffix >= 0 && (text.charAt(nlSuffix) == ' ' || text.charAt(nlSuffix) == '\t')){nlSuffix--;}
        if (nlSuffix < nlPrefix){nlSuffix = nlPrefix;}
        if (nlPrefix > 0) {
            funcText.push('if (_FLAGS.keepWhitespace == true) _OUT.write("');
            var s = text.substring(0, nlPrefix).replace('\n', '\\n'); // A macro IE fix from BJessen.
            if (s.charAt(s.length - 1) == '\n'){s = s.substring(0, s.length - 1);}
            funcText.push(s);
            funcText.push('");');
        }
        var lines = text.substring(nlPrefix, nlSuffix + 1).split('\n');
        for (var i = 0; i < lines.length; i++) {
            emitSectionTextLine(lines[i], funcText);
            if (i < lines.length - 1){funcText.push('_OUT.write("\\n");\n');}
        }
        if (nlSuffix + 1 < text.length) {
            funcText.push('if (_FLAGS.keepWhitespace == true) _OUT.write("');
            var s = text.substring(nlSuffix + 1).replace('\n', '\\n');
            if (s.charAt(s.length - 1) == '\n'){s = s.substring(0, s.length - 1);}
            funcText.push(s);
            funcText.push('");');
        }
    }

    var emitSectionTextLine = function(line, funcText) {
        var endMarkPrev = '}';
        var endExprPrev = -1;
        while (endExprPrev + endMarkPrev.length < line.length) {
            var begMark = "${", endMark = "}";
            var begExpr = line.indexOf(begMark, endExprPrev + endMarkPrev.length); // In "a${b}c", begExpr == 1
            if (begExpr < 0) {
              break;
            }
            if (line.charAt(begExpr + 2) == '%') {
                begMark = "${%";
                endMark = "%}";
            }
            var endExpr = line.indexOf(endMark, begExpr + begMark.length);         // In "a${b}c", endExpr == 4;
            if (endExpr < 0) {
              break;
            }
            emitText(line.substring(endExprPrev + endMarkPrev.length, begExpr), funcText);
            // Example: exprs == 'firstName|default:"John Doe"|capitalize'.split('|')
            var exprArr = line.substring(begExpr + begMark.length, endExpr).replace(/\|\|/g, "#@@#").split('|');
            for (var k in exprArr) {
                if (exprArr[k].replace){exprArr[k] = exprArr[k].replace(/#@@#/g, '||');}
            }
            funcText.push('_OUT.write(');
            emitExpression(exprArr, exprArr.length - 1, funcText);
            funcText.push(');');
            endExprPrev = endExpr;
            endMarkPrev = endMark;
        }
        emitText(line.substring(endExprPrev + endMarkPrev.length), funcText);
    }

    var emitText = function(text, funcText) {
        if (text == null ||
            text.length <= 0) {
          return;
        }
        text = text.replace(/\\/g, '\\\\');
        text = text.replace(/\n/g, '\\n');
        text = text.replace(/"/g,  '\\"');
        funcText.push('_OUT.write("');
        funcText.push(text);
        funcText.push('");');
    }

    var emitExpression = function(exprArr, index, funcText) {
        // Ex: foo|a:x|b:y1,y2|c:z1,z2 is emitted as c(b(a(foo,x),y1,y2),z1,z2)
        var expr = exprArr[index]; // Ex: exprArr == [firstName,capitalize,default:"John Doe"]
        if (index <= 0) {          // Ex: expr    == 'default:"John Doe"'
            funcText.push(expr);
            return;
        }
        var parts = expr.split(':');
        funcText.push('_MODIFIERS["');
        funcText.push(parts[0]); // The parts[0] is a modifier function name, like capitalize.
        funcText.push('"](');
        emitExpression(exprArr, index - 1, funcText);
        if (parts.length > 1) {
            funcText.push(',');
            funcText.push(parts[1]);
        }
        funcText.push(')');
    }

    var cleanWhiteSpace = function(result) {
        result = result.replace(/\t/g,   "    ");
        result = result.replace(/\r\n/g, "\n");
        result = result.replace(/\r/g,   "\n");
        result = result.replace(/^(\s*\S*(\s+\S+)*)\s*$/, '$1'); // Right trim by Igor Poteryaev.
        return result;
    }

    var scrubWhiteSpace = function(result) {
        result = result.replace(/^\s+/g,   "");
        result = result.replace(/\s+$/g,   "");
        result = result.replace(/\s+/g,   " ");
        result = result.replace(/^(\s*\S*(\s+\S+)*)\s*$/, '$1'); // Right trim by Igor Poteryaev.
        return result;
    }

    // The DOM helper functions depend on DOM/DHTML, so they only work in a browser.
    // However, these are not considered core to the engine.
    //
    TrimPath.parseDOMTemplate = function(elementId, optDocument, optEtc) {
        if (optDocument == null){optDocument = document;}
        var element = optDocument.getElementById(elementId);
        var content = element.value;     // Like textarea.value.
        if (content == null){content = element.innerHTML; // Like textarea.innerHTML.
}
        content = content.replace(/&lt;/g, "<").replace(/&gt;/g, ">");
        return TrimPath.parseTemplate(content, elementId, optEtc);
    }

    TrimPath.processDOMTemplate = function(elementId, context, optFlags, optDocument, optEtc) {
        return TrimPath.parseDOMTemplate(elementId, optDocument, optEtc).process(context, optFlags);
    }
}) ();
dojo.provide("clickability.w-button");
dojo.require("dj.util.Cookie");


/* Copyright 2000-2004 Clickability Inc.  */
/* Clickability ButtonServer v4.01        */

/*Functions*/
function getRegionpartnerID(TrackType)
{
  var regionCookie = dj.util.Cookie.getCookie('wsjregion');
  var defaultETRegion = 398944;
  var defaultPVRegion = 399154;

  if (typeof regionCookie !== "string" || regionCookie.length === 0)
  {
    return ((TrackType == "ET") ? defaultETRegion : defaultPVRegion);
  }
  var regionid = regionCookie.split(',');
  var ET = {};
  var PV = {};

  if (TrackType == 'ET')
  {
    ET.na = defaultETRegion;
    ET.europe = 398949;
    ET.asia = 398954;
  ET.india = 398959;
    //  console.log(ET[regionid[0]]);
  if(typeof regionid[1]!== "string")
  {
  return ET[regionid[0]];
  }
  else
  {
   return ((regionid[1].toLowerCase()=="india") ? ET[regionid[1]] : ET[regionid[0]]);
  }
  }
  else
  {
   PV.na = defaultPVRegion;
   PV.europe = 399159;
   PV.asia = 399164;
   PV.india = 399169;
   //  console.log(PV[regionid[0]]);
   if(typeof regionid[1]!== "string")
  {
    return PV[regionid[0]];
  }
  else
  {
     return ((regionid[1].toLowerCase()=="india") ? PV[regionid[1]] : PV[regionid[0]]);
    }
  }
}


function ST () {
  window.open('http://www.savethis.clickability.com/st/saveThisApp?clickMap=saveThis'+commonLoc(),'click',popWin);
  return false;
}

function STMouseOver () {
  window.status='SAVE THIS';
  return true;
}

function STMouseOut () {
  window.status='';
  return true;
}

function ET (mod) {
      var _c=new Image();
      var _qc='http://s.clickability.com/s?';
      _qc+="&7="+regionpartnerID;
      _qc+="&8="+escape(getEmailURL());
      _qc+="&10="+escape(getClickTitle());
      _qc+="&19=40003";
      _qc+="&21=1";
      _qc+="&18="+Math.random();
      _c.src=_qc;

  window.open('http://www.emailthis.clickability.com/et/emailThis?clickMap=create'+commonLoc(mod),'click',popWin);
  return false;
}

function ETMouseOver () {
  window.status='EMAIL THIS';
  return true;
}

function ETMouseOut () {
  window.status='';
  return true;
}

function MP () {
  window.open('http://at.wsj.com/mostpopular','click',popWin);
  return false;
}

function MPMouseOver () {
  window.status='MOST POPULAR';
  return true;
}

function MPMouseOut () {
  window.status='';
  return true;
}

function getClickURL() {
        if (self.clickURL) {
          return clickURL;
        }
        return document.location.href;
}

function getEmailURL() {
  if (typeof AT_VARS!=="undefined" && AT_VARS.articleEmailUrl && AT_VARS.articleUrl) {
    var emailUrl = AT_VARS.articleUrl;
    if(dj.context.article && dj.context.article.fullArticle){
        emailUrl = AT_VARS.articleEmailUrl;
    }
    return emailUrl;
  }
  return getClickURL();
}

function getClickTitle() {
  if (typeof AT_VARS!=="undefined" && AT_VARS.clickTitle) {
    return AT_VARS.clickTitle;
  }
  return document.title;
}
function getClickExpire() {
  if (self.clickExpire) {
    return clickExpire;
  }
  return "";
}

//document.write('<script language="JavaScript"> \n');
//document.write('window.onerror=function(){clickURL=document.location.href;return true;} \n');
//document.write('if(!self.clickURL) clickURL=parent.location.href; \n');
//document.write('<\/script> \n');

try {
    if (!self.clickURL) {
      clickURL=parent.location.href;
    }
  } catch (e) {
    console.error("Clickability. Cannot access parent.location.");
  }

/* WSJ.com Clickability Default Section Id/PV Id */
var PVpartnerID="59941",partnerID="150";
var regionpartnerID  = getRegionpartnerID('ET');
var PVregionpartnerID = getRegionpartnerID('PV');
/* WSJ.com Clickbility Section Id and PV Id mapping */

/* Barrons partnerID*/
if(dj.context.authorization.role.subscriber == 'BARRONS') {
  partnerID="3820";
}

var section_pv = new Array(20);

section_pv["Technology"]="110636";
section_pv["Tech"]="110636";
section_pv["Markets"]="110641";
section_pv["Market News"]="110641";
section_pv["Personal Journal"]="110651";
section_pv["Personal Finance"]="110651";
section_pv["Opinion"]="110646";
section_pv["Leisure/Weekend"]="110656";
section_pv["Lifestyle"]="110656";
section_pv["Life & Style"]="110656";
section_pv["Life &amp; Style"]="110656";
section_pv["Health"]="110676";
section_pv["Media"]="110671";

var section = new Array(20);

section["Technology"]="110591";
section["Tech"]="110591";
section["Markets"]="110596";
section["Market News"]="110596";
section["Personal Journal"]="110606";
section["Personal Finance"]="110606";
section["Opinion"]="110601";
section["Leisure/Weekend"]="110611";
section["Lifestyle"]="110611";
section["Life & Style"]="110611";
section["Life &amp; Style"]="110611";
section["Health"]="110631";
section["Media"]="110626";

try {
  if(window.mpsection){
    if(section_pv[mpsection]){
      PVpartnerID = section_pv[mpsection];
    }
    if(section[mpsection]){
      partnerID = section[mpsection];
    }
  }
}catch(err){
  txt="ERROR.\n\n"
  txt+="Error description: " + err.description + "\n\n"
  txt+="Click OK to continue.\n\n"
  console.error(txt);
}

var popWin="width=510,height=480,resizable=1,scrollbars=1";
var commonLoc=function(mod){return "&fb=Y&url="+escape(getEmailURL()+"?mod="+mod)+"&title="+escape(getClickTitle())+"&random="+Math.random()+"&partnerID="+partnerID+"&expire="+escape(getClickExpire())};

var inpop  = ( (document.domain.indexOf("printthis.clickability.com")>-1)?true:false);
var _a=new Image();
var _b=new Image();
var clickRan=Math.random();
var clickFac = 10;
if(clickFac==0){clickFac=1;}
if(!inpop && clickRan>(1-(1/clickFac))){
var _ti=900;
    var _qa="";
    var _qb="";


    // PAGE VIEW TRACKING
    var _qa='http://s.clickability.com/s?';
    _qa+="&7="+PVpartnerID;
    _qa+="&8="+escape(getClickURL());
    _qa+="&10="+escape(getClickTitle());
    _qa+="&19="+_ti;
    _qa+="&21="+clickFac;
    _qa+="&18="+Math.random();
    _a.src=_qa;
    // ET PAGEVIEW TRACKING
     var _qb='http://s.clickability.com/s?';
    _qb+="&7="+partnerID;
    _qb+="&8="+escape(getEmailURL());
    _qb+="&10="+escape(getClickTitle());
    _qb+="&19="+_ti;
    _qb+="&21="+clickFac;
    _qb+="&18="+Math.random();
    _b.src=_qb;


   // PAGE VIEW REGION TRACKING
    var _qa='http://s.clickability.com/s?';
    _qa+="&7="+PVregionpartnerID;
    _qa+="&8="+escape(getClickURL());
    _qa+="&10="+escape(getClickTitle());
    _qa+="&19="+_ti;
    _qa+="&21="+clickFac;
    _qa+="&18="+Math.random();
    _a.src=_qa;


    // ET PAGEVIEW REGION TRACKING
     var _qb='http://s.clickability.com/s?';
    _qb+="&7="+regionpartnerID;
    _qb+="&8="+escape(getEmailURL());
    _qb+="&10="+escape(getClickTitle());
    _qb+="&19="+_ti;
    _qb+="&21="+clickFac;
    _qb+="&18="+Math.random();
    _b.src=_qb;
}

// TODO: is this necessary?  This was written between 2000 and 2004, and this may be a Netscape 4 or IE 5 hack
// TODO:  intercepting window.onresize seems to be generally a bad idea.
window.onresize = function () {
    for (var i=0; i<document.links.length; i++) {
        document.links[i].onclick = document.links[i].onclick;
    }
};
dojo.provide("dj.util.animation");
dj.util.animation={crossFadeInsert:function(a,b,c){var e=new dojo.Deferred,f=0,j,h,g,l;h=dojo.byId(b);b=dojo.delegate({height:500,fadeOut:800,fadeIn:1200},c);c=dojo.contentBox(h);dojo.style(h,{position:"relative",height:c.h+"px"});if(!dojo.isIE||dojo.isIE&&!dojo.isQuirks&&dojo.isIE>7)dojo.style(h,{minHeight:"inherit"});g=dojo.create("div",{innerHTML:h.innerHTML,style:{position:"absolute",top:dojo.style(h,"paddingTop")+"px",left:dojo.style(h,"paddingLeft")+"px"}});dojo.place(g,h,"only");l=dojo.create("div",
{style:{overflow:"hidden",opacity:0,height:0}},h);a=typeof a==="object"?dojo.place(a,l):dojo.create("div",{innerHTML:a},l);a=dojo.marginBox(a);j=function(){++f===3&&e.callback()};a=dojo.animateProperty({node:h,duration:b.height,properties:{height:{start:c.h,end:a.h}},onEnd:function(){dojo.style(l,{overflow:"visible"});j()}});c=dojo.fadeOut({node:g,duration:b.fadeIn,onEnd:function(){dojo.destroy(g);dojo.style(h,{position:""});dojo.attr(l,"style","");j()}});b=dojo.fadeIn({node:l,duration:b.fadeIn,onEnd:function(){j()}});
a.play();c.play();b.play();return e}};
dojo.provide("dj.util.Form");
dj.util.Form={submitOnEvent:function(a,b,c){c=c||"onclick";a=dojo.byId(a);var e=document[b];if(typeof a==="undefined"||a===null||typeof e==="undefined"||e===null)console.warn("{dj.util.Form} element and/or form not found");else return dojo.connect(a,c,function(f){dojo.stopEvent(f);e.submit()})},clearOrDefaultValue:function(a){a=dojo.byId(a);dojo.connect(a,"onfocus",this,function(b){b=b.srcElement||b.target;if(b.value===b.defaultValue)b.value=""});dojo.connect(a,"onblur",this,function(b){b=b.srcElement||
b.target;if(b.value==="")b.value=b.defaultValue})},clearValue:function(a,b){var c=[],e=dojo.byId(a);if(e===null)throw Error("{dj.util.Form} element not found");var f=dojo.trim(e.value);if(typeof b=="undefined")e.value=" ";else if(dojo.isArray(b))c=b;else c.push(b);for(var j=0,h=c.length;j<h;j++)if(c[j]==f)e.value=""},checkEmpty:function(a){a=dojo.byId(a);if(a===null)throw Error("{dj.util.Form} element not found");return dojo.trim(a.value)===""},validateEmailAddresses:function(a){return/^([A-Za-z0-9_\-\.])+\@([A-Za-z0-9_\-\.])+\.([A-Za-z]{2,4})$/.test(a)},
hasValidContent:function(a,b){if(b!=="")return a.test(b);return false}};
typeof dojo==="object"&&dojo.provide("dj.util.JSExec");if(typeof dj=="undefined")dj={};if(typeof dj.util=="undefined")dj.util={};if(typeof dj.context=="undefined")dj.context={};if(typeof dj.context.jsexec=="undefined")dj.context.jsexec={};
(function(){var a=0,b=undefined;dj.util.JSExec=function(c){var e=dj.util,f=window.console,j=function(){},h=typeof e.Perf=="object",g=h&&typeof e.Perf.mark=="function"?e.Perf.mark:j,l=h&&typeof e.Perf.measure=="function"?e.Perf.measure:j,n=f&&typeof f.warn=="function";if(h&&(e.Perf.type=="console"||e.Perf.type=="jiffy")){b="JSEXEC: "+a++;g(b);g=j}return function(k,p,o){try{p=k+"-"+p;g(p);o.apply(c);l(p,b)}catch(r){n&&console.warn("JSExec %d: %o",k,r)}}}})();
dojo.provide("dj.util.PollingConditionChecker");dojo.declare("dj.util.PollingConditionChecker",[],{check:function(a,b,c,e){var f=new dojo.Deferred,j=0,h;h=function(){if(j>=c)f.errback(e);else if(a())f.callback();else{j++;setTimeout(h,b)}};setTimeout(h,b);return f}});
dojo.provide("dj.util.user.Environment");dojo.declare("dj.util.user.Environment",[],{constructor:function(a,b,c){this.region=a;this.product=b;this.subType=c},toString:function(){return this.region+"_"+this.product+"_"+this.subType}});
dojo.provide("dj.util.Template");dojo.require("trimpath.TrimPath");dj.util.Template={processDOMTemplate:function(a,b){return TrimPath.processDOMTemplate(a,b)},parseTemplate:function(a,b,c){return TrimPath.parseTemplate(a,b,c)}};
dojo.provide("dj.util.Config");dojo.require("dj.util.Observer");
dojo.declare("dj.util.Config",null,{constructor:function(a){this.setOwner(a);this.cfg={};this.obs={};this.hasFired={}},getOwner:function(){return this.owner},setOwner:function(a){this.owner=a},addProperty:function(a,b){a=a.toLowerCase();if(typeof b=="undefined")throw Error("Config {key: '_', value: '_'} must be set for key '"+a+"'.");else if(typeof b.value=="undefined")throw Error("Config value must be defined for key '"+a+"'.");else if(typeof b.handler=="undefined"){this.setProperty(a,b.value,true);
return}var c=new dj.util.Observer,e=this.getOwner();c.subscribe(b.handler,e);this.obs[a]=c;this.setProperty(a,b.value,true)},getProperty:function(a){a=a.toLowerCase();return this.cfg[a]},setProperty:function(a,b,c){a=a.toLowerCase();this.cfg[a]=b;var e=null;if(!c){e=this.obs[a];e.fire(b)}},applyConfig:function(a){for(var b in a)a.hasOwnProperty(b)&&this.setProperty(b,a[b],true)},fireQueue:function(a){a=typeof a=="undefined"?false:a;var b=null,c;for(c in this.cfg)if(this.cfg.hasOwnProperty(c)){var e=
this.cfg[c];if(!a&&this.hasFired[c])break;b=this.obs[c];if(typeof b=="undefined")break;b.fire(e);this.hasFired[c]=true}}});
dojo.provide("dj.util.user.EnvironmentDao");dojo.require("dj.util.user.Environment");
dojo.declare("dj.util.user.EnvironmentDao",[],{constructor:function(a,b){this.region=a;this.user=b},getEnvironment:function(){var a=new dojo.Deferred,b=new dj.util.user.Environment;b.region=this.getRegion();this.getProduct().then(dojo.hitch(this,function(c){b.product=c;return this.user.getSubscriptionType()})).then(dojo.hitch(this,function(c){b.subType=c;a.callback(b)}));return a},getRegion:function(){return(this.region.getViewByRegion().split(",")[0]||"NA").toUpperCase()},getProduct:function(){var a=
new dojo.Deferred;this.user.hasRole("WSJ-PRO",dojo.hitch(this,function(b){b?a.callback("PRO"):this.user.hasRole("WSJ-ENT",function(c){c?a.callback("PRO"):a.callback("WSJ")})}));return a}});
dojo.provide("dj.util.io.script");dojo.require("dj.util.string");dojo.require("dj.util.io");
dj.util.io.script={get:function(a){var b=new dojo.Deferred,c="dj.util.io.script._jsonp"+ ++this.__ctr+"._jsonpCallback";a=dojo.mixin({jsonp:"c",jsonpCallback:c,content:{},timeout:5E3},a);var e,f=false;dj.util.string.toFunction(a.jsonpCallback,function(j){f=true;b.callback(j)});a.content[a.jsonp]=a.jsonpCallback;c=dojo.objectToQuery(a.content);e=a.url+"?"+c;dj.util.io.insertScriptAsync(e);setTimeout(function(){f||b.errback("[io.script] url timed out: '"+e+"'")},a.timeout);return b},__ctr:0};
dojo.provide("dj.util.onVisible");dojo.require("dj.util.Element");dojo.require("dojo.window");
dj.util.onVisible={_cfg:{defaultScrollProximity:70,pollingInterval:50},scan:function(){if(!this.__isScanning){this.__isScanning=true;this._getModules();this._initOnScroll()}},addModule:function(a,b){this._getModules().push({query:a,nodeList:dojo.query(a),cb:b})},refreshModules:function(){dojo.forEach(this._getModules(),function(a){var b=dojo.query(a.query);a.nodeList=a.nodeList.concat(b)});this._handleOnScroll()},isInitialized:function(a){if(a==null){console.error("{isInitialized} domNode="+a);return true}return dj.util.Element.getData(a,
"isInitialized")=="true"},markAsInitialized:function(a){if(a==null){console.error("{markAsInitialized} domNode="+a);return true}dj.util.Element.setData(a,"isInitialized","true")},getDatasetFromWidget:function(a){a=dj.util.Element.getDataset(a);delete a.djWidget;return a},_getModules:function(){if(!this.modules)this.modules=[];return this.modules},_initOnScroll:function(){if(!this._onScrollAdded){this._onScrollAdded=true;this._interval=window.setInterval(dojo.hitch(this,this._handleOnScroll),this._cfg.pollingInterval)}if(!this._lastTick)this._lastTick=
(new Date).getTime()-1;if(!this._lastBox){this._lastBox=dojo.window.getBox();this._lastBox.t++}this._canScroll=this._isOnScrollPossible()},_handleOnScroll:function(){var a=dojo.window.getBox(),b=(new Date).getTime();if(!(a.t===this._lastBox.t&&a.h===this._lastBox.h&&b-this._lastTick<1E3)){this._lastTick=b;this._lastBox=a;dojo.forEach(this.modules,function(c){c.nodeList.forEach(function(e){if(!this.isInitialized(e)){var f=this.getDatasetFromWidget(e);if(!this._canScroll||this._isNodeVisible(e,f)){this.markAsInitialized(e);
try{c.cb(e,f)}catch(j){console.error("{util.onVisible} failed to load module: %o, error: %o",e,j)}}}},this)},this)}},_isNodeVisible:function(a,b){var c=dojo.position(a,true);if(!this._isNodeDisplayed(a))return false;var e=(this.getDatasetFromWidget(a)||b).djScrollProximity||this._cfg.defaultScrollProximity;e=new Number(e);var f=dojo.window.getBox();return this._isInProximity(c,f,e)},_isNodeDisplayed:function(a){if(a===null)return true;var b=a.tagName.toLowerCase();if(b==="body")return true;var c=
dojo.style(a,"display");return b=="script"||c!=="none"?this._isNodeDisplayed(a.parentNode):false},_isInProximity:function(a,b,c){var e=b.t-c<a.y+a.h,f=b.t+b.h+c>a.y;return b.t-c>a.y&&b.t+b.h+c<a.y+a.h||e&&f},_isOnScrollPossible:function(){var a=navigator.userAgent.toLowerCase(),b=a.indexOf("iphone")>-1;a=a.indexOf("ipad")>-1;return dojo.isBrowser&&!(b||a)}};
dojo.provide("dj.util.onVisibleImg");dojo.require("dj.util.onVisible");dj.util.onVisibleImg={scan:function(){this.onv=dj.util.onVisible;this.onv.addModule("img[data-src]",dojo.hitch(this,this.loadModule));this.onv.scan()},loadModule:function(a,b){a.src=b.src}};
dojo.provide("dj.util.onVisibleWidget");dojo.require("dj.util.onVisible");dojo.require("dj.util.Template");
dj.util.onVisibleWidget={scan:function(){this.onv=dj.util.onVisible;this.onv.addModule("[data-dj-widget=onvisible.module]",dojo.hitch(this,this.loadModule));this.onv.addModule("[data-dj-widget=onvisible.template]",dojo.hitch(this,this.loadTemplate));this.onv.scan()},loadModule:function(a,b){var c=b.djModule,e=b.djModuleInit||"init";console.info("{loadModule} deferred load, module="+c+"."+e);if(c=dojo.getObject(c))if(typeof c[e]==="function"){delete b.djWidget;delete b.djModule;delete b.djModuleInit;
delete b.djScrollProximity;c[e].call(c,b,a)}else throw Error("{_loadModule} data-module-init %s is not a function",e);},loadTemplate:function(a,b){console.info("{loadTemplate} deferred load, template id="+(a.id?a.id:""));delete b.djWidget;this._handleTemplate(a,b);this.onv.refreshModules()},getDatasetFromWidget:function(a){this.onv.getDatasetFromWidget(a)},_handleTemplate:function(a,b){var c=this._getTemplateFromWidget(a);this._renderTemplate(a,c,b)},_getTemplateFromWidget:function(a){var b=dojo.query("textarea",
a)[0];if(!b)throw Error("{util.onVisibleWidget} no template domNode found in %o",a);return this._stripCdataTags(b.value)},_renderTemplate:function(a,b,c){b=dj.util.Template.parseTemplate(b).process(c);a.innerHTML=b},_stripCdataTags:function(a){a=a.replace(/\s*<!\[CDATA\[\s*/,"");return a=a.replace(/\s*\]\]>\s*/,"")}};
dojo.provide("dj.util.liveWidget");dojo.require("dj.lang");dojo.require("dj.util.Element");
dj.util.liveWidget={register:function(a,b,c){if(typeof a!=="string"||!a||typeof b!=="function")throw Error("{liveWidget.register} widgetName must be a non-empty string, and callback -- a function");var e=this;this._widgetEvents[a]=dj.lang.addLiveEvent("div[data-dj-live-widget="+a+"]","click",function(f){if(!e._isInitialized(this)){e._markAsInitialized(this);var j=dj.util.Element.getDataset(this);delete j.djLiveWidget;f={domNode:this,event:f};try{b.call(c,f,j)}catch(h){console.error("{liveWidget} '%s': %o threw: %o",
a,this,h.message)}}})},unregister:function(a){if(typeof a!=="string"||!a)throw Error("{liveWidget.unregister} widgetName must be a non-empty string");(a=this._widgetEvents[a])&&dj.lang.removeLiveEvent(a)},_isInitialized:function(a){return dj.util.Element.getData(a,"isInitialized")=="true"},_markAsInitialized:function(a){dj.util.Element.setData(a,"isInitialized","true")},_widgetEvents:[]};
dojo.provide("dj.widget.fragmentloader.dao.FileServiceDao");
dojo.declare("dj.widget.fragmentloader.dao.FileServiceDao",[],{DEFAULT_CONFIG:{TTL:"24h"},constructor:function(a,b,c){this.script=a;this.coreContext=b;this.cfg=dojo.delegate(this.DEFAULT_CONFIG,c)},getFragment:function(a){if(!a||!a.id)throw Error("FileServiceDao: fragment must have an id");this._useDataId(a.id);var b=new dojo.Deferred,c,d=a.getAbsolutePaths();c=this._getFileServiceUrl();d={absolutePath:d,TTL:this.cfg.TTL};if(this.cfg.maxCacheDurationSeconds!==null&&typeof this.cfg.maxCacheDurationSeconds!=
"undefined")d.maxCacheDurationSeconds=this.cfg.maxCacheDurationSeconds;c=this.script.get({url:c,content:d,jsonp:"c",jsonpCallback:"dj.module._fileServiceDao."+a.id,timeout:25E3});c.addCallback(this,function(e){var f,g,h;g=0;for(h=e.files.length;g<h;g++){f=e.files[g];if(f.statusCode!==200){b.errback(Error("FileServiceDao: unsuccessful status code: "+f.statusCode+" for url: "+f.absolutePath));return}}b.callback(this._populateFragmentWithFiles(a,e.files))});c.addErrback(function(e){b.errback(Error("FileServiceDao: service error: "+
e))});return b},__dataIds:{},_useDataId:function(a){this.__dataIds[a]=true},_getFileServiceUrl:function(){var a=this.coreContext.customCacheCdnPrefix;if(typeof this.cfg.akamaiCdnPrefix!=="undefined"&&this.cfg.akamaiCdnPrefix!=="")a=this.cfg.akamaiCdnPrefix;return a+"/cdssvco/file/v2/Files"},_populateFragmentWithFiles:function(a,b){if(dojo.isArray(a.cssFiles))for(var c=0,d=a.cssFiles.length;c<d;c++){var e=a.cssFiles[c];e.data=this._getDataByPath(b,e.absolutePath)}if(a.jsFile)a.jsFile.data=this._getDataByPath(b,
a.jsFile.absolutePath);if(a.htmlFile)a.htmlFile.data=this._getDataByPath(b,a.htmlFile.absolutePath);if(a.jsonFile)a.jsonFile.data=this._getDataByPath(b,a.jsonFile.absolutePath);return a},_getDataByPath:function(a,b){var c,d,e;c=0;for(d=a.length;c<d;c++){e=a[c];if(e.absolutePath===b)return e.data}throw"FileServiceDao: path is not in the files";}});
dojo.provide("dj.widget.fragmentloader.File");dojo.declare("dj.widget.fragmentloader.File",[],{constructor:function(a,b){this.absolutePath=a;this.data=b}});
dojo.provide("dj.widget.fragmentloader.Fragment");dojo.declare("dj.widget.fragmentloader.Fragment",[],{constructor:function(a,b,c,d){this.id=a;this.cssFiles=b;this.jsFile=c;this.htmlFile=d},getAbsolutePaths:function(){var a=[],b,c;if(dojo.isArray(this.cssFiles)){b=0;for(c=this.cssFiles.length;b<c;b++)a.push(this.cssFiles[b].absolutePath)}this.jsFile&&a.push(this.jsFile.absolutePath);this.htmlFile&&a.push(this.htmlFile.absolutePath);return a}});
dojo.provide("dj.widget.fragmentloader.renderer.FileRenderer");dojo.require("dj.util.string");
dojo.declare("dj.widget.fragmentloader.renderer.FileRenderer",[],{constructor:function(a,b){this.animation=a;this.checker=b},renderCss:function(a){var b,c,d,e,f=dojo.doc.head||dojo.query("head")[0];b=0;for(c=a.length;b<c;b++){e=a[b];d=dojo.create("style",{type:"text/css","data-absolutePath":e.absolutePath});cssStr=e.data;if(d.styleSheet)d.styleSheet.cssText=cssStr;else d.appendChild(dojo.doc.createTextNode(cssStr));dojo.place(d,f,"last")}},renderHtml:function(a,b,c){c=typeof c=="undefined"?true:c;
var d=new this.checker.check(function(){return dojo.byId(b)},25,40,"Retriever: exceded num of retries for HTML");if(c)return dojo.when(d,dojo.hitch(this.animation,"crossFadeInsert",a.data,b));else{dojo.place(a.data,b,"only");def=new dojo.Deferred;def.resolve();return def}},renderJs:function(a){var b=dojo.create("script",{type:"text/javascript"});if(dojo.isIE)b.text=a.data;else b.appendChild(dojo.doc.createTextNode(a.data));a=dojo.doc.getElementsByTagName("script")[0];a.parentNode.insertBefore(b,a)},
renderInlineJs:function(a){dj.util.string.evalScripts(a.data,a.absolutePath)}});
dojo.provide("dj.widget.fragmentloader.bo.FragmentBo");dojo.require("dj.widget.fragmentloader.File");dojo.require("dj.widget.fragmentloader.Fragment");
dojo.declare("dj.widget.fragmentloader.bo.FragmentBo",[],{DEFAULT_CONFIG:{js:{providedUnits:"j_global_slim"},css:{},html:{}},constructor:function(a,b,c){this.dao=a;this.userEnv=b;this.cfg=dojo.delegate(this.DEFAULT_CONFIG,c);this.assetPaths=dj.context.core.assetPaths;this.cssToGetList=dj.context.core.cssToGet},getFragment:function(a,b){return dojo.when(this.userEnv,dojo.hitch(this,function(c){var d="fragment_"+c.toString()+"_"+a;d=new dj.widget.fragmentloader.Fragment(d);d.cssFiles=this.cfg.isLoadCss?
this._getCssFiles(c,a,b):undefined;d.jsFile=this.cfg.isLoadJs?this._getJsFile(c,a,b):undefined;d.htmlFile=this.cfg.isLoadHtml?this._getHtmlFile(c,a,b):undefined;return this.dao.getFragment(d)}))},_getCssFiles:function(a,b,c){var d=this._getCssFileList(dojo.isIE),e=Array(d.length);i=0;for(len=d.length;i<len;i++)e[i]=new dj.widget.fragmentloader.File(this.assetPaths.style+"/"+d[i]+"/"+a+"/"+b+"-"+c+".css");return e},_getJsFile:function(a,b,c){return new dj.widget.fragmentloader.File(this.assetPaths.script+
"/bucket/"+a+"/page/"+b+"/provided/"+this.cfg.js.providedUnits+"/version/"+c+".js")},_getHtmlFile:function(a,b,c){var d=this._getHtmlChipStr();return new dj.widget.fragmentloader.File("/public"+this.assetPaths.page+"/"+a+":"+b+"-"+d+c+".html")},_getHtmlChipStr:function(){return dojo.isArray(this.cfg.html.chips)?this.cfg.html.chips.join("-")+"-":""},_getCssFileList:function(a){var b=["2/std","3/std","4/std"];if(typeof this.cssToGetList!=="undefined")b=this.cssToGetList;if(typeof a!=="undefined")if(a<
7)b.push("1/ie6");else if(a==7)b.push("1/ie7");else if(a==8)b.push("1/ie8");else a==9&&b.push("1/ie9");return b}});
dojo.provide("dj.widget.fragmentloader.FragmentLoader");dojo.require("dj.util.PollingConditionChecker");dojo.require("dj.util.animation");dojo.require("dj.util.io.script");dojo.require("dj.widget.fragmentloader.renderer.FileRenderer");dojo.require("dj.widget.fragmentloader.bo.FragmentBo");dojo.require("dj.widget.fragmentloader.dao.FileServiceDao");
dojo.declare("dj.widget.fragmentloader.FragmentLoader",[],{DEFAULT_CONFIG:{isLoadJs:true,isLoadCss:true,isLoadHtml:true,isLoadInlineJs:false,isDataCallback:false,isAnimated:true,akamaiCdnPrefix:""},constructor:function(a,b,c,d,e){this.userEnv=a;this.mstPageId=b;this.domNodeId=d;this.version=c;this.cfg=dojo.delegate(this.DEFAULT_CONFIG,e);this._initRenderers()},load:function(){return dojo.when(this.fragmentBo.getFragment(this.mstPageId,this.version),dojo.hitch(this,function(a){this.cfg.isDataCallback&&
this.onDataCallback(a);if(this.cfg.isLoadCss){this.fileRenderer.renderCss(a.cssFiles);this.onCssLoad()}if(this.cfg.isLoadHtml)this.fileRenderer.renderHtml(a.htmlFile,this.domNodeId,this.cfg.isAnimated).then(dojo.hitch(this,function(){this.onHtmlLoad();if(this.cfg.isLoadJs){this.fileRenderer.renderJs(a.jsFile);this.onJsLoad()}if(this.cfg.isLoadInlineJs){this.fileRenderer.renderInlineJs(a.htmlFile);this.onInlineJsLoad()}}));else if(this.cfg.isLoadJs){this.fileRenderer.renderJs(a.jsFile);this.onJsLoad()}}))},
onCssLoad:function(){},onJsLoad:function(){},onHtmlLoad:function(){},onInlineJsLoad:function(){},onDataCallback:function(){},_initRenderers:function(){var a=new dj.widget.fragmentloader.dao.FileServiceDao(dj.util.io.script,dj.context.core,this.cfg),b=new dj.util.PollingConditionChecker;this.fragmentBo=new dj.widget.fragmentloader.bo.FragmentBo(a,this.userEnv,this.cfg);this.fileRenderer=new dj.widget.fragmentloader.renderer.FileRenderer(dj.util.animation,b)}});

dojo.provide("dj.util.bluegrass");dj.util.bluegrass=function(){var Connection=function(runtime,endpoint,callback){var _runtime=runtime;var _endpoint=endpoint;var _callbacks=[];_callbacks.push(callback);var _channels={};var _impl=null;var _reconnectTimer=null;var thunk=this;var _callback=function(connection,type){dojo.forEach(_callbacks,function(callbck){try{callbck(connection,type);}
catch(err){if(typeof(console)!="undefined"&&console.warn)
{console.warn("Error in connection callback: "+err.message);}}});};var _channelTrigger=function(message,channel){if(message.h.a=="unsubscribe"){if(_channels[channel.getChannelName()]!==null)
{delete _channels[channel.getChannelName()];}}
_impl.send(message);};var _systemCallback=function(message){if(message.h.a==="process"&&message.b){if(message.b.reconnect&&_reconnectTimer===null){_impl.setPickupInterval(5000);_reconnectTimer=setTimeout(function(){_reconnect();},2000);}
else if(message.b.pickupInterval&&_impl!==null){_impl.setPickupInterval(message.b.pickupInterval);}
else if(message.b.channelState){_setChannelState(message.b.channelState);}}
else if(message.h.a==="inform"){if(message.h.t==="/system/channelinfo"){_setChannelInfo(message.b);}}};var _reconnect=function(){var channels=[];try{for(var channelKey in _channels){if(channelKey)
{var tempChannel=_channels[channelKey];if(tempChannel)
{tempChannel.clearTimers();channels.push({c:tempChannel.getChannelName(),b:tempChannel.getCallbacks(),n:tempChannel.getLastMessageNumber()});}}}}
catch(e){}
_channels={};var type="reconnect";if(!_impl||!_impl.isOpen()){type="connect";}
var callback=function(){_callback(thunk,type);dojo.forEach(channels,function(channel){channel=thunk.subscribe(channel.c,channel.b[0],{sequence:null,number:channel.n});if(typeof channel.b!=='undefined'&&channel.b.length>1){for(var i=1;i<channel.b.length;i++){channel.addCallback(channel.b[i]);}}});};_implInitialize(callback);_reconnectTimer=null;};var _setChannelInfo=function(channelInfo){if(channelInfo&&channelInfo.channelName){var tempChannel=_channels[channelInfo.channelName];if(tempChannel){if(tempChannel.getChannelName()==channelInfo.channelName){if(channelInfo.deliveryType){tempChannel.setDeliveryType(channelInfo.deliveryType);}}}}};var _setChannelState=function(channelState){var channel=_channels[channelState.channelName];if(channel!==null){if(!channelState.enabled){channel.resetState();}}};var _implInitialize=function(callback){_implTerminate();var connectCallback=function(){_callback(thunk,"connect");};if(callback){connectCallback=callback;}
_impl=new ConnectionImpl(connectCallback,function(message){_systemCallback(message);});_impl.initialize(_endpoint,function(impl,messages){_implCallback(impl,messages);});};var _implTerminate=function(){if(_impl!==null){_impl.terminate();_impl=null;}};var _implCallback=function(impl,messages){if(impl!=_impl){impl.terminate();return;}
if(!messages){return;}
for(var i=0;i<messages.length;i++){var mess=messages[i];var channel=_channels[mess.h.t];if(channel){channel.deliver(mess);}}};this.subscribe=function(channelName,callback,options){var channel;if(_channels[channelName]===null||typeof(_channels[channelName])==='undefined'){channel=new Channel(channelName,callback,options,_channelTrigger);_channels[channelName]=channel;}
else{channel=_channels[channelName];channel.addCallback(callback);}
return channel;};this.unsubscribe=function(channelName,callback,options){var channel;if(_channels[channelName]!==null||typeof(_channels[channelName])!=='undefined'){console.log(channelName);channel=_channels[channelName];channel.removeCallback(callback);channel.unsubscribe();}
return channel;};this.getChannel=function(channelName){return _channels[channelName];};this.close=function(){_callbacks=[];_channels={};_implTerminate();};this.reconnect=function(){if(_reconnectTimer===null){_reconnectTimer=setTimeout(function(){_reconnect();},100);}};this.isOpen=function(){if(_impl!==null){return _impl.isOpen();}
else{return false;}};this.isDisabled=function(){if(_impl!==null){return _impl.isDisabled();}
else{return false;}};this.addCallback=function(callback){_callbacks.push(callback);};this.setTransmitHook=function(hook){_impl.setTransmitHook(hook);};this.setReceiveHook=function(hook){_impl.setReceiveHook(hook);};this.scrambleClientId=function(){_impl.scrambleClientId();};this.getChannelCount=function(){var size=0;for(var key in _channels){if(_channels.hasOwnProperty(key)){size++;}}
return size;};_implInitialize();};var ConnectionImpl=(function(){return function(connectCallback,systemCallback){var _callback,_endpoint;var _clientInfo,_protocolInfo;var _transmitHookCallback=null;var _receiveHookCallback=null;var _outgoing=[];var _connectFailCount=0;var _failCount=0;var _inProgress=0;var _timer,_connectTimer;var _isOpen=false,_isDisabled=false;var _sendTimer=null;var _connectCallback=connectCallback;var _systemCallback=systemCallback;var thunk=this;var _pumpMessages=function(){if(!_isOpen){return;}
_sendTimer=null;var shouldSend=false;if(_inProgress<1){shouldSend=true;}
else if(_inProgress<2&&_outgoing.length>0){shouldSend=true;}
if(shouldSend){var immediate=_outgoing.length>0;for(var i=0,l=_outgoing.length;i<l;i++){var o=_outgoing[i];if(o.b&&('0'===o.b.number)&&(''===o.b.sequence)){delete o.b;}}
var payload={c:dojo.toJson(_clientInfo),m:dojo.toJson(_outgoing.splice(0,15))};if(typeof(_protocolInfo.pickupInterval)==='number'&&_protocolInfo.pickupInterval>0&&_failCount===0&&!immediate){_timer=setTimeout(function(){_messageRequest(payload);},_protocolInfo.pickupInterval);}
else if(_failCount>0){_timer=setTimeout(function(){_messageRequest(payload);},1000*Math.min(900,Math.pow(2,_failCount)));}
else{clearTimeout(_timer);_messageRequest(payload);if(_outgoing.length>0){_sendTimer=setTimeout(_pumpMessages,100);}}}};var _connectFail=function(xhr,status,error,message){_connectFailCount++;_connectTimer=setTimeout(function(){_connectRequest();},1000*Math.min(900,Math.pow(2,_connectFailCount)));};var _connectResponse=function(request,response){_clientInfo=response.clientInfo;_protocolInfo=response.protocolInfo;_inProgress=0;if(response.status.disabled){_isOpen=false;_isDisabled=true;}
else{_isOpen=true;_pumpMessages();if(dojo.isFunction(_connectCallback)){_connectCallback();}}};var _connectRequest=function(){var url=_endpoint.to;if(_endpoint.via){url=_endpoint.via+"?to="+url;}
dojo.xhrGet({url:url,preventCache:true,failOk:true,headers:{"X-Requested-With":""},handleAs:"json",load:function(responseObject,xhr){_connectResponse(xhr,responseObject);},error:function(error,ioArgs){_connectFail(ioArgs,ioArgs.xhr.status,error,request);}});};var _messageRequest=function(request){var url=_protocolInfo.pickupUrl;var currentDomain='http://'+document.location.toString().split(/\/+/g)[1];if(_endpoint.altPickupUrl){url=_endpoint.altPickupUrl;}else if(_endpoint.via){url=_endpoint.via+"?to="+url;}else{var tmpUrl=url;if(tmpUrl.indexOf("com")!==-1){tmpUrl=tmpUrl.substring(tmpUrl.indexOf("com")+3,tmpUrl.length);url=currentDomain+tmpUrl;}
else{url=tmpUrl.replace(tmpUrl.split(/\/+/g)[1],document.location.toString().split(/\/+/g)[1]);}}
_inProgress++;if(_transmitHookCallback!==null){dojo.forEach(eval(request.m),function(rm){_transmitHookCallback(rm,_clientInfo);});}
dojo.xhrGet({url:url,content:request,preventCache:true,failOk:true,headers:{"X-Requested-With":""},handleAs:"json",load:function(responseObject,xhr){_messageResponse(responseObject);},error:function(error,ioArgs){_messageFail(ioArgs,ioArgs.xhr.status,error,request);}});};var _messageResponse=function(response){_inProgress--;_failCount=0;if(response!==null&&response.length>0){if(_receiveHookCallback!==null){dojo.forEach(response,function(res){_receiveHookCallback(res);});}
dojo.forEach(response,function(res){if(res.h&&res.h.t&&res.h.t.indexOf("\/system\/")===0){_systemCallback(res);}});}
_callback(thunk,response);_pumpMessages();};var _messageFail=function(xhr,status,error,message){_inProgress--;_failCount++;var originalMessage=unescape(message.data);originalMessage="{\""+originalMessage.replace(new RegExp("\\+","g"),"").replace(new RegExp("=","g"),"\":").replace(new RegExp("&amp;","g"),",\"")+"}";var messageData=dojo.toJson(originalMessage);if(messageData&&messageData.m&&messageData.m.length>0){for(var i=0;i<messageData.m.length;i++){_outgoing.push(messageData.m[i]);}}
_pumpMessages();};this.initialize=function(endpoint,callback){_endpoint=endpoint;_callback=callback;_connectRequest();};this.terminate=function(){_isOpen=false;if(_timer){clearInterval(_timer);}
if(_connectTimer)
{clearInterval(_connectTimer);}};this.setPickupInterval=function(interval){_protocolInfo.pickupInterval=interval;};this.scrambleClientId=function(){_clientInfo.c="Boom!";};this.setTransmitHook=function(hook){_transmitHookCallback=hook;};this.setReceiveHook=function(hook){_receiveHookCallback=hook;};this.send=function(messages){if(!_isOpen){return;}
_outgoing.splice(_outgoing.length,0,messages);if(_sendTimer===null){_sendTimer=setTimeout(_pumpMessages,100);}};this.isOpen=function(){return _isOpen;};this.isDisabled=function(){return _isDisabled;};};})();var Channel=function(channelName,callback,options,trigger){var _channelName=channelName;var _callbacks=[];var _currentSequence="";var _firstMessageNumber="0";var _trigger=trigger;_callbacks.push(callback);var _callback=function(message){for(var i=0;i<_callbacks.length;i++){try{var callbck=_callbacks[i];callbck(message);}
catch(err){if(typeof(console)!="undefined"&&console.warn)
{console.warn("Error delivering message on \""+_channelName+"\": "+err.message);}}}};var _deliveryType="";if(options&&options.sequence)
{_currentSequence=options.sequence;}
if(options&&options.number)
{_firstMessageNumber=options.number;}
var _lastMessageNumber=_firstMessageNumber;var _ackTimer=null;var _acksSent=0;var _bypassQueue=[];var _bypassTimer=null;if(dojo.isFunction(_trigger)){var message={h:{t:_channelName,a:"subscribe"},b:{sequence:_currentSequence,number:_firstMessageNumber}};_trigger(message,this);}
var thunk=this;var _scanBypassQueue=function(){if(_bypassQueue&&_bypassQueue.length>0){_bypassQueue.sort(function(a,b){return a.h.n-b.h.n;});var index=0;for(var i=0;i<_bypassQueue.length;i++){var bypassQ=_bypassQueue[i];if(bypassQ.h.n==_lastMessageNumber+1){_callback(bypassQ);_lastMessageNumber=bypassQ.h.n;index=i+1;}
else{break;}}
if(_bypassQueue.length>index)
{_bypassQueue=_bypassQueue.slice(index);}
else{_bypassQueue=[];}
if(_bypassQueue.length>0){_bypassTimer=setTimeout(function(){_scanBypassQueue();},1000);}
else{clearTimeout(_ackTimer);_bypassTimer=null;_acksSent=0;_bypassQueue=[];}}};var _sendAck=function(){if(_acksSent>=10){_ackTimer=setTimeout(function(){thunk.unsubscribe();},1000);return;}
var numbers=1+"-"+_lastMessageNumber;var numbersInQueue="";var last=0;var next="";_bypassQueue.sort(function(a,b){return a.h.n-b.h.n;});if(typeof(_bypassQueue!='undefined')){for(var i=0;i<_bypassQueue.length;i++){var m=_bypassQueue[i];if(last===0){numbersInQueue=m.h.n;}
else if(m.h.n==last+1){next="-"+m.h.n;}
else{if(next.length>0){numbersInQueue+=next+","+m.h.n;next="";}
else{numbersInQueue+=","+m.h.n;}}
last=m.h.n;}
numbersInQueue+=next;}
if(numbersInQueue.length>0||numbersInQueue>0)
{numbers+=","+numbersInQueue;}
if(dojo.isFunction(_trigger)){var message={h:{t:_channelName,a:"acknowledge"},b:{sequence:_currentSequence,numbers:numbers}};_trigger(message,thunk);}
_acksSent++;_ackTimer=setTimeout(function(){_sendAck();},1000*Math.min(32,Math.pow(2,_acksSent)));};this.getChannelName=function(){return _channelName;};this.getDeliveryType=function(){return _deliveryType;};this.setDeliveryType=function(deliveryType){_deliveryType=deliveryType;};this.getCallbacks=function(){return _callbacks;};this.clearTimers=function(){if(_ackTimer)
{clearTimeout(_ackTimer);}
if(_bypassTimer)
{clearTimeout(_bypassTimer);}};this.unsubscribe=function(){if(dojo.isFunction(_trigger)){var message={h:{t:_channelName,a:"unsubscribe"}};_trigger(message,this);}};this.deliver=function(message){if(_callback&&message&&message.h&&(message.h.t==_channelName)){if(message.h.a=="retransmit"){var inQueue=false;for(var i=0;i<_bypassQueue.length;i++){var bpQueue=_bypassQueue[i];if(bpQueue.h.n==message.h.n){inQueue=true;break;}}
if(!inQueue){_bypassQueue.push(message);}
if(_bypassTimer===null){_bypassTimer=setTimeout(function(){_scanBypassQueue();},1000);}}
else if(message.h.a=="broadcast"){if(message.h.s!=_currentSequence){_currentSequence=message.h.s;_firstMessageNumber=message.h.n;_bypassQueue=[];clearTimeout(_ackTimer);_acksSent=0;}
var messageOk=false;if((_deliveryType=="Lossy"&&message.h.n>_lastMessageNumber)||_deliveryType=="BestEffort"){messageOk=true;}
else if(_deliveryType=="Guaranteed"){if(_lastMessageNumber+1==message.h.n||message.h.n==_firstMessageNumber){messageOk=true;}
else{var count=_bypassQueue.push(message);if(count==1){_ackTimer=setTimeout(function(){_sendAck();},1000);}
else if(count>=50){this.resetState();this.deliver(message);}}}
if(messageOk){_lastMessageNumber=message.h.n;_callback(message,_channelName);}}}};this.resetState=function(){_currentSequence="";_bypassQueue=[];clearTimeout(_ackTimer);_acksSent=0;};this.addCallback=function(callback){if(dojo.indexOf(_callbacks,callback)==-1){_callbacks.push(callback);}};this.removeCallback=function(callback){var index=-1;if(_callbacks.length==1&&_callbacks[0]==callback){this.unsubscribe();return;}
for(var i=0;i<_callbacks.length;i++){var callBck=_callbacks[i];if(callBck==callback){index=i;}}
if(index>=0){_callbacks=BlueGrass.Utility.arrayRemove(_callbacks,index);}};this.getLastMessageNumber=function(){return _lastMessageNumber;};};var _connection=null;var _userOffset=new Date().getTimezoneOffset()/60;var _reconTimer=null;var _isConnecting=false;return{Runtime:{openConnection:function(endpoint,callback){if(!endpoint)
{endpoint={to:"/bg/api/Connect.ashx"};}
else if(!endpoint.to)
{endpoint.to="/bg/api/Connect.ashx";}
if((document.domain=="localhost"||document.domain=="localhost.marketwatch.com")&&typeof(_bgProxyUrl)!="undefined"){endpoint.via=_bgProxyUrl;if(endpoint.to.substr(0,5)!="http:")
{endpoint.to="http://mw5.marketwatch.com"+endpoint.to;}}
if(_connection===null){if(_isConnecting){setTimeout(function(){BlueGrass.Runtime.openConnection(endpoint,callback);},100);}
else{_isConnecting=true;_connection=new Connection(this,endpoint,callback);var checkConn=function(){if(_connection.isOpen())
{_isConnecting=false;}
else
{setTimeout(checkConn,1000);}};checkConn();}}
else{_connection.addCallback(callback);if(_connection.isOpen()){callback(_connection,"connect");}
else if(!_isConnecting){if(_reconTimer===null){_reconTimer=setTimeout(function(){if(!_connection.isOpen()&&!_connection.isDisabled())
{_connection.reconnect();}
_reconTimer=null;},1000);}}}},getConnection:function(){return _connection;}},Utility:{arrayRemove:function(array,from,to){var rest=array.slice((to||from)+1||array.length);array.length=from<0?array.length+from:from;return array.push.apply(array,rest);},convertToExchangeTime:function(utcDateString,offset){if(!utcDateString){return;}
if(typeof(offset)!='undefined'){offset=offset+_userOffset;}else{offset=0;}
var converted=parseInt(utcDateString,10);if(isNaN(converted)){if(utcDateString.indexOf("-")>=0||utcDateString.indexOf("+")>=0){utcDateString=utcDateString.substring(6,utcDateString.length-7);}
else{utcDateString=utcDateString.substring(6,utcDateString.length-2);}
converted=parseInt(utcDateString,10);}
converted+=3600000*offset;var dateTime=new Date(converted);return dateTime;},prettyDate:function(date,offset){if(typeof(date)!="object"){date=this.convertToExchangeTime(date,offset);}
var time_formats=[[60,'Just Now'],[90,'1 Minute'],[3600,'Minutes',60],[5400,'1 Hour'],[86400,'Hours',3600],[129600,'1 Day'],[604800,'Days',86400],[907200,'1 Week'],[2628000,'Weeks',604800],[3942000,'1 Month'],[31536000,'Months',2628000],[47304000,'1 Year'],[3153600000,'Years',31536000],[4730400000,'1 Century']];var dt=new Date(),seconds=(dt-date)/1000,token=' Ago',format;if(seconds<0){seconds=Math.abs(seconds);token='';}
for(var i=0,l=time_formats.length;i<l;i++){format=time_formats[i];if(seconds<format[0]){if(format.length==2){return format[1]+(i>1?token:'');}else{return Math.round(seconds/format[2])+' '+format[1]+(i>1?token:'');}}}
if(seconds>4730400000){return Math.round(seconds/4730400000)+' Centuries'+token;}
return date;}}};}();
dojo.provide("dj.service.livenews.BluegrassProvider");dojo.require("dj.lang");dojo.require("dj.util.bluegrass");dojo.declare("dj.service.livenews.BluegrassProvider",null,{channels:[],_cfg:{},DEFAULT_CONFIG:{toURL:"/bg/api/connect.ashx",viaURL:null},constructor:function(a){this._cfg=dj.lang.cloneMixin(this.DEFAULT_CONFIG,a)},subscribeToChannel:function(a,b,c){this.channels.push({channelName:a,view:b,options:c})},subscribeToChannels:function(a,b,c){var d=this;dojo.forEach(a,function(e){d.subscribeToChannel(e,b,c)})},connectCallback:function(a,b){if(b=="connect"){connection=a;dojo.forEach(this.channelList,function(c){if(typeof c.view.render=="function"){var d=dojo.hitch(c.view,c.view.render);connection.subscribe(c.channelName,d,c.options)}else console.log("View object for channel %s does not have a render method",channelName)})}},connect:function(){var a=dojo.hitch({channelList:this.channels},this.connectCallback);dj.util.bluegrass.Runtime.openConnection({to:"/bg/api/connect.ashx",via:this._cfg.viaURL},a)}});
dojo.provide("dj.widget.ProgressBar");dojo.declare("dj.widget.ProgressBar",null,{TYPES:["horizontal"],constructor:function(container,config){this.cfg=dojo.mixin({indicator:"div",fps:30,timer:4,type:"horizontal"},(config||{}));this.oCnt=dojo.byId(container);this.oInd=dojo.create(this.cfg.indicator,{width:"100%"},this.oCnt);this._anim=null;},destructor:function(){if(this._anim){this._anim.stop();}
if(this.oInd){dojo.destroy(this.oInd);}},play:function(){if(this._anim!==null){if(this._anim.status=="stopped"){this._anim.play(0,true);}else{this._anim.gotoPercent(0,true);}
return;}
this._createAnimation();this._anim.play();},pause:function(){if(this._anim===null){return;}
this._anim.pause();},stop:function(){if(this._anim===null){return;}
this._anim.stop();this._anim.gotoPercent(0);dojo.style(this.oInd,"left",0);},_createAnimation:function(){var maxLeft=this._getMaxLeft(),durationInMillis=(this.cfg.timer*1000),animCfg={node:this.oInd,duration:durationInMillis,easing:function(x){return x;},onBegin:this.cfg.beforeStart,onEnd:this.cfg.afterFinish,properties:{left:maxLeft}};this._anim=dojo.animateProperty(animCfg);},_getMaxLeft:function(){if(this._maxLeftCache){return this._maxLeftCache;}
var pos=dojo.position(this.oCnt);this._maxLeftCache=pos.w;return pos.w;}});
dojo.provide("dj.widget.Slider");dojo.declare("dj.widget.Slider",null,{constructor:function(handle,track,options){this._eventConnectHandles=[];var slider=this;if(dojo.isArray(handle)){this.handles=[];for(var count=0,max=handle.length;count<max;count++){this.handles.push(dojo.byId(handle[count]));}}else{this.handles=[dojo.byId(handle)];}
this.track=dojo.byId(track);this.options=options||{};this.axis=this.options.axis||'horizontal';this.increment=this.options.increment||1;this.step=parseInt(this.options.step||'1',10);this.range=this.options.range||{start:0,end:1};this.value=0;this.values=[];dojo.forEach(this.handles,dojo.hitch(this,function(){this.values.push(0);}));this.spans=this.options.spans?dojo.forEach(this.options.spans,function(s){return dojo.byId(s);}):false;this.options.startSpan=dojo.byId(this.options.startSpan||null);this.options.endSpan=dojo.byId(this.options.endSpan||null);this.restricted=this.options.restricted||false;this.maximum=this.options.maximum||this.range.end;this.minimum=this.options.minimum||this.range.start;this.alignX=parseInt(this.options.alignX||'0',10);this.alignY=parseInt(this.options.alignY||'0',10);this.trackLength=this.maximumOffset()-this.minimumOffset();this.handleLength=this.isVertical()?(this.handles[0].offsetHeight!==0?this.handles[0].offsetHeight:this.handles[0].style.height.replace(/px$/,"")):(this.handles[0].offsetWidth!==0?this.handles[0].offsetWidth:this.handles[0].style.width.replace(/px$/,""));this.active=false;this.dragging=false;this.disabled=false;if(this.options.disabled){this.setDisabled();}
this.allowedValues=this.options.values?this.options.values.sort():false;if(this.allowedValues){this.minimum=(this.allowedValues.length>0)?this.allowedValues[0]:0;this.maximum=(this.allowedValues.length>0)?this.allowedValues[this.allowedValues.length-1]:0;}
this.eventMouseDown=dojo.hitch(this,this.startDrag);this.eventMouseUp=dojo.hitch(this,this.endDrag);this.eventMouseMove=dojo.hitch(this,this.update);dojo.forEach(this.handles,function(h,i){i=slider.handles.length-1-i;slider.setValue(parseFloat((dojo.isArray(slider.options.sliderValue)?slider.options.sliderValue[i]:slider.options.sliderValue)||slider.range.start),i);if(h.style.position&&h.style.position==='static'){h.style.position='relative';if(dojo.isOpera){h.style.top=0;h.style.left=0;}}
slider._eventConnectHandles.push(dojo.connect(h,'onmousedown',slider.eventMouseDown));});this._eventConnectHandles.push(dojo.connect(this.track,'onmousedown',this.eventMouseDown));this._eventConnectHandles.push(dojo.connect(document,'onmouseup',this.eventMouseUp));this._eventConnectHandles.push(dojo.connect(document,'onmousemove',this.eventMouseMove));this.initialized=true;},dispose:function(){dojo.forEach(this._eventConnectHandles,dojo.disconnect);},setDisabled:function(){this.disabled=true;},setEnabled:function(){this.disabled=false;},getNearestValue:function(value){if(this.allowedValues){var max=(this.allowedValues.length>0)?this.allowedValues[this.allowedValues.length-1]:0;if(value>=max){return(max);}
var min=(this.allowedValues.length>0)?this.allowedValues[0]:0;if(value<=min){return(min);}
var offset=Math.abs(this.allowedValues[0]-value);var newValue=this.allowedValues[0];dojo.forEach(this.allowedValues,function(v){var currentOffset=Math.abs(v-value);if(currentOffset<=offset){newValue=v;offset=currentOffset;}});return newValue;}
if(value>this.range.end){return this.range.end;}
if(value<this.range.start){return this.range.start;}
return value;},setValue:function(sliderValue,handleIdx){if(!this.active){this.activeHandleIdx=handleIdx||0;this.activeHandle=this.handles[this.activeHandleIdx];this.updateStyles();}
handleIdx=handleIdx||this.activeHandleIdx||0;if(this.initialized&&this.restricted){if((handleIdx>0)&&(sliderValue<this.values[handleIdx-1])){sliderValue=this.values[handleIdx-1];}
if((handleIdx<(this.handles.length-1))&&(sliderValue>this.values[handleIdx+1])){sliderValue=this.values[handleIdx+1];}}
sliderValue=this.getNearestValue(sliderValue);this.values[handleIdx]=sliderValue;this.value=this.values[0];this.handles[handleIdx].style[this.isVertical()?'top':'left']=this.translateToPx(sliderValue);this.drawSpans();if(!this.dragging||!this.event){this.updateFinished();}},setValueBy:function(delta,handleIdx){this.setValue(this.values[handleIdx||this.activeHandleIdx||0]+delta,handleIdx||this.activeHandleIdx||0);},translateToPx:function(value){return Math.round(((this.trackLength-this.handleLength)/(this.range.end-this.range.start))*(value-this.range.start))+"px";},translateToValue:function(offset){return((offset/(this.trackLength-this.handleLength)*(this.range.end-this.range.start))+this.range.start);},getRange:function(range){var v=this.values.sort();range=range||0;return{start:v[range],end:v[range+1]};},minimumOffset:function(){return(this.isVertical()?this.alignY:this.alignX);},maximumOffset:function(){return(this.isVertical()?(this.track.offsetHeight!==0?this.track.offsetHeight:this.track.style.height.replace(/px$/,""))-this.alignY:(this.track.offsetWidth!==0?this.track.offsetWidth:this.track.style.width.replace(/px$/,""))-this.alignX);},isVertical:function(){return(this.axis=='vertical');},drawSpans:function(){var slider=this;if(this.spans){for(var count=0,max=this.spans.length-1;count<=max;count++){slider.setSpan(slider.spans[count],slider.getRange(count));}}
if(this.options.startSpan){this.setSpan(this.options.startSpan,{start:0,end:this.values.length>1?this.getRange(0).start:this.value});}
if(this.options.endSpan){this.setSpan(this.options.endSpan,{start:this.values.length>1?this.getRange(this.spans.length-1).end:this.value,end:this.maximum});}},setSpan:function(span,range){if(this.isVertical()){span.style.top=this.translateToPx(range.start);span.style.height=this.translateToPx(range.end-range.start+this.range.start);}else{span.style.left=this.translateToPx(range.start);span.style.width=this.translateToPx(range.end-range.start+this.range.start);}},updateStyles:function(){dojo.forEach(this.handles,function(h){dojo.removeClass(h,'selected');});dojo.addClass(this.activeHandle,'selected');},startDrag:function(event){if(dojo.mouseButtons.isLeft(event)){if(!this.disabled){this.active=true;var handle=event.target;var pointer=[event.clientX,event.clientY];var track=handle;if(track==this.track){var trackPosition=dojo.position(this.track);this.event=event;this.setValue(this.translateToValue((this.isVertical()?pointer[1]-trackPosition.y:pointer[0]-trackPosition.x)-(this.handleLength/2)));var handlePosition=dojo.position(this.activeHandle);this.offsetX=(pointer[0]-handlePosition.x);this.offsetY=(pointer[1]-handlePosition.y);}else{while((dojo.indexOf(this.handles,handle)==-1)&&handle.parentNode){handle=handle.parentNode;}
if(dojo.indexOf(this.handles,handle)!=-1){this.activeHandle=handle;this.activeHandleIdx=dojo.indexOf(this.handles,this.activeHandle);this.updateStyles();var activeHandlePosition=dojo.position(this.activeHandle);this.offsetX=(pointer[0]-activeHandlePosition.x);this.offsetY=(pointer[1]-activeHandlePosition.y);}}}
dojo.stopEvent(event);}},update:function(event){if(this.active){if(!this.dragging){this.dragging=true;}
this.draw(event);if(dojo.isWebKit){window.scrollBy(0,0);}
dojo.stopEvent(event);}},draw:function(event){var pointer=[event.clientX,event.clientY];var trackPosition=dojo.position(this.track);pointer[0]-=this.offsetX+trackPosition.x;pointer[1]-=this.offsetY+trackPosition.y;this.event=event;this.setValue(this.translateToValue(this.isVertical()?pointer[1]:pointer[0]));if(this.initialized&&this.options.onSlide){this.options.onSlide(this.values.length>1?this.values:this.value,this);}},endDrag:function(event){if(this.active&&this.dragging){this.finishDrag(event,true);dojo.stopEvent(event);}
this.active=false;this.dragging=false;},finishDrag:function(event,success){this.active=false;this.dragging=false;this.updateFinished();},updateFinished:function(){if(this.initialized&&this.options.onChange){this.options.onChange(this.values.length>1?this.values:this.value,this);}
this.event=null;}});
dojo.provide("dj.widget.panels.PanelDTO");dojo.declare("dj.widget.panels.PanelDTO",null,{constructor:function(id,position){this._id=null;this._position=null;if(typeof id!=="undefined"){this.setId(id);}
if(typeof position!=="undefined"){this.setPosition(position);}},getId:function(){return this._id;},setId:function(id){if(typeof id==="undefined"){throw new Error("ID must be defined.");}
this._id=id;},getPosition:function(){return this._position;},setPosition:function(position){if(typeof position!=="number"){throw new TypeError("Position must be a number.");}
this._position=position;}});dojo.provide("dj.widget.panels.view.Pagination");dojo.declare("dj.widget.panels.view.Pagination",null,{constructor:function(model,pagCnt,config){this._model=model;this._pagCnt=pagCnt;this.panelIncrement=config.panelIncrement;this.paginationDivider=config.paginationDivider;},displayActiveSuccess:function(){var ap=this._model.getActive();var num=this._model.getNumberOfPanels();var start=Math.ceil(ap.getPosition()/this.panelIncrement)+(ap.getPosition()%this.panelIncrement>1?1:0);this._pagCnt.innerHTML=start+" "+this.paginationDivider+" "+Math.ceil(num/this.panelIncrement);}});dojo.provide("dj.widget.panels.controller.NavArrows");dojo.require("dj.lang");dojo.declare("dj.widget.panels.controller.NavArrows",null,{DEFAULT_CONFIG:{panelIncrement:1,doStopEvent:true,tabletSwipe:false,thresholdRatio:(1/2),swipeStartId:"imageSlide",hasLastSlideScrim:false},constructor:function(model,nav,cfg){this._cfg=dj.lang.cloneMixin(this.DEFAULT_CONFIG,cfg);this._model=model;this._nav=nav;this._procs=[];this.connectHandles=[];},setLastActive:function(){var mdl=this._model;if(mdl.isLocked()){this._enqueueProc(this.setNextActive);return;}
mdl.setActiveByPosition(mdl.getNumberOfPanels()-mdl.getViewArea()+1);},setFirstActive:function(){if(this._model.isLocked()){this._enqueueProc(this.setPreviousActive);return;}
this._model.setDirection(this._model.DIRECTION.PREVIOUS);this._model.setActiveByPosition(1);},setPreviousActive:function(){if(this._model.isLocked()){this._enqueueProc(this.setPreviousActive);return;}
this._model.setDirection(this._model.DIRECTION.PREVIOUS);this._model.setActiveByPosition(this._model.getActive().getPosition()-this._cfg.panelIncrement);},setNextActive:function(){var mdl=this._model;if(mdl.isLocked()){this._enqueueProc(this.setNextActive);return;}
var tryNextPosition=(this._model.getActive().getPosition()+this._cfg.panelIncrement);var nxt=mdl.getByPosition(tryNextPosition);if(mdl.getRotationType()==mdl.ROTATION_TYPE.LINEAR){var hasMore=(((mdl.getNumberOfPanels()-(mdl.getViewArea()||0))-mdl.getActive().getPosition())>=0);if(hasMore===false){mdl._activePanelObserver.fireByName("failure",tryNextPosition);if(this._cfg.hasLastSlideScrim){this.ignoreActions=true;}
return;}}
mdl.setDirection(mdl.DIRECTION.NEXT);mdl.setActiveByPosition(tryNextPosition);},addEvents:function(){if(this._nav.prevButton){this._addEventForType(this._nav.prevButton,"prev");}
if(this._nav.nextButton){this._addEventForType(this._nav.nextButton,"next");}
if(this._nav.firstButton){this._addEventForType(this._nav.firstButton,"first");}
if(this._nav.lastButton){this._addEventForType(this._nav.lastButton,"last");}
if(this._cfg.tabletSwipe){this._addSwipeEventHandlers();}},removeEvents:function(){for(var i=0,len=this.connectHandles.length;i<len;i++){dojo.disconnect(this.connectHandles[i]);}},_enqueueProc:function(proc){this._procs.push(proc);this._model.addLockListener(function(){var pr=this._procs.shift();if(pr){pr.call(this);}},this);},_addEventForType:function(oBtn,btnType,doRemoveEvent){this.connectHandles.push(dojo.connect(oBtn,"onclick",this,this._stopEventBridge));this.connectHandles.push(dojo.connect(oBtn,'onmousedown',this,function(ev){this._stopEventBridge(ev);this._setActiveByTypeOrBeginInterval(btnType);}));this.connectHandles.push(dojo.connect(oBtn,'onmouseup',this,this._endEventBridge));this.connectHandles.push(dojo.connect(oBtn,'onmouseout',this,this._endEventBridge));},_stopEventBridge:function(ev){if(this._cfg.doStopEvent===true){dojo.stopEvent(ev);}},_setActiveByTypeOrBeginInterval:function(type){if(!this._nextInterval||this._nextInterval===null){this._setActiveByType(type);}
if(!this._cfg.disableInterval){this._nextInterval=setInterval(dojo.hitch(this,function(){this._setActiveByType(type);}),400);}},_endEventBridge:function(){clearInterval(this._nextInterval);this._nextInterval=null;},_setActiveByType:function(type){if(this.ignoreActions){return;}
var proc;switch(type){case"prev":proc=this.setPreviousActive;break;case"first":proc=this.setFirstActive;break;case"last":proc=this.setLastActive;break;case"next":proc=dojo.hitch(this,"setNextActive",type);break;default:var panelPosition=(isNaN(parseInt(type,10))?0:parseInt(type,10));if(panelPosition>0){this._model.setViewArea(panelPosition);proc=dojo.hitch(this._model,"setActiveByPosition",panelPosition);}
break;}
proc.call(this);},_addSwipeEventHandlers:function(){var that=this,_oUl=dojo.byId(this._cfg.swipeStartId);dojo.query("li img",_oUl).forEach(function(ele){that.connectHandles.push(dojo.connect(ele,'touchstart',that,that._swipeHandleStart));});},_swipeHandleStart:function(ev){var touch=ev.touches[0],_b=dojo.byId(this._cfg.swipeStartId),_dc=dojo.connect,_pnls=this._model.views.panels;_pnls._doSetup();this.oSwipe={clientX:touch.clientX,clientY:touch.clientY,oUL:_pnls.getPanelByPosition(1).getElement().parentNode,mouseUpHandle:_dc(_b,"touchend",this,this._swipeHandleStop),mouseMoveHandle:_dc(_b,"touchmove",this,this._swipeHandleMouseMove)};},_swipeHandleStop:function(ev){if(typeof this.oSwipe.lastPosition!=="undefined"){var begin=this.oSwipe,end=begin.lastPosition,bx=begin.clientX,by=begin.clientY,ex=end.clientX,ey=end.clientY,_pnls=this._model.views.panels,_model=this._model.model,numOfPanels=_model.getNumberOfPanels(),panelWidth=_pnls._panelWidth;var finalDistance=(ex-bx),slidesToMove=Math.floor(Math.abs(finalDistance)/panelWidth),remainder=Math.abs(finalDistance%panelWidth),direction=(finalDistance>0?-1:(finalDistance===0?0:1)),threshold=panelWidth*this._cfg.thresholdRatio;var lastSlide=_model.getActive()._position;if(remainder>threshold){slidesToMove++;}
var newSlide=lastSlide+(slidesToMove*direction);if(newSlide<1){newSlide=1;}
else if(newSlide>numOfPanels){newSlide=numOfPanels;}
_model.setActiveByPosition(newSlide);}
dojo.disconnect(this.oSwipe.mouseUpHandle);dojo.disconnect(this.oSwipe.mouseMoveHandle);delete this.oSwipe;},_swipeHandleMouseMove:function(ev){var touch=ev.touches[0],_pnls=this._model.views.panels,_hasLast=(typeof this.oSwipe.lastPosition!=="undefined"),_oLast=(_hasLast?this.oSwipe.lastPosition:this.oSwipe),oUL=this.oSwipe.oUL,left=oUL.style.left;this.oSwipe.lastPosition={clientX:touch.clientX,clientY:touch.clientY};var distanceX=touch.clientX-_oLast.clientX,distanceY=touch.clientY-_oLast.clientY;if(Math.abs(distanceX)>Math.abs(distanceY)){dojo.stopEvent(ev);}
else{return;}
if(left===""){left=0;}
else{left=parseInt(left.replace("px",""),10);}
oUL.style.left=(left+distanceX)+"px";ev.preventDefault();},disableLastSlideScrim:function(){this.ignoreActions=false;}});dojo.provide("dj.widget.panels.controller.NavTabs");dojo.require("dj.lang");dojo.declare("dj.widget.panels.controller.NavTabs",null,{DEFAULT_CONFIG:{activeEvent:"onclick",doStopEvent:true},constructor:function(model,tabs,cfg){this._cfg=dj.lang.cloneMixin(this.DEFAULT_CONFIG,cfg);this.model=model;this.tabs=tabs;this.connectHandles=[];},setActive:function(tid){this.model.setActiveById(tid);},addEvents:function(doRemoveEvents){for(var tid in this.tabs){if(this.tabs.hasOwnProperty(tid)){this._addEventForTab(this.tabs[tid]);}}},removeEvents:function(){for(var i=0,len=this.connectHandles.length;i<len;i++){dojo.disconnect(this.connectHandles[i]);}},_addEventForTab:function(tab){this.connectHandles.push(dojo.connect(tab.getElement(),this._cfg.activeEvent,dojo.hitch(this,function(ev){if(this._cfg.doStopEvent===true){dojo.stopEvent(ev);}
this.setActive(tab.getId());})));}});dojo.provide("dj.widget.panels.PanelModel");dojo.require("dj.util.Observer");dojo.declare("dj.widget.panels.PanelModel",null,{ROTATION_TYPE:{LINEAR:0,CIRCULAR:1},DIRECTION:{PREVIOUS:0,NEXT:1},DEFAULT_CONFIG:{rotationType:0},constructor:function(panels,cfg){this._cfg=dojo.mixin(dojo.clone(this.DEFAULT_CONFIG),cfg);this._hPanels={};this._panelIds=[];this._prevInHistory=null;this._lastPosition=1;this._activePanel=null;this._activePanelObserver=new dj.util.Observer();this._direction=this.DIRECTION.NEXT;this._isLocked=false;this._lockObserver=new dj.util.Observer();this._rotationState=1;if(panels){this.addPanels(panels);}},updatePanels:function(panels){this._hPanels={};this._panelIds=[];var i=1;for(var pid in panels){if(panels.hasOwnProperty(pid)){var panel=panels[pid],panelId=panel.getId();this._panelIds[i++]=panelId;this._hPanels[panelId]=panel;}}},addPanel:function(panelId){var panel=new dj.widget.panels.Panel(panelId,this._lastPosition);this._panelIds[this._lastPosition]=panel.getId();this._hPanels[panelId]=panel;this._lastPosition++;},addPanels:function(panels){for(var pid in panels){if(panels.hasOwnProperty(pid)){var panel=panels[pid],panelId=panel.getId();this._panelIds[this._lastPosition]=panelId;this._hPanels[panelId]=panel;this._lastPosition++;}}},hasId:function(panelId){return(typeof this._hPanels[panelId]!=="undefined");},hasPosition:function(panelPosition){return((panelPosition>0)&&(panelPosition<this._panelIds.length));},getById:function(panelId){if(!this.hasId(panelId)){throw new Error("NoSuchElementException");}
return this._hPanels[panelId];},getByPosition:function(panelPosition){if(!this.hasPosition(panelPosition)){if(this._cfg.rotationType===this.ROTATION_TYPE.CIRCULAR){var numOfPan=this.getNumberOfPanels();panelPosition=(panelPosition%numOfPan);panelPosition=(panelPosition===0)?numOfPan:panelPosition;}else{return;}}
var pid=this._panelIds[panelPosition];return this._hPanels[pid];},getActive:function(){return this._activePanel;},getPrevInHistory:function(){return this._prevInHistory;},getAll:function(){var values=[];for(var value in this._hPanels){if(this._hPanels.hasOwnProperty(value)){values.push(this._hPanels[value]);}}
return values;},getNumberOfPanels:function(){return(this._panelIds.length-1);},getRotationState:function(){return this._rotationState;},getRotationType:function(){return this._cfg.rotationType;},getDirection:function(){return this._direction;},setRotationState:function(state){if(state<0||state>1){this._activePanelObserver.fireByName("rotationStateFailure",state);}
this._rotationState=state;this._activePanelObserver.fireByName("rotationStateSuccess",state);},setDirection:function(dir){if(dir<0||dir>1){throw new Error("IndexOutOfBoundsException");}
this._direction=dir;},setActive:function(panel){if(panel&&panel.getId){this.setActiveById(panel.getId());}},setActiveById:function(panelId){if(!this.hasId(panelId)){this._activePanelObserver.fireByName("failure",panelId);return;}
var panel=this.getById(panelId);this._prevInHistory=this._activePanel;this._activePanel=panel;this._activePanelObserver.fireByName("success",panel);for(var controller in this.controllers){if(this.controllers[controller].panelChangedHook){this.controllers[controller].panelChangedHook(panelId);}}},setActiveByPosition:function(panelPosition){if(!this.hasPosition(panelPosition)){if(this._cfg.rotationType===this.ROTATION_TYPE.CIRCULAR){var numOfPan=this.getNumberOfPanels();panelPosition=(panelPosition%numOfPan);panelPosition=(panelPosition===0)?numOfPan:panelPosition;}else{this._activePanelObserver.fireByName("failure",panelPosition);return;}}
var pid=this._panelIds[panelPosition];this.setActiveById(pid);},addChangeListener:function(event,listener,context){if(arguments.length<3&&(typeof event==="function")){context=listener;listener=event;event="success";}
context=(typeof context!=="undefined")?context:this;this._activePanelObserver.subscribeByName(event,listener,context);},isLocked:function(){return this._isLocked;},addLockListener:function(cb,context){this._lockObserver.subscribe(cb,context);},doLock:function(){this._isLocked=true;},releaseLock:function(){this._isLocked=false;this._lockObserver.fire();},runAfterLockReleased:function(cb,ctx){if(this._isLocked){this.addLockListener(cb,ctx);}else{cb.call(ctx);}},getViewArea:function(){return this._viewArea;},setViewArea:function(va){this._viewArea=va;},getActivePanel:function(){return this.getActive().getId();},setActivePanel:function(pid){var meth=(typeof pid=="string")?this.setActiveById:this.setActiveByPosition;return meth.call(this,pid);},hasPanel:function(panel){var pid=(panel.getId)?panel.getId():panel;return this.hasId(pid);},observePanels:function(callback){this.addChangeListener(function(panel){callback.apply(this,[panel.getId(),panel.getId()]);},this);}});dojo.provide("dj.widget.panels.view.BasePanel");dojo.require("dj.lang");dojo.declare("dj.widget.panels.view.BasePanel",null,{DEFAULT_CONFIG:{animationDuration:0.3,animationType:"slide",orientation:"horizontal"},enableLazyImages:function(model,panelGroup){var a=model.getActivePanel();var v=model.getViewArea();var ulCount=dojo.query('ul.newsItem',panelGroup.parentNode).length;for(j=0;j<ulCount;j++){for(i=a;i<a+(2*v);i++){var ULs=dojo.query('ul.newsItem',panelGroup.parentNode);var image=dojo.query('img',ULs[j])[i];if(!image){break;}
if(image.getAttribute('data-src')){image.setAttribute('src',image.getAttribute('data-src'));}}}}});dojo.provide("dj.widget.panels.view.NavArrows");dojo.require("dj.lang");dojo.declare("dj.widget.panels.view.NavArrows",null,{DEFAULT_CONFIG:{prevButtonEnabledStyle:"enabledPrev",nextButtonEnabledStyle:"enabledNext",firstButtonEnabledStyle:"enabledFirst",lastButtonEnabledStyle:"enabledLast",panelIncrement:1},constructor:function(model,nav,cfg){this._cfg=dj.lang.cloneMixin(this.DEFAULT_CONFIG,cfg);this._model=model;this._nav=nav;},displayActiveSuccess:function(panel){this._updatePrevious();this._updateNext();},_updatePrevious:function(){var mod=this._model,pp=mod.getByPosition(mod.getActive().getPosition()-this._cfg.panelIncrement);if(!pp){dojo.removeClass(this._nav.prevButton,this._cfg.prevButtonEnabledStyle);if(this._nav.firstButton){dojo.removeClass(this._nav.firstButton,this._cfg.firstButtonEnabledStyle);}}else{dojo.addClass(this._nav.prevButton,this._cfg.prevButtonEnabledStyle);if(this._nav.firstButton){dojo.addClass(this._nav.firstButton,this._cfg.firstButtonEnabledStyle);}}},_updateNext:function(){var mod=this._model,np=mod.getByPosition(mod.getActive().getPosition()+mod.getViewArea());if(!np){dojo.removeClass(this._nav.nextButton,this._cfg.nextButtonEnabledStyle);if(this._nav.lastButton){dojo.removeClass(this._nav.lastButton,this._cfg.lastButtonEnabledStyle);}}else{dojo.addClass(this._nav.nextButton,this._cfg.nextButtonEnabledStyle);if(this._nav.lastButton){dojo.addClass(this._nav.lastButton,this._cfg.lastButtonEnabledStyle);}}},displayLastSlideScrim:function(){dojo.removeClass(this._nav.nextButton,this._cfg.nextButtonEnabledStyle);dojo.removeClass(this._nav.prevButton,this._cfg.prevButtonEnabledStyle);}});dojo.provide("dj.widget.panels.view.Panel");dojo.require("dj.lang");dojo.declare("dj.widget.panels.view.Panel",null,{DEFAULT_CONFIG:{selectedClass:"",deselectedClass:"hidden"},constructor:function(model,panels,cfg){this._cfg=dj.lang.cloneMixin(this.DEFAULT_CONFIG,cfg);this._model=model;this._oPanels=panels;},displayActiveSuccess:function(panel){this._deselectAllExcept(panel);this._select(panel);},getContainer:function(){if(this._oCnt){return this._oCnt;}
if(this._cfg.container&&this._cfg.container!==""){this._oCnt=dojo.byId(this._cfg.container);return this._oCnt;}
if(this._oPanelGroup){this._oCnt=this._oPanelGroup.parentNode;return this._oCnt;}
var ap=this._model.getByPosition(1);var el=this._oPanels[ap.getId()];if(!el.parentNode||!el.parentNode.parentNode){return null;}
var grp=el.parentNode;this._oCnt=grp.parentNode;return this._oCnt;},getPanelByPosition:function(pos){return this._oPanels[pos];},_deselectAllExcept:function(panelNotToHide){var panel=null;for(var pid in this._oPanels){if(this._oPanels.hasOwnProperty(pid)){panel=this._oPanels[pid];if(panelNotToHide.getId()==pid){continue;}
dojo.removeClass(panel.getElement(),this._cfg.selectedClass);dojo.addClass(panel.getElement(),this._cfg.deselectedClass);}}},_select:function(panel){var pid=panel.getId();var oPan=this._oPanels[pid];if(!oPan){return;}
dojo.removeClass(oPan.getElement(),this._cfg.deselectedClass);dojo.addClass(oPan.getElement(),this._cfg.selectedClass);}});dojo.provide("dj.widget.panels.view.Timer");dojo.require("dj.lang");dojo.declare("dj.widget.panels.view.Timer",null,{DEFAULT_CONFIG:{pauseButtonEnabledStyle:"enabledPause"},constructor:function(model,nav,cfg){this._cfg=dj.lang.cloneMixin(this.DEFAULT_CONFIG,cfg);this._model=model;this._nav=nav;},rotationStateSuccess:function(state){var isPlayState=(state==1);if(isPlayState){dojo.removeClass(this._nav.pauseButton,this._cfg.pauseButtonEnabledStyle);}else{dojo.addClass(this._nav.pauseButton,this._cfg.pauseButtonEnabledStyle);}}});dojo.provide("dj.widget.panels.controller.Timer");dojo.require("dj.widget.ProgressBar");dojo.require("dj.lang");dojo.declare("dj.widget.panels.controller.Timer",null,{DEFAULT_CONFIG:{rotateTime:4,rotateIterations:3,progressBar:".progressbarBox",pauseButton:".nav-inline .pause"},constructor:function(model,cfg){this._cfg=dj.lang.cloneMixin(this.DEFAULT_CONFIG,cfg);this._model=model;this.connectHandles=[];},addEvents:function(){this._setupProgressBars();this._setupPauseButton();this._startTimer(this._cfg.rotateTime);this._addEvents();this._model.addChangeListener("rotationStateSuccess",function(state){if(state===0){this._pause();}
else{this._play();}},this);},removeEvents:function(){for(var i=0,len=this.connectHandles.length;i<len;i++){dojo.disconnect(this.connectHandles[i]);}
this._pause();this._destroyProgressBars();},_setupProgressBars:function(){var progressBar=this._cfg.progressBar;var rotateTime=this._cfg.rotateTime;var pbs=[];var oPb=dojo.query(progressBar,this._cfg.container).empty(oPb);for(var i=0,len=oPb.length;i<len;i++){pbs.push(new dj.widget.ProgressBar(oPb[i],{timer:rotateTime}));}
this._pbState="mt";this._pbIrupt=false;this._progressBars=pbs;var activePos=this._model.getActive().getPosition()-1;var ipb=this._progressBars[activePos];if(ipb){ipb.play();}},_destroyProgressBars:function(){for(var i=0,len=this._progressBars.length;i<len;i++){this._progressBars[i].destructor();}},_setupPauseButton:function(){var oPause=dojo.query(this._cfg.pauseButton,this._cfg.container);if(oPause.length<1){return;}else{oPause=oPause[0];}
var btnOn=this._cfg.pauseButtonEnabledStyle;this.connectHandles.push(dojo.connect(oPause,"onclick",this,function(ev){dojo.stopEvent(ev);if(this._model.getRotationState()===0){this._model.setRotationState(1);}
else{this._model.setRotationState(0);}}));},_startTimer:function(seconds){if(((typeof this._intervalId!="undefined")&&(this._intervalId!==null))||(typeof seconds=="undefined")||(seconds===0)){return;}
var model=this._model;var nextPanel=null;this._maxIter=this._maxIter||(this._cfg.rotateIterations*model.getNumberOfPanels());this._iteration=(this._iteration||1);var that=this;this._intervalId=setInterval(function(){if(that._iteration>that._maxIter){that._intervalId=null;return;}
nextPanel=(model.getByPosition(model.getActive().getPosition()+1)||model.getByPosition(1));model.setActiveByPosition(nextPanel.getPosition());var pb=that._progressBars[nextPanel.getPosition()-1];if(typeof pb!=="undefined"){if(that._pbIrupt===false){pb.stop();pb.play();}else{pb.pause();}}
that._iteration++;},seconds*1000);},_addEvents:function(){this.connectHandles.push(dojo.connect(this._cfg.container,"onmouseover",this,function(){var tid=this._model.getActive().getPosition();this._pause(tid);}));this.connectHandles.push(dojo.connect(this._cfg.container,"onmouseout",this,function(){var tid=this._model.getActive().getPosition();this._play(tid);}));},_play:function(tabNum){if(this._pbState==="mt"||(this._model.getRotationState()===0)){return;}else{this._pbState="mt";}
this._pbIrupt=true;this._startTimer(this._cfg.rotateTime);this._pbIrupt=false;var pb=this._progressBars[tabNum-1];if(pb){pb.play();}},_pause:function(tabNum){if(this._pbState==="mr"){return;}else{this._pbState="mr";}
if(this._intervalId){clearInterval(this._intervalId);this._intervalId=null;}
var pb=this._progressBars[tabNum-1];if(pb){pb.pause();}}});dojo.provide("dj.widget.panels.Panel");dojo.require("dj.widget.panels.PanelDTO");dojo.declare("dj.widget.panels.Panel",dj.widget.panels.PanelDTO,{constructor:function(id,position,element){this._element=null;if(typeof element!=="undefined"){this.setElement(element);}},getElement:function(){return this._element;},setElement:function(element){if(typeof element!=="object"){throw new TypeError("Element must be an object.");}
this._element=element;}});dojo.provide("dj.widget.panels.view.SlidePanel");dojo.require("dj.widget.panels.view.BasePanel");dojo.require("dj.lang");dojo.declare("dj.widget.panels.view.SlidePanel",dj.widget.panels.view.BasePanel,{DEFAULT_CONFIG:{animationDuration:0.3,animationType:"slide",orientation:"horizontal",cacheVector:true,tabletSwipe:false},constructor:function(model,panels,cfg){this._cfg=dj.lang.cloneMixin(this.DEFAULT_CONFIG,cfg);this._isOrientVert=(this._cfg.orientation=="vertical");this._isOrientHoriz=(this._cfg.orientation=="horizontal");this._model=model;this._panels=panels;this._isSetupDone=false;this._animation=null;this._vectorMap={};this._oCnt=this._cfg.container;this._enableLazyImages=this._cfg.enableLazyImages;this._isPanelsUpdated=false;},updatePanels:function(panels){this._panels=panels;this._isPanelsUpdated=true;},displayActiveSuccess:function(activePanel){this._model.doLock();this._doSetup();if(this._isPanelGroupLargerThanAllPanels()){return;}
if(this._isRotationCircular){this._doCircularActiveSuccess(activePanel);}else{this._doLinearActiveSuccess(activePanel);}},_doCircularActiveSuccess:function(activePanel){var prevPanel=this._model.getPrevInHistory(),prvPos=prevPanel.getPosition(),avePos=activePanel.getPosition(),that=this,isIncreasing=(this._model.getDirection()==this._model.DIRECTION.NEXT),delta=0;var isIncFlip=false;var isDecrFlip=false;if(isIncreasing&&(prvPos==this._numberOfPanels)&&(avePos==1)){isIncFlip=true;delta=(that._isOrientVert)?-this._panelHeight:-this._panelWidth;}else if(!isIncreasing&&(prvPos==1)&&(avePos==this._numberOfPanels)){isDecrFlip=true;delta=(that._isOrientVert)?this._panelHeight:this._panelWidth;}else{delta=this._getVector(prevPanel,activePanel);}
afterFin=function(){if(this._enableLazyImages){this.enableLazyImages(this._model,this._oPanelGroup);}
if(isIncFlip){var offsetType=(that._isOrientVert)?"top":"left";that._oPanelGroup.style[offsetType]="0px";}
that._model.setViewArea(that.getViewArea());that._model.releaseLock();};beforeStr=function(){if(isDecrFlip){var mv,offsetTopOrLeft,offsetHeightOrWidth;if(that._isOrientVert){offsetTopOrLeft="top";offsetHeightOrWidth="_panelHeight";}else if(that._isOrientHoriz){offsetTopOrLeft="left";offsetHeightOrWidth="_panelWidth";}
mv=that._getVector(prevPanel,activePanel)-that[offsetHeightOrWidth];this.properties.left=(mv+this.properties.xD);dojo.style(that._oPanelGroup,offsetTopOrLeft,mv+"px");}};this._doScrollAnimation(delta,beforeStr,afterFin);},_doLinearActiveSuccess:function(activePanel){var prevPanel=this._model.getPrevInHistory(),afterFin=dojo.hitch(this,function(){if(this._enableLazyImages){this.enableLazyImages(this._model,this._oPanelGroup);}
this._model.setViewArea(this.getViewArea());this._model.releaseLock();}),beforeStr=function(){};var delta=this._getVector(prevPanel,activePanel);this._doScrollAnimation(delta,beforeStr,afterFin);},_doSetup:function(){if(this._isSetupDone){return;}
this._isSetupDone=true;this._setCoreValues();this._resetStyle();if(this._isRotationCircular&&!this._isPanelGroupLargerThanAllPanels()){this._circularLoopSetup();}},_doScrollAnimation:function(delta,beforeStr,afterFin){var xD,yD;if(this._isOrientVert){xD=0;yD=delta;}else if(this._isOrientHoriz){xD=delta;yD=0;}
var newLeft=(dojo.style(this._oPanelGroup,"left")+xD),newTop=(dojo.style(this._oPanelGroup,"top")+yD),animationDurationInMillis=(this._cfg.animationDuration*1000);var animCfg={node:this._oPanelGroup,duration:animationDurationInMillis,beforeBegin:beforeStr,onEnd:afterFin,properties:{"xD":xD,"yD":yD,left:newLeft,top:newTop}};this._animation=dojo.animateProperty(animCfg);this._animation.play();},getContainer:function(){if(this._oCnt){return this._oCnt;}
if(this._cfg.container&&this._cfg.container!==""){this._oCnt=dojo.byId(this._cfg.container);return this._oCnt;}
if(this._oPanelGroup){this._oCnt=this._oPanelGroup.parentNode;return this._oCnt;}
var ap=this._panels[this._model.getByPosition(1).getId()];var el=ap.getElement();if(!el.parentNode||!el.parentNode.parentNode){return null;}
var grp=el.parentNode;this._oCnt=grp.parentNode;return this._oCnt;},getPanelByPosition:function(pos){var el=this._model.getByPosition(pos);return this._panels[el.getId()];},destroy:function(){this._resetStyle();},getViewArea:function(){var viewArea=0;if(typeof this._cfg.viewArea=="number"){viewArea=this._cfg.viewArea;}else if(this._isRotationCircular||this._isFixedSizePanels()){viewArea=this._getFixedSizeViewArea();}else{viewArea=this._getDynamicSizeViewArea();}
this._model.setViewArea(viewArea);return viewArea;},_getFixedSizeViewArea:function(){var el=(this._panels[this._model.getByPosition(1).getId()]).getElement(),cnt=el.parentNode.parentNode,hOrW=(this._isOrientVert)?"h":"w",viewArea=Math.round(dojo.position(cnt)[hOrW]/dojo.position(el)[hOrW]);return viewArea;},_getDynamicSizeViewArea:function(){var viewArea=0,activePanel=this._panels[this._model.getActive().getId()],cnt=activePanel.getElement().parentNode.parentNode,numOfPanels=this._model.getNumberOfPanels(),hOrW=(this._isOrientVert)?"h":"w",cntWidthOrHeight=dojo.position(cnt)[hOrW],totalWidthOrHeight=0;for(var i=activePanel.getPosition();i<=numOfPanels;i++){var panel=this._panels[this._model.getByPosition(i).getId()];totalWidthOrHeight+=dojo.position(panel.getElement())[hOrW];if(totalWidthOrHeight>cntWidthOrHeight){break;}
viewArea++;}
return viewArea;},_isFixedSizePanels:function(){if(typeof this.__isFixedLengthPanels==="undefined"){this.__isFixedLengthPanels=true;var hOrW=(this._isOrientVert)?"h":"w",prevLen=Math.round(dojo.position(this.getPanelByPosition(1).getElement())[hOrW]);for(var i=2;i<=this._model.getNumberOfPanels();i++){var len=Math.round(dojo.position(this.getPanelByPosition(i).getElement())[hOrW]);if(prevLen!==len){this.__isFixedLengthPanels=false;break;}
prevLen=len;}}
return this.__isFixedLengthPanels;},_getWidthOrHeightOfPanels:function(){if(typeof this._widthOrHeightOfPanels=="undefined"||this._isPanelsUpdated){var lastPanel=this.getPanelByPosition(this._model.getNumberOfPanels()),lastPanelBox=dojo.marginBox(lastPanel.getElement());this._widthOrHeightOfPanels=(this._isOrientVert)?(lastPanel.getElement().offsetTop+lastPanelBox.h):(lastPanel.getElement().offsetLeft+lastPanelBox.w);}
return this._widthOrHeightOfPanels;},_getVector:function(prevPanel,currPanel){var existingVector=this._getExistingVector(prevPanel,currPanel);if(existingVector&&this._cfg.cacheVector){return existingVector;}
currPanel=this._panels[currPanel.getId()];var offsetType=(this._isOrientVert)?"offsetTop":"offsetLeft",topOrLeft=(this._isOrientVert)?"t":"l",heightOrWidth=(this._isOrientVert)?"h":"w",yOrx=(this._isOrientVert)?"y":"x",panelsHeightOrWidth=this._getWidthOrHeightOfPanels();var panelGroupBox=dojo.marginBox(this._oPanelGroup),panelGroupOffset=this._oPanelGroup[offsetType],prevOffset=Math.abs(panelGroupBox[topOrLeft]),currPanelBox=dojo.marginBox(currPanel.getElement()),currOffset=Math.abs(currPanel.getElement()[offsetType]);var currPanelPos=currPanel.getPosition(),prevPanelPos=prevPanel.getPosition(),lastPanelPos=this._getPanelsCount(),panelDiff=currPanelPos-prevPanelPos,samePanel=(panelDiff===0),isInc=panelDiff>0;if(!isInc&&(currOffset>prevOffset)){if(!samePanel||!this._cfg.tabletSwipe){return 0;}
else{isInc=true;}}
var delta=Math.abs(currOffset-prevOffset);vector=((isInc)?(delta*-1):delta);if(this._cfg.tabletSwipe){if(samePanel){if(currPanelPos===1&&panelGroupOffset>0){vector*=-1;}}}
if(!this._isRotationCircular&&(!this._isFixedSizePanels()||!this._hasSufficientPanelsAtEnd(currPanel))){var panelGroupPos=dojo.position(this._oPanelGroup.parentNode),newPos=(panelGroupBox[topOrLeft]+vector),maxPos=(panelGroupPos[heightOrWidth]-panelsHeightOrWidth),diff=(maxPos-newPos);if(isInc&&(diff>0)){vector+=diff;}}
if(this._cfg.cacheVector){this._setExistingVector(prevPanel,currPanel,vector);}
return vector;},_hasSufficientPanelsAtEnd:function(currPanel){var delta=this._model.getNumberOfPanels()-(currPanel.getPosition()-1+this.getViewArea());if(delta>=0){return true;}else{return false;}},_getExistingVector:function(panel1,panel2){return this._vectorMap[panel1.getId()+"_"+panel2.getId()];},_setExistingVector:function(panel1,panel2,vector){this._vectorMap[panel1.getId()+"_"+panel2.getId()]=vector;},_isPanelGroupLargerThanAllPanels:function(){var heightOrWidth=(this._isOrientVert)?"h":"w",panelsHeightOrWidth=this._getWidthOrHeightOfPanels(),panelGroupPos=dojo.position(this._oPanelGroup.parentNode);return(panelGroupPos[heightOrWidth]>panelsHeightOrWidth);},_setCoreValues:function(){if(this._isCoreValuesSet){return;}
var model=this._model,ap=this._panels[model.getByPosition(1).getId()];this._oPanelGroup=dojo.query(this._cfg.panelGroup,this.getContainer())[0];this._numberOfPanels=model.getNumberOfPanels();this._isRotationCircular=(model.getRotationType()==model.ROTATION_TYPE.CIRCULAR);if(this._isOrientVert){this._panelHeight=dojo.position(ap.getElement()).h;}else if(this._isOrientHoriz){this._panelWidth=dojo.position(ap.getElement()).w;}
this._isCoreValuesSet=true;},_resetStyle:function(){if(typeof this._oPanelGroup==="object"){dojo.style(this._oPanelGroup,{left:0,top:0});}},_circularLoopSetup:function(){for(var i=1,element=null,clone=null,len=this.getViewArea();i<=len;i++){element=this._panels[this._model.getByPosition(i).getId()].getElement();clone=element.cloneNode(true);this._oPanelGroup.appendChild(clone);}},_getPanelsCount:function(){if(typeof this.panelsCount==="undefined"){var _pnls=this._panels,lastPanelPos=-1;for(var i in _pnls){if(_pnls.hasOwnProperty(i)){var pos=_pnls[i].getPosition();if(pos>lastPanelPos){lastPanelPos=pos;}}}
this.panelsCount=lastPanelPos;}
return this.panelsCount;}});dojo.provide("dj.widget.panels.PanelsFactory");dojo.require("dj.lang");dojo.require("dj.widget.panels.PanelDTO");dojo.require("dj.widget.panels.Panel");dojo.require("dj.widget.panels.PanelModel");dj.widget.panels.PanelsFactory={_CONFIG:{core:{panelGroup:".newsItem",panel:"> li",panelPrefix:"panelsPanel_",panels:undefined,panelToggleStyle:"hidden",activePanel:1,disabledPanels:undefined,panelIncrement:1,viewArea:undefined,paginationDivider:"/",paginationContainer:".pagination",controller:undefined,enableBrowserHistory:false,animationDuration:0.3},tabs:{tabPrefix:"panelsTab_",tabGroup:".newsItem",tab:"> li",navContainer:".nav-inline",prevButton:".prev",nextButton:".next",navButtonEnabledStyle:"enabled",tabOnEvent:"click",tabOnStyle:"active",tabOffStyle:"deselected"},carousel:{orientation:"horizontal",navContainer:".nav-inline",pagination:{container:false,linkClass:"prevnext_page",selectedClass:"prevnext_page-current",label:false,labelClass:"prevnext_pagelabel",prevNextDisableClass:'prevnext_prev-disabled'},disableInterval:false,prevButton:".prev",nextButton:".next",prevButtonEnabledStyle:"enabledPrev",nextButtonEnabledStyle:"enabledNext"},rotator:{rotateTime:8,rotateIterations:3,pauseOnMouseOver:false,pauseButton:".nav-inline .pause",pauseButtonEnabledStyle:"enabledPause",progressBar:".progressbarBox"}},_panelsType:{NONE:0,SLIDE:1,SWITCH:2},_paginationType:{SIMPLE:0,RANGE:1},_lookupType:{NONE:0,SELECTOR:1,PREFIX:2},create:function(container,cfg,doIgnoreOptCache){if(!container||(typeof cfg!=="object")){console.warn("{Panels} no container or config specified.");return;}
container=dojo.byId(container);if(container&&!doIgnoreOptCache){if(this._isReinitializedAndSetCache(container,cfg)){console.warn("{Panels} prevented attempt to reinitialize \""+container.id+"\".");return;}}
try{var mvc=this._setupMvc(container,cfg);this._addCompatibilityMethods(mvc,container,cfg);return mvc.model;}catch(ex){console.info(ex.message);}},_isReinitializedAndSetCache:function(container,cfg){var optCache=['{',container.id,': ',dj.lang.objectToString(cfg,true),'}'].join(''),cntOpt=container.getAttribute("djw_optcache");if(cntOpt){var opts=cntOpt.split("_");for(var i=0,len=opts.length;i<len;i++){if(opts[i]==optCache){return true;}}}
if(cntOpt){container.setAttribute("djw_optcache",[optCache,cntOpt].join("_"));}else{container.setAttribute("djw_optcache",optCache);}
return false;},createPanels:function(userCfg){var djwp=dj.widget.panels,_lookupType=this._lookupType,_panType=this._panelsType,_d=dojo,model=null,views={},controllers={};var config=dojo.clone(this._CONFIG.core);config.container="";config.doAddChangeListeners=true;config.panelsType=_panType.SWITCH;config.panelsLookupType=_lookupType.SELECTOR;dojo.mixin(config,userCfg);var panels=null;switch(config.panelsLookupType){case _lookupType.PREFIX:panels=this.lookupByPrefix(config.panelPrefix,config.panels);break;case _lookupType.SELECTOR:panels=this.lookupBySelector(config.container,config.panelGroup,config.panel);break;default:return;}
var rotType=(((config.type==djwp.PanelModel.prototype.ROTATION_TYPE.CIRCULAR)||(config.type=="circular"))?djwp.PanelModel.prototype.ROTATION_TYPE.CIRCULAR:djwp.PanelModel.prototype.ROTATION_TYPE.LINEAR);model=new djwp.PanelModel(this.panelsToPanelsDTO(panels),{rotationType:rotType});model.setActiveByPosition(config.activePanel);var view=null,viewPanelConfig,viewPanelType;switch(config.panelsType){case _panType.SLIDE:_d.require("dj.widget.panels.view.SlidePanel");viewPanelType="SlidePanel";viewPanelConfig={animationDuration:config.animationDuration,viewArea:config.viewArea,orientation:config.orientation,panelGroup:config.panelGroup,container:config.container,enableLazyImages:config.enableLazyImages};if(typeof config.cacheVector!=="undefined"){viewPanelConfig.cacheVector=config.cacheVector;}
if(typeof config.tabletSwipe!=="undefined"){viewPanelConfig.tabletSwipe=config.tabletSwipe;}
break;case _panType.SWITCH:_d.require("dj.widget.panels.view.Panel");viewPanelType="Panel";viewPanelConfig={selectedClass:config.selectedPanelClass,deselectedClass:config.deselectedPanelClass};break;}
view=new djwp.view[viewPanelType](model,panels,viewPanelConfig);views.panels=view;if(config.doAddChangeListeners){model.addChangeListener("success",view.displayActiveSuccess,view);}
return{"model":model,"views":views,"controllers":controllers};},addModuleNavArrows:function(mvc,userCfg){var _lookupType=this._lookupType,model=mvc.model,views=mvc.views,controllers=mvc.controllers,_d=dojo;var config=_d.clone(this._CONFIG.carousel);config.container="";config.doAddEvents=true;config.doAddChangeListeners=true;config.doHide=false;dj.lang.mixin(config,userCfg);if(!config.container&&views.panels&&views.panels.getContainer){config.container=views.panels.getContainer();}
var navArrowsLookupType=_lookupType.NONE;if(!config.lookupType){navArrowsLookupType=(config)?_lookupType.SELECTOR:navArrowsLookupType;}else{navArrowsLookupType=config.lookupType;}
var navArrows={};if(navArrowsLookupType==_lookupType.SELECTOR){navArrows.navContainer=_d.query(config.navContainer,config.container)[0];if(navArrows.navContainer){navArrows.prevButton=_d.query(config.prevButton,navArrows.navContainer)[0];navArrows.nextButton=_d.query(config.nextButton,navArrows.navContainer)[0];navArrows.lastButton=(config.lastButton)?_d.query(config.lastButton,navArrows.navContainer)[0]:null;navArrows.firstButton=(config.firstButton)?_d.query(config.firstButton,navArrows.navContainer)[0]:null;}else{return;}}else{return;}
if(config.doHide){navArrows.navContainer.style.visibility="hidden";return;}else if(navArrows.navContainer.style.visibility==="hidden"){navArrows.navContainer.style.visibility="";}
var controller;if(config.pagination.container){_d.require("dj.widget.panels.controller.NavArrowsPagination");controller=new dj.widget.panels.controller.NavArrowsPagination(model,navArrows,config);}else{_d.require("dj.widget.panels.controller.NavArrows");controller=new dj.widget.panels.controller.NavArrows(model,navArrows,config);}
controllers.navArrows=controller;_d.require("dj.widget.panels.view.NavArrows");var view=new dj.widget.panels.view.NavArrows(model,navArrows,config);view.displayActiveSuccess();views.navArrows=view;if(config.doAddEvents){controller.addEvents();}
if(config.doAddChangeListeners){model.addChangeListener("success",view.displayActiveSuccess,view);}},addModuleNavTabs:function(mvc,userCfg){var _lookupType=this._lookupType,model=mvc.model,views=mvc.views,controllers=mvc.controllers,_d=dojo;var config=dojo.clone(this._CONFIG.tabs);config.container="";config.panels=this._CONFIG.core.panels;config.doAddEvents=true;config.doAddChangeListeners=true;dj.lang.mixin(config,userCfg);if(!config.container&&views.panels&&views.panels.getContainer){config.container=views.panels.getContainer();}
var navTabsLookupType=_lookupType.NONE;if(!config.lookupType){navTabsLookupType=(userCfg)?_lookupType.SELECTOR:navTabsLookupType;navTabsLookupType=(userCfg&&userCfg.tabPrefix)?_lookupType.PREFIX:navTabsLookupType;}else{navTabsLookupType=config.lookupType;}
var navTabs=null;switch(navTabsLookupType){case _lookupType.PREFIX:navTabs=this.lookupByPrefix(config.tabPrefix,config.panels);break;case _lookupType.SELECTOR:navTabs=this.lookupBySelector(config.container,config.tabGroup,config.tab);break;default:return;}
_d.require("dj.widget.panels.view.Panel");var view=new dj.widget.panels.view.Panel(model,navTabs,{selectedClass:config.tabOnStyle,deselectedClass:config.tabOffStyle});_d.require("dj.widget.panels.controller.NavTabs");var controller=new dj.widget.panels.controller.NavTabs(model,navTabs,{activeEvent:config.tabOnEvent});views.navTabs=view;controllers.navTabs=controller;if(config.doAddEvents){controller.addEvents();}
if(config.doAddChangeListeners){model.addChangeListener("success",view.displayActiveSuccess,view);}},addModulePagination:function(mvc,userCfg){var config={},_d=dojo;var model=mvc.model,views=mvc.views;dj.lang.mixin((config={container:"",doAddChangeListeners:true,paginationContainer:this._CONFIG.core.paginationContainer,doHide:false}),userCfg);if(!config.container&&views.panels&&views.panels.getContainer){config.container=views.panels.getContainer();}
var oPaginationCnt=_d.query(config.paginationContainer,config.container)[0];if(!oPaginationCnt){return;}
if(config.doHide){oPaginationCnt.style.visibility="hidden";return;}
var view,isTypeRangePagination=(config.type&&config.type==this._paginationType.RANGE),requireClassName=(isTypeRangePagination)?"RangePagination":"Pagination";if(isTypeRangePagination){var ototalResultsCnt=_d.query(config.totalResultsContainer,config.container)[0];var totalCnt=ototalResultsCnt.innerHTML;_d.require("dj.widget.panels.view.RangePagination");view=new dj.widget.panels.view.RangePagination(model,oPaginationCnt,totalCnt,ototalResultsCnt,config.pageSize);model.setViewArea(1);model.setActiveByPosition(1);}else{_d.require("dj.widget.panels.view.Pagination");view=new dj.widget.panels.view.Pagination(model,oPaginationCnt,config);}
view.displayActiveSuccess();views.pagination=view;if(config.doAddChangeListeners){model.addChangeListener("success",view.displayActiveSuccess,view);}},addModuleTimer:function(mvc,userCfg){var _d=dojo,config=_d.clone(this._CONFIG.rotator);config.container="";config.doAddEvents=true;config.doAddChangeListeners=true;dj.lang.mixin(config,userCfg);var controllers=mvc.controllers;_d.require("dj.widget.panels.controller.Timer");controllers.timer=new dj.widget.panels.controller.Timer(mvc.model,config);var oPause=_d.query(config.pauseButton,config.container)[0];if(oPause){_d.require("dj.widget.panels.view.Timer");var view=new dj.widget.panels.view.Timer(mvc.model,{pauseButton:oPause},userCfg);if(config.doAddChangeListeners){mvc.model.addChangeListener("rotationStateSuccess",view.rotationStateSuccess,view);}}
if(config.doAddEvents){controllers.timer.addEvents();}},addModuleBrowserHistory:function(mvc,userCfg){var config={},_d=dojo;dj.lang.mixin((config={doAddEvents:true}),userCfg);_d.require("dj.widget.panels.controller.History");mvc.controllers.browserHistory=new dj.widget.panels.controller.History(mvc.model,config);if(config.doAddEvents){controllers.browserHistory.addEvents();}},addController:function(mvc,cMvc){if(!cMvc||!cMvc.model||!cMvc.model.addChangeListener||!mvc||!mvc.model){throw new Error("{Panels.addController} mvc and/or controller is invalid.");}
var model=mvc.model,controllerModel=cMvc.model;controllerModel.addChangeListener("success",function(panel){model.setActive(panel);});},_setupMvc:function(container,userConfig){var oCnt=dojo.byId(container);container=(oCnt.id||container);var config=dj.lang.cloneMixin(this._CONFIG,userConfig),typeCfg=this._getPanelsTypeConfig(userConfig,config);var panelsCfg={container:oCnt,doAddChangeListeners:false,panelsType:typeCfg.panelsType,panelsLookupType:typeCfg.panelsLookupType};dj.lang.mixin(panelsCfg,config.core);if(typeCfg.panelsType==this._panelsType.SWITCH){dj.lang.mixin(panelsCfg,config.tabs);}else if(typeCfg.panelsType==this._panelsType.SLIDE){dj.lang.mixin(panelsCfg,config.carousel);}
var mvc=this.createPanels(panelsCfg);if(mvc.model.getNumberOfPanels()==-1){throw new Error("{Panels} container \""+container+"\" has no panels.");}
var model=mvc.model,views=mvc.views,controllers=mvc.controllers;if(typeCfg.hasNavTabs){var navTabCfg=config.tabs;navTabCfg.container=oCnt;navTabCfg.panels=config.core.panels;navTabCfg.doAddEvents=false;navTabCfg.doAddChangeListeners=false;navTabCfg.lookupType=typeCfg.navTabsLookupType;this.addModuleNavTabs(mvc,navTabCfg);}
if(typeCfg.hasNavArrows){var navArrCfg=config.carousel;navArrCfg.container=oCnt;navArrCfg.doAddEvents=false;navArrCfg.doAddChangeListeners=false;navArrCfg.lookupType=typeCfg.navArrowsLookupType;navArrCfg.panelIncrement=config.core.panelIncrement;navArrCfg.doHide=((typeCfg.panelsType==this._panelsType.SLIDE)&&(views.panels.getViewArea()>=model.getNumberOfPanels())&&!config.carousel.showNavButtons);this.addModuleNavArrows(mvc,navArrCfg);}
var enablePagination=config.core.enablePagination;if((typeCfg.panelsType==this._panelsType.SLIDE&&(views.panels.getViewArea()<=1))||enablePagination){var paginCfg={container:oCnt,paginationContainer:config.core.paginationContainer,panelIncrement:config.core.panelIncrement,paginationDivider:config.core.paginationDivider,doAddEvents:false,doAddChangeListeners:false,doHide:(views.panels.getViewArea()==1&&enablePagination)};this.addModulePagination(mvc,paginCfg);}
if(typeCfg.hasTimer){var timerCfg=config.rotator;timerCfg.container=oCnt;timerCfg.doAddEvents=false;this.addModuleTimer(mvc,timerCfg);}
if(typeCfg.hasBrowserHistory){var histConf={container:(typeCfg.panelsLookupType==this._lookupType.SELECTOR)?oCnt.id:container,doAddEvents:false};this.addModuleBrowserHistory(mvc,histConf);}
if(typeCfg.hasController){this.addController(mvc,config.core.controller);}
this._addViewChangeListenersToModel(model,views);this._addEventsToControllers(controllers);if(!typeCfg.hasBrowserHistory&&typeCfg.panelsType==this._panelsType.SWITCH){model.setActiveByPosition(panelsCfg.activePanel);}
return mvc;},_getPanelsTypeConfig:function(userConfig,config){var _panType=this._panelsType;var _lookType=this._lookupType;var typeCfg={};typeCfg.panelsType=_panType.NONE;typeCfg.panelsType=(userConfig.core)?_panType.SWITCH:typeCfg.panelsType;typeCfg.panelsType=(userConfig.carousel)?_panType.SLIDE:typeCfg.panelsType;typeCfg.panelsLookupType=_lookType.SELECTOR;typeCfg.panelsLookupType=(userConfig.core&&userConfig.core.panelPrefix)?_lookType.PREFIX:typeCfg.panelsLookupType;typeCfg.navTabsLookupType=_lookType.NONE;typeCfg.navTabsLookupType=(userConfig.tabs)?_lookType.SELECTOR:typeCfg.navTabsLookupType;typeCfg.navTabsLookupType=(userConfig.tabs&&userConfig.tabs.tabPrefix)?_lookType.PREFIX:typeCfg.navTabsLookupType;typeCfg.navArrowsLookupType=_lookType.NONE;typeCfg.navArrowsLookupType=(userConfig.carousel)?_lookType.SELECTOR:typeCfg.navArrowsLookupType;typeCfg.navArrowsLookupType=(userConfig.tab&&userConfig.tab.navContainer)?_lookType.SELECTOR:typeCfg.navArrowsLookupType;typeCfg.hasController=(userConfig.core&&(typeof userConfig.core.controller=="object"));typeCfg.hasNavArrows=(typeCfg.navArrowsLookupType!==_lookType.NONE);typeCfg.hasNavTabs=(typeCfg.navTabsLookupType!==_lookType.NONE);typeCfg.hasTimer=(typeof userConfig.rotator=="object"&&userConfig.rotator.rotateTime>0);typeCfg.hasBrowserHistory=(config.core.enableBrowserHistory);return typeCfg;},_addViewChangeListenersToModel:function(model,views){var view=null;for(var viewName in views){if(views.hasOwnProperty(viewName)){view=views[viewName];if(view.displayActiveSuccess){model.addChangeListener("success",view.displayActiveSuccess,view);}
if(view.displayActiveFailure){model.addChangeListener("failure",view.displayActiveFailure,view);}}}},_addEventsToControllers:function(controllers){var controller=null;for(var controllerName in controllers){if(controllers.hasOwnProperty(controllerName)){controller=controllers[controllerName];controller.addEvents();}}},_addCompatibilityMethods:function(mvc,container,config){var that=this;if(typeof mvc.model.update==="undefined"){mvc.model.update=function(){that.destroy(mvc);mvc=that.create((container.id||container),config,true);return mvc;};}
if(typeof mvc.model.destroy==="undefined"){mvc.model.destroy=function(){that.destroy(mvc);};}
if(mvc.controllers&&mvc.controllers.navTabs){var tabs=mvc.controllers.navTabs.tabs,_d=dojo;mvc.model.observeTabs=function(callback,eventType){eventType=(eventType||"onclick");var _addEvForTab=function(tab){_d.connect(tab.getElement(),eventType,function(ev){var tid=tab.getId();if(mvc.controllers.navTabs._cfg.doStopEvent===true){_d.stopEvent(ev);}
tid=(isNaN(parseInt(tid,10)))?tid:(mvc.model.getById(tid).getPosition()+"");callback.call(null,tid,mvc.model);});};for(var tid in tabs){if(tabs.hasOwnProperty(tid)){_addEvForTab(tabs[tid]);}}};}
if(typeof mvc.model.updateNewPanels==="undefined"){mvc.model.updateNewPanels=function(container,group,node){var panels=that.lookupBySelector(container,group,node);mvc.model.updatePanels(that.panelsToPanelsDTO(panels));mvc.views.panels.updatePanels(panels);};}
mvc.model.model=mvc.model;mvc.model.views=mvc.views;mvc.model.controllers=mvc.controllers;},destroy:function(mvc){for(var controller in mvc.controllers){if(mvc.controllers.hasOwnProperty(controller)){mvc.controllers[controller].removeEvents();delete mvc.controllers[controller];}}
for(var viewName in mvc.views){if(mvc.views.hasOwnProperty(viewName)){var view=mvc.views[viewName];if(typeof view.destroy=="function"){view.destroy();}
delete mvc.views[viewName];}}},panelsToPanelsDTO:function(panels){var elms={};for(var panId in panels){if(panels.hasOwnProperty(panId)){var pan=panels[panId];elms[panId]=new dj.widget.panels.PanelDTO(pan.getId(),pan.getPosition());}}
return elms;},lookupByPrefix:function(prefix,names){var elms={};for(var i=0,len=names.length,id=null,el=null,pos=1;i<len;i++){id=names[i];el=dojo.byId(prefix+id);if((typeof el==="undefined")||el===null||el.firstChild===null){continue;}
elms[id]=new dj.widget.panels.Panel(id,pos++,el);}
return elms;},lookupBySelector:function(container,group,node){if(!container||container===null){throw new Error('{dj.util.Panels} container for group: "'+group+'" is undefined.');}
var oCnt=dojo.byId(container);var oPanels=dojo.query((group+' '+node),oCnt);var elms={};for(var i=0,len=oPanels.length,el=null,pos=1;i<len;i++){el=oPanels[i];if(el===null||(el.tagName!=="IMG"&&el.firstChild===null)){continue;}
elms[pos-1]=new dj.widget.panels.Panel(pos-1,pos++,el);}
return elms;}};dojo.provide("dj.widget.panels.prebuilt.Slideshow");dojo.require("dj.widget.panels.PanelsFactory");dojo.require("dj.widget.panels.view.Pagination");dojo.declare("dj.widget.panels.prebuilt.Slideshow",null,{STATE_CLASS:{NORMAL:"sl_inline-norm",OVER:"sl_inline-over",END:"sl_inline-end"},constructor:function(id){this._domContainer=dojo.byId(id);this._isCaptionsEnabled=true;this._isLastFrameEnabled=true;this._createPanels(this._domContainer);this._connectCaptionEvents();this._connectLastFrameEvents();},getPanels:function(){return this._panels;},nextSlide:function(){this._panels.controllers.navArrows.setNextActive();},previousSlide:function(){this._panels.controllers.navArrows.setPreviousActive();},showCaption:function(){if(!this._isCaptionsEnabled){return;}
dojo.removeClass(this._domContainer,this.STATE_CLASS.NORMAL);dojo.addClass(this._domContainer,this.STATE_CLASS.OVER);var caption=this._getCurrentCaption(),captionHeight=dojo.position(caption).h;var smallCaption=this._getSmallCaption();var smallCaptionHeight=dojo.position(smallCaption).h;captionHeight=captionHeight-(smallCaptionHeight);dojo.anim(caption,{top:{end:-captionHeight}});},hideCaption:function(){if(!this._isCaptionsEnabled){return;}
var caption=this._getCurrentCaption();var an=dojo.anim(caption,{top:{end:0}});console.log(an);dojo.connect(an,"onEnd",this,function(){dojo.addClass(this._domContainer,this.STATE_CLASS.NORMAL);dojo.removeClass(this._domContainer,this.STATE_CLASS.OVER);});},_createPanels:function(domNode){this._panels=dj.widget.panels.PanelsFactory.create(domNode,{core:{panelGroup:".sl_c",panel:".sl_i",paginationDivider:"of"},carousel:{navContainer:".box-arrows",prevButton:".prev",nextButton:".next"}});},_connectCaptionEvents:function(){var captions=dojo.query(".cap_c",this._domContainer);if(captions.length===0){this._isCaptionsEnabled=false;return;}
var smallCaptions=dojo.query(".cap_s",this._domContainer);smallCaptions.connect("onclick",dojo.hitch(this,function(event){dojo.stopEvent(event);this.showCaption();}));var largeCaptions=dojo.query(".cap_l",this._domContainer);largeCaptions.connect("onclick",this,this.hideCaption);dojo.connect(dojo.doc,"onclick",this,this.hideCaption);this._panels.addChangeListener("success",this.hideCaption,this);},_connectLastFrameEvents:function(){var lastFrame=dojo.query(".sl_end",this._domContainer);if(lastFrame.length===0){this._isLastFrameEnabled=false;this._panels.addChangeListener("success",dojo.hitch(this,function(){this._updateArrows(this._panels);}),this);return;}
this._panels.addChangeListener("success",dojo.hitch(this,function(){this._hideLastFrame(this._panels);}),this);this._panels.addChangeListener("failure",dojo.hitch(this,function(){this._showLastFrame(this._panels);}),this);},_getCurrentCaption:function(){var activePanelModel=this._panels.model.getActive(),activePanel=this._panels.views.panels.getPanelByPosition(activePanelModel.getPosition());return dojo.query(".cap_l",activePanel.getElement())[0];},_getSmallCaption:function(){var activePanelModel=this._panels.model.getActive(),activePanel=this._panels.views.panels.getPanelByPosition(activePanelModel.getPosition());return dojo.query(".cap_s",activePanel.getElement())[0];},_showLastFrame:function(currenPanel){this.currenPanel=currenPanel;var activePanelModel=currenPanel.model.getActive();var position=activePanelModel.getPosition();if(position!=1){dojo.removeClass(this._domContainer,this.STATE_CLASS.NORMAL);dojo.addClass(this._domContainer,this.STATE_CLASS.END);dojo.addLiveEvent(".backToBeginning","click",dojo.hitch(this,function(ev){dojo.stopEvent(ev);this._backToBeginning(this.currenPanel);}),this);dojo.addLiveEvent(".lastScreenArrow","click",dojo.hitch(this,function(ev){dojo.stopEvent(ev);this._hideLastFrame(this.currenPanel);}),this);}},_backToBeginning:function(pnlsObj){if(pnlsObj!==undefined&&pnlsObj!==null){pnlsObj.setActiveByPosition(1);}else{this.pnls.setActiveByPosition(1);}
dojo.addClass(dojo.query("div.slide_inline")[0],"sl_inline-first");},_hideLastFrame:function(currenPanel){this._updateArrows(currenPanel);if(dojo.hasClass(this._domContainer,this.STATE_CLASS.END)){dojo.addClass(this._domContainer,this.STATE_CLASS.NORMAL);dojo.removeClass(this._domContainer,this.STATE_CLASS.END);}},_updateArrows:function(currenPanel){var activePanelModel=currenPanel.model.getActive();var container=dojo.query("div.slide_inline");var containerDiv;if(container.length>0){containerDiv=container[0];if(activePanelModel.getPosition()!=1){dojo.removeClass(containerDiv,"sl_inline-init");dojo.removeClass(containerDiv,"sl_inline-first");var lastFrame=dojo.query(".sl_end",this._domContainer);if(lastFrame.length===0&&activePanelModel.getPosition()==currenPanel.model.getNumberOfPanels()){dojo.addClass(containerDiv,"sl_inline-last");}else{dojo.removeClass(containerDiv,"sl_inline-last");}}else{dojo.addClass(containerDiv,"sl_inline-first");}}}});dojo.provide("dj.module.panels.liveSlideshow");dojo.require("dj.util.liveWidget");dojo.require("dj.util.Element");dojo.require("dj.widget.panels.prebuilt.Slideshow");dj.module.panels.liveSlideshow={init:function(type){if(this._isInit){return;}
this._isInit=true;this.type=type;this._setupLiveWidget();},destroy:function(){dj.util.liveWidget.unregister("panels.Slideshow");},_setupLiveWidget:function(){dj.util.liveWidget.register("panels.Slideshow",function(liveWidget,dataset){dojo.stopEvent(liveWidget.event);this._initWidget(liveWidget,dataset);},this);},_initWidget:function(liveWidget,dataset){var id=dj.util.Element.identify(liveWidget.domNode),slideshow;if(this.type&&this.type==="Article"){slideshow=new dj.widget.panels.prebuilt.ArticleSlideshow(id);}else{slideshow=new dj.widget.panels.prebuilt.Slideshow(id);}
var target=liveWidget.event.target;this._tryPossibleInitEvents(target,slideshow);},_tryPossibleInitEvents:function(target,slideshow){var is=dj.util.Element.isOrIsChildOf;if(is(target,".cap_s")){slideshow.showCaption();}
if(is(target,".next")){slideshow.nextSlide();}
if(is(target,".prev")){slideshow.previousSlide();}}};dojo.provide("dj.widget.panels.virtual.Tabs");dojo.require("dj.widget.panels.PanelsFactory");dojo.require("dj.widget.panels.controller.NavTabs");dojo.require("dj.widget.panels.view.Panel");dojo.provide("dj.widget.panels.virtual.Carousel");dojo.require("dj.widget.panels.PanelsFactory");dojo.require("dj.widget.panels.view.SlidePanel");dojo.require("dj.widget.panels.view.NavArrows");dojo.require("dj.widget.panels.controller.NavArrows");
dojo.provide("dj.widget.panel.LiveModalPanel");dojo.require("dj.util.Element");(function(djl){(dj.widget.panel.LiveModalPanel=function(cfg){this.cfg=djl.cloneMixin(this.DEFAULT_CONFIG,cfg);this._setupEvents();}).prototype={DEFAULT_CONFIG:{container:".linklist_dropdown .mn_dropdown_container",containerInd:".linklist_dropdown .mn_dropdown_container",dropdownContent:".mn_dropdownPanel > .mn_dropdownContent",actionEvent:"click",stateContainer:".mn_dropdownTree",stateCollapsed:"mn_ddState-collapsed",stateExpanded:"mn_ddState-expanded",navContainer:".pmMainNav",stateHover:"mndd_ddState-hover ",queryUpClass:"mn_dropdownTree",addMouseEvents:false},prevActivePanel:undefined,navOpened:false,_setupEvents:function(){var that=this;if(this.cfg.addMouseEvents){djl.addLiveEvent(this.cfg.container,"mouseover",function(ev){that.mouseOverOut(this,ev);});}
djl.addLiveEvent(this.cfg.containerInd,this.cfg.actionEvent,function(ev){var node=that._queryUpForClassName(this,that.cfg.queryUpClass);that.togglePanel(node,ev);});if(this.cfg.addMouseEvents){djl.addLiveEvent(this.cfg.container,"mouseout",function(ev){that.mouseOverOut(this,ev);});}
this.oDropdownContainer=dojo.query(this.cfg.navContainer)[0];dojo.connect(document,'onclick',function(ev){if(ev.target.nodeName=="A"){return true;}
if(that.prevActivePanel!==undefined&&that.navOpened===true){var dropd=dojo.query(that.cfg.dropdownContent,that.prevActivePanel)[0];if(dropd!==undefined&&!dj.util.Element.contains(dropd,ev.clientX,ev.clientY)){that.togglePanel(dropd,ev);that.navOpened=false;}}});},_queryUpForClassName:function(node,cn){if(node.className.indexOf(cn)==-1){while((typeof node!=="object")||(null===node.className)||!node.className||(node.className.indexOf(cn)!==0)){node=node.parentNode;}}
return node;},togglePanel:function(dropd,event){var cfg=this.cfg;if(dojo.hasClass(dropd,cfg.stateCollapsed)){dojo.removeClass(dropd,cfg.stateCollapsed);dojo.addClass(dropd,cfg.stateExpanded);this.navOpened=true;}else{dojo.removeClass(dropd,cfg.stateExpanded);dojo.addClass(dropd,cfg.stateCollapsed);this.navOpened=false;}
if(this.prevActivePanel!==undefined&&this.prevActivePanel!=dropd){dojo.removeClass(this.prevActivePanel,cfg.stateExpanded);dojo.addClass(this.prevActivePanel,cfg.stateCollapsed);}
this.prevActivePanel=dropd;dojo.stopEvent(event);},mouseOverOut:function(elm,ev){var cfg=this.cfg,dropd=dojo.query(cfg.stateContainer,elm)[0];if(dropd!==undefined){if(ev.type=="mouseover"){dojo.addClass(dropd,cfg.stateHover);}else if(ev.type=="mouseout"){dojo.removeClass(dropd,cfg.stateHover);}}}};}(dj.lang));dojo.provide("dj.widget.panel.Tooltip");dojo.require("dj.lang");dojo.require("dj.util.Query");dojo.declare("dj.widget.panel.Tooltip",null,{constructor:function(containerClass,tipTargetBox,tipTarget,tooltipBox,container,hideDelayInMillis){this._delayedMouseOver(tipTarget,dojo.hitch(this,function(node){this.init(containerClass,{elementsContainerClass:tipTargetBox,targetClass:tipTarget,tooltipClass:tooltipBox,container:container,hideTooltipDelay:hideDelayInMillis});this.isInitialized=true;var ttb=dj.util.Query.up(node,tipTargetBox),tb=dojo.query(tooltipBox,ttb)[0];this.showTooltip(tb);}),200);},_delayedMouseOver:function(containerClass,func,time){var doInit=false,initDelay;var outEvent=dj.lang.addLiveEvent(containerClass,"mouseout",function(){doInit=false;});var overEvent=dj.lang.addLiveEvent(containerClass,"mouseover",function(){if(initDelay){clearTimeout(initDelay);}
doInit=true;var elm=this;initDelay=setTimeout(function(){if(!doInit){return;}
dj.lang.removeLiveEvent(overEvent);dj.lang.removeLiveEvent(outEvent);func.call(null,elm);},time);});},DEFAULT_CONFIG:{hideTooltipDelay:100},init:function(containerClass,config){this.eventPointerList=[];this.containerClass=containerClass;this.cfg=dj.lang.cloneMixin(this.DEFAULT_CONFIG,config);this._setupTooltips();},_setupTooltips:function(){this.oContainer=(this.cfg.container?dojo.byId(this.cfg.container):this.cfg.container);this.oTooltipContainers=((typeof this.oContainer!=='undefined')&&(this.oContainer!==null))?dojo.query(this.containerClass,this.oContainer):dojo.query(this.containerClass);this.oTooltipContainers.forEach(dojo.hitch(this,function(oTooltipContainer){var oTooltipElementsContainer=dojo.query(this.cfg.elementsContainerClass,oTooltipContainer)[0],oTooltipTarget=dojo.query(this.cfg.targetClass,oTooltipContainer)[0],oTooltip=dojo.query(this.cfg.tooltipClass,oTooltipContainer)[0];if(!((typeof oTooltipElementsContainer!=='undefined')&&(oTooltipElementsContainer!==null)&&(typeof oTooltipTarget!=='undefined')&&(oTooltipTarget!==null)&&(typeof oTooltip!=='undefined')&&(oTooltip!==null))){console.log("{Tooltip} oTooltipTarget or oTooltip is not defined for tooltip container");return;}
var tipTarget=dojo.query(this.cfg.targetClass,oTooltipElementsContainer)[0];if((typeof tipTarget==='undefined')||(tipTarget===null)){dojo.place(oTooltipElementsContainer,oTooltipTarget,"before");dojo.place(oTooltipTarget,oTooltip,"after");}
var tooltipVisibleFlag=false;var showTooltipListener=function(){tooltipVisibleFlag=true;this.showTooltip(oTooltip);};var hideTooltipListener=function(){tooltipVisibleFlag=false;setTimeout(dojo.hitch(this,function(){if(tooltipVisibleFlag===false){this.hideTooltip(oTooltip);}}),this.cfg.hideTooltipDelay);};this.eventPointerList.push(dojo.connect(oTooltipTarget,"onmouseover",dojo.hitch(this,showTooltipListener)));this.eventPointerList.push(dojo.connect(oTooltipTarget,"onmouseout",dojo.hitch(this,hideTooltipListener)));this.eventPointerList.push(dojo.connect(oTooltip,"onmouseover",dojo.hitch(this,showTooltipListener)));this.eventPointerList.push(dojo.connect(oTooltip,"onmouseout",dojo.hitch(this,hideTooltipListener)));}));},showTooltip:function(oTooltip){dojo.style(oTooltip,{display:"block"});},hideTooltip:function(oTooltip){dojo.style(oTooltip,{display:"none"});},destructor:function(){if(!this.isInitialized){console.warn("{dj.widget.panel.Tooltip} has not been initialized yet");return;}
this.oContainer=null;this.oTooltipContainers=null;for(var i=0,len=this.eventPointerList.length;i<len;i++){dojo.disconnect(this.eventPointerList[i]);delete this.eventPointerList[i];}},refreshTooltips:function(container){if(!this.isInitialized){return;}
this.destructor();this._setupTooltips();}});dojo.provide("dj.widget.panel.ModalPanel");dojo.require("dj.util.Config");dojo.require("dj.util.Element");dojo.require("dj.util.Observer");(dj.widget.panel.ModalPanel=function(modalId,modalContainer,config){this.oModalId=dojo.byId(modalId);if(!this.oModalId){throw new Error("{dj.widget.panel.ModalPanel} modal-id is null or undefined");}
this.oModalContainer=dojo.byId(modalContainer);if(!this.oModalContainer){throw new Error("{dj.widget.panel.ModalPanel} modal-container is null or undefined");}
this.observeOpenModalPanel=new dj.util.Observer();this.observeCloseModalPanel=new dj.util.Observer();this.cfg=new dj.util.Config(this);this._setupConfig();if(config){this.cfg.applyConfig(config,true);}
this.cfg.fireQueue();if(this.oModalId===null){this._setupTargetlessModalPanel(this.oModalContainer);}else{this._setupModalPanel(this.oModalId,this.oModalContainer);}}).prototype={DEFAULT_CONFIG:{OPEN_MODAL_PANEL_EVENT_OPTION:{key:"openModalPanelEvent",value:"mouseover"},CLOSE_MODAL_PANEL_EVENT_OPTION:{key:"closeModalPanelEvent",value:"mouseout"},CLOSE_MODAL_PANEL_BUTTON_SELECTOR:{key:"closeModalPanelButtonSelector",value:null},CLOSE_MODAL_PANEL_EVENT_FOR_BUTTON_SELECTOR:{key:"closeModalPanelEventForButtonSelector",value:null}},_setupModalPanel:function(oModalId,oModalContainer){dojo.style(oModalContainer,{visibility:"hidden"});var modalOpenEvent=this.cfg.getProperty(this.DEFAULT_CONFIG.OPEN_MODAL_PANEL_EVENT_OPTION.key);var modalCloseEvent=this.cfg.getProperty(this.DEFAULT_CONFIG.CLOSE_MODAL_PANEL_EVENT_OPTION.key);var that=this;dojo.connect(oModalId,"on"+modalOpenEvent,this,function(event){dojo.stopEvent(event);this.openModalPanel();});var closeModalPanelSelector=this.cfg.getProperty(this.DEFAULT_CONFIG.CLOSE_MODAL_PANEL_BUTTON_SELECTOR.key);if(closeModalPanelSelector!==null){var closeModalPanelButtons=dojo.query(closeModalPanelSelector,oModalContainer);var modalCloseEventForButtonSelector=(this.cfg.getProperty(this.DEFAULT_CONFIG.CLOSE_MODAL_PANEL_EVENT_FOR_BUTTON_SELECTOR.key)!==null)?this.cfg.getProperty(this.DEFAULT_CONFIG.CLOSE_MODAL_PANEL_EVENT_FOR_BUTTON_SELECTOR.key):modalCloseEvent;closeModalPanelButtons.forEach(function(oCloseModalPanelButton){dojo.connect(oCloseModalPanelButton,"on"+modalCloseEventForButtonSelector,this,function(event){dojo.stopEvent(event);this.closeModalPanel();});},this);}else{dojo.connect(oModalContainer,"onmouseover",this,this.openModalPanel);dojo.connect(oModalContainer,"on"+modalCloseEvent,this,this.closeModalPanel);}
if(modalCloseEvent=='blur'){dojo.connect(document,"onclick",this,function(event){var isMousePointerinModalContainer=dj.util.Element.contains(oModalContainer,event.clientX,event.clientY);if(isMousePointerinModalContainer===false){this.closeModalPanel();}});}},_setupTargetlessModalPanel:function(oModalContainer){var modalCloseEvent=this.cfg.getProperty(this.DEFAULT_CONFIG.CLOSE_MODAL_PANEL_EVENT_OPTION.key);var closeModalPanelSelector=this.cfg.getProperty(this.DEFAULT_CONFIG.CLOSE_MODAL_PANEL_BUTTON_SELECTOR.key);this.openModalPanel();var that=this;if(closeModalPanelSelector!==null){var closeModalPanelButtons=dojo.query(closeModalPanelSelector,oModalContainer).each(function(oCloseModalPanelButton){dojo.connect(oCloseModalPanelButton,"on"+modalCloseEvent,this,function(event){dojo.stopEvent(event);this.closeModalPanel();});});}else{dojo.connect(oCloseModalPanelButton,"on"+modalCloseEvent,this,this.closeModalPanel);}},openModalPanel:function(){dojo.style(this.oModalContainer,{visibility:"visible"});},closeModalPanel:function(){dojo.style(this.oModalContainer,{visibility:"hidden"});},_setupConfig:function(config){var cfg=this.cfg;var defCfg=this.DEFAULT_CONFIG;cfg.addProperty(defCfg.OPEN_MODAL_PANEL_EVENT_OPTION.key,{value:defCfg.OPEN_MODAL_PANEL_EVENT_OPTION.value});cfg.addProperty(defCfg.CLOSE_MODAL_PANEL_EVENT_OPTION.key,{value:defCfg.CLOSE_MODAL_PANEL_EVENT_OPTION.value});cfg.addProperty(defCfg.CLOSE_MODAL_PANEL_BUTTON_SELECTOR.key,{value:defCfg.CLOSE_MODAL_PANEL_BUTTON_SELECTOR.value});cfg.addProperty(defCfg.CLOSE_MODAL_PANEL_EVENT_FOR_BUTTON_SELECTOR.key,{value:defCfg.CLOSE_MODAL_PANEL_EVENT_FOR_BUTTON_SELECTOR.value});}};dojo.provide("dj.widget.panel.SelectDropdownPanel");dojo.require("dj.util.Element");dojo.require("dj.lang");dojo.declare("dj.widget.panel.SelectDropdownPanel",null,{DEFAULT_CONFIG:{scrollContainerClass:".scroll_container",scrollBarClass:".scrollbar",scrollTrackClass:".scrollbar_container",scrollValuesContainerClass:".scroll_values_container",dropdownCollapsedClassName:"dropdown_collapsed",dropdownExpandedClassName:"dropdown_open",scrollContainerCollapsedClassName:"collapsed",scrollContainerExpandedClassName:"expanded",selectedClassName:".selected",scrollTrackContainerClassName:".scroll_track",dropdownScrollUpArrow:".scroll_up",dropdownScrollDownArrow:".scroll_down",scrollTrackHeight:"154",scrollValuesDisplayHeight:"190",scrollBarArrowShiftValue:"2"},constructor:function(selectDropdownContainer,config){this.cfg=dj.lang.cloneMixin(this.DEFAULT_CONFIG,config);var scrollBarClass=this.cfg.scrollBarClass;var scrollTrackClass=this.cfg.scrollTrackClass;var scrollContainerClass=this.cfg.scrollContainerClass;var scrollValuesContainerClass=this.cfg.scrollValuesContainerClass;this.oSelectDropDownContainer=dojo.byId(selectDropdownContainer);if(this.oSelectDropDownContainer){this.oScrollBar=dojo.query(scrollBarClass,this.oSelectDropDownContainer)[0];this.oScrollTrack=dojo.query(scrollTrackClass,this.oSelectDropDownContainer)[0];this.oScrollContainer=dojo.query(scrollContainerClass,this.oSelectDropDownContainer)[0];this.oScrollValuesContainer=dojo.query(scrollValuesContainerClass,this.oSelectDropDownContainer)[0];this._setupSelectDropdown(this.oSelectDropDownContainer,this.oScrollContainer,this.oScrollValuesContainer,this.oScrollBar,this.oScrollTrack);}},_setupSelectDropdown:function(oSelectDropdownContainer,oScrollContainer,oScrollValuesContainer,oScrollBar,oScrollTrack){var selectDropdownCollapsedClassName=this.cfg.dropdownCollapsedClassName;var selectDropdownExpandedClassName=this.cfg.dropdownExpandedClassName;var scrollContainerCollapsedClassName=this.cfg.scrollContainerCollapsedClassName;var scrollContainerExpandedClassName=this.cfg.scrollContainerExpandedClassName;var selectedClassName=this.cfg.selectedClassName;this.oSelected=dojo.query(selectedClassName,oSelectDropdownContainer)[0];var toggleDropdownClass=function(){if(dojo.hasClass(oSelectDropdownContainer,selectDropdownCollapsedClassName)){dojo.removeClass(oSelectDropdownContainer,selectDropdownCollapsedClassName);dojo.addClass(oSelectDropdownContainer,selectDropdownExpandedClassName);}else
if(dojo.hasClass(oSelectDropdownContainer,selectDropdownExpandedClassName)){dojo.removeClass(oSelectDropdownContainer,selectDropdownExpandedClassName);dojo.addClass(oSelectDropdownContainer,selectDropdownCollapsedClassName);}
if(dojo.hasClass(oScrollContainer,scrollContainerCollapsedClassName)){dojo.removeClass(oScrollContainer,scrollContainerCollapsedClassName);dojo.addClass(oScrollContainer,scrollContainerExpandedClassName);}else
if(dojo.hasClass(oScrollContainer,scrollContainerExpandedClassName)){dojo.removeClass(oScrollContainer,scrollContainerExpandedClassName);dojo.addClass(oScrollContainer,scrollContainerCollapsedClassName);}};dojo.connect(this.oSelected,"onclick",toggleDropdownClass);dojo.connect(oScrollValuesContainer,"onclick",toggleDropdownClass);dojo.connect(document,"onclick",function(event){var isMousePointerinModalContainer=dj.util.Element.contains(oScrollContainer,event.clientX,event.clientY);if(isMousePointerinModalContainer===false){if(dojo.hasClass(oSelectDropdownContainer,selectDropdownExpandedClassName)){dojo.removeClass(oSelectDropdownContainer,selectDropdownExpandedClassName);dojo.addClass(oSelectDropdownContainer,selectDropdownCollapsedClassName);}
if(dojo.hasClass(oScrollContainer,scrollContainerExpandedClassName)){dojo.removeClass(oScrollContainer,scrollContainerExpandedClassName);dojo.addClass(oScrollContainer,scrollContainerCollapsedClassName);}}});if(oScrollBar&&oScrollBar!==null&&oScrollTrack&&oScrollTrack!==null){dojo.require("dj.widget.Slider");var noOfValues=oScrollValuesContainer.children.length;var scrollTrackHeight=parseInt(this.cfg.scrollTrackHeight,10);var scrollValuesDisplayHeight=parseInt(this.cfg.scrollValuesDisplayHeight,10);var scrollBarHeight=parseInt((scrollTrackHeight/(noOfValues/10)),10);dojo.style(oScrollBar,{height:scrollBarHeight+"px"});var scrollValuesTopShiftFactor=(scrollValuesDisplayHeight/scrollTrackHeight)*(noOfValues/10);var moveDropDown=function(value){var sliderPx=slider.translateToPx(value);var sliderPxValue=sliderPx.replace("px","");dojo.style(oScrollValuesContainer,{top:"-"+sliderPxValue*scrollValuesTopShiftFactor+"px"});};var slider=new dj.widget.Slider(oScrollBar,oScrollTrack,{onSlide:moveDropDown,onChange:moveDropDown,axis:'vertical'});var scrollTrackContainerClass=this.cfg.scrollTrackContainerClassName;this.oScrollTrackContainer=dojo.query(scrollTrackContainerClass,oSelectDropdownContainer)[0];var scrollUpArrowClass=this.cfg.dropdownScrollUpArrow;var scrollDownArrowClass=this.cfg.dropdownScrollDownArrow;this.oScrollUpArrow=dojo.query(scrollUpArrowClass,this.oScrollTrackContainer)[0];this.oScrollDownArrow=dojo.query(scrollDownArrowClass,this.oScrollTrackContainer)[0];var scrollArrowShiftValue=parseInt(this.cfg.scrollBarArrowShiftValue,10);var scrollBarTopPx,scrollBarTop,sliderValue;dojo.connect(this.oScrollUpArrow,"onclick",function(event){scrollBarTop=dojo.style(oScrollBar,"top");sliderValue=slider.translateToValue(scrollBarTop-scrollArrowShiftValue);if(scrollBarTop>0){slider.setValue(sliderValue);}});dojo.connect(this.oScrollDownArrow,"onclick",function(event){scrollBarTop=dojo.style(oScrollBar,"top");sliderValue=slider.translateToValue(scrollBarTop+scrollArrowShiftValue);if(scrollBarTop<(scrollTrackHeight-scrollBarHeight)){slider.setValue(sliderValue);}});}}});dojo.provide("dj.module.refreshTooltips");dojo.require("dj.util.User");dojo.require("dj.widget.panel.Tooltip");dj.module.refreshTooltips=function(oTooltip){dj.util.User.isSubLoggedIn(function(subLoggedIn){if(!subLoggedIn){if((typeof oTooltip!=='undefined')&&(oTooltip!==null)&&(typeof oTooltip.refreshTooltips=="function")){oTooltip.refreshTooltips();}}});};
dojo.provide("dj.widget.flash.Flash");dojo.require("dj.util.Cookie");dojo.require("dj.util.Observer");dojo.require("dj.util.Element");dojo.require("swfobject.swfobject_2_2.swfobject");dojo.declare("dj.widget.flash.Flash",null,{constructor:function(idOrDomNode,p,s,params){this.parent=dojo.byId(idOrDomNode);if(this._isWidgetAlreadyHandled()){return;}
dj.util.Element.identify(this.parent);params=dojo.mixin({noload:false,getSettings:true,swfsettings:undefined},params);this.config={};this.config.myMovie='/public/resources/documents/info-flash08-preloader.swf';this.p=p;this.s=s;this.swfsettings=params.swfsettings;this.getSettings=params.getSettings;this.swfPrefix='info-';this.params=params;this._swfFlashvars={};this._swfParams={};this._swfAttributes={};this.settingsObserver=new dj.util.Observer();if(p&&!params.noload){this.load(p,s);}},_isWidgetAlreadyHandled:function(){var isWidgetAlreadyHandled=((typeof dojo.query("div[data-dj-live-widget]",this.parent)[0]==="object")||(typeof dojo.query("div[data-dj-widget]",this.parent)[0]==="object"));if(isWidgetAlreadyHandled){console.info("{Flash} %o will be handled by the util.template.",this.parent.id);return true;}
return false;},load:function(p,s){this.newId();this.settingsObserver.subscribe(this.create,this);this.loadsettings(p,s);if(this.swfsettings){this.create(p,s);}},newId:function(){this.flid="flashdiv_"+Math.floor(Math.random()*999999);},loadsettings:function(p,s){this.p=p;this.s=s;if(!this.getSettings){this.swfsettings={};return;}
this.settingfile='/public/resources/documents/'+this.swfPrefix+p+'-settings.js';if(!this.swfsettings){this.swfsettings=null;var that=this;var deferred=dojo.xhrGet({url:this.settingfile,load:function(data,ioargs){if(!data){return;}
var jso=that._normalizeJsonToObject(data);that.swfsettings=jso.swfsettings;that.settingsObserver.fire(that.p,that.s);},error:function(response,ioargs){console.error("{Flash} HTTP status code: %s, response: %o",ioargs.xhr.status,response);}});}},create:function(p,s){this.createwrapper();this.createflash();this.settingsObserver.unsubscribe(this.create);},createwrapper:function(){this.newId();this.div=document.createElement('div');this.div.setAttribute('id',this.flid);this.parent.appendChild(this.div);},createflash:function(){if(this.so){return;}
var preloader=null;try{if(this.swfsettings.requiredSettings.preloader!==undefined&&this.swfsettings.requiredSettings.preloader!==null)
{preloader=this.swfsettings.requiredSettings.preloader;if(preloader.indexOf('http://')===-1){preloader='/public/resources/documents/'+this.swfsettings.requiredSettings.preloader;}else{preloader=this.swfsettings.requiredSettings.preloader;}}}catch(exp){console.log('Unable to load swfsettings.requiredSettings.preloader : '+exp);}
this.myMovie=(preloader)?(preloader):(this.config.myMovie);this._setSwfParams();this._setSwfFlashvars();this._setSwfAttributes();try{swfobject.embedSWF(this.myMovie,this.flid,this.swfsettings.requiredSettings.swfwidth,this.swfsettings.requiredSettings.swfheight,"9.0.0","",this._swfFlashvars,this._swfParams,this._swfAttributes);}catch(e){console.error("{Flash} threw the following error: %o",e.message);}},_setSwfParams:function(){this._swfParams=dojo.mixin(this._swfParams,{allowScriptAccess:"always",wmode:"opaque",base:"/public/resources/documents",menu:"false",bgcolor:"#FFFFFF",allowfullscreen:"true",height:this.swfsettings.requiredSettings.swfheight});},_setSwfFlashvars:function(){if(this.swfsettings&&this.swfsettings.optionalSettings){for(var setting in this.swfsettings.optionalSettings){if(this.swfsettings.optionalSettings.hasOwnProperty(setting)){this._swfFlashvars[setting]=this.swfsettings.optionalSettings[setting];}}}
if(this.params&&this.params.flashVars){for(var flashVar in this.params.flashvars){if(this.params.flashvars.hasOwnProperty(flashVar)){this._swfFlashvars[flashVar]=this.params.flashvars[flashVar];}}}
this._swfFlashvars.SlugName=this.p;this._swfFlashvars.placement="tab";this.preload='info-'+this.p+'-preload.xml';this._swfFlashvars.PreloaderURL=this.preload;this._swfFlashvars.MovieWidth=this.swfsettings.requiredSettings.swfwidth;this._swfFlashvars.MovieHeight=this.swfsettings.requiredSettings.swfheight;this._swfFlashvars.asub=dj.util.Cookie.getCookie("user_type");this._swfFlashvars.basePath='/public/resources/documents';this._swfFlashvars.cdnDomain=dj.context.core.cdnPrefix;this._swfFlashvars.serverDomain=dj.context.core.urlPrefix;try{if((this.s===undefined||this.s===null||this.s==="")&&(this.swfsettings.optionalSettings.id!==undefined&&this.swfsettings.optionalSettings.id!=="")){this._swfFlashvars.id=this.swfsettings.optionalSettings.id;}else{this._swfFlashvars.id=this.s;}}catch(error){this._swfFlashvars.id=this.s;}
this._swfFlashvars.PLAYER_ID=this.p;try{console.log("parent.id*************** "+this.parent.id+" ******************");this._swfFlashvars.containermodule=this.parent.id;}catch(exp){console.error("Error while getting parent.id in Flash.js");}},_setSwfAttributes:function(){this._swfAttributes=dojo.mixin(this._swfAttributes,{id:this.p});},_normalizeJsonToObject:function(response){var json_start=response.indexOf('{');var json_end=response.lastIndexOf('}');if(json_start>-1){response=response.substring(json_start,json_end+1);}
return dojo.fromJson(response);}});dojo.declare("dj.widget.flash.SlideshowFlash",dj.widget.flash.Flash,{constructor:function(id,p,s,noload){this.config.myMovie='/public/resources/documents/info-slideshow08-preloader.swf';window.getContent=this.getContent;},getContent:function(){return null;}});dojo.provide("dj.util.flash.template");dojo.require("dj.util.Element");dojo.require("dj.util.Template");dojo.require("swfobject.swfobject_2_2.swfobject");dojo.require("dj.widget.flash.Flash");dojo.require("dj.util.Ads");dj.util.flash.template={scan:function(){var that=this;dojo.query("div[data-dj-widget=flash.Template]").forEach(function(domNode){try{if(that._isInitialized(domNode)){return;}
that._markAsInitialized(domNode);var dataset=that._getDatasetFromWidget(domNode);if(that._hasValidFlashVersion()){that._handleFlash(domNode,dataset);}else if(dataset.djHideIfNoFlash=="true"){that._destroyWidget(domNode);}else{that._setMagicDatapoints(dataset);that._handleTemplate(domNode,dataset);}}catch(e){console.error("{flash.Template} threw the following error: %s",e.message);}});dojo.query("div[data-dj-live-widget=slideshow.nonflash]").forEach(function(domNode){try{if(that._isInitialized(domNode)){return;}
that._markAsInitialized(domNode);var dataset=that._getDatasetFromWidget(domNode);if(dataset.djWidgetType=="largeSlideshow"){dj.widget.article.slideshow.nonflashSlideshow.init({containerId:"slideContainer",adRefreshCounter:dataset.djWidgetAdrefreshcounter});var a=new dj.util.Ads().loadAds("slideshow");if(dojo.getObject("dj.util.onVisibleWidget",true).scan){dj.util.onVisibleWidget.scan();}}else if(dataset.djWidgetType=="slideshow.explore"){dj.widget.article.slideshow.nonflashSlideshow.initExplore();}}catch(e){console.error("{flash.Template} threw the following error: %s",e.message);}});},_isInitialized:function(domNode){return(dj.util.Element.getData(domNode,"isInitialized")=="true");},_markAsInitialized:function(domNode){dj.util.Element.setData(domNode,"isInitialized","true");},_hasValidFlashVersion:function(){return(swfobject.getFlashPlayerVersion().major>=9);},_handleFlash:function(domNode,dataset){var hasFlashSettings=dataset.flashSettings;var options=hasFlashSettings?{noload:true,swfsettings:dojo.fromJson(dataset.flashSettings).swfsettings}:{};var fl=new dj.widget.flash.Flash(domNode,dataset.flashProject,dataset.flashSecondParam,options);if(hasFlashSettings){fl.create(dataset.flashProject,dataset.flashSecondParam);}},_destroyWidget:function(domNode){var parent=domNode.parentNode;dojo.destroy(domNode);var textarea=dojo.query("textarea",parent)[0];if(textarea){dojo.destroy(textarea);}
this._recursivelyDestroyEmptyParents(parent);},_recursivelyDestroyEmptyParents:function(parent){var numOfChildren=dojo.query("*",parent).length;if(numOfChildren===0){var itsParent=parent.parentNode;dojo.destroy(parent);this._recursivelyDestroyEmptyParents(itsParent);}},_setMagicDatapoints:function(dataset){dataset.djIsFlashPossible=this._isFlashPossible();},_handleTemplate:function(domNode,dataset){var template=this._getTemplateFromWidget(domNode);this._renderTemplate(domNode,template,dataset);},_getTemplateFromWidget:function(domNode){var template=dojo.query("textarea",domNode)[0];if(!template){throw new Error("{flash.Template} no template domNode found in %o",domNode);}
return this._stripCdataTags(template.value);},_getDatasetFromWidget:function(domNode){var dataset=dj.util.Element.getDataset(domNode);delete dataset.djWidget;return dataset;},_renderTemplate:function(domNode,template,dataset){domNode.innerHTML=dj.util.Template.parseTemplate(template).process(dataset);},_stripCdataTags:function(string){string=string.replace(/\s*<!\[CDATA\[\s*/,"");string=string.replace(/\s*\]\]>\s*/,"");return string;},_isFlashPossible:function(){var userAgentString=navigator.userAgent.toLowerCase(),isIphone=(userAgentString.indexOf("iphone")>-1),isIpad=(userAgentString.indexOf("ipad")>-1);return(dojo.isBrowser&&!(isIphone||isIpad));}};
dojo.provide("dj.util.account");dojo.require("dj.lang");dj.util.account={getAccountData:function(a,b){b.responseType=!b.responseType?"application/json":b.responseType;var c=b.responseType.indexOf("json")>-1;this._sendXhrRequest(a,b,{requestMethod:"GET",handleAs:c?"json":"text",requestHeaders:{Accept:b.responseType}})},postAccountData:function(a,b,c){c.requestType=!c.requestType?"application/json":c.requestType;this._sendXhrRequest(a,c,{requestMethod:"POST",content:b,requestHeaders:{"X-HTTP-Method-Override":"POST","Content-Type":c.requestType}})},putAccountData:function(a,b,c){this._sendXhrRequest(a,c,{requestMethod:"PUT",content:dojo.toJson(b),requestHeaders:{"X-HTTP-Method-Override":"PUT","Content-Type":"application/json"}})},_sendXhrRequest:function(a,b,c){var d=dj.lang.cloneMixin({callback:function(){}},b);b=dj.lang.cloneMixin({requestHeaders:{Accept:"application/json"},handleAs:"json"},c);return this._getRequestByMethod(b.requestMethod)({url:a,headers:b.requestHeaders,handleAs:b.handleAs,postData:b.content,timeout:dj.context.account.serviceTimeOut,load:function(e,f){d.callback.apply(d.context,[e,f.xhr,d])},error:function(e,f){console.error("HTTP status code: %s, response: %o",f.xhr.status,e);typeof d.errorCallback!=="undefined"?d.errorCallback.apply(d.context,[e.status,f.xhr,d]):d.callback.apply(d.context,[e.status,f.xhr,d])}})},_getRequestByMethod:function(a){return a=="GET"?dojo.xhrGet:dojo.xhrPost}};dojo.provide("dj.widget.loader.LoadPageFragment");dojo.require("dj.widget.fragmentloader.FragmentLoader");dojo.require("dj.util.Region");dojo.require("dj.util.User");dojo.require("dj.util.user.EnvironmentDao");dojo.require("dj.util.Url");dojo.declare("dj.widget.loader.LoadPageFragment",null,{constructor:function(a){this._cfg=dojo.mixin(this.DEFAULT_CONFIG,a);this.getGreyBckgroundCSSDiv="getGreyBckgroundCSSDiv";this.scrimManagerFile=dj.context.account.scrimManagerFilePath},DEFAULT_CONFIG:{isLoadJs:true,isLoadCss:true,isLoadHtml:true,version:5.9},init:function(){dojo.query(this._cfg.initNodeClass).connect("click",this,function(){this.initLoader(this._cfg.domNodeId,this._cfg.mstPageId,this.scrimCallback,this)})},initScrim:function(){this.initLoader(this._cfg.domNodeId,this._cfg.mstPageId,this.scrimCallback,this)},getScrimContents:function(a,b,c,d,e){var f=(new dj.util.user.EnvironmentDao(dj.util.Region,dj.util.User)).getEnvironment();if(typeof e!="undefined")this._cfg.akamaiCdnPrefix=e;a=new dj.widget.fragmentloader.FragmentLoader(f,b,this._cfg.version,a,this._cfg);a.load();dojo.connect(a,"onJsLoad",this,function(){typeof c!="undefined"&&typeof c==="function"&&c.call(d)})},initLoader:function(a,b,c,d,e){var f=dojo.byId(a);if(f!=null&&dj.lang.trim(f.innerHTML)!="")if(dojo.hasClass(f,"initialLoad")){dojo.removeClass(f,"initialLoad");d.scrimCallback(true)}else d.showScrim(a);else{if(dojo.byId(this.getGreyBckgroundCSSDiv)==null){dojo.create("div",{id:this.getGreyBckgroundCSSDiv,"class":"login_overlay"},dojo.body(),"last");this.addclassForArticles()}dojo.destroy("overlayDiv");dojo.create("div",{id:a},this.getGreyBckgroundCSSDiv,"last");this.getScrimContents(a,b,c,d,e)}},initIframeLoader:function(a,b){this._cfg.domNodeId="overlayDiv";if(dojo.byId(this._cfg.domNodeId)==null||dj.lang.trim(dojo.byId(this._cfg.domNodeId).innerHTML)==""){if(dojo.byId(this.getGreyBckgroundCSSDiv)==null){dojo.create("div",{id:this.getGreyBckgroundCSSDiv,"class":"login_overlay"},dojo.body(),"last");this.addclassForArticles()}if(dojo.byId("loginScrimLoader")==null){dojo.create("div",{id:"loginScrimLoader","class":"login_scrim_loader"},this.getGreyBckgroundCSSDiv,"last");dojo.byId("loginScrimLoader").innerHTML="<h4>"+dj.context.account.loading+"</h4>"}dojo.create("div",{id:this._cfg.domNodeId,"class":"login_scrim_wrapper hidden"},this.getGreyBckgroundCSSDiv,"last");dojo.create("div",{id:"login_inner","class":"login_scrim_inner"},this._cfg.domNodeId,"last");dojo.create("div",{id:"module","class":"login_scrim_module"},"login_inner","last");dojo.create("div",{id:"iframe_headerStrap","class":"headerStrap"},"module","last");dojo.byId("iframe_headerStrap").innerHTML='<a href="#" class="closeBtn iframeOverlayCloseBtn">'+dj.context.account.closeText+"</a>";this.addListnerForCloseButton()}else{dojo.addClass(this._cfg.domNodeId,"hidden");if(typeof this.userdata!="undefined"&&(typeof this.userdata.screenName!="undefined"||typeof this.userdata.confScreenName!="undefined"))if(this.userdata.screenName=="LoginVerifyEmail"||this.userdata.confScreenName=="LoginVerifyEmail"||this.userdata.screenName=="UnverifiedFreeReg"||this.userdata.confScreenName=="UnverifiedFreeReg")this.addListnerForCloseButton()}if(dojo.byId("moduleiframe")==null||dj.lang.trim(dojo.byId("moduleiframe")).innerHTML==""){this.disableIPadScroll();this.initIFrame("module",a,b)}else{this.fadeScrim("moduleiframe",300);dojo.removeClass(dojo.byId("module"),"hidden")}},addListnerForCloseButton:function(){dojo.query(".iframeOverlayCloseBtn").connect("click",this,function(a){dojo.stopEvent(a);this.enableIPadScroll();dojo.destroy(dojo.byId("moduleiframe"));dojo.destroy(dojo.byId(this.getGreyBckgroundCSSDiv));this.destroyAccountInstanceArr();if(typeof this.userdata!="undefined"&&(typeof this.userdata.screenName!="undefined"||typeof this.userdata.confScreenName!="undefined"))if(this.userdata.screenName=="LoginVerifyEmail"||this.userdata.confScreenName=="LoginVerifyEmail"){a=decodeURIComponent(this.userdata.refreshPageUrlForUnverifiedSub);parent.location=decodeURIComponent(a)}else if(this.userdata.screenName=="UnverifiedFreeReg"||this.userdata.confScreenName=="UnverifiedFreeReg")this.initIFrameForLogout()})},enableIPadScroll:function(){document.ontouchmove=function(){return true}},disableIPadScroll:function(){document.ontouchmove=function(){return false}},initIFrameForLogout:function(){dojo.byId("unverifiedFreeReglogout")==null&&dojo.create("div",{id:"unverifiedFreeReglogout","class":"hidden"},dojo.body(),"last");var a="http://"+document.domain+"/logout";window.console&&console.log("url for logout "+a);a={src:a,"class":"hidden"};setTimeout(this.isUserLoggedout,1E4);dj.util.Url.createSimpleIframe(a,"unverifiedFreeReglogout",this.testLogoutIframeLoaded,this)},testLogoutIframeLoaded:function(){this.userLoggedOut=true;dojo.destroy("unverifiedFreeReglogout")},isUserLoggedout:function(){this.userLoggedOut||window.console&&console.warn(" unverified free reg user couldn't be logged out ")},initIFrame:function(a,b,c){url=dj.context.account.idDomainToHostScrims+this._cfg.mstPageId+".html?successFileUrl="+encodeURIComponent("http://"+document.domain+this.scrimManagerFile)+"&currentPageUrl="+encodeURIComponent(this.getPageUrl())+"&region="+encodeURIComponent(dj.util.Region.getViewByRegion());if(typeof this.userdata!="undefined"){if(typeof this.userdata.refreshPageUrlForUnverifiedSub!="undefined")this.userdata.refreshPageUrlForUnverifiedSub=encodeURIComponent(this.userdata.refreshPageUrlForUnverifiedSub);url+="&userdata="+dojo.toJson(this.userdata)}dj.util.Url.createSimpleIframe({src:url,"class":"login_scrim_framed",style:{height:b,width:c},allowTransparency:"true"},a,this.iframeLoaded,this)},initScrimFromIframe:function(){this.initIframeLoader(this._cfg.height,this._cfg.width)},iframeLoaded:function(){if(dojo.hasClass(this._cfg.domNodeId,"hidden")){this.fadeScrim(this._cfg.domNodeId,300);dojo.byId(this._cfg.domNodeId)!=null&&dojo.removeClass(dojo.byId(this._cfg.domNodeId),"hidden")}},getDomain:function(){var a="";return a=typeof gcDomain!=="undefined"&&gcDomain!==null&&gcDomain!==""?"http://"+gcDomain:"http://"+document.domain},getPageUrl:function(){var a=this._cfg.NONSUBSCRIBER_HOMEPAGE_PID,b=this._cfg.NONSUBSCRIBER_SEARCH_PAGE_PID,c=this._cfg.NONSUBSCRIBER_NEWSLETTERS_ALERTS_PAGE_PID,d=this._cfg.MDC_PAGE_PID,e;e=this.getDomain();var f;var g=f=dojo.isIE?window.location.href:document.location.href;if(typeof pID!=="undefined"){g=pID===a?e+this._cfg.HOMEPAGE_SUBSCRIBER_URL:pID===c?e+"/email":pID===b?e+this._cfg.SEARCH_PAGE_SUBSCRIBER_URL:pID===d?e+this._cfg.MDC_LINK_URL:f;a=g.indexOf("?")!=-1?"&":"?";if(typeof a!==undefined){a=a+"_nocache="+(new Date).getTime();if(g.indexOf("#")!=-1)g=g.replace("#",a);else g+=a}}return g},initHiddenScrim:function(a,b,c,d){if(typeof b=="undefined")b=this._cfg.mstPageId;if(typeof a=="undefined")a=this._cfg.domNodeId;if(dojo.byId(a)==null||dj.lang.trim(dojo.byId(a).innerHTML)==""){if(dojo.byId(a)==null){if(dojo.byId(this.getGreyBckgroundCSSDiv)==null){dojo.create("div",{id:this.getGreyBckgroundCSSDiv,"class":"login_overlay"},dojo.body(),"last");this.addclassForArticles()}dojo.create("div",{id:a,"class":"hidden initialLoad"},this.getGreyBckgroundCSSDiv,"last")}else dojo.addClass(dojo.byId(a),"hidden");this.getScrimContents(a,b,c,d)}},fadeScrim:function(a,b){var c=1E3;if(b)c=b;dojo.style(a,"opacity","0");dojo.fadeIn({node:a,duration:c}).play()},addclassForArticles:function(){this.getPageUrl().indexOf("/article/")>0&&dojo.addClass(dojo.byId(this.getGreyBckgroundCSSDiv),"article_LIFP")},setUserdata:function(a){this.userdata=a},addToAccountInstanceArr:function(a){if(typeof dj.module.loader.accountInstanceArr=="undefined")dj.module.loader.accountInstanceArr=[];dj.module.loader.accountInstanceArr.push(a)},addToAccountWidgetInstanceArr:function(){},destroyAccountInstanceArr:function(){if(typeof dj.module.loader!="undefined"&&typeof dj.module.loader.accountInstanceArr!="undefined"){for(;dj.module.loader.accountInstanceArr.length!=0;){var a=dj.module.loader.accountInstanceArr.pop();typeof a!="undefined"&&typeof a.destroyObject!="undefined"&&typeof a.destroyObject=="function"&&a.destroyObject()}if(dj.module.loader.accountInstanceArr.length==0){dj.module.loader.accountInstanceArr={};dj.module.loader={}}}}});dojo.provide("dj.widget.loader.FBInitLoader");dojo.require("dj.widget.loader.LoadPageFragment");dojo.declare("dj.widget.loader.FBInitLoader",[],{constructor:function(a){this._cfg=dojo.mixin(this.DEFAULT_CONFIG,a);this.loadpageFragObj=new dj.widget.loader.LoadPageFragment({version:this._cfg.version})},DEFAULT_CONFIG:{isLoadJs:true,isLoadCss:true,isLoadHtml:true,version:4.2,initNodeClass:".connectwithfb",mstPageId:dj.context.account.fbInitPageId,domNodeId:"fbInitDivId"},init:function(){dojo.query(this._cfg.initNodeClass).connect("click",this,function(){this.initScrim()})},initScrim:function(){this.isShow=true;if(typeof this.loadStatus!="undefined")this.loadStatus=="loaded"&&this.showScrim();else this.loadpageFragObj.initLoader(this._cfg.domNodeId,this._cfg.mstPageId,this.scrimCallback,this)},initHiddenScrim:function(){if(typeof this.isShow=="undefined"&&typeof this.loadStatus=="undefined"){this.isShow=false;this.loadStatus="loading";this.loadpageFragObj.initHiddenScrim(this._cfg.domNodeId,this._cfg.mstPageId,this.scrimCallback,this)}else this.isShow=false},initScrimFromIframe:function(){this.isShow=true;if(typeof this.loadStatus!="undefined")this.loadStatus=="loaded"&&this.showScrim();else this.loadpageFragObj.initLoader(this._cfg.domNodeId,this._cfg.mstPageId,this.scrimCallback,this,this._cfg.akamaiCdnPrefix)},scrimCallback:function(a){this.loadStatus="loaded";if(typeof this.fbInitdWidget!="undefined"&&this.fbInitdWidget!=null)this.fbInitdWidget.init(this._cfg.domNodeId,a,this.isShow);else{this.fbInitdWidget=new dj.widget.accountscrim.FBInit(this._cfg);this.fbInitdWidget.init(this._cfg.domNodeId,a,this.isShow);this.loadpageFragObj.addToAccountWidgetInstanceArr(this.fbInitdWidget)}},showScrim:function(){if(typeof this.fbInitdWidget!="undefined"&&this.fbInitdWidget!=null)this.fbInitdWidget.showScrim(this._cfg.domNodeId,true);else{this.fbInitdWidget=new dj.widget.accountscrim.FBInit(this._cfg);this.fbInitdWidget.showScrim(this._cfg.domNodeId,true);this.loadpageFragObj.addToAccountWidgetInstanceArr(this.fbInitdWidget)}},destroyObject:function(){delete this.fbInitdWidget}});dojo.provide("dj.widget.loader.FbLoginOrWSJPswdConfirmationLoader");dojo.require("dj.widget.loader.LoadPageFragment");dojo.declare("dj.widget.loader.FbLoginOrWSJPswdConfirmationLoader",dj.widget.loader.LoadPageFragment,{constructor:function(a,b){this._cfg=dojo.mixin(this.DEFAULT_CONFIG,b);this._cfg.domNodeId=this.getDomNodeId(a);this._cfg.mstPageId=this.getMstPageId(a);this.userdata=a},DEFAULT_CONFIG:{isLoadJs:true,isLoadCss:true,isLoadHtml:true,version:4.2,height:"370px",width:"678px"},scrimCallback:function(a){if(typeof this.fbLoginOrWSJPswdConfWidget!="undefined"&&this.fbLoginOrWSJPswdConfWidget!=null)this.fbLoginOrWSJPswdConfWidget.init(this._cfg.domNodeId,this.userdata,a);else{this.fbLoginOrWSJPswdConfWidget=new dj.widget.accountscrim.Confirmation(this._cfg);this.fbLoginOrWSJPswdConfWidget.init(this._cfg.domNodeId,this.userdata,a);this.addToAccountWidgetInstanceArr(this.fbLoginOrWSJPswdConfWidget)}},showScrim:function(){if(typeof this.fbLoginOrWSJPswdConfWidget!="undefined"&&this.fbLoginOrWSJPswdConfWidget!=null)this.fbLoginOrWSJPswdConfWidget.showScrim(this._cfg.domNodeId,this.userdata,true);else{this.fbLoginOrWSJPswdConfWidget=new dj.widget.accountscrim.Confirmation(this._cfg);this.fbLoginOrWSJPswdConfWidget.showScrim(this._cfg.domNodeId,this.userdata,true);this.addToAccountWidgetInstanceArr(this.fbLoginOrWSJPswdConfWidget)}},getDomNodeId:function(a){return a.screenName+"ConfirmationDivId"},getMstPageId:function(){return dj.context.account.fbLoginOrWSJPswdConfPageId},destroyObject:function(){delete this.fbLoginOrWSJPswdConfWidget}});dojo.provide("dj.widget.loader.ForgotPasswordConfirmationLoader");dojo.require("dj.widget.loader.LoadPageFragment");dojo.declare("dj.widget.loader.ForgotPasswordConfirmationLoader",dj.widget.loader.LoadPageFragment,{constructor:function(a,b){this._cfg=dojo.mixin(this.DEFAULT_CONFIG,b);this._cfg.domNodeId=this.getDomNodeId(a);this._cfg.mstPageId=this.getMstPageId(a);this.userdata=a},DEFAULT_CONFIG:{isLoadJs:true,isLoadCss:true,isLoadHtml:true,version:4.2,height:"340px",width:"678px"},scrimCallback:function(a){if(typeof this.forgotPasswordConfWidget!="undefined"&&this.forgotPasswordConfWidget!=null)this.forgotPasswordConfWidget.init(this._cfg.domNodeId,this.userdata,a);else{this.forgotPasswordConfWidget=new dj.widget.accountscrim.Confirmation(this._cfg);this.forgotPasswordConfWidget.init(this._cfg.domNodeId,this.userdata,a);this.addToAccountWidgetInstanceArr(this.forgotPasswordConfWidget)}},showScrim:function(){if(typeof this.forgotPasswordConfWidget!="undefined"&&this.forgotPasswordConfWidget!=null)this.forgotPasswordConfWidget.showScrim(this._cfg.domNodeId,this.userdata,true);else{this.forgotPasswordConfWidget=new dj.widget.accountscrim.Confirmation(this._cfg);this.forgotPasswordConfWidget.showScrim(this._cfg.domNodeId,this.userdata,true);this.addToAccountWidgetInstanceArr(this.forgotPasswordConfWidget)}},getDomNodeId:function(a){return a.screenName+"ConfirmationDivId"},getMstPageId:function(){return dj.context.account.forgotPasswordConfPageId},destroyObject:function(){delete this.forgotPasswordConfWidget}});dojo.provide("dj.widget.loader.ForgotPasswordLoader");dojo.require("dj.widget.loader.LoadPageFragment");dojo.declare("dj.widget.loader.ForgotPasswordLoader",dj.widget.loader.LoadPageFragment,{constructor:function(a,b){this._cfg=dojo.mixin(this.DEFAULT_CONFIG,b);this.userdata={}},DEFAULT_CONFIG:{isLoadJs:true,isLoadCss:true,isLoadHtml:true,version:4.4,initNodeClass:".forgotPasswordClass",mstPageId:dj.context.account.forgotPasswordPageId,domNodeId:"forgotPasswordDivId",height:"370px",width:"678px"},init:function(){dojo.query(this._cfg.initNodeClass).connect("click",this,function(){this.initIframeLoader(this._cfg.height,this._cfg.width)})},destroyObject:function(){delete this.forgotPasswordWidget}});dojo.provide("dj.widget.loader.ForgotUsernameConfirmationLoader");dojo.require("dj.widget.loader.LoadPageFragment");dojo.declare("dj.widget.loader.ForgotUsernameConfirmationLoader",dj.widget.loader.LoadPageFragment,{constructor:function(a,b){this._cfg=dojo.mixin(this.DEFAULT_CONFIG,b);this._cfg.domNodeId=this.getDomNodeId(a);this._cfg.mstPageId=this.getMstPageId(a);this.userdata=a},DEFAULT_CONFIG:{isLoadJs:true,isLoadCss:true,isLoadHtml:true,version:4.2,height:"370px",width:"678px"},scrimCallback:function(a){if(typeof this.forgotUsernameConfWidget!="undefined"&&this.forgotUsernameConfWidget!=null)this.forgotUsernameConfWidget.init(this._cfg.domNodeId,this.userdata,a);else{this.forgotUsernameConfWidget=new dj.widget.accountscrim.Confirmation(this._cfg);this.forgotUsernameConfWidget.init(this._cfg.domNodeId,this.userdata,a);this.addToAccountWidgetInstanceArr(this.forgotUsernameConfWidget)}},showScrim:function(){if(typeof this.forgotUsernameConfWidget!="undefined"&&this.forgotUsernameConfWidget!=null)this.forgotUsernameConfWidget.showScrim(this._cfg.domNodeId,this.userdata,true);else{this.forgotUsernameConfWidget=new dj.widget.accountscrim.Confirmation(this._cfg);this.forgotUsernameConfWidget.showScrim(this._cfg.domNodeId,this.userdata,true);this.addToAccountWidgetInstanceArr(this.forgotUsernameConfWidget)}},getDomNodeId:function(a){return a.screenName+"ConfirmationDivId"},getMstPageId:function(){return dj.context.account.forgotUsernameConfPageId},destroyObject:function(){delete this.forgotUsernameConfWidget}});dojo.provide("dj.widget.loader.ForgotUserOrPswdLoader");dojo.require("dj.widget.loader.LoadPageFragment");dojo.declare("dj.widget.loader.ForgotUserOrPswdLoader",dj.widget.loader.LoadPageFragment,{constructor:function(a){this._cfg=dojo.mixin(this.DEFAULT_CONFIG,a);this.userdata={}},DEFAULT_CONFIG:{isLoadJs:true,isLoadCss:true,isLoadHtml:true,version:4.4,initNodeClass:".forgotUsernameClass",mstPageId:dj.context.account.forgotUsernamePageId,domNodeId:"forgotUsernameDivId",height:"350px",width:"678px"},init:function(){dojo.query(this._cfg.initNodeClass).connect("click",this,function(){this.initIframeLoader(this._cfg.height,this._cfg.width)})},initScrimFromIframe:function(){this.initIframeLoader(this._cfg.height,this._cfg.width)},destroyObject:function(){delete this.forgotUsernameWidget}});dojo.provide("dj.widget.loader.LoginVerifyEmailConfirmationLoader");dojo.require("dj.widget.loader.LoadPageFragment");dojo.declare("dj.widget.loader.LoginVerifyEmailConfirmationLoader",dj.widget.loader.LoadPageFragment,{constructor:function(a,b){this._cfg=dojo.mixin(this.DEFAULT_CONFIG,b);this._cfg.domNodeId=this.getDomNodeId(a);this._cfg.mstPageId=this.getMstPageId(a);this.userdata=a},DEFAULT_CONFIG:{isLoadJs:true,isLoadCss:true,isLoadHtml:true,version:4.2,height:"280px",width:"678px"},scrimCallback:function(a){if(typeof this.loginVerifyConfWidget!="undefined"&&this.loginVerifyConfWidget!=null)this.loginVerifyConfWidget.init(this._cfg.domNodeId,this.userdata,a);else{this.loginVerifyConfWidget=new dj.widget.accountscrim.Confirmation(this._cfg);this.loginVerifyConfWidget.init(this._cfg.domNodeId,this.userdata,a);this.addToAccountWidgetInstanceArr(this.loginVerifyConfWidget)}},showScrim:function(){if(typeof this.loginVerifyConfWidget!="undefined"&&this.loginVerifyConfWidget!=null)this.loginVerifyConfWidget.showScrim(this._cfg.domNodeId,this.userdata,true);else{this.loginVerifyConfWidget=new dj.widget.accountscrim.Confirmation(this._cfg);this.loginVerifyConfWidget.showScrim(this._cfg.domNodeId,this.userdata,true);this.addToAccountWidgetInstanceArr(this.loginVerifyConfWidget)}},getDomNodeId:function(a){return a.screenName+"ConfirmationDivId"},getMstPageId:function(){return dj.context.account.loginVerifyEmailConfPageId},destroyObject:function(){delete this.loginVerifyConfWidget}});dojo.provide("dj.widget.loader.UnverifiedFreeRegConfirmationLoader");dojo.require("dj.widget.loader.LoadPageFragment");dojo.declare("dj.widget.loader.UnverifiedFreeRegConfirmationLoader",dj.widget.loader.LoadPageFragment,{constructor:function(a,b){this._cfg=dojo.mixin(this.DEFAULT_CONFIG,b);this._cfg.domNodeId=this.getDomNodeId(a);this._cfg.mstPageId=this.getMstPageId(a);this.userdata=a},DEFAULT_CONFIG:{isLoadJs:true,isLoadCss:true,isLoadHtml:true,version:4.2,height:"280px",width:"678px"},scrimCallback:function(a){if(typeof this.unverifiedFreeRegConfWidget!="undefined"&&this.unverifiedFreeRegConfWidget!=null)this.unverifiedFreeRegConfWidget.init(this._cfg.domNodeId,this.userdata,a);else{this.unverifiedFreeRegConfWidget=new dj.widget.accountscrim.Confirmation(this._cfg);this.unverifiedFreeRegConfWidget.init(this._cfg.domNodeId,this.userdata,a);this.addToAccountWidgetInstanceArr(this.unverifiedFreeRegConfWidget)}},showScrim:function(){if(typeof this.unverifiedFreeRegConfWidget!="undefined"&&this.unverifiedFreeRegConfWidget!=null)this.unverifiedFreeRegConfWidget.showScrim(this._cfg.domNodeId,this.userdata,true);else{this.unverifiedFreeRegConfWidget=new dj.widget.accountscrim.Confirmation(this._cfg);this.unverifiedFreeRegConfWidget.showScrim(this._cfg.domNodeId,this.userdata,true);this.addToAccountWidgetInstanceArr(this.unverifiedFreeRegConfWidget)}},getDomNodeId:function(a){return a.screenName+"ConfirmationDivId"},getMstPageId:function(){return dj.context.account.unverifiedFreeRegConfPageId},destroyObject:function(){delete this.unverifiedFreeRegConfWidget}});dojo.provide("dj.widget.loader.UserWithoutEmailLoader");dojo.require("dj.widget.loader.LoadPageFragment");dojo.declare("dj.widget.loader.UserWithoutEmailLoader",dj.widget.loader.LoadPageFragment,{constructor:function(a,b){this._cfg=dojo.mixin(this.DEFAULT_CONFIG,b);this.userdata=a},DEFAULT_CONFIG:{isLoadJs:true,isLoadCss:true,isLoadHtml:true,version:4.5,mstPageId:dj.context.account.userWithoutEmailPageId,domNodeId:"changeUsernameDivId",height:"400px",width:"678px"},chkIfUserWoEmail:function(){var a=dojo.queryToObject(window.location.search.slice(1));if(typeof a.user!="undefined"&&a.user=="welcome"){var b=this;dj.util.User.isLoggedIn(function(c){if(c)if(!djcs.UserInfo.hasRole("SEAMLESS")){if(dojo.byId("userEmailId_temp")!=null)dojo.byId("userEmailId_temp").innerHTML="";else dojo.addClass(dojo.create("div",{id:"userEmailId_temp"},dojo.body()),"hidden");dj.util.User.renderEmailAddress("userEmailId_temp");c=dojo.byId("userEmailId_temp").innerHTML;var d=dojo.indexOf(["dupe@wsj.com","cancel@dowjones.com","canceled@wsj.com","cancelled@wsj.com","dup@wsj.com","cancel@wsj.com","dupe@wsj.com","test@test.com","cancel@dj.com","dup@dowjones.com","duplicate@wsj.com","refused@wsj.com"],c);if(typeof c=="undefined"||c=="undefined"||c==""||d>0)b.initIframeLoader(b._cfg.height,b._cfg.width)}})}},scrimCallback:function(a){(new dj.widget.accountscrim.UserWithoutEmail(this._cfg)).init(this._cfg.domNodeId,a)},showScrim:function(){(new dj.widget.accountscrim.UserWithoutEmail(this._cfg)).showScrim(this._cfg.domNodeId,true)}});dojo.provide("dj.service.account.LoginService");dojo.require("dj.util.account");dojo.require("dj.util.Observer");dj.service.account.LoginService={loginUser:function(a,b,c,d,e){dj.util.account.postAccountData(a,b,{callback:this.handleSuccessResp,errorCallback:this.handleErrorResp,context:this,url:a,responseType:"application/json",clientInfo:{loadCallback:c,errorCallback:d,context:e}})},handleErrorResp:function(a,b,c){a="";var d=[];if(b.status=="404"||b.status=="500")d[0]="generalError";else if(b.status=="503"||b.status=="403")d[0]="unavailableError";else{a=dojo.fromJson(b.responseText);if(typeof a["user-status"]!="undefined")d[0]=a["user-status"];else dojo.forEach(a.errors,function(e,f){d[f]=e.name+e.status})}c.clientInfo.errorCallback.apply(c.clientInfo.context,[d])},handleSuccessResp:function(a,b,c){b.status=="200"&&c.clientInfo.loadCallback.call(c.clientInfo.context,a)},testLogin:function(a,b,c,d,e){dj.util.account.postAccountData(a,b,{callback:this.handleLoginSuccess,errorCallback:this.handleLoginError,context:this,url:a,responseType:"application/json",clientInfo:{loadCallback:c,errorCallback:d,context:e}})},handleLoginSuccess:function(a,b,c){c.clientInfo.loadCallback.call(c.clientInfo.context,a)},handleLoginError:function(a,b,c){c.clientInfo.errorCallback.call(c.clientInfo.context,a)}};dojo.provide("dj.service.account.RegistrationService");dojo.require("dj.util.account");dojo.require("dj.util.Observer");dj.service.account.RegistrationService={registerUser:function(a,b,c,d,e){dj.util.account.postAccountData(a,b,{callback:this.handleSuccessResp,errorCallback:this.handleErrorResp,context:this,url:a,responseType:"application/json",requestType:"application/x-www-form-urlencoded;charset="+document.characterSet,clientInfo:{loadCallback:c,errorCallback:d,context:e}})},handleErrorResp:function(a,b,c){a=[];if(b.status=="404"||b.status=="500")a[0]="generalError";else if(b.status==412){b=dojo.fromJson(b.responseText);if(b.status=="precondition_failed"){b=b.profile.errors;a[0]=b.emailAddress;if(typeof b.emailAddress=="undefined")a[0]="generalError"}}else if(b.status=="503"||b.status=="403")a[0]="unavailableError";c.clientInfo.errorCallback.apply(c.clientInfo.context,[a])},handleSuccessResp:function(a,b,c){b.status=="200"&&c.clientInfo.loadCallback.call(c.clientInfo.context,a.profile.emailAddress)},changeUsername:function(a,b,c,d,e){dj.util.account.postAccountData(a,b,{callback:this.handleChangeUsernameSuccessResp,errorCallback:this.handleChangeUsernameErrorResp,context:this,url:a,responseType:"application/json",requestType:"application/x-www-form-urlencoded;charset="+document.characterSet,clientInfo:{loadCallback:c,errorCallback:d,context:e}})},handleChangeUsernameErrorResp:function(a,b,c){a=[];if(b.status=="404"||b.status=="500")a[0]="generalError";else if(b.status==412){b=dojo.fromJson(b.responseText);if(b.status=="precondition_failed"){b=b.profile.errors;a[0]=b.username;if(typeof b.username=="undefined")a[0]="generalError"}}else if(b.status=="503"||b.status=="403")a[0]="unavailableError";c.clientInfo.errorCallback.apply(c.clientInfo.context,[a])},handleChangeUsernameSuccessResp:function(a,b,c){b.status=="200"&&c.clientInfo.loadCallback.call(c.clientInfo.context,a.profile.uuid)},getNodeValue:function(a,b){return a.getElementsByTagName(b)[0].firstChild.nodeValue},getNode:function(a,b){return a.getElementsByTagName(b)[0]},getAttribute:function(a,b){return a.getAttribute(b)}};dojo.provide("dj.widget.loader.FBConnectedLoader");dojo.require("dj.widget.loader.LoadPageFragment");dojo.require("dj.util.Ads");dojo.declare("dj.widget.loader.FBConnectedLoader",dj.widget.loader.LoadPageFragment,{constructor:function(a){this._cfg=dojo.mixin(this.DEFAULT_CONFIG,a)},DEFAULT_CONFIG:{isLoadJs:true,isLoadCss:true,isLoadHtml:true,version:4.2,initNodeClass:".connectwithfb",mstPageId:dj.context.account.fbConnectedPageId,domNodeId:"fbConnectedDivId"},initScrimFromIframe:function(){this.initLoader(this._cfg.domNodeId,this._cfg.mstPageId,this.scrimCallback,this)},scrimCallback:function(a){if(typeof this.fbConnectedWidget!="undefined"&&this.fbConnectedWidget!=null)this.fbConnectedWidget.init(this._cfg.domNodeId,a);else{this.fbConnectedWidget=new dj.widget.accountscrim.FBConnected(this._cfg);this.fbConnectedWidget.init(this._cfg.domNodeId,a);this.addToAccountWidgetInstanceArr(this.fbConnectedWidget)}(new dj.util.Ads).loadAds("facebook2")},showScrim:function(){if(typeof this.fbConnectedWidget!="undefined"&&this.fbConnectedWidget!=null)this.fbConnectedWidget.showScrim(this._cfg.domNodeId,true);else{this.fbConnectedWidget=new dj.widget.accountscrim.FBConnected(this._cfg);this.fbConnectedWidget.showScrim(this._cfg.domNodeId,true);this.addToAccountWidgetInstanceArr(this.fbConnectedWidget)}(new dj.util.Ads).loadAds("facebook2")},destroyObject:function(){delete this.fbConnectedWidget}});dojo.provide("dj.widget.loader.LoginLoader");dojo.require("dj.widget.loader.LoadPageFragment");dojo.require("dj.util.Region");dojo.declare("dj.widget.loader.LoginLoader",dj.widget.loader.LoadPageFragment,{constructor:function(a){this._cfg=dojo.mixin(this.DEFAULT_CONFIG,a)},DEFAULT_CONFIG:{isLoadJs:true,isLoadCss:true,isLoadHtml:true,version:4.2,initNodeClass:".loginClass",mstPageId:dj.context.account.loginOverlayPageId,domNodeId:"loginDivId",scrimManagerFile:"/static_html_files/account/accountScrimManager.html",height:dj.context.account.loginOverlayHeight,width:dj.context.account.loginOverlayWidth,isMobile:false},init:function(){window.console&&console.log("this._cfg.initNodeClass "+this._cfg.initNodeClass);dojo.query(this._cfg.initNodeClass).connect("click",this,function(a){dojo.stopEvent(a);this.redirectIfMobileUser()})},initLoginScrimInIframe:function(){this.initIframeLoader(this._cfg.height,this._cfg.width)},isGermanyProduct:function(){if(dj.util.Region.getViewByRegion()==="germany")return true;return false},redirectIfMobileUser:function(){var a=this;navigator.userAgent.search(/Mobile/i)>-1&&!a.isGermanyProduct()?dojo.xhrGet({url:"/static_html_files/mobile/mobileDevices.json",headers:{Accept:"application/json"},handleAs:"json",load:function(b){if(b.hasOwnProperty("deviceList"))for(var c in b.deviceList){device=b.deviceList[c];if(RegExp(device.OS,"i").test(navigator.userAgent)){a._cfg.isMobile=true;break}}},error:function(b,c){console.error("HTTP status code: ",c.xhr.status)}}).then(function(){if(a._cfg.isMobile)window.location=dj.context.core.secureLoginPrefix+"/content/public/page/login-mobile.html";else a.initIframeLoader(a._cfg.height,a._cfg.width)},function(b){console.log("errror"+
b)}):this.initIframeLoader(this._cfg.height,this._cfg.width)}});dojo.provide("dj.widget.loader.LoaderInstanceFactory");dj.widget.loader.LoaderInstanceFactory={intializeLoader:function(){if(dj.module.loader==null||typeof dj.module.loader=="undefined")dj.module.loader={}},getLoginLoaderInstance:function(a){this.intializeLoader();if(typeof dj.module.loader.loginLoaderObj=="undefined"||dj.module.loader.loginLoaderObj==null){var b={};if(typeof a!="undefined")b={isLoadJs:a.isLoadJs,version:a.version};dj.module.loader.loginLoaderObj=new dj.widget.loader.LoginLoader(b);dj.module.loader.loginLoaderObj.addToAccountInstanceArr(dj.module.loader.loginLoaderObj)}return dj.module.loader.loginLoaderObj},getRegistrationLoaderInstance:function(){this.intializeLoader();if(typeof dj.module.loader.registrationLoaderObj=="undefined"||dj.module.loader.registrationLoaderObj==null){dj.module.loader.registrationLoaderObj=new dj.widget.loader.RegistrationLoader;dj.module.loader.registrationLoaderObj.addToAccountInstanceArr(dj.module.loader.registrationLoaderObj)}return dj.module.loader.registrationLoaderObj},getForgotUserOrPswdLoaderInstance:function(a){this.intializeLoader();if(typeof dj.module.loader.forgotUserOrPswdLoaderObj=="undefined"||dj.module.loader.forgotUserOrPswdLoaderObj==null){dj.module.loader.forgotUserOrPswdLoaderObj=new dj.widget.loader.ForgotUserOrPswdLoader;dj.module.loader.forgotUserOrPswdLoaderObj.addToAccountInstanceArr(dj.module.loader.forgotUserOrPswdLoaderObj)}dj.module.loader.forgotUserOrPswdLoaderObj.setUserdata(a);return dj.module.loader.forgotUserOrPswdLoaderObj},getForgotPasswordLoaderInstance:function(a){this.intializeLoader();if(typeof dj.module.loader.forgotPasswordLoaderObj=="undefined"||dj.module.loader.forgotPasswordLoaderObj==null){dj.module.loader.forgotPasswordLoaderObj=new dj.widget.loader.ForgotPasswordLoader;dj.module.loader.forgotPasswordLoaderObj.addToAccountInstanceArr(dj.module.loader.forgotPasswordLoaderObj)}dj.module.loader.forgotPasswordLoaderObj.setUserdata(a);return dj.module.loader.forgotPasswordLoaderObj},getFBInitLoaderInstance:function(a){this.intializeLoader();if(typeof dj.module.loader.fbInitLoaderObj=="undefined"||dj.module.loader.fbInitLoaderObj==null){dj.module.loader.fbInitLoaderObj=new dj.widget.loader.FBInitLoader(a);dj.module.loader.fbInitLoaderObj.loadpageFragObj.addToAccountInstanceArr(dj.module.loader.fbInitLoaderObj)}return dj.module.loader.fbInitLoaderObj},getLoginVerifyEmailLoaderInstance:function(a){this.intializeLoader();if(typeof dj.module.loader.loginVerifyEmailLoaderObj=="undefined"||dj.module.loader.loginVerifyEmailLoaderObj==null){dj.module.loader.loginVerifyEmailLoaderObj=new dj.widget.loader.LoginVerifyEmailLoader;dj.module.loader.loginVerifyEmailLoaderObj.addToAccountInstanceArr(dj.module.loader.loginVerifyEmailLoaderObj)}dj.module.loader.loginVerifyEmailLoaderObj.setUserdata(a);return dj.module.loader.loginVerifyEmailLoaderObj},getUnverifiedFreeRegLoaderInstance:function(a){this.intializeLoader();if(typeof dj.module.loader.unverifiedFreeRegLoaderObj=="undefined"||dj.module.loader.unverifiedFreeRegLoaderObj==null){dj.module.loader.unverifiedFreeRegLoaderObj=new dj.widget.loader.UnverifiedFreeRegLoader;dj.module.loader.unverifiedFreeRegLoaderObj.addToAccountInstanceArr(dj.module.loader.unverifiedFreeRegLoaderObj)}dj.module.loader.unverifiedFreeRegLoaderObj.setUserdata(a);return dj.module.loader.unverifiedFreeRegLoaderObj},getFbLoginOrWSJPswdLoaderInstance:function(a){this.intializeLoader();if(typeof dj.module.loader.fbLoginOrWSJPswdLoaderObj=="undefined"||dj.module.loader.fbLoginOrWSJPswdLoaderObj==null){dj.module.loader.fbLoginOrWSJPswdLoaderObj=new dj.widget.loader.FbLoginOrWSJPswdLoader;dj.module.loader.fbLoginOrWSJPswdLoaderObj.addToAccountInstanceArr(dj.module.loader.fbLoginOrWSJPswdLoaderObj)}dj.module.loader.fbLoginOrWSJPswdLoaderObj.setUserdata(a);return dj.module.loader.fbLoginOrWSJPswdLoaderObj},getThankYouLoaderInstance:function(a){this.intializeLoader();if(typeof dj.module.loader.thankYouLoaderObj=="undefined"||dj.module.loader.thankYouLoaderObj==null){dj.module.loader.thankYouLoaderObj=new dj.widget.loader.ThankYouLoader;dj.module.loader.thankYouLoaderObj.addToAccountInstanceArr(dj.module.loader.thankYouLoaderObj)}dj.module.loader.thankYouLoaderObj.setUserdata(a);return dj.module.loader.thankYouLoaderObj},getUserWithourEmailConfirmationLoaderInstance:function(a){this.intializeLoader();if(typeof dj.module.loader.userWithourEmailConfirmationLoaderObj=="undefined"||dj.module.loader.userWithourEmailConfirmationLoaderObj==null){dj.module.loader.userWithourEmailConfirmationLoaderObj=new dj.widget.loader.UserWithourEmailConfirmationLoader;dj.module.loader.userWithourEmailConfirmationLoaderObj.addToAccountInstanceArr(dj.module.loader.userWithourEmailConfirmationLoaderObj)}dj.module.loader.userWithourEmailConfirmationLoaderObj.setUserdata(a);return dj.module.loader.userWithourEmailConfirmationLoaderObj},getFBConnectedLoaderInstance:function(a){this.intializeLoader();if(typeof dj.module.loader.fbConnectedLoaderObj=="undefined"||dj.module.loader.fbConnectedLoaderObj==null){dj.module.loader.fbConnectedLoaderObj=new dj.widget.loader.FBConnectedLoader({isLoadJs:a.isLoadJs,version:a.version});dj.module.loader.fbConnectedLoaderObj.addToAccountInstanceArr(dj.module.loader.fbConnectedLoaderObj)}return dj.module.loader.fbConnectedLoaderObj},getConfirmationLoaderInstance:function(a){this.intializeLoader();if(typeof a!="undefined")if(a.confScreenName==="LoginVerifyEmail"){dojo.require("dj.widget.loader.LoginVerifyEmailConfirmationLoader");if(typeof dj.module.loader.loginVerifyEmailConfirmationLoaderObj=="undefined"||dj.module.loader.loginVerifyEmailConfirmationLoaderObj==null){dj.module.loader.loginVerifyEmailConfirmationLoaderObj=new dj.widget.loader.LoginVerifyEmailConfirmationLoader(a);dj.module.loader.loginVerifyEmailConfirmationLoaderObj.addToAccountInstanceArr(dj.module.loader.loginVerifyEmailConfirmationLoaderObj)}dj.module.loader.loginVerifyEmailConfirmationLoaderObj.setUserdata(a);return dj.module.loader.loginVerifyEmailConfirmationLoaderObj}else if(a.confScreenName==="FbLoginOrWSJPswd"){dojo.require("dj.widget.loader.FbLoginOrWSJPswdConfirmationLoader");if(typeof dj.module.loader.fbLoginOrWSJPswdConfirmationLoaderObj=="undefined"||dj.module.loader.fbLoginOrWSJPswdConfirmationLoaderObj==null){dj.module.loader.fbLoginOrWSJPswdConfirmationLoaderObj=new dj.widget.loader.FbLoginOrWSJPswdConfirmationLoader(a);dj.module.loader.fbLoginOrWSJPswdConfirmationLoaderObj.addToAccountInstanceArr(dj.module.loader.fbLoginOrWSJPswdConfirmationLoaderObj)}dj.module.loader.fbLoginOrWSJPswdConfirmationLoaderObj.setUserdata(a);return dj.module.loader.fbLoginOrWSJPswdConfirmationLoaderObj}else if(a.confScreenName==="ForgotUsername"){dojo.require("dj.widget.loader.ForgotUsernameConfirmationLoader");if(typeof dj.module.loader.forgotUsernameConfirmationLoaderObj=="undefined"||dj.module.loader.forgotUsernameConfirmationLoaderObj==null){dj.module.loader.forgotUsernameConfirmationLoaderObj=new dj.widget.loader.ForgotUsernameConfirmationLoader(a);dj.module.loader.forgotUsernameConfirmationLoaderObj.addToAccountInstanceArr(dj.module.loader.forgotUsernameConfirmationLoaderObj)}dj.module.loader.forgotUsernameConfirmationLoaderObj.setUserdata(a);return dj.module.loader.forgotUsernameConfirmationLoaderObj}else if(a.confScreenName==="ForgotPassword"){dojo.require("dj.widget.loader.ForgotPasswordConfirmationLoader");if(typeof dj.module.loader.forgotPasswordConfirmationLoaderObj=="undefined"||dj.module.loader.forgotPasswordConfirmationLoaderObj==null){dj.module.loader.forgotPasswordConfirmationLoaderObj=new dj.widget.loader.ForgotPasswordConfirmationLoader(a);dj.module.loader.forgotPasswordConfirmationLoaderObj.addToAccountInstanceArr(dj.module.loader.forgotPasswordConfirmationLoaderObj)}dj.module.loader.forgotPasswordConfirmationLoaderObj.setUserdata(a);return dj.module.loader.forgotPasswordConfirmationLoaderObj}else if(a.confScreenName==="UnverifiedFreeReg"){dojo.require("dj.widget.loader.UnverifiedFreeRegConfirmationLoader");if(typeof dj.module.loader.unverifiedFreeRegConfirmationLoaderObj=="undefined"||dj.module.loader.unverifiedFreeRegConfirmationLoaderObj==null){dj.module.loader.unverifiedFreeRegConfirmationLoaderObj=new dj.widget.loader.UnverifiedFreeRegConfirmationLoader(a);dj.module.loader.unverifiedFreeRegConfirmationLoaderObj.addToAccountInstanceArr(dj.module.loader.unverifiedFreeRegConfirmationLoaderObj)}dj.module.loader.unverifiedFreeRegConfirmationLoaderObj.setUserdata(a);return dj.module.loader.unverifiedFreeRegConfirmationLoaderObj}}};dojo.provide("dj.widget.loader.RegistrationLoader");dojo.require("dj.widget.loader.LoadPageFragment");dojo.require("dj.widget.loader.LoaderInstanceFactory");dojo.declare("dj.widget.loader.RegistrationLoader",dj.widget.loader.LoadPageFragment,{constructor:function(a){this._cfg=dojo.mixin(this.DEFAULT_CONFIG,a)},DEFAULT_CONFIG:{isLoadJs:true,isLoadCss:true,isLoadHtml:true,version:13.2,initNodeClass:".registerUserClass",mstPageId:dj.context.account.registrationOverlayPageId,domNodeId:"registrationDivId",scrimManagerFile:"/static_html_files/account/accountScrimManager.html",height:dj.context.account.registrationOverlayHeight,width:dj.context.account.registrationOverlayWidth},init:function(){window.console&&console.log("this._cfg.initNodeClass in reg "+this._cfg.initNodeClass);dojo.query(this._cfg.initNodeClass).connect("click",this,function(){this.initIframeLoader(this._cfg.height,this._cfg.width)})},initRegisterScrimInIframe:function(){this.initIframeLoader(this._cfg.height,this._cfg.width)},loadRegistrationRelatedScrims:function(){dj.widget.loader.LoaderInstanceFactory.getThankYouLoaderInstance(this._cfg).initHiddenScrim()}});dojo.provide("dj.widget.loader.FBLoginLoader");dojo.require("dj.widget.loader.LoadPageFragment");dojo.require("dj.widget.loader.LoaderInstanceFactory");dojo.require("dj.widget.loader.FBConnectedLoader");dojo.declare("dj.widget.loader.FBLoginLoader",dj.widget.loader.LoadPageFragment,{constructor:function(a){this._cfg=dojo.mixin(this.DEFAULT_CONFIG,a)},DEFAULT_CONFIG:{isLoadJs:true,isLoadCss:true,isLoadHtml:true,version:4.2,initNodeClass:".connectwithfb",mstPageId:dj.context.account.fbLoginPageId,domNodeId:"fbLoginDivId",scrimManagerFile:"/static_html_files/account/accountScrimManager.html",height:"660px",width:"678px"},init:function(){this.initIframeLoader(this._cfg.height,this._cfg.width)},loadFBRegistrationRelatedScrims:function(){dj.widget.loader.LoaderInstanceFactory.getFBConnectedLoaderInstance(this._cfg).initHiddenScrim()}});dojo.provide("dj.widget.accountscrim.BaseScrim");dojo.require("dj.util.Form");dojo.require("dj.widget.loader.LoaderInstanceFactory");dojo.require("dj.widget.loader.ForgotUserOrPswdLoader");dojo.require("dj.widget.loader.ForgotPasswordLoader");dojo.require("dj.widget.loader.FBInitLoader");dojo.require("dj.widget.loader.RegistrationLoader");dojo.require("dj.util.Url");dojo.declare("dj.widget.accountscrim.BaseScrim",null,{constructor:function(a){this._cfg=dojo.mixin(this.DEFAULT_CONFIG,a);this.PRODUCT_CD=dj.context.account.productCd;this.queryStringList={};this.getGreyBckgroundCSSDiv="getGreyBckgroundCSSDiv";this._constants=this.CONSTANTS;this.successFileUrl=this.getQueryStrParam("successFileUrl");this.currentPageUrl=this.getQueryStrParam("currentPageUrl");this.userdata=this.getQueryStrParam("userdata");this.userdata=dojo.fromJson(this.userdata);this.omniturePrefix=dj.context.account&&dj.context.account.omniturePrefix?dj.context.account.omniturePrefix:"WSJ";this.checkIfMobileUser()},DEFAULT_CONFIG:{},CONSTANTS:{FORGOT_USERNAME_SCREEN:"ForgotUsername",FORGOT_PASSWORD_SCREEN:"ForgotPassword",FB_LOGIN_OR_WSJ_PSWD_SCREEN:"FbLoginOrWSJPswd",UNVERIFIED_FREE_REG:"UnverifiedFreeReg",LOGIN_VERIFY_EMAIL_SCREEN:"LoginVerifyEmail",FORGOT_USERNAME_CONF_SCREEN:"ForgotUsernameConfirmation",FORGOT_PASSWORD_CONF_SCREEN:"ForgotPasswordConfirmation",FB_LOGIN_OR_WSJ_PSWD_CONF_SCREEN:"FbLoginOrWSJPswdConfirmation",UNVERIFIED_FREE_CONF_REG:"UnverifiedFreeRegConfirmation",LOGIN_VERIFY_EMAIL_CONF_SCREEN:"LoginVerifyEmailConfirmation",USER_WITHOUT_EMAIL:"UserWithoutEmail",LOGIN_SCREEN:"Login",SCRIMS_OK_CLOSE_BTN_CLASS:".accountScrimOkOrCloseBtnClass"},checkIfMobileUser:function(){if(typeof dj.context.mobile!=="undefined"){dj.context.account.forgotUserOrPswdPageUrl=dj.context.mobile.forgotUserOrPswdPageUrl;dj.context.account.forgotUsernameConfPageUrl=dj.context.mobile.forgotUsernameConfPageUrl;dj.context.account.forgotPasswordPageUrl=dj.context.mobile.forgotPasswordPageUrl;dj.context.account.forgotPasswordConfPageUrl=dj.context.mobile.forgotPasswordConfPageUrl;dj.context.account.resetPasswordPageUrl=dj.context.mobile.resetPasswordPageUrl}},hideErrorMessages:function(){dojo.addClass(dojo.byId(this._nodes.errorUl),this._nodes.hiddenClass)},hideScrim:function(a){if(typeof this._nodes.isStandalonePage=="undefined"||!this._nodes.isStandalonePage)dojo.byId(a)!=null&&dojo.addClass(dojo.byId(a),this._nodes.hiddenClass)},displayScrim:function(a,b){if(typeof this._nodes.isStandalonePage=="undefined"||!this._nodes.isStandalonePage){typeof b!="undefined"&&b&&this.fadeScrim(a);dojo.byId(a)!=null&&dojo.removeClass(dojo.byId(a),this._nodes.hiddenClass)}},showErrorMessage:function(a,b){var c="";if(b.length>0){dojo.forEach(b,function(e){c+=dojo.byId(e).innerHTML},this);var d=dojo.byId(a);d.innerHTML=c;dojo.removeClass(d,this._nodes.hiddenClass);if(typeof this._nodes.isIframe!="undefined"&&this._nodes.isIframe){dojo.removeClass(dojo.byId(this._nodes.iframeErrorOverlayDiv),this._nodes.hiddenClass);dojo.connect(dojo.byId(this._nodes.goBackToIframeFrmErr),"click",this,function(){dojo.addClass(dojo.byId(this._nodes.iframeErrorOverlayDiv),this._nodes.hiddenClass)})}}},addErrorClass:function(a){dojo.addClass(dojo.byId(a),this._nodes.fieldErrorClass)},connectForgotPasswordFromIframe:function(a){dojo.query(this._nodes.gotoForgotPasswordFromIframe).connect("click",this,function(b){dojo.stopEvent(b);if(this._nodes.isStandalonePage)window.location=typeof a=="undefined"?this._nodes.pageUrls.forgotPasswordPageUrl:this._nodes.pageUrls.forgotPasswordPageUrl+"?userEmailId="+a;else if(this.chkIfHttpsDomain())parent.location=dj.context.account.forgotPasswordPageUrl;else this.initForgotPasswordFromIframe(a)})},connectForgotUsernameFromIframe:function(a){dojo.query(this._nodes.gotoForgotUsernameFromIframe).connect("click",this,function(b){dojo.stopEvent(b);if(this._nodes.isStandalonePage)window.location=typeof a=="undefined"?this._nodes.pageUrls.forgotUserOrPswdPageUrl:this._nodes.pageUrls.forgotUserOrPswdPageUrl+"?userEmailId="+a;else this.initForgotUsernameFromIframe(a)})},connectForgotUsername:function(){dojo.query(this._nodes.gotoForgotUsername).connect("click",this,function(a){dojo.stopEvent(a);if(this._nodes.isStandalonePage)window.location=this._nodes.pageUrls.forgotUserOrPswdPageUrl;else this.initForgotUserOrPswd()})},connectForgotPassword:function(){dojo.query(this._nodes.gotoForgotPassword).connect("click",this,function(a){dojo.stopEvent(a);if(this._nodes.isStandalonePage)window.location=this._nodes.pageUrls.forgotPasswordPageUrl;else this.initForgotPassword()})},initForgotUserOrPswd:function(){this.hideScrim(this.domNodeId);dj.widget.loader.LoaderInstanceFactory.getForgotUserOrPswdLoaderInstance(this._cfg).initScrim()},initForgotPassword:function(){this.hideScrim(this.domNodeId);dj.widget.loader.LoaderInstanceFactory.getForgotPasswordLoaderInstance(this._cfg).initScrim()},initConfirmation:function(a){this.hideScrim(this.domNodeId);dj.widget.loader.LoaderInstanceFactory.getConfirmationLoaderInstance(a).initScrim()},initConfirmationFromIframe:function(a){if((a.confScreenName=="LoginVerifyEmail"||a.confScreenName=="ForgotPassword")&&this.chkIfHttpsDomain())this.successFileUrl="/content/javascript/account/accountScrimManager.html";document.location=this.successFileUrl+"?userdata="+dojo.toJson(a)},initLoginScrim:function(){if(this.domNodeId!=null&&dojo.byId(this.domNodeId)!=null){this.hideScrim(this.domNodeId);dj.widget.loader.LoaderInstanceFactory.getLoginLoaderInstance(this._cfg).initLoginScrimInIframe()}},initRegistration:function(){dj.widget.loader.LoaderInstanceFactory.getRegistrationLoaderInstance(this._cfg).initRegisterScrimInIframe()},initForgotUsernameFromIframe:function(a){if(typeof a=="undefined")a="";document.location=this.successFileUrl+"?userdata="+dojo.toJson({screenName:this._constants.FORGOT_USERNAME_SCREEN,userEmail:a})},initLoginFromIframe:function(){document.location=this.successFileUrl+"?userdata="+dojo.toJson({screenName:this._constants.LOGIN_SCREEN})},initForgotPasswordFromIframe:function(a){if(typeof a=="undefined")a="";document.location=this.successFileUrl+"?userdata="+dojo.toJson({screenName:this._constants.FORGOT_PASSWORD_SCREEN,userEmail:a})},initRegistrationFromIframe:function(){document.location=this.successFileUrl+"?userdata="+dojo.toJson({screenName:"Registration"})},moveOutOfIframe:function(a){if(this._nodes.isStandalonePage||this.chkIfHttpsDomain())parent.dj.widget.loader.ScrimLoaders.callBackFromIframe(dojo.toJson(a));else if(typeof a.refreshPageUrl!="undefined")parent.location=decodeURIComponent(a.refreshPageUrl);else document.location=this.successFileUrl+"?userdata="+dojo.toJson(a)},isChkEnter:function(a){if((a.keyCode||a.which)==dojo.keys.ENTER)return true;return false},isChkBackSpace:function(a){if((a.keyCode||a.which)==dojo.keys.BACKSPACE)return true;return false},initConnectWithFbNoIframe:function(){dojo.query(this._nodes.connectFB).connect("click",this,function(){this.hideScrim(this.domNodeId);dj.widget.loader.LoaderInstanceFactory.getFBInitLoaderInstance(this._cfg).initScrim()})},initConnectWithFB:function(){this.moveOutOfIframe({cfg:this._cfg,screenName:"FBInit"})},makeFBConnections:function(a){this.makeFBWhatsThisConnection();dojo.query(this._nodes.connectFB).connect("click",this,function(){this.initConnectWithFB(a)})},makeFBConnectionsNoIframe:function(){this.makeFBWhatsThisConnection();this.initConnectWithFbNoIframe()},makeFBWhatsThisConnection:function(){dojo.query(this._nodes.whatsThisFbClass).connect("click",this,function(a){dojo.stopEvent(a);dojo.removeClass(dojo.query(this._nodes.fbToolTipClass)[0],this._nodes.hiddenClass)});dojo.query(this._nodes.fbToolTipCloseClass).connect("click",this,function(a){dojo.stopEvent(a);dojo.addClass(dojo.query(this._nodes.fbToolTipClass)[0],this._nodes.hiddenClass)})},makeCloseOrOKButtonConnection:function(a){dojo.query(this._constants.SCRIMS_OK_CLOSE_BTN_CLASS).connect("click",this,function(b){this.closeNDestroyGreyBckground(a,b)})},closeNDestroyGreyBckground:function(a,b){dojo.stopEvent(b);typeof a!="undefined"&&dojo.byId(a)!=null&&this.hideScrim(a);this.destroyGreyBckground();this.destroyAccountInstanceArr()},destroyGreyBckground:function(){dojo.destroy(this.getGreyBckgroundCSSDiv)},makeCloseOrOKButtonConnectionFromIframe:function(){dojo.query(this._constants.SCRIMS_OK_CLOSE_BTN_CLASS).connect("click",this,function(){this.closeFromIframe()})},closeFromIframe:function(){this.destroyAccountInstanceArr();this.moveOutOfIframe({close:"close"})},hideErrorNPassIndGreen:function(a){dojo.addClass(this._nodes.errorUl,this._nodes.hiddenClass);this.updatePasswordInd(a,this._nodes.passIndClassGreen)},chkEmpty:function(a){if(typeof a!="undefined")return dj.lang.trim(a)===""?false:true;return false},updatePasswordInd:function(a,b){dojo.byId(a).className=b},isValidEmailAddress:function(a){return dj.util.Form.validateEmailAddresses(a)},chkEmailAddress:function(a){if(this.chkEmpty(a)){if(!this.isValidEmailAddress(a)){this.errorArr.push(this._nodes.invalidemailFormat);return false}}else{this.errorArr.push(this._nodes.emailIdrequired);return false}return true},chkPasswordLength:function(a,b){if(typeof a!="undefined"){var c=a.value;if(typeof c!="undefined")if(dj.lang.trim(c).length<5)dojo.indexOf(this.errorArr,this._nodes.passwordTooShort)<0&&this.errorArr.push(this._nodes.passwordTooShort);else if(dj.lang.trim(c).length>15)dojo.indexOf(this.errorArr,this._nodes.passwordTooLong)<0&&this.errorArr.push(this._nodes.passwordTooLong);else{this.updatePasswordInd(b,this._nodes.passIndClassGreen);return true}}this.updatePasswordInd(b,this._nodes.passIndClassRed);return false},chkPasswordMatch:function(a,b){if(typeof a!="undefined"&&typeof b!="undefined")if(typeof a.value!="undefined"&&typeof b.value!="undefined")if(dj.lang.trim(a.value)===dj.lang.trim(b.value)){this.hideErrorNPassIndGreen(this._nodes.newPassInd);this.hideErrorNPassIndGreen(this._nodes.confirmPassInd);return true}this.updatePasswordInd(this._nodes.confirmPassInd,this._nodes.passIndClassRed);this.errorArr.push(this._nodes.passwordDoNotMatch);return false},validateNewPassword:function(){var a=true;if(this.chkEmpty(this.oNewPassword.value))if(this.chkPasswordLength(this.oNewPassword,this._nodes.newPassInd,this._nodes.errorUl))this.chkPasswordSplChars(this.oNewPassword,this._nodes.newPassInd,this._nodes.errorUl)||(a=false);else a=false;else{dojo.indexOf(this.errorArr,this._nodes.newPasswordRequired)<0&&this.errorArr.push(this._nodes.newPasswordRequired);this.updatePasswordInd(this._nodes.newPassInd,this._nodes.passIndClassRed);a=false}a&&this.hideErrorNPassIndGreen(this._nodes.newPassInd);return a},validateConfirmPassword:function(){var a=true;if(this.chkEmpty(this.oConfirmPassword.value))if(this.chkPasswordLength(this.oConfirmPassword,this._nodes.confirmPassInd,this._nodes.errorUl))this.chkPasswordSplChars(this.oConfirmPassword,this._nodes.confirmPassInd,this._nodes.errorUl)||(a=false);else a=false;else{dojo.indexOf(this.errorArr,this._nodes.confirmPasswordRequired)<0&&this.errorArr.push(this._nodes.confirmPasswordRequired);this.updatePasswordInd(this._nodes.confirmPassInd,this._nodes.passIndClassRed);a=false}a&&this.hideErrorNPassIndGreen(this._nodes.confirmPassInd);return a},initForgotPasswordPage:function(){dojo.byId(this._nodes.userEmailId);document.location=this._nodes.pageUrls.forgotPasswordPageUrl},getQueryStrParam:function(a,b){if(typeof this.queryStringList[a]=="undefined"){var c="";c=typeof b=="undefined"?window.location.toString():b.toString();c.match(/\?(.+)$/);c=RegExp.$1;c=c.split("&");for(var d=0;d<c.length;d++){var e=c[d].split("=");this.queryStringList[e[0]]=unescape(e[1])}}return this.queryStringList[a]},hideFormFactor:function(a){a=dojo.query(a);a.length>0&&dojo.addClass(a[0],"hidden");a=dojo.query(".lnColl");a.length>0&&dojo.addClass(a[0],"hidden");a=dojo.query(".custNav");a.length>0&&dojo.addClass(a[0],"hidden")},fadeScrim:function(a,b){var c=500;if(b)c=b;dojo.style(a,"opacity","0");dojo.fadeIn({node:a,duration:c}).play()},getPageUrl:function(){var a=this._cfg.NONSUBSCRIBER_HOMEPAGE_PID,b=this._cfg.NONSUBSCRIBER_SEARCH_PAGE_PID,c=this._cfg.NONSUBSCRIBER_NEWSLETTERS_ALERTS_PAGE_PID,d=this._cfg.MDC_PAGE_PID,e;e=typeof gcDomain!=="undefined"&&gcDomain!==null&&gcDomain!==""?"http://"+gcDomain:"http://"+document.domain;var f;var g=f=parent.window.location.href;if(typeof pID!=="undefined"){g=this._nodes.isStandalonePage?e+this._cfg.HOMEPAGE_SUBSCRIBER_URL:pID===a?e+this._cfg.HOMEPAGE_SUBSCRIBER_URL:pID===c?e+"/email":pID===b?e+this._cfg.SEARCH_PAGE_SUBSCRIBER_URL:pID===d?e+this._cfg.MDC_LINK_URL:f;a=g.indexOf("?")!=-1?"&":"?";if(typeof a!==undefined){a=a+"_nocache="+(new Date).getTime();if(g.indexOf("#")!=-1)g=g.replace("#",a+"#");else g+=a}}return g},chkPasswordSplChars:function(a,b){if(typeof a!="undefined"){var c=a.value;if(typeof c!="undefined"){for(var d=true,e=0;e<c.length;e++)if("!@#$%^&*()+=-[]\\';,./{}|\":<>?~_ ".indexOf(c.charAt(e))!=-1)d=false;if(d){this.updatePasswordInd(b,this._nodes.passIndClassGreen);return true}else dojo.indexOf(this.errorArr,this._nodes.invalidCharacters)<0&&this.errorArr.push(this._nodes.invalidCharacters)}}this.updatePasswordInd(b,this._nodes.passIndClassRed);return false},resizeIframe:function(){if(dojo.byId("moduleiframe")!=null&&typeof dojo.byId("moduleiframe")!="undefined"){var a=dojo.query(".loginModule")[0].clientHeight?dojo.query(".loginModule")[0].clientHeight:0;if(a!=0)dojo.byId("moduleiframe").style.height=a}},addClassToBody:function(){dojo.addClass(dojo.body(),"loginForm_content")},chkIfHttpsDomain:function(){try{if(typeof parent.window.location.href!="undefined"&&parent.window.location.href.indexOf("https://")>-1)return true;return false}catch(a){return false}},lifpOmnitureTracking:function(a,b,c){setMetaData("pagename",c);c=c.replace(this.omniturePrefix,"");setMetaData("apage",this.omniturePrefix+"_Customer Resources_"+
c);setMetaData("atype",this.omniturePrefix+"_Customer Resourcess_"+c);setMetaData("section","Customer Resources");setMetaData("subsection",this.omniturePrefix+"_Login");setMetaData("csource","Customer Resources");setMetaData("ctype","marketing and support");setMetaData("basesection",this.omniturePrefix+"_Customer Resources_Login");if(typeof a!="undefined"&&a.length>0)for(index=0;index<a.length;index++)setMetaData(a[index][0],a[index][1]);if(typeof b!="undefined")s.events=b;typeof dj.context.core!=="undefined"&&typeof dj.context.core.urlPrefix!=="undefined"&&dj.context.core.urlPrefix.indexOf("wallstreetjournal.de")!==-1?dj.util.Tracking.omniture.firePixel(true,"WSJDE_"):dj.util.Tracking.omniture.firePixel(true)},destroyIframe:function(){parent.dojo.destroy("moduleiframe");parent.dojo.destroy("overlayDiv")},destroyAccountInstanceArr:function(){if(typeof dj.module.loader!="undefined"&&typeof dj.module.loader.accountInstanceArr!="undefined"){for(;dj.module.loader.accountInstanceArr.length!=0;){var a=dj.module.loader.accountInstanceArr.pop();typeof a!="undefined"&&typeof a.destroyObject!="undefined"&&typeof a.destroyObject=="function"&&a.destroyObject()}if(dj.module.loader.accountInstanceArr.length==0){dj.module.loader.accountInstanceArr={};dj.module.loader={}}}},logoutTheUnverifiedFreeRegUser:function(){this.destroyAccountInstanceArr();this.moveOutOfIframe({logout:"logout"})},submitTowerStreamForm:function(){var a="wsj/wsjwifi";if(this._nodes.towerUsername&&this._nodes.towerUsername!="")a=this._nodes.towerUsername;var b="laiZeis6";if(this._nodes.towerPassword&&this._nodes.towerPassword!="")b=this._nodes.towerPassword;if(this._nodes.towerStreamUrl&&this._nodes.towerStreamUrl!="")document.towerWifiForm.action=this._nodes.towerStreamUrl;if(this._nodes.towerIP&&this._nodes.towerIP!="")document.towerWifiForm.ip.value=this._nodes.towerIP;document.towerWifiForm.username.value=a;document.towerWifiForm.password.value=b;document.towerWifiForm.submit()}});dojo.provide("dj.widget.accountscrim.FBConnected");dojo.require("dj.widget.accountscrim.BaseScrim");dojo.require("dj.util.User");dojo.declare("dj.widget.accountscrim.FBConnected",dj.widget.accountscrim.BaseScrim,{constructor:function(a){this._cfg=dojo.mixin(this.DEFAULT_CONFIG,a);this.fragmentLoaded=false;this._nodes=this.WIDGET_CONFIG;this.errorArr=[]},DEFAULT_CONFIG:{isLoadJs:true,version:4.3,NONSUBSCRIBER_HOMEPAGE_PID:"0_0_WH_0001_public",NONSUBSCRIBER_SEARCH_PAGE_PID:"3_0466",NONSUBSCRIBER_NEWSLETTERS_ALERTS_PAGE_PID:"5_6007",MDC_PAGE_PID:"2_3000",HOMEPAGE_SUBSCRIBER_URL:"/",SEARCH_PAGE_SUBSCRIBER_URL:"/search",MDC_LINK_URL:"/mdc/page/marketsdata.html"},WIDGET_CONFIG:{closeButton:".closeBtn",tryagain:".tryagian",hiddenClass:"hidden"},init:function(a,b){this.displayScrim(a,b);this.domNodeId=a;this.makeWidgetConnections();if(typeof dj.module.facebook!="undefined"&&typeof dj.module.facebook.connect!="undefined")typeof FB=="undefined"?dj.module.facebook.connect.init(this.updateUserInfo):this.updateUserInfo();else window.console&&console.warn(" In {FBConnected.js} dj.module.facebook.connect is not found, please make the required js file available")},setOmnitureTracking:function(){var a=[],b="";b=this.omniturePrefix+"_Auth_FBConnect_Thank_You_Original";dj.util.User.isSubLoggedIn(function(c){a[0]=c?["caccess","sub"]:["caccess","reg"]});this.lifpOmnitureTracking(a,"event12,evenr57",b)},showScrim:function(a,b){this.domNodeId=a;this.displayScrim(a,b);this.setOmnitureTracking()},makeWidgetConnections:function(){this.makeCloseOrOKButtonConnection(this.domNodeId);dojo.query(".login_invite").connect("click",this,function(a){this.closeNDestroyGreyBckground(this.domNodeId,a);FB.ui({method:"apprequests",message:"You should learn more about this awesome game.",data:"tracking information for the user"})})},updateUserInfo:function(){typeof FB!="undefined"&&FB.api("/me",function(a){if(!(!a||a.error))dojo.byId("name").innerHTML=a.first_name+" "+a.last_name})}});dojo.provide("dj.widget.accountscrim.Registration");dojo.require("dj.widget.accountscrim.BaseScrim");dojo.require("dj.util.Form");dojo.require("dj.service.account.RegistrationService");dojo.declare("dj.widget.accountscrim.Registration",dj.widget.accountscrim.BaseScrim,{constructor:function(a){this._cfg=dojo.mixin(this.DEFAULT_CONFIG,a);this.fragmentLoaded=false;this._nodes=this.WIDGET_CONFIG;this.errorArr=[]},DEFAULT_CONFIG:{isLoadJs:true,version:4.2},WIDGET_CONFIG:{serviceUrls:{registrationServiceUrl:"/epiton/registration/v2/profile",loginServiceUrl:"/auth/submitlogin.json"},closeButton:"registrationClose",firstName:"firstName",lastName:"lastName",emailToRegister:"emailToRegister",newPassword:"newPassword",confirmPassword:"confirmPassword",companySize:"companySize",registerNow:"registerNow",newPassInd:"newPassInd",confirmPassInd:"confirmPassInd",jobTitleDropDown:"jobTitleDropDown",passIndClassRed:"validate no",passIndClassGreen:"validate yes",hiddenClass:"hidden",gotoLogin:".loginClass",gotoForgotPasswordFromIframe:".forgotPasswordFromIframeClass",registrationIframeForm:"registrationIframeForm",errorUl:"registrationErrorUl",goBackToIframeFrmErr:"goBackToIframeFrmErr",fieldErrorClass:"errorState",isIframe:false,iframeErrorOverlayDiv:"iframeErrorOverlayDiv",firstNameRequired:"firstNameRequired",lastNameRequired:"lastNameRequired",invalidemailFormat:"invalidemailFormat",emailIdrequired:"emailIdrequired",newPasswordRequired:"newPasswordRequired",confirmPasswordRequired:"confirmPasswordRequired",privacyPolicyRequired:"privacyPolicyRequired",passwordTooShort:"passwordTooShort",passwordTooLong:"passwordTooLong",invalidCharacters:"invalidCharacters",passwordDoNotMatch:"passwordDoNotMatch",passwordSuggestion:".pw_suggestion",passwordSuggestionClose:".pw_tooltip",generalError:"generalError",emailAddressexists:"emailAddressexists",emailAddressinvalid:"emailAddressinvalid",connectFB:".connectwithfb",whatsThisFbClass:".whatsThisFbClass",fbToolTipClass:".fb_tooltip",fbToolTipCloseClass:".fb-close-tooltip-btn"},init:function(a){this.addClassToBody();this.successFileUrl=this.getQueryStrParam("successFileUrl");this.numOfLoginAttempts=0;this.domNodeId=a;this.makeWidgetConnections();this.makeFBConnections(this.successFileUrl);this.setOmnitureTracking()},setOmnitureTracking:function(){var a=[],b=this.omniturePrefix+"_FreeReg_Login_FreeReg_Form";a[0]=["basesection",this.omniturePrefix+"_Free_Reg"];a[1]=["subsection",this.omniturePrefix+"_Free_Reg"];a[2]=["caccess","free"];this.lifpOmnitureTracking(a,"event12",b)},showScrim:function(a){this.domNodeId=a;this.displayScrim(a);this.hideErrorMessages(this._nodes.errorUl);this.setOmnitureTracking()},makeWidgetConnections:function(){this.fragmentLoaded=true;this.oFirstName=dojo.byId(this._nodes.firstName);this.oLastName=dojo.byId(this._nodes.lastName);this.oEmailToRegister=dojo.byId(this._nodes.emailToRegister);this.oNewPassword=dojo.byId(this._nodes.newPassword);this.oConfirmPassword=dojo.byId(this._nodes.confirmPassword);this.oCompanySize=dojo.byId(this._nodes.companySize);this.oRegisterNow=dojo.byId(this._nodes.registerNow);if(this.oFirstName!==null){dojo.connect(this.oFirstName,"onfocus",this,function(){dj.util.Form.clearValue(this.oFirstName,"First Name")});dojo.connect(this.oFirstName,"onclick",this,function(){dj.util.Form.clearValue(this.oFirstName,"First Name")})}dojo.connect(dojo.byId("registrationIframeForm"),"onsubmit",this,function(a){dojo.stopEvent(a);this.submitForm()});dojo.connect(dojo.byId(this._nodes.closeButton),"click",this,function(a){dojo.stopEvent(a);dojo.addClass(dojo.byId(this.domNodeId),this._nodes.hiddenClass)});if(this.oNewPassword!==null)this.oNewPassword.type="password";if(this.oConfirmPassword!==null)this.oConfirmPassword.type="password";dojo.connect(this.oNewPassword,"keyup",this,function(a){if(this.oNewPassword.value==""&&!this.isChkEnter(a)){dojo.removeClass(dojo.byId("newPassInd"),"validate no");dojo.removeClass(dojo.byId("newPassInd"),"validate yes");dojo.removeClass(dojo.byId("newPassword"),"errorState")}});dojo.connect(this.oConfirmPassword,"keyup",this,function(a){if(this.oConfirmPassword.value==""&&!this.isChkEnter(a)){dojo.removeClass(dojo.byId("confirmPassInd"),"validate no");dojo.removeClass(dojo.byId("confirmPassInd"),"validate yes");dojo.removeClass(dojo.byId("confirmPassword"),"errorState")}});dojo.query(this._nodes.passwordSuggestion).connect("click",this,function(){dojo.removeClass(dojo.byId("pwSuggestion"),"hidden")});dojo.query(this._nodes.passwordSuggestionClose).connect("click",this,function(){dojo.addClass(dojo.byId("pwSuggestion"),"hidden")});dojo.query(this._nodes.gotoLogin).connect("click",this,function(){this.chkIfHttpsDomain()?this.moveOutOfIframe({close:"close"}):this.initLoginFromIframe(this.successFileUrl)})},submitForm:function(){this.clearRedBoundaryFromFields();if(this.validateForm()){dojo.byId(this._nodes.errorUl).innerHTML="";var a=dojo.byId(this._nodes.jobTitleDropDown),b="profile.firstName="+this.oFirstName.value;b+="&profile.lastName="+this.oLastName.value;b+="&profile.emailAddress="+this.oEmailToRegister.value;b+="&profile.password="+this.oNewPassword.value;b+="&profile.passwordConfirmation="+this.oConfirmPassword.value;b+="&service.prodct=wsj-online&service.templateCode="+this.PRODUCT_CD;b+="&service.registrationType=FREE_REGISTRATION";if(typeof this._nodes.isTowerLoadPage!="undefined"&&typeof this._nodes.isTowerLoadPage!="")b+="&service.trackingCode=tsWifi";if(typeof a!="undefined"&&a.value!="")b+="&profile.demographics.questionId1=dt_job_title&profile.demographics.answer1="+a.value;a=this.load;if(typeof this._nodes.isTowerLoadPage!="undefined"&&typeof this._nodes.isTowerLoadPage!="")a=this.towerLoad;dj.service.account.RegistrationService.registerUser(this._nodes.serviceUrls.registrationServiceUrl,b,a,this.error,this)}},load:function(){this.moveOutOfIframe({screenName:"RegistrationConfirmation",emailId:"",firstName:"",lastName:""})},error:function(a){dojo.forEach(a,function(c,d){if(c.indexOf("-")>-1){c=c.replace(/-/g,"");a[d]=c}},this);this.showErrorMessage(this._nodes.errorUl,a);var b=false;dojo.forEach(a,function(c){if(c==this._nodes.emailAddressexists||c==this._nodes.emailAddressinvalid){this.addErrorClass(this._nodes.emailToRegister);if(c==this._nodes.emailAddressexists)b=true}},this);b&&this.lifpOmnitureTracking([],"event12",this.omniturePrefix+"_Auth_"+this.omniturePrefix+"_Registration_Scrim Email Already Exists");this.connectForgotPasswordFromIframe()},validateForm:function(){var a=true;if(!this.chkEmpty(this.oFirstName.value)){this.errorArr.push(this._nodes.firstNameRequired);this.addErrorClass(this._nodes.firstName);a=false}if(!this.chkEmpty(this.oLastName.value)){this.errorArr.push(this._nodes.lastNameRequired);this.addErrorClass(this._nodes.lastName);a=false}var b=this.chkEmailAddress(this.oEmailToRegister.value);b||this.addErrorClass(this._nodes.emailToRegister);a=a?b:false;(b=this.validateNewPassword())||this.addErrorClass(this._nodes.newPassword);var c=this.validateConfirmPassword();c||this.addErrorClass(this._nodes.confirmPassword);a=a?b?c:false:false;if(b&&c)if(!this.chkPasswordMatch(this.oNewPassword,this.oConfirmPassword,this._nodes.errorUl)){this.addErrorClass(this._nodes.confirmPassword);a=false}if(dojo.byId("privacypolicybox"))if(dojo.byId("privacypolicybox").checked==false){this.errorArr.push(this._nodes.privacyPolicyRequired);a=false}this.showErrorNClearArray();return a},showErrorNClearArray:function(){this.showErrorMessage(this._nodes.errorUl,this.errorArr);this.errorArr=[]},highlightTheErrorField:function(a){dojo.forEach(a,function(b){b==this._nodes.usernamemissing&&this.addErrorClass(this._nodes.userOrEmailInput);b==this._nodes.passwordmissing&&this.addErrorClass(this._nodes.password)},this)},clearRedBoundaryFromFields:function(){dojo.removeClass(dojo.byId(this._nodes.firstName),this._nodes.fieldErrorClass);dojo.removeClass(dojo.byId(this._nodes.lastName),this._nodes.fieldErrorClass);dojo.removeClass(dojo.byId(this._nodes.emailToRegister),this._nodes.fieldErrorClass);dojo.removeClass(dojo.byId(this._nodes.newPassword),this._nodes.fieldErrorClass);dojo.removeClass(dojo.byId(this._nodes.confirmPassword),this._nodes.fieldErrorClass)}});dojo.provide("dj.widget.accountscrim.BaseLogin");dojo.require("dj.widget.accountscrim.BaseScrim");dojo.require("dj.util.Form");dojo.require("dj.service.account.LoginService");dojo.require("dj.util.User");dojo.declare("dj.widget.accountscrim.BaseLogin",dj.widget.accountscrim.BaseScrim,{constructor:function(){},submitForm:function(a){this.clearRedBoundaryFromFields();if(this.validateForm(a)){dojo.byId(this._nodes.errorUl).innerHTML="";if(this._nodes.isStandalonePage)this.currentPageUrl=this._nodes.isAmazonOffer?this._nodes.shopnbuyUrl:this._nodes.loginTargetUrl?this._nodes.loginTargetUrl:this.getPageUrl();var b="";b=this.currentPageUrl.indexOf("?")>-1?encodeURIComponent(this.currentPageUrl+"&user=welcome"):encodeURIComponent(this.currentPageUrl+"?user=welcome");var c=encodeURIComponent(dj.context.account.testLogin+"?currentPageUrl=")+b;b=this.load;if(typeof this._nodes.isTowerLoadPage!="undefined"&&typeof this._nodes.isTowerLoadPage!=""){b=this.towerLoginLoad;c=encodeURIComponent(this._nodes.landingPage)}a={username:dj.lang.trim(a.username),password:a.password,url:c,template:"default",realm:"default",savelogin:a.savelogin};dj.service.account.LoginService.loginUser(this._nodes.serviceUrls.loginServiceUrl,dojo.toJson(a),b,this.error,this)}},setupLoginData:function(){return{username:this.oUserName.value,password:this.oPassword.value,savelogin:dojo.byId(this._nodes.savelogin).checked+"",errorUI:this._nodes.errorUl}},load:function(a){var b="";if(typeof a.status!="undefined"){if(this.isValidEmailAddress(a.username))b=a.username;else{if(dojo.byId("userEmailIdToResendEmail")!=null)dojo.byId("userEmailIdToResendEmail").innerHTML="";else dojo.create("div",{id:"userEmailIdToResendEmail"},dojo.body());dj.util.User.renderEmailAddress("userEmailIdToResendEmail");b=dojo.byId("userEmailIdToResendEmail").innerHTML}if(a.status==this._nodes.unverifiedsubscriber){this.isUnverifiedSubscriber=true;this.loginVerifyEmailUserdata={screenName:this._constants.LOGIN_VERIFY_EMAIL_SCREEN,uuid:a.uuid,productCode:this.PRODUCT_CD,userEmail:b,refreshPageUrlForUnverifiedSub:encodeURIComponent(this.currentPageUrl)};dojo.byId("unverifiedFreeRegOrSub")==null&&dojo.create("div",{id:"unverifiedFreeRegOrSub","class":"hidden"},dojo.body(),"last")}else if(a.status==this._nodes.unverifiedfreereg){this.isUnverifiedFreeReg=true;this.unverifiedFreeRegUserdata={screenName:this._constants.UNVERIFIED_FREE_REG,uuid:a.uuid,productCode:this.PRODUCT_CD,userEmail:b};dojo.byId("unverifiedFreeRegOrSub")==null&&dojo.create("div",{id:"unverifiedFreeRegOrSub","class":"hidden"},dojo.body(),"last")}else if(typeof a.status!="undefined"&&dojo.trim(a.status)!="")this.successLogin=true}if(this.successLogin)parent.location=a.url;else if(this._nodes.isStandalonePage&&typeof this.isUnverifiedSubscriber=="undefined"&&typeof this.isUnverifiedFreeReg=="undefined")window.location=a.url;else{dojo.create("div",{id:"testLoginContainer"},dojo.body(),"last");this.initIFrame("testLoginContainer",0,0,a.url)}},error:function(a){if(this._nodes.fbConnectLogin){dojo.removeClass(dojo.byId("fbconnect"),"disabled");dojo.removeClass(dojo.byId("loginSubmit"),"disabled")}var b="N";this.numOfLoginAttempts++;dojo.forEach(a,function(e,f){if(e.indexOf("-")>-1){e=e.replace(/-/g,"");a[f]=e;if(e===this._nodes.usernameinvalidcredentials&&this.numOfLoginAttempts>2){a[f]=this._nodes.morethan2invalidcredentials;b="Y"}e===this._nodes.facebookconnected&&this.moveOutOfIframe({screenName:this._constants.FB_LOGIN_OR_WSJ_PSWD_SCREEN,username:this.oUserName.value,productCode:this.PRODUCT_CD})}},this);this.showErrorMessage(this._nodes.errorUl,a);if(a.length>0){this.clearRedBoundaryFromFields();this.focusOnError()}if(b==="Y"){this.connectForgotUsernameFromIframe();this.connectForgotPasswordFromIframe()}var c=[],d="";c=[];d=this._nodes.fbConnectLogin?"WSJ_Auth_WSJ/Barrons_Login_Page_Post_FBConnect Invalid Login Credentials":this._nodes.isStandalonePage?"WSJ_Auth_WSJ_Login_Page Bad Credentials page":"WSJ_Auth_WSJ_Login_Scrim Bad Credentials page";this.lifpOmnitureTracking(c,"event12",d)},gotoSubscribePage:function(){var a={};if(dj.util.Region.getViewByRegion()=="asia,india"){this._nodes.subscribeFromLoginPage=dj.context.account.india_subscribeFromLoginPage;this._nodes.subscribeFromLoginOverlay=dj.context.account.india_subscribeFromLoginOverlay}else if(dj.util.Region.getViewByRegion()=="asia"){this._nodes.subscribeFromLoginPage=dj.context.account.asia_subscribeFromLoginPage;this._nodes.subscribeFromLoginOverlay=dj.context.account.asia_subscribeFromLoginOverlay}else if(dj.util.Region.getViewByRegion()=="europe"){this._nodes.subscribeFromLoginPage=dj.context.account.europe_subscribeFromLoginPage;this._nodes.subscribeFromLoginOverlay=dj.context.account.europe_subscribeFromLoginOverlay}a=this._nodes.isStandalonePage?{refreshPageUrl:encodeURIComponent(this._nodes.subscribeFromLoginPage)}:{refreshPageUrl:encodeURIComponent(this._nodes.subscribeFromLoginOverlay)};this.moveOutOfIframe(a)},highlightTheErrorField:function(a){dojo.forEach(a,function(b){b==this._nodes.usernamemissing&&this.addErrorClass(this._nodes.userOrEmailInput);b==this._nodes.passwordmissing&&this.addErrorClass(this._nodes.password)},this)},clearRedBoundaryFromFields:function(){dojo.removeClass(dojo.byId(this._nodes.userOrEmailInput),this._nodes.fieldErrorClass);dojo.removeClass(dojo.byId(this._nodes.password),this._nodes.fieldErrorClass)},focusOnError:function(){this.oPassword.value="";this.oUserName.focus()},validateForm:function(a){var b=true;if(!this.chkEmpty(a.username)){this.errorArr.push(this._nodes.usernamemissing);this.addErrorClass(this._nodes.userOrEmailInput);b=false}if(b)if(!this.chkEmpty(a.password)){this.errorArr.push(this._nodes.passwordmissing);this.addErrorClass(this._nodes.password);b=false}this.showErrorMessage(a.errorUI,this.errorArr);this.errorArr=[];return b},initIFrame:function(a,b,c,d){setTimeout(this.isLoginSuccess,2E4);dj.util.Url.createSimpleIframe({src:d,"class":"hidden",allowTransparency:"true"},a,this.testLoginIframeLoaded,this)},isLoginSuccess:function(){if(!this.isUserLoggedIn){this.errorArr=["generalError"];this.showErrorMessage(this._nodes.errorUl,this.errorArr);window.console&&console.warn("User couldn't be logged in ");this.errorArr=[];this.isUserLoggedIn=false}},testLoginIframeLoaded:function(){this.isUserLoggedIn=true;if(this.isUnverifiedSubscriber)this.moveOutOfIframe(this.loginVerifyEmailUserdata);else this.isUnverifiedFreeReg&&this.moveOutOfIframe(this.unverifiedFreeRegUserdata);dojo.destroy("unverifiedFreeRegOrSub")}});dojo.provide("dj.widget.accountscrim.Login");dojo.require("dj.widget.accountscrim.BaseLogin");dojo.require("dj.util.Form");dojo.require("dj.service.account.LoginService");dojo.require("dj.util.User");dojo.declare("dj.widget.accountscrim.Login",dj.widget.accountscrim.BaseLogin,{constructor:function(a){this._cfg=dojo.mixin(this.DEFAULT_CONFIG,a);this._nodes=this.WIDGET_CONFIG;this._dls=dj.service.account.LoginService;this.errorArr=[]},DEFAULT_CONFIG:{isLoadJs:true,version:4.2,NONSUBSCRIBER_HOMEPAGE_PID:"0_0_WH_0001_public",NONSUBSCRIBER_SEARCH_PAGE_PID:"3_0466",NONSUBSCRIBER_NEWSLETTERS_ALERTS_PAGE_PID:"5_6007",MDC_PAGE_PID:"2_3000",HOMEPAGE_SUBSCRIBER_URL:"/",SEARCH_PAGE_SUBSCRIBER_URL:"/search",MDC_LINK_URL:"/mdc/page/marketsdata.html"},WIDGET_CONFIG:{serviceUrls:{loginServiceUrl:"/auth/submitlogin.json"},closeButton:"loginClose",userOrEmailInput:"loginUserOrEmail",password:"password",submitButton:"loginSubmit",hiddenClass:"hidden",gotoForgotUsernameFromIframe:".forgotUsernameFromIframeClass",gotoForgotPasswordFromIframe:".forgotPasswordFromIframeClass",gotoRegistration:".registerUserClass",gotoSubscribe:".subscribeUser",savelogin:"savelogin",loginIframeForm:"loginIframeForm",errorUl:"loginErrorUl",goBackToIframeFrmErr:"goBackToIframeFrmErr",fieldErrorClass:"errorState",isIframe:false,iframeErrorOverlayDiv:"iframeErrorOverlayDiv",usernamemissing:"usernamemissing",passwordmissing:"passwordmissing",usernameinvalidcredentials:"usernameinvalidcredentials",morethan2invalidcredentials:"morethan2invalidcredentials",cookiesDisabledMsg:"cookiesDisabledMsg",facebookconnected:"facebookconnected",unverifiedsubscriber:"unverified-subscriber",unverifiedfreereg:"unverified-freereg",generalError:"generalError",connectFB:".connectwithfb",whatsThisFbClass:".whatsThisFbClass",fbToolTipClass:".login_tooltip",fbToolTipCloseClass:".close-tooltip-btn",subscribeFromLoginOverlay:dj.context.account.subscribeFromLoginOverlay,subscribeFromLoginPage:dj.context.account.subscribeFromLoginPage},init:function(a,b){if(typeof this._nodes.isStandalonePage=="undefined"||!this._nodes.isStandalonePage){this.addClassToBody();this.updatePromoUrlnImage()}this.numOfLoginAttempts=0;this.domNodeId=a;this.makeWidgetConnections();if(this._nodes.isStandalonePage&&typeof this._nodes.akamaiCdnPrefix!="undefined"&&this._nodes.akamaiCdnPrefix!="")this._cfg.akamaiCdnPrefix=this._nodes.akamaiCdnPrefix;this.makeFBConnections(this.successFileUrl);var c=this;dj.lang.addLiveEvent(".login_id","keypress",function(d){if(dojo.isIE)if(c.isChkEnter(d)){dojo.stopEvent(d);c.submitForm(c.setupLoginData())}});dj.lang.addLiveEvent(".login_pw","keypress",function(d){if(dojo.isIE)if(c.isChkEnter(d)){dojo.stopEvent(d);c.submitForm(c.setupLoginData())}});if(typeof b=="undefined"||b)dojo.ready(function(){setTimeout(function(){document.loginform.loginUserOrEmail.focus()},100)});this.setOmnitureTracking()},chkIfCookieEnabledOnMob:function(){if(navigator.userAgent.search(/Mobile/i)>-1)navigator.cookieEnabled||this.showErrorMessage(this._nodes.errorUl,[this._nodes.cookiesDisabledMsg])},setOmnitureTracking:function(){var a="";a=this._nodes.isStandalonePage?this.omniturePrefix+"_Auth_"+this.omniturePrefix+"/Barrons_Login_Page_Sub_with_Promo":this.omniturePrefix+"_Auth_"+this.omniturePrefix+"/Barrons_Login_Scrim_Sub_with_Promo";this.lifpOmnitureTracking([],"event12",a)},showScrim:function(a){this.domNodeId=a;this.displayScrim(a);this.hideErrorMessages(this._nodes.errorUl);this.setOmnitureTracking()},makeWidgetConnections:function(){this.fragmentLoaded=true;this.oUserName=dojo.byId(this._nodes.userOrEmailInput);this.oPassword=dojo.byId(this._nodes.password);this.oLoginSub=dojo.byId(this._nodes.submitButton);if(this.oUserName!==null){dojo.connect(this.oUserName,"focus",this,function(){dj.util.Form.clearValue(this.oUserName,"User Name")});dojo.connect(this.oUserName,"click",this,function(){dj.util.Form.clearValue(this.oUserName,"User Name")})}dojo.connect(dojo.byId("loginIframeForm"),"onsubmit",this,function(a){this.submitForm(this.setupLoginData());dojo.stopEvent(a)});dojo.connect(dojo.byId(this._nodes.closeButton),"click",this,function(a){dojo.stopEvent(a);dojo.addClass(dojo.byId(this.domNodeId),this._nodes.hiddenClass)});if(this.oPassword!==null){this.oPassword.type="password";dojo.connect(this.oPassword,"focus",this,function(){dj.util.Form.clearValue(this.oPassword,"Password")})}this.connectForgotPasswordFromIframe();this.connectForgotUsernameFromIframe();dojo.query(this._nodes.gotoRegistration).connect("click",this,function(){this._nodes.isStandalonePage?this.initRegistration():this.initRegistrationFromIframe(this.successFileUrl)});dojo.query(this._nodes.gotoSubscribe).connect("click",this,function(a){dojo.stopEvent(a);this.gotoSubscribePage()})},updatePromoUrlnImage:function(){var a=dj.util.Region.getViewByRegion();console.log("region "+a);if(typeof a!="undefined"&&dojo.byId("usLoginPromo")!=null){var b="usLoginPromo",c="asiaLoginPromo",d="europeLoginPromo";if(a.toUpperCase().indexOf("US")>-1){b="usLoginPromo";c="asiaLoginPromo";d="europeLoginPromo"}else if(a.toUpperCase().indexOf("ASIA")>-1){b="asiaLoginPromo";c="usLoginPromo";d="europeLoginPromo"}else if(a.toUpperCase().indexOf("EUROPE")>-1){b="europeLoginPromo";c="usLoginPromo";d="asiaLoginPromo"}dojo.removeClass(dojo.byId(b),"hidden");dojo.addClass(dojo.byId(c),"hidden");dojo.addClass(dojo.byId(d),"hidden")}}});dojo.provide("dj.widget.accountscrim.FBLogin");dojo.require("dj.widget.accountscrim.BaseLogin");dojo.require("dj.util.Form");dojo.require("dj.service.account.LoginService");dojo.require("dj.widget.accountscrim.Login");dojo.require("dj.widget.accountscrim.Registration");dojo.declare("dj.widget.accountscrim.FBLogin",dj.widget.accountscrim.BaseLogin,{constructor:function(a){this._cfg=dojo.mixin(this.DEFAULT_CONFIG,a);this.fragmentLoaded=false;this._nodes=this.WIDGET_CONFIG;this._dls=dj.service.account.LoginService;this.errorArr=[]},DEFAULT_CONFIG:{isLoadJs:true,version:4.2,productCd:"WSJ_FACEBOOK",NONSUBSCRIBER_HOMEPAGE_PID:"0_0_WH_0001_public",NONSUBSCRIBER_SEARCH_PAGE_PID:"3_0466",NONSUBSCRIBER_NEWSLETTERS_ALERTS_PAGE_PID:"5_6007",MDC_PAGE_PID:"2_3000",HOMEPAGE_SUBSCRIBER_URL:"/",SEARCH_PAGE_SUBSCRIBER_URL:"/search",MDC_LINK_URL:"/mdc/page/marketsdata.html"},WIDGET_CONFIG:{serviceUrls:{loginServiceUrl:"/auth/submitlogin.json",registrationServiceUrl:"/epiton/registration/v2/profile"},closeButton:".closeBtn",userOrEmailInput:"fb_loginUserOrEmail",password:"fb_password",loginSubmit:"loginSubmit",fbSubmit:"fbconnect",hiddenClass:"hidden",gotoForgotUsernameFromIframe:".forgotUsernameFromIframeClass",loginConnect:".wsj_login_form_intro",loginForm:".wsj_login_form",savelogin:"fb_savelogin",errorUl:"fb_loginErrorUl",usernamemissing:"usernamemissing",passwordmissing:"passwordmissing",usernameinvalidcredentials:"usernameinvalidcredentials",morethan2invalidcredentials:"morethan2invalidcredentials",facebookconnected:"facebookconnected",unverifiedsubscriber:"unverified-subscriber",unverifiedfreereg:"unverified-freereg",generalError:"generalError",fieldErrorClass:"errorState",firstNameRequired:"firstNameRequired",lastNameRequired:"lastNameRequired",invalidemailFormat:"invalidemailFormat",emailIdrequired:"emailIdrequired",newPasswordRequired:"newPasswordRequired",confirmPasswordRequired:"confirmPasswordRequired",passwordTooShort:"passwordTooShort",passwordTooLong:"passwordTooLong",invalidCharacters:"invalidCharacters",passwordDoNotMatch:"passwordDoNotMatch",emailAddressexists:"emailAddressexists",firstName:"fb_firstName",lastName:"fb_lastName",emailToRegister:"fb_emailToRegister",newPassword:"fb_newPassword",confirmPassword:"fb_confirmPassword",registerErrorUl:"fb_registrationErrorUl",registerNow:"registerNow",newPassInd:"newPassInd",confirmPassInd:"confirmPassInd",passIndClassRed:"validate no",passIndClassGreen:"validate yes",passwordSuggestion:".pw_suggestion",passwordSuggestionClose:".pw_tooltip",connectFB:"connectwithfb",whatsThisFb:"whatsThisFb",fbToolTip:"fbToolTip",fbToolTipClose:"fbToolTipClose",helpTipTarget:".helpTipTarget",helpbtnclose:".btn_close"},init:function(a){this.addClassToBody();this._nodes.fbConnectLogin=true;this.successFileUrl=this.getQueryStrParam("successFileUrl");this.currentPageUrl=this.getQueryStrParam("currentPageUrl");this.fbconnectURL=this.getFBConnectURL(this.currentPageUrl);this.numOfLoginAttempts=0;this.domNodeId=a;this.makeWidgetConnections();if(typeof dj.module.facebook!="undefined"&&typeof dj.module.facebook.connect!="undefined")typeof FB=="undefined"?dj.module.facebook.connect.init(this.updateUserInfo):this.updateUserInfo();else window.console&&console.warn(" In {FBLogin.js} dj.module.facebook.connect is not found, please make the required js file available");this.setOmnitureTracking();var b=this;dj.lang.addLiveEvent(".fbloginid","keypress",function(c){if(dojo.isIE)if(b.isChkEnter(c)){dojo.stopEvent(c);b.submitLoginForm()}});dj.lang.addLiveEvent(".fbloginpassword","keypress",function(c){if(dojo.isIE)if(b.isChkEnter(c)){dojo.stopEvent(c);b.submitLoginForm()}})},showScrim:function(a){this.domNodeId=a;this.displayScrim(a);this.hideErrorMessages(this._nodes.errorUl);this.setOmnitureTracking()},setOmnitureTracking:function(){var a="";a=this.omniturePrefix+"_Auth_"+this.omniturePrefix+"_Login_Page_Post_FBConnect";this.lifpOmnitureTracking([],"event12",a)},updateUserInfo:function(){FB.api("/me",function(a){if(!(!a||a.error)){dojo.byId("fb_firstName").value=a.first_name;dojo.byId("fb_lastName").value=a.last_name;dojo.byId("fb_emailToRegister").value=a.email}})},showLoginForm:function(){dojo.removeClass(dojo.byId("wsj_login_box"),"wsj_login_box collapsed");dojo.addClass(dojo.byId("wsj_login_box"),"wsj_login_box expanded");this.makeLoginConnections()},setupRegistrationData:function(){return{firstname:this.oFirstName.value,lastname:this.oLastName.value,email:this.oEmailToRegister.value,password:this.oNewPassword.value,confirmpassword:this.oConfirmPassword.value,errorUI:this._nodes.registerErrorUl}},setupLoginData:function(){return{username:this.oUserName.value,password:this.oPassword.value,savelogin:dojo.byId(this._nodes.savelogin).checked+"",errorUI:this._nodes.errorUl}},makeWidgetConnections:function(){this.fragmentLoaded=true;this.oFirstName=dojo.byId(this._nodes.firstName);this.oLastName=dojo.byId(this._nodes.lastName);this.oEmailToRegister=dojo.byId(this._nodes.emailToRegister);this.oNewPassword=dojo.byId(this._nodes.newPassword);this.oConfirmPassword=dojo.byId(this._nodes.confirmPassword);dojo.connect(dojo.byId("fbRegisterForm"),"onsubmit",this,function(a){dojo.stopEvent(a);this.submitFBForm()});dojo.query(this._nodes.closeButton).connect("click",this,function(){dojo.addClass(dojo.byId(this.domNodeId),this._nodes.hiddenClass)});this.connectForgotPasswordFromIframe();this.connectForgotUsernameFromIframe();dojo.query(this._nodes.loginConnect).connect("click",this,function(){this.showLoginForm()});dojo.query(this._nodes.helpTipTarget).connect("click",this,function(){dojo.removeClass(dojo.byId("helpTipTree"),"helpTipTree-collapsed");dojo.addClass(dojo.byId("helpTipTree"),"helpTipTree-expanded")});dojo.query(this._nodes.helpbtnclose).connect("click",this,function(){dojo.addClass(dojo.byId("helpTipTree"),"helpTipTree-collapsed");dojo.removeClass(dojo.byId("helpTipTree"),"helpTipTree-expanded")});dojo.query(this._nodes.passwordSuggestion).connect("click",this,function(){dojo.removeClass(dojo.byId("pwSuggestion"),"hidden")});dojo.query(this._nodes.passwordSuggestionClose).connect("click",this,function(){dojo.addClass(dojo.byId("pwSuggestion"),"hidden")});dojo.connect(this.oConfirmPassword,"keyup",this,function(a){if(this.oConfirmPassword.value==""&&!this.isChkEnter(a)){dojo.removeClass(dojo.byId("confirmPassInd"),"validate no");dojo.removeClass(dojo.byId("confirmPassInd"),"validate yes");dojo.removeClass(dojo.byId("fb_confirmPassword"),"errorState")}if(this.isChkEnter(a)){dojo.stopEvent(a);this.submitFBForm()}});dojo.connect(this.oNewPassword,"keyup",this,function(a){if(this.oNewPassword.value==""&&!this.isChkEnter(a)){dojo.removeClass(dojo.byId("newPassInd"),"validate no");dojo.removeClass(dojo.byId("newPassInd"),"validate yes");dojo.removeClass(dojo.byId("fb_newPassword"),"errorState")}if(this.isChkEnter(a)){dojo.stopEvent(a);this.submitFBForm()}})},makeLoginConnections:function(){this.fragmentLoaded=true;this.oUserName=dojo.byId(this._nodes.userOrEmailInput);this.oPassword=dojo.byId(this._nodes.password);this.oLoginSub=dojo.byId(this._nodes.loginSubmit);this.oFBSub=dojo.byId(this._nodes.fbSubmit);if(this.oUserName!==null){dojo.connect(this.oUserName,"focus",this,function(){dj.util.Form.clearValue(this.oUserName,"User Name")});dojo.connect(this.oUserName,"click",this,function(){dj.util.Form.clearValue(this.oUserName,"User Name")})}dojo.connect(dojo.byId("fbLoginForm"),"onsubmit",this,function(a){dojo.stopEvent(a);this.submitLoginForm()})},validateLoginForm:function(a){this.errorArr=[];var b=true;if(!this.chkEmpty(a.username)){this.errorArr.push(this._nodes.usernamemissing);this.addErrorClass(this._nodes.userOrEmailInput);b=false}if(b)if(!this.chkEmpty(a.password)){this.errorArr.push(this._nodes.passwordmissing);this.addErrorClass(this._nodes.password);b=false}this.showErrorMessage(a.errorUI,this.errorArr);this.errorArr=[];return b},submitLoginForm:function(){if(!dojo.hasClass(dojo.byId("loginSubmit"),"disabled")){this.clearRedBoundaryFromFields("loginForm");var a=this.setupLoginData();if(this.validateLoginForm(a)){dojo.byId(this._nodes.errorUl).innerHTML="";dojo.addClass(dojo.byId("loginSubmit"),"disabled");a={username:dj.lang.trim(a.username),password:a.password,url:encodeURIComponent(dj.context.account.testLogin)+"?fbConnectPageUrl="+this.fbconnectURL,template:"default",realm:"default",savelogin:a.savelogin};dj.service.account.LoginService.loginUser(this._nodes.serviceUrls.loginServiceUrl,dojo.toJson(a),this.load,this.error,this)}}},submitFBForm:function(){if(!dojo.hasClass("fbconnect","disabled")){this.clearRedBoundaryFromFields("registrationForm");if(this.validateRegistrationForm()){dojo.byId(this._nodes.registerErrorUl).innerHTML="";dojo.addClass(dojo.byId("fbconnect"),"disabled");var a="profile.firstName="+this.oFirstName.value;a+="&profile.lastName="+this.oLastName.value;a+="&profile.emailAddress="+this.oEmailToRegister.value;a+="&profile.password="+this.oNewPassword.value;a+="&profile.passwordConfirmation="+this.oConfirmPassword.value;a+="&profile.uuid=true";a+="&profile.options.createCommunityProfile=";a+="&profile.options.featureEmailOptIn=true";a+="&profile.options.returnLink=http%3A%2F%2F"+document.domain;a+="&service.registrationType=FREE_REGISTRATION";a+="&profile.trackingCode=FACEBOOK_CONNECT";a+="&profile.newsletterOptIns=";a+="&service.templateCode="+this.PRODUCT_CD+"_FACEBOOK";a+="&profile.registrationSource=facebook";dj.service.account.RegistrationService.registerUser(this._nodes.serviceUrls.registrationServiceUrl,a,this.registrationLoad,this.registrationError,this)}}},registrationLoad:function(){var a={username:dj.lang.trim(this.oEmailToRegister.value),password:this.oNewPassword.value,url:encodeURIComponent(dj.context.account.testLogin)+"?fbConnectPageUrl="+this.fbconnectURL,template:"default",realm:"sbk-default",savelogin:"true"};dj.service.account.LoginService.loginUser(this._nodes.serviceUrls.loginServiceUrl,dojo.toJson(a),this.load,this.error,this)},registrationError:function(a){dojo.removeClass(dojo.byId("fbconnect"),"disabled");dojo.forEach(a,function(c,d){if(c.indexOf("-")>-1){c=c.replace(/-/g,"");a[d]=c}},this);this.showErrorMessage(this._nodes.registerErrorUl,a);this.connectForgotPasswordFromIframe();var b="";b=this.omniturePrefix+"_Auth_"+this.omniturePrefix+"/Barrons_Login_Page_Post_FBConnect EmailAddressexists Error Page";this.lifpOmnitureTracking([],"event12",b)},validateRegistrationForm:function(){var a=true;if(!this.chkEmpty(this.oFirstName.value)){this.errorArr.push(this._nodes.firstNameRequired);this.addErrorClass(this._nodes.firstName);a=false}if(!this.chkEmpty(this.oLastName.value)){this.errorArr.push(this._nodes.lastNameRequired);this.addErrorClass(this._nodes.lastName);a=false}var b=this.chkEmailAddress(this.oEmailToRegister.value);b||this.addErrorClass(this._nodes.emailToRegister);a=a?b:false;(b=this.validateNewPassword())||this.addErrorClass(this._nodes.newPassword);var c=this.validateConfirmPassword();c||this.addErrorClass(this._nodes.confirmPassword);a=a?b?c:false:false;if(b&&c)this.chkPasswordMatch(this.oNewPassword,this.oConfirmPassword,this._nodes.registerErrorUl)||(a=false);this.showErrorNClearArray();return a},showErrorNClearArray:function(){this.showErrorMessage(this._nodes.registerErrorUl,this.errorArr);this.errorArr=[]},getFBConnectURL:function(a){var b=a.substring(a.indexOf("?")+1,a.length);b=dojo.queryToObject(b);var c="";if(typeof b.url!="undefined")c=b.url.constructor.toString().indexOf("Array")==-1?b.url:b.url[1];else{a=a.substring(0,a.indexOf("?"));c=dj.context.facebook.commerceFBConnectURL+"?url="+encodeURIComponent(a);c=encodeURIComponent(c)}return c},clearRedBoundaryFromFields:function(a){if(typeof a=="undefined")a="loginForm";if(a=="registrationForm"){dojo.removeClass(dojo.byId(this._nodes.firstName),this._nodes.fieldErrorClass);dojo.removeClass(dojo.byId(this._nodes.lastName),this._nodes.fieldErrorClass);dojo.removeClass(dojo.byId(this._nodes.emailToRegister),this._nodes.fieldErrorClass);dojo.removeClass(dojo.byId(this._nodes.newPassword),this._nodes.fieldErrorClass);dojo.removeClass(dojo.byId(this._nodes.confirmPassword),this._nodes.fieldErrorClass)}else if(a=="loginForm"){dojo.removeClass(dojo.byId(this._nodes.userOrEmailInput),this._nodes.fieldErrorClass);dojo.removeClass(dojo.byId(this._nodes.password),this._nodes.fieldErrorClass)}}});
dojo.provide("dj.module.scrimloader.ScrimLoader");dojo.declare("dj.module.scrimloader.ScrimLoader",[],{DEFAULT_CONFIG:{scrimWrapperDiv:"genericdiv"},constructor:function(a,b){if(b){this.preCallback=b.preCallBack;this.postCallback=b.postCallBack;this.callbackContext=b.context}this.cfg=dojo.mixin(this.DEFAULT_CONFIG,a)},initScrim:function(){this._preCallback(this.preCallback,this.callbackContext);var a=dojo;a.require("djscript.require.dj_module_scrimloader.version.1");a.addOnLoad(this._requiredJSLoaded())},_requiredJSLoaded:function(){this._loadScrimContent();this._showScrim()},_showScrim:function(){var a=new dj.widget.scrim.ShowScrim(this.cfg);this.dialog=a.init()},_loadScrimContent:function(){dojo.create("div",{id:this.cfg.scrimWrapperDiv},dojo.body(),"last");this._scrimContent=new dj.module.scrimloader.LoadScrimContent(this.cfg,this.postCallback,this.callbackContext);this._scrimContent.init()},_preCallback:function(a,b){if(typeof a==="function")return a.call(b);return false}});dojo.provide("dj.widget.scrim.marketingScrim.scrimTracking");dojo.require("dj.util.Tracking");dj.widget.scrim.marketingScrim.scrimTracking={init:function(){this.omniture={};this.omniture.saveVars=["pageName","prop2","prop3","prop4","prop8","prop20","prop26"];this.omniture.saveValues=[]},omnituresavepixel:function(){for(var a=this.omniture.saveVars.length,b=0;b<a;b++)this.omniture.saveValues[b]=this.omniture.pixel.getMetaData(this.omniture.saveVars[b])},omniturerestorepixel:function(){for(var a=this.omniture.saveVars.length,b=0;b<a;b++)this.omniture.pixel.setMetaData(this.omniture.saveVars[b],this.omniture.saveValues[b])},omniturefirepixel:function(){this.init();if(!this.omniture.pixel)this.omniture.pixel=dj.util.Tracking.omniture;this.omniture.pixel.resetPixel();this.omnituresavepixel();this.omniture.pixel.setMetaData("pageName","WSJ_Marketing Scrim");this.omniture.pixel.setMetaData("section","Customer Resources");this.omniture.pixel.setMetaData("subsection","WSJ_Marketing");this.omniture.pixel.setMetaData("apage","WSJ_Customer Marketing Scrim");this.omniture.pixel.setMetaData("atype","WSJ_Customer Marketing Scrim");this.omniture.pixel.setMetaData("aheadline","");this.omniture.pixel.setMetaData("csource","WSJ Online");this.omniture.pixel.setMetaData("abasedocid","");this.omniture.pixel.setMetaData("basesection","WSJ_Marketing");this.omniture.pixel.firePixel(true);this.omniturerestorepixel()}};dojo.provide("dj.widget.scrim.starbucksscrim.scrimTracking");dojo.require("dj.util.Tracking");dj.widget.scrim.starbucksscrim.scrimTracking={init:function(){this.omniture={};this.omniture.saveVars=["pageName","prop2","prop3","prop4","prop8","prop20","prop26"];this.omniture.saveValues=[]},omnituresavepixel:function(){for(var a=this.omniture.saveVars.length,b=0;b<a;b++)this.omniture.saveValues[b]=this.omniture.pixel.getMetaData(this.omniture.saveVars[b])},omniturerestorepixel:function(){for(var a=this.omniture.saveVars.length,b=0;b<a;b++)this.omniture.pixel.setMetaData(this.omniture.saveVars[b],this.omniture.saveValues[b])},omniturefirepixel:function(){this.init();if(!this.omniture.pixel)this.omniture.pixel=dj.util.Tracking.omniture;this.omniture.pixel.resetPixel();this.omnituresavepixel();this.omniture.pixel.setMetaData("pageName","WSJ_Starbucks Scrim");this.omniture.pixel.setMetaData("section","Customer Resources");this.omniture.pixel.setMetaData("subsection","WSJ_Marketing");this.omniture.pixel.setMetaData("apage","WSJ_Customer Resources_Starbucks Scrim");this.omniture.pixel.setMetaData("atype","WSJ_Customer Resources_Starbucks Scrim");this.omniture.pixel.setMetaData("aheadline","");this.omniture.pixel.setMetaData("csource","WSJ Online");this.omniture.pixel.setMetaData("abasedocid","");this.omniture.pixel.setMetaData("basesection","WSJ_Marketing");this.omniture.pixel.firePixel(true);this.omniturerestorepixel()}};dojo.provide("dj.module.itpScrim.ItpScrim");dojo.require("dj.module.scrimloader.ScrimLoader");dojo.require("dj.util.Cookie");dojo.require("dj.util.User");dojo.declare("dj.module.itpScrim.ItpScrim",dj.module.scrimloader.ScrimLoader,{itpScrimCount:dj.util.Cookie.getGroupCookie("DJCOOKIE","itp_scrim_count"),scrimSeenCount:0,constructor:function(a){this.cfg=dojo.mixin(this.DEFAULT_CONFIG,a);this.postCallback=this._postScrimCall;this.callbackContext={ItpScrimObj:this}},init:function(){this.showScrim()},hasSeenScrim:function(){return this.itpScrimCount>=3||dj.util.Cookie.getGroupCookie("DJCOOKIE",this.cfg.cookieName)==true?true:false},setScrimAsSeen:function(){dj.util.Cookie.setGroupCookie("DJCOOKIE","itp_scrim_count",3,0);dj.util.Cookie.setGroupCookie("DJCOOKIE",this.cfg.cookieName,"true",0)},showScrim:function(){if(this._isWsjUser()){this.setScrimAsSeen();return false}if(this.itpScrimCount==null){dj.util.Cookie.setGroupCookie("DJCOOKIE","itp_scrim_count",this.scrimSeenCount,0);this.itpScrimCount=dj.util.Cookie.getGroupCookie("DJCOOKIE","itp_scrim_count")}else this.scrimSeenCount=dj.util.Cookie.getGroupCookie("DJCOOKIE","itp_scrim_count");if(this.hasSeenScrim()){var a=dojo.byId("itpPdfhref");a!==null&&this.cfg.pdfLink!==null&&a.setAttribute("href",this.cfg.pdfLink);a=dojo.byId("itpPdfhref2");a!==null&&this.cfg.pdfLink!==null&&a.setAttribute("href",this.cfg.pdfLink)}else{this.scrimSeenCount=parseInt(this.scrimSeenCount)+parseInt(1);dj.util.Cookie.setGroupCookie("DJCOOKIE","itp_scrim_count",this.scrimSeenCount,0);this.itpScrimCount=dj.util.Cookie.getGroupCookie("DJCOOKIE","itp_scrim_count");this.itpScrimCount>=3&&this.setScrimAsSeen();this.initScrim()}return false},_isIpad:function(){if(navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/iPad/i))return true;return false},_postScrimCall:function(){var a=dojo.byId("scrimCloseBtn");dojo.connect(a,"click",this,function(){this.ItpScrimObj.dialog.hide();if(a.hasAttribute("href"))this.ItpScrimObj.cfg.pdfLink!==null?a.setAttribute("href",this.ItpScrimObj.cfg.pdfLink):console.warn("PDF link not set");else console.warn("HREF attribute not found")});dojo.connect(dojo.query(".scrimWSJNewCircBtn")[0],"click",this,function(){this.ItpScrimObj.dialog.hide()});dojo.query(".dijit_scrim")[0].style.zIndex=1050},_isWsjUser:function(){dj.util.User.isSubLoggedIn(function(a){if(a)return true})}});dojo.provide("dj.module.marketingScrim.MarketingScrim");dojo.require("dj.module.scrimloader.ScrimLoader");dojo.require("dj.util.Cookie");dojo.require("dj.util.User");dojo.require("dj.widget.scrim.marketingScrim.scrimTracking");dojo.declare("dj.module.marketingScrim.MarketingScrim",dj.module.scrimloader.ScrimLoader,{constructor:function(a){this.cfg=dojo.mixin(this.DEFAULT_CONFIG,a);this.postCallback=this._postScrimCall;this.callbackContext={MarketingScrimObj:this}},init:function(){this.showScrim()},hasSeenScrim:function(){return dj.util.Cookie.getGroupCookie("DJCOOKIE",this.cfg.cookieName)!==null},setScrimAsSeen:function(){dj.util.Cookie.setGroupCookie("DJCOOKIE",this.cfg.cookieName,"true",365)},showScrim:function(){if(!this.hasSeenScrim()){if(this._isIpad())return false;this._isWsjUser()}return false},_isBlockedScreenResolution:function(a,b){if(screen.height<=a&&screen.width<=b)return true;return false},_isIpad:function(){if(navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/iPad/i))return true;return false},_postScrimCall:function(){dojo.connect(dojo.query(".closeBtn")[0],"click",this,function(){this.MarketingScrimObj.dialog.hide()});dojo.connect(dojo.query(".scrimWSJNewCircApr12Btn_connect")[0],"click",this,function(){this.MarketingScrimObj.dialog.hide()});dojo.connect(dojo.query(".scrimWSJNewCircApr12Btn_askLater")[0],"click",this,function(){this.MarketingScrimObj.dialog.hide()});dojo.query(".dijit_scrim")[0].style.zIndex=1050;dj.widget.scrim.marketingScrim.scrimTracking.omniturefirepixel()},_isWsjUser:function(){var a=this;dj.util.User.isSubLoggedIn(function(b){if(!b){a.setScrimAsSeen();a.initScrim()}})}});dojo.provide("dj.module.starbucksscrim.StarbucksScrim");dojo.require("dj.module.scrimloader.ScrimLoader");dojo.require("dj.util.Cookie");dojo.require("dj.util.User");dojo.require("dj.widget.scrim.starbucksscrim.scrimTracking");dojo.declare("dj.module.starbucksscrim.StarbucksScrim",dj.module.scrimloader.ScrimLoader,{constructor:function(a){this.cfg=dojo.mixin(this.DEFAULT_CONFIG,a);this.postCallback=this._postScrimCall;this.callbackContext={StarbucksScrimObj:this}},init:function(){this.showScrim()},hasSeenScrim:function(){return dj.util.Cookie.getGroupCookie("DJSESSION",this.cfg.cookieName)!==null},setScrimAsSeen:function(){dj.util.Cookie.setGroupCookie("DJSESSION",this.cfg.cookieName,"true")},showScrim:function(){if(!this.hasSeenScrim()){if(this._isIpad())return false;if(this._isBlockedScreenResolution(600,800))return false;this._isWsjUser()}return false},_isBlockedScreenResolution:function(a,b){if(screen.height<=a&&screen.width<=b)return true;return false},_isIpad:function(){if(navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/iPad/i))return true;return false},_postScrimCall:function(){dojo.connect(dojo.query(".closeBtn")[0],"click",this,function(){this.StarbucksScrimObj.dialog.hide()});dojo.connect(dojo.query(".scrimStarbucksReadMore")[0],"click",this,function(){this.StarbucksScrimObj.dialog.hide()});dojo.connect(dojo.query(".starbucksScrimBtnNo")[0],"click",this,function(){this.StarbucksScrimObj.dialog.hide()});dojo.query(".dijit_scrim")[0].style.zIndex=1050;dj.widget.scrim.starbucksscrim.scrimTracking.omniturefirepixel()},_isWsjUser:function(){var a=this;dj.util.User.isOpenHouseUser("SDN",function(b){b&&dj.util.User.isLoggedIn(function(c){if(!c){a.setScrimAsSeen();a.initScrim()}})})}});
dojo.provide("dj.module.facebook.connect");dojo.require("dj.lang");dojo.require("dj.util.Region");dj.module.facebook.connect={init:function(a,b){if(typeof FB==="object"&&FB.XFBML)FB.XFBML.parse();else if(typeof FB!=="object"&&typeof FB==="undefined"){window.fbAsyncInit=function(){FB.init({appId:dj.context.facebook.appId,status:true,cookie:false,xfbml:true,oauth:true});FB.getLoginStatus(function(){if(typeof a=="function")b?a.apply(b):a()})};(function(){var c=document.createElement("script"),d,e=dj.util.Region.getViewByRegion(),h={"na,us":"en_US","asia,indo":"id_ID","asia,jp":"ja_JP","asia,kr":"ko_KR","europe,tr":"tr_TR",germany:"de_DE","sa,br":"pt_BR"};if(typeof e!=="undefined"&&e)d=h[e];c.src=typeof d!=="undefined"&&d?document.location.protocol+"//connect.facebook.net/"+d+"/all.js":document.location.protocol+"//connect.facebook.net/en_US/all.js";c.type="text/javascript";c.charset="utf-8";c.async=true;d=dojo.byId("fb-root");if(null==d)d=dojo.create("div",{id:"fb-root",style:{display:"none"}},dojo.body());dojo.place(c,d)})()}},registerFBConnect:function(a){if(typeof a=="undefined")a=fbScrimCFG;FB.getLoginStatus(function(b){console.log("Facebook connect staus: "+b.status);if(b.status=="connected"){dojo.require("dj.widget.loader.FBLoginLoader");dojo.require("dj.widget.accountscrim.FBLogin");(new dj.widget.loader.FBLoginLoader(a)).init()}})},fbConnected:function(a){if(typeof a=="undefined")a=fbScrimCFG;dojo.require("dj.widget.loader.FBConnectedLoader");dojo.require("dj.widget.accountscrim.FBConnected");(new dj.widget.loader.FBConnectedLoader(a)).initScrim()},fireScrimPixel:function(a){if(typeof setMetaData!="undefined"){var b=dj.util.Tracking.omniture.getMetaData("pagename"),c=dj.util.Tracking.omniture.getMetaData("ctype"),d=dj.util.Tracking.omniture.getMetaData("section"),e=dj.util.Tracking.omniture.getMetaData("subsection"),h=dj.util.Tracking.omniture.getMetaData("caccess"),g=dj.util.Tracking.omniture.getMetaData("qsymbol"),f=dj.util.Tracking.omniture.getMetaData("basesection");setMetaData("pagename",a);setMetaData("ctype","marketing and support");setMetaData("section","WSJ_Customer Resources");setMetaData("subsection","WSJ_Customer Resources");setMetaData("caccess","free");setMetaData("basesection","WSJ_FBconnect");setMetaData("qsymbol",null);dj.util.Tracking.omniture.firePixel();setMetaData("pagename",b);setMetaData("ctype",c);setMetaData("section",d);setMetaData("subsection",e);setMetaData("caccess",h);setMetaData("basesection",f);setMetaData("qsymbol",g)}},login:function(a){typeof FB=="undefined"?this.init(dj.module.facebook.connect.processLogin):this.processLogin(a)},processLogin:function(a,b){if(a)this.afterLoginURL=a;typeof b!="undefined"?FB.login(b,{scope:"publish_stream,email,read_stream,publish_actions"}):FB.login(dj.module.facebook.connect.afterLogin,{scope:"publish_stream,email,read_stream,publish_actions"})},afterLogin:function(a){if(a.authResponse){dj.util.Cookie.setCookie("djfbsr_"+dj.context.facebook.appId,'{"accessToken":"'+a.authResponse.accessToken+'","userID":"'+a.authResponse.userID+'","expiresIn":"0","signedRequest":"'+a.authResponse.signedRequest+'"}');if(dj.module.facebook.connect.afterLoginURL)location.href=dj.context.facebook.commerceFBConnectURL+"?url="+encodeURIComponent(dj.module.facebook.connect.afterLoginURL);else{oldUrlParts=location.href.split("?");location.href=dj.context.facebook.commerceFBConnectURL+"?url="+encodeURIComponent(oldUrlParts[0])}}},addConnectClick:function(a,b){var c=this;dj.lang.addLiveEvent(a,"click",function(d){dojo.stopEvent(d);c.login(b)})},displayMessage:function(a){a.url="";a.message="";typeof a.callback=="function"&&a.callback()},logout:function(a){dj.util.Cookie.deleteCookie("djfbsr_"+
dj.context.facebook.appId);FB.logout(a)},getUserID:function(){return FB.getAuthResponse()?FB.getAuthResponse().userID:null},getFBUserInfo:function(){var a;FB.api("/me",function(b){a=b});return a},checkQueryString:function(a){fbScrimCFG=a;var b=dojo.queryToObject(window.location.search.slice(1));if(typeof b.fbresult!="undefined")if(b.fbresult=="add")typeof FB=="undefined"?dj.module.facebook.connect.init(dj.module.facebook.connect.fbConnected):dj.module.facebook.connect.fbConnected(a);else if(b.fbresult=="register")typeof FB=="undefined"?dj.module.facebook.connect.init(dj.module.facebook.connect.registerFBConnect):dj.module.facebook.connect.registerFBConnect(a)},publish:function(a,b){if(typeof FB!="undefined"){if(FB.getAuthResponse()){myObj=a;myObj.method="stream.publish";myObj.preview=1;myObj.display="popup";FB.ui(myObj,b)}}else{console.error("User is not logged in or FB in undefined");b(false)}},showModalScrim:function(){var a=dojo.byId("fbscrim"),b=dojo.byId("fbscrim_content");a.style.display="block";b.style.display="block";dojo.query("div#fbscrim_content a.closebtn").connect("onclick",dj.module.facebook.connect.hideModalScrim)},hideModalScrim:function(){var a=dojo.byId("fbscrim"),b=dojo.byId("fbscrim_content");a.style.display="none";b.style.display="none"},openModalMessage:function(){}};dojo.provide("dj.module.facebook.api");dojo.require("dj.module.facebook.connect");dj.module.facebook.api={modValue:"fbconnect_wsj",numOfWords:40,truncateWords:function(a,b){var c="",d=a.split(" ");if(d.length>b){c="...";d=d.slice(0,b)}return d.join(" ")+c},addtracking:function(a,b){parseUri=function(g){var f=parseUri.options;g=f.parser[f.strictMode?"strict":"loose"].exec(g);for(var n={},m=14;m--;)n[f.key[m]]=g[m]||"";n[f.q.name]={};n[f.key[12]].replace(f.q.parser,function(k,i,j){if(i)n[f.q.name][i]=j});return n};parseUri.options={strictMode:false,key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}};var c=parseUri(a),d=c.protocol+"://"+c.host+c.path+"?",e=b?b:this.modValue,h;for(h in c.queryKey)if(String(h).toUpperCase()!="MOD")d+=h+"="+c.queryKey[h]+"&";d+="mod="+e;d+=c.anchor?"#"+c.anchor:"";return d},postAnswer:function(a){if(!(a.question&&a.answer&&a.questionPermalink))return false;var b=this.truncateWords(a.answer,this.numOfWords),c={name:a.question,href:this.addtracking(a.questionPermalink),caption:"WSJ.com"},d=[{text:"Answer",href:this.addtracking(a.questionPermalink)}];this.sendStream(b,c,d,a.callbackFn,a.callbackParams)},postArticleComment:function(a){if(!(a.comment&&a.commentPermalink))return false;JSON.stringify=function(g){return dojo.toJson(g)};var b=typeof AT_VARS!="undefined"?AT_VARS.articleUrl:a.commentPermalink,c=typeof AT_VARS!="undefined"?AT_VARS.seoHeadline:"";if(typeof c=="undefined")c=AT_VARS.articleHeadline;var d=typeof AT_VARS!="undefined"?AT_VARS.imgSizeA:"http://s.wsj.net/img/WSJ_profile_lg.gif",e=typeof AT_VARS!="undefined"&&typeof AT_VARS.bodyText!="undefined"?AT_VARS.bodyText.replace(/\+/g," "):"",h=this.truncateWords(a.comment,this.numOfWords);c={name:c,href:this.addtracking(b),description:unescape(e),caption:"WSJ.com"};if(d!=null)c.media=[{type:"image",src:d,href:this.addtracking(b)}];b=[{text:"Read the Article",href:this.addtracking(a.commentPermalink)}];this.sendStream(h,c,b,a.callbackFn,a.callbackParams)},postCreateGroup:function(a){if(!(a.groupName&&a.groupDescription&&a.groupPermalink))return false;var b={name:a.groupName,href:this.addtracking(a.groupPermalink),description:a.groupDescription,caption:"WSJ.com"},c=[{text:"Join this Journal Group",href:this.addtracking(a.groupPermalink)}];this.sendStream("",b,c,a.callbackFn,a.callbackParams)},postJoinGroup:function(a){if(!(a.groupName&&a.groupDescription&&a.groupPermalink))return false;var b={name:a.groupName,href:this.addtracking(a.groupPermalink),description:a.groupDescription,caption:"WSJ.com"},c=[{text:"Join this Journal Group",href:this.addtracking(a.groupPermalink)}];this.sendStream("",b,c,a.callbackFn,a.callbackParams)},postPollVote:function(a){if(!a)return null;params=dojo.fromJson(a);a="";JSON.stringify=function(c){return dojo.toJson(c)};for(var b=0;b<params.options.length;b++)a+=b+1+") "+params.options[b].value+" ";a={name:params.question,href:this.addtracking(window.location),description:a,media:[{type:"image",src:"http://s.wsj.net/img/WSJ_profile_lg.gif",href:this.addtracking(window.location)}]};b=[{text:"Related Article",href:this.addtracking(params.poll_meta.urlSrc)}];if(params.poll_meta.communityURLSrc!="")b=[{text:"Journal Community Group",href:this.addtracking(params.poll_meta.communityURLSrc)}];this.sendStream("voted on a Wall Street Journal poll",a,b,function(){},null)},postQuestion:function(a){if(!(a.question&&a.category&&a.questionPermalink))return false;var b=this.truncateWords(a.question,this.numOfWords),c={name:a.category,href:this.addtracking(a.questionPermalink),caption:"WSJ.com"},d=[{text:"Answer",href:this.addtracking(a.questionPermalink)}];this.sendStream(b,c,d,a.callbackFn,a.callbackParams)},postTopic:function(a){if(!(a.topic&&a.topicPermalink&&a.description))return false;var b=this.truncateWords(a.topic,this.numOfWords),c={name:a.topic,href:this.addtracking(a.topicPermalink),description:a.description,caption:"WSJ.com"},d=[{text:"Join the discussion",href:this.addtracking(a.topicPermalink)}];this.sendStream(b,c,d,a.callbackFn,a.callbackParams)},postTopicComment:function(a){if(!(a.comment&&a.commentPermalink&&a.topicName&&a.topicDescription&&a.topicPermalink))return false;var b=this.truncateWords(a.comment,this.numOfWords),c={name:a.topicName,href:this.addtracking(a.topicPermalink),description:a.topicDescription,caption:"WSJ.com"},d=[{text:"Join this discussion",href:this.addtracking(a.commentPermalink)}];this.sendStream(b,c,d,a.callbackFn,a.callbackParams)},sendStream:function(a,b,c,d,e){var h=-1;FB.getLoginStatus(function(g){g.session?dj.module.facebook.connect.publish({message:a,attachment:b,action_links:c},function(f){if(f){h=f.post_id;dj.module.facebook.api.omnitureEventCall("event56");d?d(e,dj.module.facebook.connect.getUserID(),h):console.log("success: "+h)}}):dj.module.facebook.connect.processLogin(document.location,dojo.hitch(this,dj.module.facebook.api.sendStream,a,b,c,d,e))});return h},omnitureEventCall:function(){if(typeof s!="undefined"){s.linkTrackVars="events";s.linkTrackEvents="event56";s.events="event56";s.tl(this,"o","fb_activity");s.linkTrackVars="None";s.linkTrackEvents="None"}}};dojo.provide("dj.util.ie9.pin");
dojo.require("dj.util.Tracking");

dj.util.ie9.pin = {
  siteMode : function() {
    var returnMode="";
    try {
      if (window.external.msIsSiteMode()) {
        returnMode="pinned";
      }
      else {
        returnMode="pinnable";
      }
      
    }
    catch(ex) {
      returnMode="notpinnable";
    }
    return returnMode;
  }
};
dojo.provide("dj.module.renderJumplist");
dojo.require("dj.util.ie9.pin");
dojo.require("dojo.window");

dj.module.renderJumplist = {
  init : function(args) {
    try
    {
        this.defaultArgs = {
          headlineCount:5,
          breakingNewsCount: 2,
          section_feed : {"section":  "Sports" ,"feedURL":  "/xml/rss/3_7041.xml" },    
          breakingNews_feed : {"section":  "Breaking News" ,"feedURL":  "/xml/rss/3_8998.xml" },    
          Mod :"WSJ_Pinned_exp",  
          wsj_ext:window.external,
          section_Icon: {"section":  "Sports" ,"icon":  "" }, 
          breakingNews_Icon: {"section":  "Breaking News" ,"icon":  "http://si.wsj.net/favicon.ico" },
          section_overlayIcon: {"section":  "Sports" ,"overlayIcon":  "http://si.wsj.net/favicon.ico" },
          clearOverlayTimer : 30000,
          renderFunctionTimer :5000,
          sitePinAlertContainer: "PinGroup",
          sitePinAlertCloseId: "PinGroupClose",
          sitePinAlertCloseTime: 1000,
          sitePinAlertAnimate: true,
          serverDomain: "http://online.f.dev.wsj.com",
          showBannerMode: "beforeClose",
          useNotificationIcon: true
        };
        dojo.mixin(this.defaultArgs, args);
        var mode = dj.util.ie9.pin.siteMode();
        if (mode !== undefined) {
          if (mode == "pinned" )
          {
            this.jumpListItems = [];
            this.renderFeed();
          }
          else if (mode == "pinnable" ) { 
            var isIE9BannerDisplayed = document.cookie.indexOf( "IE9BannerDisplayed=yes" ) >= 0;
            if (! isIE9BannerDisplayed) {
              this.siteAlertContainerObject = this.siteAlertContainerObject || dojo.byId(this.defaultArgs.sitePinAlertContainer);
              dojo.removeClass(this.siteAlertContainerObject, "hidden");
              if (this.defaultArgs.showBannerMode == "once") {
                document.cookie = "IE9BannerDisplayed=yes; path=/;";
              }
              this.siteAlertCloseObject = this.siteAlertCloseObject || dojo.byId(this.defaultArgs.sitePinAlertCloseId);
              var me = this;
              dojo.connect(this.siteAlertCloseObject, "click", null, function (ev) {
                if (me.defaultArgs.showBannerMode == "beforeClose") {
                  document.cookie = "IE9BannerDisplayed=yes; path=/;";
                }
                dojo.stopEvent(ev);
                if (me.defaultArgs.sitePinAlertAnimate) {
                  var myWindowBox = dojo.window.getBox();
                  dojo.animateProperty({
                    node:me.siteAlertContainerObject,
                    duration: me.defaultArgs.sitePinAlertCloseTime,
                    properties: {
                        height: { end:0 , units:"px" } 
                    }
                  }).play();                
                }
                else {
                  dojo.addClass(me.defaultArgs.sitePinAlertContainer, "hidden");
                }
              });
            }
        }
        }
    }catch(error)
    {
        console.log("{renderJumpList}Failing in init");
        console.log(error);
    }  
  },
  addJumplistItemsFrom:function(list, count, icon_text)
  {
    var newJumpListItems = [];
    try
      {
        if(this.defaultArgs.wsj_ext !== null)
        {
          var items = list;
          for(var i =0; i < count; i++){
             var item = items[i];
             newJumpListItems[i]=item.getElementsByTagName('link')[0].text;
             var title = item.getElementsByTagName('title')[0].text;
             var link = item.getElementsByTagName('link')[0].text.replace(/^\s+|\s+$/g,"");
             var lowercaseLink = link.toLowerCase();
             if (lowercaseLink.indexOf("javascript") === 0 ) {
               var openWinIndex = link.indexOf("dj.util.Url.openWin");
               if (openWinIndex != -1 ) {
                 var newLink = link.substring(openWinIndex + 19 );
                 var quoteIndexEnd = 0;
                 var quoteIndexStart = newLink.indexOf("'");
                 if (quoteIndexStart >= 0) {
                   quoteIndexEnd = newLink.indexOf("'",quoteIndexStart + 1); 
                   link = newLink.substr(quoteIndexStart + 1, quoteIndexEnd - quoteIndexStart - 1 ).replace(/^\s+|\s+$/g,"");
                   lowercaseLink = link.toLowerCase();
                 }
                 else {
                   quoteIndexStart = newLink.indexOf('"');
                   if (quoteIndexStart >= 0) {
                     quoteIndexEnd = newLink.lastIndexOf('"', quoteIndexStart + 1); 
                     link = newLink.substr(quoteIndexStart + 1, quoteIndexEnd - quoteIndexStart - 1 ).replace(/^\s+|\s+$/g,"");
                     lowercaseLink = link.toLowerCase();
                   }
                 }
               }
               else {
                 link = "";
                 lowercaseLink = link;
               }
             }
             var modIndexEnd = 0;
             var strippedModLink = "";
             var modIndexStart = lowercaseLink.indexOf("?mod=");             
             if (modIndexStart >= 0) {
               modIndexEnd = lowercaseLink.indexOf("&",modIndexStart + 1); 
               if (modIndexEnd == -1 ) {
                 strippedModLink = link.substr(0, modIndexStart);
               }
               else {
                 strippedModLink = link.substr(0, modIndexStart + 1) + link.substr(modIndexEnd); 
               }
               link = strippedModLink;
               lowercaseLink = link.toLowerCase();
             } 
             else {
               modIndexStart = lowercaseLink.indexOf("&mod=");             
               if (modIndexStart >= 0) {
                 modIndexEnd = lowercaseLink.indexOf("&",modIndexStart + 1); 
                 if (modIndexEnd == -1 ) {
                   strippedModLink = link.substr(0, modIndexStart);
                 }
                 else {
                   strippedModLink = link.substr(0, modIndexStart + 1) + link.substr(modIndexEnd); 
                 }
                 link = strippedModLink;
                 lowercaseLink = link.toLowerCase();
               }               
             }
             if (link.length >= 0 ) {
               var parametersChar = "?"; 
               if (lowercaseLink.indexOf("?") >= 0) {
                 parametersChar = "&";
               }
               if (lowercaseLink.indexOf("http") === 0 ) {
                 this.defaultArgs.wsj_ext.msSiteModeAddJumpListItem(title,link + parametersChar + "mod="+this.defaultArgs.Mod,icon_text);
               }
               else {
                   this.defaultArgs.wsj_ext.msSiteModeAddJumpListItem(title,this.defaultArgs.serverDomain+ link + parametersChar + "mod="+this.defaultArgs.Mod,icon_text);
               }
             }
          }
        }
      }
    catch(e)
    {
      console.log("{renderJumpList}Failing in addJumplistItemsFrom");
      console.log(e);      
    }
    return newJumpListItems;
  },
  renderFeed:function()
  {
  var that = this;
  try
    {   
      this.defaultArgs.wsj_ext.msSiteModeClearJumpList();
      var jumpItems=[];
      var breakingNewsList = this.getFeedList(this.defaultArgs.breakingNews_feed.feedURL); 
      var breakingNewsItemCount = 0;
      if (breakingNewsList) {
        breakingNewsItemCount = Math.min(this.defaultArgs.breakingNewsCount, breakingNewsList.length); 
      }      
      var sectionList = this.getFeedList(this.defaultArgs.section_feed.feedURL);
      var maxSectionItemCount = this.defaultArgs.headlineCount - breakingNewsItemCount;
      var sectionItemCount = 0;
      if (sectionList) {
        sectionItemCount = Math.min(maxSectionItemCount, sectionList.length); 
      } 
      if(this.defaultArgs.wsj_ext !== null)
      {
       this.defaultArgs.wsj_ext.msSiteModeCreateJumpList(this.defaultArgs.section_feed.section);
      }
      var ji = 0;
      for (var si=sectionItemCount-1; si >= 0;  si--) {
        jumpItems[ji++] = sectionList[si];
      }
      var usedSectionItems = this.addJumplistItemsFrom(jumpItems, sectionItemCount, this.defaultArgs.section_Icon.icon);
      ji = 0;
      jumpItems=[];
      for (var bni=breakingNewsItemCount-1; bni >= 0;  bni--) {
        jumpItems[ji++] = breakingNewsList[bni];
      }
      var usedBreakingNewsItems = this.addJumplistItemsFrom(jumpItems, breakingNewsItemCount, this.defaultArgs.breakingNews_Icon.icon);
      if (this.defaultArgs.useNotificationIcon) {
        var newJumpListItems = usedSectionItems.concat(usedBreakingNewsItems); 
        if (this.jumpListItems.length > 0 ) {
          var same = true; 
          for(var j =0; j <= this.defaultArgs.headlineCount && same; j++){
            if (newJumpListItems[j] != this.jumpListItems[j]) {
              same=false;
            }
          }
          if (! same ) {
            //If a timeout has been started, clear it so a new timeout can be started
            if (this._clearIconOverlay) {
              var clearOverlayTimeout = this._clearIconOverlay;
              this._clearIconOverlay = null;
              clearTimeout(clearOverlayTimeout);
            }
            this.defaultArgs.wsj_ext.msSiteModeSetIconOverlay(this.defaultArgs.section_overlayIcon.overlayIcon, this.defaultArgs.section_feed.section +" News");
          }
          if (! this._clearIconOverlay) {
            this._clearIconOverlay = setTimeout(function () {
              that._clearIconOverlay = null;
              window.external.msSiteModeClearIconOverlay();
            }, that.defaultArgs.clearOverlayTimer);
          }
        }
        this.jumpListItems = newJumpListItems;
      }
      this.defaultArgs.wsj_ext.msSiteModeShowJumplist();
      //Call function recursively to provide the latest news to the user and the respective notifications
      setTimeout(function () {
        that.renderFeed();
      }, that.defaultArgs.renderFunctionTimer); 
    }catch(error)
    {
      console.log(error);
      console.log("{renderJumpList}Failing in renderFeed");
    }
  },
  getFeedList:function(feedUrl)
  {
    var that = this;
  try
    { 
      dojo.xhrGet({
             url: feedUrl,
             handleAs: "xml",
             sync:true,
             preventCache: true,
             load: function (data,ioArgs){
                 try{
                   if(data !== null && data !== undefined)
                     {  
                       var items = data.getElementsByTagName('item');
                       that.returnList = items;
                     }
                 }
                 catch (e){
                     console.info("{renderJumpList}ERROR loading response", e);
                 }
             },
             error: function (response, ioArgs){
                 console.log("{renderJumpList}ERROR loading response" + response);
             }      
         });  
      return that.returnList;
    }catch(error)
    {
      console.log(error);
      console.log("{renderJumpList}Failing in getFeedList");
    }    
  }   
};
dojo.provide("dj.module.email.service.EmailThisService");

dj.module.email.service.EmailThisService = {
    
    sendEmail : function(url, postData, loadCallback, errorCallback, context) {

      var clientInfo ={
          loadCallback : loadCallback,
          errorCallback : errorCallback,
          context : context
      };
      this.sendEmailToUser(url, postData, {
        callback : this.handleSuccessResp,
        errorCallback : this.handleErrorResp,
        context : this,
        url : url,
        responseType: "application/json",
        clientInfo : clientInfo
      });
    },
    
    
    sendEmailToUser:function(url, postData, params){

      var xhrArgs = {
          url: url,
          handleAs: 'json',
          headers:{Accept:"application/json"},
          postData: postData,          
          load: dojo.hitch(this,function(data, ioargs) {
            params.callback.apply(params.context, [ data, ioargs.xhr, params ]); 
          }),
          error: dojo.hitch(this,function(error, ioargs) {
            params.errorCallback.apply(params.context, ["", ioargs.xhr, params ]);
          }) 
      };

      var deferred = dojo.xhrPost(xhrArgs);

    },
    
    handleErrorResp: function(response, xhr, params) {
      var resp = {};
      if(xhr.status == '404' || xhr.status == '500' || xhr.status == '415') {
        resp.error = "error";
      }else{
        resp = dojo.fromJson( xhr.responseText );
      }
      params.clientInfo.errorCallback.apply(params.clientInfo.context, [resp]);

    },
    handleSuccessResp : function(response, xhr, params) {
      var resp = dojo.fromJson( xhr.responseText );
      params.clientInfo.loadCallback.call(params.clientInfo.context, resp);
      //if(xhr.status == '200') {
//        if(response.recaptchaResult){
//          params.clientInfo.loadCallback.call(params.clientInfo.context, response);  
//        }else{
//          params.clientInfo.errorCallback.call(params.clientInfo.context, response);
//        }
        
      //}

    }

};
dojo.provide("dj.util.EmailUtils");

(function(){
  dj.util.EmailUtils = {

	addVideoParameters: function(data) {
      var wsjPrefix = 'WSJ_';
      var wsjLivePrefix = '';
      params = {};
      if(this.seekTime) { params.seekTime = this.seekTime; this.seekTime = null;}
      params.emailPartnerID = 110626;
      params.site = this.site;
      params.msrc = this.msrc;
      params.playerName = "video_live";
      params.embedPlayerURL = "";
      params.embedConfigURL = "";
      params.embedPlayerID = "1000";
      params.embedName = "video_live";
      params.embedBaseURL = "video_live";
      params.embedHeight = "";
      params.embedWidth = "";
      params.larsID= 91;
      params.larsAdTrackingID= 1259;
      if(this.playedOn) {
        params.lineupID = unescape(this.playedOn).toLowerCase().replace(/[^a-zA-Z0-9]/g, "");
      }

      params.prop59 = dj.util.Cookie.getCookie('referrerURL');
      if(params.prop59 === undefined || "" === params.prop59 || params.prop59 === null) {
    	  var ref = document.referrer;
    	  try{
    	  	  if(ref !== undefined && "" !== ref) {
    		  	  ref = ref.substring(ref.indexOf('http://')+7);
    		  	  params.prop59 = ref.substring(0, ref.indexOf('/'));
    	  	  }
      	  }catch(exp){}
      }

      params.prop60 = dj.util.Cookie.getCookie('sitereferrer');

      params.prop62 = wsjPrefix + data.tabCategory;
      var reg = dj.util.Region.getViewByRegion();
      try{
        var editionToNameMap = dj.util.Omniture.editionToNameMap;
        params.prop24 =  editionToNameMap[reg.toLowerCase()];
      }catch(e){}

      params.pageName = "Video_article type_"+ data.id;

      params.prop1= 'Video';
      params.prop13= data.adZone;
      params.prop20 = "video_"+data.id;
      params.prop21 = wsjLivePrefix + data.author;
      params.prop23 = "video_"+ data.formattedCreationDate;

      params.prop27= "";
      try {
          dj.util.User.isLoggedIn(function(isLoggedIn){
            if (isLoggedIn) {
                dj.util.User.isSubLoggedIn(function(subLoggedIn) {
                    if (subLoggedIn) {
                      dj.util.User.hasRole('WSJ-PRO', function(hasRole) {
                       if (hasRole) {
                          wsjPrefix = 'WSJPRO_';
                          params.prop27 = 'WSJ_proc_sub_yes';
                        }else{
                            dj.util.User.hasRole('WSJ-ENT', function(hasRole) {
                                if (hasRole) {
                                   wsjPrefix = 'WSJPRO_';
                                   params.prop27 = 'WSJ_proe_sub_yes';
                                 }else{
                                 params.prop27 = 'WSJ_sub_yes';
                                 }
                               });
                        }
                      });

                    } else {
                      params.prop27 = 'WSJ_mem_yes';
                    }

                  });
            }
            else {
              if (params.cookieUserType === null || params.cookieUserType !== "subscribed") {
                params.prop27 = 'WSJ_free';
              }
              else {
                params.prop27 = 'WSJ_reg_yes';
              }
            }
          });
        } catch (pErr) {
          try{
                if (params.cookieUserType === null || params.cookieUserType !== "subscribed") {
                  params.prop27 = 'WSJ_free';
                }
                else {
                  params.prop27 = 'WSJ_reg_yes';
                }
          }catch(cookErr){}
        }

      var subSecComponent = "";
      var secComponent = "";

      try{
	      if(dj.utils && dj.utils.VideoUtils) {
	    	  subSecComponent = dj.utils.VideoUtils.omnitureEncoding(data['wsj-section'], data['wsj-subsection'], 's');
	    	  secComponent = dj.utils.VideoUtils.omnitureEncoding(data['wsj-section'], data['wsj-subsection'], 'c');
	      } else {
	    	  subSecComponent = dj.util.VideoUtils.omnitureEncoding(data['wsj-section'], data['wsj-subsection'], 's');
	    	  secComponent = dj.util.VideoUtils.omnitureEncoding(data['wsj-section'], data['wsj-subsection'], 'c');
	      }
      } catch(utilExp){
    	  console.log('Error in the om:'+ utilExp);
      }

      if( (typeof secComponent === undefined || secComponent === null) && params.tabCategory == "Partner Channel"){
        secComponent = params.tabCategory;

        if( (typeof subSecComponent === undefined || subSecComponent === null) && params.tabCategory == "Partner Channel"){
          subSecComponent = params.subTabCategory;
        }
      }

      params.appName = wsjPrefix.substring(0, wsjPrefix.length-1);
      params.appType = "";
      params.section = secComponent;
      params.subsection = subSecComponent;

      params.prop2 = wsjLivePrefix + secComponent;
      params.prop3 = wsjLivePrefix + "Video_" + secComponent;
      params.prop4 = wsjLivePrefix + "Video_" + secComponent + "_" + data.titletag + "_" +data.duration;

      params.prop26 = wsjLivePrefix + subSecComponent;

      params.prop5= window.location.href.split('?')[0];
      params.prop6= window.location.href;
      params.prop7= "off";
      params.prop8= "video_" + data.doctypeID;
      params.prop9 = 'free';


      try{
        //set flag
        if(dj.util.Page.getQueryParam("mod") && "" !== dj.util.Page.getQueryParam("mod")) {
          params.prop10= dj.util.Page.getQueryParam("mod");
        } else {
          params.prop10= dj.util.Page.getQueryParam("link");
      }
      }catch(errF){}


      params.prop16 = "WSJLive_video_" +data.subTabCategory;

      params.campaign= params.prop10; //dj.util.Page.getQueryParam("mod");
      try{
        var refVal = document.referrer;

        if(refVal && "" !== refVal) {
          refVal = refVal.substring(refVal.indexOf("//")+2);
          var domain = refVal.substring(0, refVal.indexOf("/"));
          domain = domain.toLowerCase();

        }
      }catch(refErr){
      }

      params.prop25= dj.util.Cookie.getCookie('TR');

      try {
        params.cookieUserType = dj.util.Cookie.getCookie("user_type");
      } catch (paramErr) {
        console.error("cookie read error while fetching cookieUserType : "+e);
      }

      //TODO: remove global 'pID'
      var suprsAd = ((typeof pID === "string") && (pID.indexOf('0_0_WH') != -1)) ? '1' : '0';

      params.suppressAds = suprsAd;
      return params;
    },


    _setOmnitureData: function(omObject, that) {
	  	for (var key in omObject) {
	      	if (typeof key !== undefined) {
	      		that.omniture.pixel._s[key] = omObject[key];
	      	}
	      }
    },


    isBlog: function() {
    	try{
	    	var isBlogs = document.domain.indexOf('blogs')==-1 ? false:true;
	    	if(isBlogs){
	    		return true;
	    	} else if(typeof pID !== undefined && pID !== null && pID === 'blogs') {
	    		return true;
	    	}
	    	return false;
    	}catch(isblogErr){
    		console.log('Error while checking for blog pages: '+isblogErr);
    	}
    	return false;
    }


  };
}());
dojo.provide("dj.module.email.EmailThisForm");
dojo.require("dj.util.Form");
dojo.require("dj.module.email.service.EmailThisService");
dojo.require("dj.util.User");
dojo.require("dj.util.EmailUtils");


dj.module.email.EmailThisForm = {

    DEFAULT_CONFIG : {
      mod:"wsj_valettop_email",
      url:"",
      title:"",
      aheadline:"",
      type:"article",
      emailVideoInfo: {},
      serviceUrl:"/cdssvco/emailThis/v1/sendEmail",
      //url:"/cdssvco/recaptcha/v1/recaptcha",
      recaptchaPublicKey:"6LdsXtkSAAAAAO_SUY_Il1uV_TsP-37nbN2bMsik",
      emailDelimiter:",",
      EMAIL_COUNT:20,
      mobileSubjectP: "",
      mobileSubjectS: "",
      errorCodes:{
        'invalidEmailAddress':'invalidEmailAddress',
        'invalidDelimiter':'invalidDelimiter',
        'blankEmailAddress':'blankEmailAddress',
        'emptyRecaptchaCd':'emptyRecaptchaCd',
        'invalidRecaptchaCd':'invalidRecaptchaCd',
        'tooManyEmailAddresses':'tooManyEmailAddresses'
      }

    },

    ELEMENT_CONFIG : {
      emailScrimId:"emailThisScrim",
      emailConfScrimId:"emailConfScrim",
      emailScrimSubmitId:"emailScrimSubmit",
      emailThisAddressToId:"emailThisAddressTo",
      emailThisAddressFromId:"emailThisAddressFrom",
      emailThisAddressToErrorId:"emailThisAddressToError",
      emailThisAddressFromErrorId:"emailThisAddressFromError",
      emailThisMsgId:"emailThisMsg",
      emailScrimCloseBtn:".emailScrimCloseBtn",
      emailConfScrimCloseBtn:"emailConfScrimCloseBtn",
      recaptchaError:"recaptchaError",
      emailErrorScrim:"emailErrorScrim",
      emailErrorScrimCloseBtn:"emailErrorScrimCloseBtn",
      clearField: ".clearField",
      emailThisAddressTo: "emailThisAddressTo",
      reopenEmailScrimFromError:"reopenEmailScrimFromError"
    },

    init:function(cfg, elementsCfg, isMobile){
      this._cfg = dojo.mixin(this.DEFAULT_CONFIG, cfg);
      this._eleCfg = dojo.mixin(this.ELEMENT_CONFIG, elementsCfg);

      if(isMobile){
    	  this.sendMail();
    	  return true;
      } else {
    	  this.resetForm();
          this.initiateOmnitureVar();
          this.clearForm();
      }
      if(this.showEmailForm() ){//&& (typeof this.isScrimInitialized == undefined || this.isScrimInitialized == false )){
    	this.addEvents();
        this.populateUserEmail();
        if(typeof this.isScrimInitialized == "undefined" || this.isScrimInitialized === false ){
          this.isScrimInitialized = true;
          this.makeEmailScrimConnections();
        }
        //showRecaptcha();
      }
    },

    addEvents:function(){
    	if(dojo.query(this._eleCfg.clearField).length > 0) {
	    	dojo.connect(dojo.query(this._eleCfg.clearField)[0], "onclick", this, function(e) {
	            dojo.stopEvent(e);
	            dojo.byId(this._eleCfg.emailThisAddressTo).value = '';
	            dojo.addClass(dojo.query(this._eleCfg.clearField)[0],"hidden");
			});
	    	if(dojo.byId(this._eleCfg.emailThisAddressTo)) {
			dojo.connect(dojo.byId(this._eleCfg.emailThisAddressTo), "onkeypress", this, function(event) {
			            var chCode = ('charCode' in event) ? event.charCode : event.keyCode;
			            if(chCode === 44)
			            {
			                dojo.query(this._eleCfg.clearField).removeClass('hidden');
			            }
			});
	    	}
    	}
    },

    initiateOmnitureVar:function(){
      this.omniture = {
          saveVars: ["pageName","events","section","atype","aheadline","author", "ctype"],
          saveValues: [],
          ctype: "tools_article_emailconfirm",
          cbtype: "tools_blog_emailconfirm",
          cstype: "tools_slideshow_email",
        cvtype: "tools_video_email",
          errCtype: "tools_article_emailerror",
          errCbtype: "tools_blog_emailerror",
          errCstype: "tools_slideshow_emailerror",
          errCvtype: "tools_video_emailerror",
          section: "Research and Tools",
          atype: "_Research and Tools",
          events: "event12,event89",
          errEvents: "event12",
          aheadline: "",
          author: "",
          pageNameSuffix: "_emailconfirmation",
          errPageNameSuffix: "_emailfailure"
      };
    },

    populateUserEmail:function(){

          var userEmail = this.getUserEmail();
          if(typeof userEmail !== "undefined" && userEmail !== null && dj.lang.trim(userEmail) !== ""){
            var emailAddressFrom = dojo.byId(this._eleCfg.emailThisAddressFromId);
            if(emailAddressFrom !== null && typeof emailAddressFrom !== "undefined"){
              emailAddressFrom.value = userEmail;
            }
          }

    },

    showEmailForm:function(){
      this.resetForm();
       var emailScrim = dojo.byId(this._eleCfg.emailScrimId);
       var isSuccess = false;
       if(emailScrim !== null){
         dojo.removeClass(emailScrim,"hidden");
         isSuccess = true;
       }
       if(typeof Recaptcha != "undefined"){
         Recaptcha.reload();
       }else{

         dj.util.User.isLoggedIn(dojo.hitch(this,function(isLoggedIn) {
           if (!isLoggedIn) {

             if(document.domain.indexOf('smartmoney') !== -1){
               var smartMoneyCookie = dj.util.Cookie.getCookie("SMID");
               if(smartMoneyCookie === null || dj.lang.trim(smartMoneyCookie) === ""){
                   this.includeRecaptchaJS(dojo.byId("recaptcha_div"));
               }
             }else{
               this.includeRecaptchaJS(dojo.byId("recaptcha_div"));
             }

           }
         }));

       }

       return isSuccess;
    },


    hideEmailForm:function(){
      var emailScrim = dojo.byId(this._eleCfg.emailScrimId);
      if(emailScrim !== null){
        dojo.addClass(emailScrim,"hidden");
        return true;
      }
   },


   showEmailConfForm:function(){
     var emailConfScrim = dojo.byId(this._eleCfg.emailConfScrimId);
     if(emailConfScrim !== null){
       dojo.removeClass(emailConfScrim,"hidden");
       return true;
     }
  },

  hideEmailConfForm:function(){
    var emailConfScrim = dojo.byId(this._eleCfg.emailConfScrimId);
    if(emailConfScrim !== null){
      dojo.addClass(emailConfScrim,"hidden");
      return true;
    }
 },

 showEmailErrorForm:function(){
   var emailErrorScrim = dojo.byId(this._eleCfg.emailErrorScrim);
   if(emailErrorScrim !== null){
     dojo.removeClass(emailErrorScrim,"hidden");
     return true;
   }
  },

  hideEmailErrorForm:function(){
    var emailErrorScrim = dojo.byId(this._eleCfg.emailErrorScrim);
    if(emailErrorScrim !== null){
      dojo.addClass(emailErrorScrim,"hidden");
      return true;
    }
  },

    makeEmailScrimConnections:function(){
	  if(dojo.byId(this._eleCfg.emailScrimSubmitId)) {
	      dojo.connect(dojo.byId(this._eleCfg.emailScrimSubmitId), "onclick", this, function(e) {
	        dojo.stopEvent(e);
	        if(this.isFormValidated()){
	           this.resetForm();
	           this.postEmailData();
	        }
	        //call service
	      });
	  }

	  if(dojo.query(this._eleCfg.emailScrimCloseBtn).length > 0) {
	      dojo.query(this._eleCfg.emailScrimCloseBtn).connect("onclick", this, function(e) {
	          this.hideEmailForm();
	          var cancleBtn = dojo.byId(e.target);
	          if(dojo.hasClass(cancleBtn, 'popupwindow')){
	        	  window.close();
	          }
	      });
	  }

    },

    isFormValidated:function(){
      this.resetForm();
      var isFormValid = true;
      var errorText = "";
      this.emailAddressTo = dojo.byId(this._eleCfg.emailThisAddressToId);
      if(this.emailAddressTo !== null && typeof this.emailAddressTo !== "undefined"){
        this.emailAddressToVal = this.emailAddressTo.value;
        if(this.chkEmpty(this.emailAddressToVal)){
           if(!this.isValidToEmailAddress(this.emailAddressToVal)){
              errorText = dojo.byId(this._cfg.errorCodes.invalidEmailAddress).innerHTML;
              dojo.byId(this._eleCfg.emailThisAddressToErrorId).innerHTML = errorText;
              dojo.removeClass(this._eleCfg.emailThisAddressToErrorId,"hidden");
              dojo.addClass(this.emailAddressTo,"emailError");
              isFormValid = false;
           }else{
             if(!this.isEmailCountValid(this.emailAddressToVal)){
               errorText = dojo.byId(this._cfg.errorCodes.tooManyEmailAddresses).innerHTML;
               dojo.byId(this._eleCfg.emailThisAddressToErrorId).innerHTML = errorText;
               dojo.removeClass(this._eleCfg.emailThisAddressToErrorId,"hidden");
               dojo.addClass(this.emailAddressTo,"emailError");
               isFormValid = false;
             }
           }
        }else{
          errorText = dojo.byId(this._cfg.errorCodes.blankEmailAddress).innerHTML;
          dojo.byId(this._eleCfg.emailThisAddressToErrorId).innerHTML = errorText;
          dojo.removeClass(this._eleCfg.emailThisAddressToErrorId,"hidden");
          dojo.addClass(this.emailAddressTo,"emailError");
          isFormValid = false;

        }
      }

      this.emailAddressFrom = dojo.byId(this._eleCfg.emailThisAddressFromId);
      if(this.emailAddressFrom !== null && typeof this.emailAddressFrom !== "undefined"){
        this.emailAddressFromVal = this.emailAddressFrom.value;
        if(this.chkEmpty(this.emailAddressFromVal)){
           if(!this.isValidEmailAddress(this.emailAddressFromVal)){
              errorText = dojo.byId(this._cfg.errorCodes.invalidEmailAddress).innerHTML;
              dojo.byId(this._eleCfg.emailThisAddressFromErrorId).innerHTML = errorText;
              dojo.removeClass(this._eleCfg.emailThisAddressFromErrorId,"hidden");
              dojo.addClass(this.emailAddressFrom,"emailError");
              isFormValid = false;
           }
        }else{
          errorText = dojo.byId(this._cfg.errorCodes.blankEmailAddress).innerHTML;
          dojo.byId(this._eleCfg.emailThisAddressFromErrorId).innerHTML = errorText;
          dojo.removeClass(this._eleCfg.emailThisAddressFromErrorId,"hidden");
          dojo.addClass(this.emailAddressFrom,"emailError");
          isFormValid = false;
        }
      }



      if(typeof Recaptcha != "undefined"){
        var userResp = Recaptcha.get_response();
        if(userResp !== null && typeof userResp != "undefined" && dj.lang.trim(userResp) === ""){

          errorText = dojo.byId(this._cfg.errorCodes.emptyRecaptchaCd).innerHTML;
          dojo.byId(this._eleCfg.recaptchaError).innerHTML = errorText;
          dojo.removeClass(this._eleCfg.recaptchaError,"hidden");
          isFormValid = false;

        }
      }

      return isFormValid;
    },

    isValidToEmailAddress:function(emailAddress){
      var emailArr = emailAddress.split(this._cfg.emailDelimiter);
      for(var i=0;i<emailArr.length;i++){
        var isValid = this.isValidEmailAddress(dj.lang.trim(emailArr[i]));
        if(!isValid){
          return false;
        }
      }
      return true;
    },


    isEmailCountValid:function(emailAddress){
      var emailArr = emailAddress.split(this._cfg.emailDelimiter);
      if(emailArr.length > this._cfg.EMAIL_COUNT){
        return false;
      }
      return true;
    },

    isValidEmailAddress: function (emailAddress) {
      //if (window.console) console.log("in isValidEmailAddress");
      return dj.util.Form.validateEmailAddresses(emailAddress);
    },

    chkEmpty: function(value) {
      if(typeof value != "undefined") {
        if(dj.lang.trim(value) === "" ) {
          return false;
        } else {
          return true;
        }
      }
      return false;
    },

    getEmailThisMsg:function(){
      var msg = "";
      var msgEle = dojo.byId(this._eleCfg.emailThisMsgId);
      if(this.chkEmpty(msgEle.value)){
        msg = msgEle.value;
      }
      return msg;
    },

    sendMail:function() {
       var prefix = this.populateData();
       var subject = this._cfg.title;
       var articleHeadline = this._cfg.aheadline;
       var articleLink = this._cfg.url;

       var subPrefix = this._cfg.mobileSubjectP;
       var subSuffix = this._cfg.mobileSubjectS;
       var userEmail = this.getUserEmail();
       if(userEmail === undefined || userEmail === null || userEmail === "")
       {
    	   userEmail =" ";
       }
	   var link = "mailto:?subject=" + subject + "&body=" + subPrefix + " " + articleHeadline + escape ("\n\n") + articleLink + escape ("\n\n") + subSuffix + "&cc=" + userEmail;
	   window.location.href = link;
    },


    populateData:function() {

    	var subject = "";
        var articleHeadline = "";
        var articleLink = "";

        var prefix = "WSJ.com - ";
        if(document.domain.indexOf('barrons') !== -1){
          prefix = "Barrons.com - ";
        }

        //Set the configuration type attribute.
        if(this._cfg.type === undefined || this._cfg.type === null || this._cfg.type === "")
        {
      	  var isBlogs = dj.util.EmailUtils.isBlog();
      	  if(isBlogs) {
      		  this._cfg.type = "blogs";
      		  this.setTitleAndURL();
      	  } else {
      		  this._cfg.type = "article";
      	  }
        }

        //Set the title, url and subject
        if(this._cfg.type === "video" || this._cfg.type === "blogs" || this._cfg.type === "guides"){
          if(this._cfg.type === "video" ){
            prefix = "WSJ Video - ";
            if(this._cfg.videoURL){
          	  this._cfg.url = this._cfg.videoURL;
            }
          } else if(this._cfg.type === "blogs" ){
            prefix = "WSJ Blogs - ";
            if(document.domain.indexOf('barrons') !== -1){
              prefix = "Barrons.com - ";
            }
          } else if(this._cfg.type === "guides" ){
            prefix = "WSJ Guides - ";
          }
          this.setTitleAndURL();
          this._cfg.title = prefix + this._cfg.title;

        } else if(this._cfg.type === "page"){
            this.setTitleAndURL();
            this._cfg.title = prefix + this._cfg.title;
         } else {

            if(typeof window.AT_VARS != "undefined" && window.AT_VARS !== null){
              if(typeof window.AT_VARS.clickTitle != "undefined" && window.AT_VARS.clickTitle !== ""){
                this._cfg.title = window.AT_VARS.clickTitle;
              }
              if(typeof window.AT_VARS.articleHeadline != "undefined" && window.AT_VARS.articleHeadline !== ""){
                this._cfg.aheadline = window.AT_VARS.articleHeadline;
              } else if(typeof this._cfg.aheadline === "undefined" || this._cfg.aheadline === null || this._cfg.aheadline === ''){
            	  this._cfg.aheadline  = this._cfg.title;
              }
              this._cfg.url = this.getArticleLink();

            }
        }// End of else

        return prefix;

    },

    postEmailData:function(){
      var challenge = "";
      var response = "";
      if(typeof Recaptcha != "undefined"){
        challenge = Recaptcha.get_challenge();
        response = Recaptcha.get_response();
      }

      var prefix = this.populateData();

      var subject = encodeURIComponent(this._cfg.title);
      var articleHeadline = encodeURIComponent(this._cfg.aheadline);
      var articleLink = this._cfg.url;

      if(articleLink.indexOf("?") > -1 ){
        articleLink = articleLink + "&mod=" + this._cfg.mod;
      }else{
        articleLink = articleLink + "?mod=" + this._cfg.mod;
      }

      var postData = {
          to: encodeURIComponent(this.emailAddressToVal),
          from: encodeURIComponent(this.emailAddressFromVal),
          subject: subject,
          body: encodeURIComponent(this.getEmailThisMsg()),
          articleHeadline: articleHeadline,
          articleLink: encodeURIComponent(articleLink),
          challenge:encodeURIComponent(challenge),
          response:encodeURIComponent(response)
      };

      if(dojo.byId("ccMeChkBox") !== null && typeof dojo.byId("ccMeChkBox") !== "undefined" ){
        var isChecked = dojo.byId("ccMeChkBox").checked;
        if(isChecked){
          postData.cc = postData.from;
        }
     }


      dj.module.email.service.EmailThisService.sendEmail(this._cfg.serviceUrl,  dojo.toJson(postData), this.load, this.error, this);


//
//      var xhrArgs = {
//          url: "/public/page/0_1_WG_EmailThisService.json",
//          handleAs: 'json',
//          content: postData,
//          load: dojo.hitch(this,function(data) {
//            if (data && data.success && data.success === true) {
//                this.hideEmailForm();
//                this.showEmailConfForm();
//            }else{
//              console.error("email thrown error ");
//            }
//          }),
//          error: dojo.hitch(this,function(error) {
//            //dojo.query(emailThis.errorMessages.to).append(emailThis.failedMessage);
//            console.error("email thrown error " + error);
//          })
//      };
//
//      var deferred = dojo.xhrPost(xhrArgs);

    },


    setTitleAndURL:function(){
      if(typeof this._cfg.title === "undefined" || this._cfg.title === null || this._cfg.title === ''){
    	var title = this.getClickTitle();
    	if(typeof title !== "undefined" && title !== null && title !== ''){
    		title = title.replace(' - WSJ','');
    		this._cfg.title = title;
    	}
      }
      if(typeof this._cfg.url === "undefined" || this._cfg.url === null || this._cfg.url === ''){
        this._cfg.url = this.getEmailURL();
      }
      this._cfg.aheadline  = this._cfg.title;
    },


    load:function(resp){

      if(typeof resp != "undefined" &&  typeof resp.emailSuccess != "undefined" && resp.emailSuccess){
        this.hideEmailForm();
        this.showEmailConfForm();
        if(dojo.byId(this._eleCfg.emailConfScrimCloseBtn)){
	        dojo.connect(dojo.byId(this._eleCfg.emailConfScrimCloseBtn), "onclick", this, function(e) {
	          this.hideEmailConfForm();
	        });
        }
        this.omniturefirepixel(false);
      }else{
        this.showErrorScreen();
      }


    },

    error:function(resp){
      if(typeof resp.reCaptchaValid != "undefined" && !resp.reCaptchaValid){
        var errorText = dojo.byId(this._cfg.errorCodes.invalidRecaptchaCd).innerHTML;
        dojo.byId(this._eleCfg.recaptchaError).innerHTML = errorText;
        dojo.removeClass(this._eleCfg.recaptchaError,"hidden");
      }else{
        this.showErrorScreen();
        console.error("email thrown error " + error);
      }
    },


    showErrorScreen:function(){

      this.hideEmailForm();
      this.showEmailErrorForm();

      if(dojo.byId(this._eleCfg.reopenEmailScrimFromError)) {
	      dojo.connect(dojo.byId(this._eleCfg.reopenEmailScrimFromError), "onclick", this, function(e) {
	        this.clearForm();
	        this.hideEmailErrorForm();
	        this.getUserEmail();
	        this.showEmailForm();
	      });
      }

      if(dojo.byId(this._eleCfg.emailErrorScrimCloseBtn)) {
	      dojo.connect(dojo.byId(this._eleCfg.emailErrorScrimCloseBtn), "onclick", this, function(e) {
	        this.hideEmailErrorForm();
	      });
      }
      this.omniturefirepixel(true);

    },

    getUserEmail:function(){
      var userEmail = "";


      dj.util.User.isLoggedIn(dojo.hitch(this,function(isLoggedIn) {
        if (isLoggedIn) {



      if(dojo.byId("userEmailId_temp") !== null && typeof dojo.byId("userEmailId_temp") !== "undefined"){
        dojo.byId("userEmailId_temp").innerHTML = "";
      }else{
        dojo.addClass(dojo.create("div", {id:"userEmailId_temp"},dojo.body()),"hidden");
      }
      dj.util.User.renderEmailAddress("userEmailId_temp");

      userEmail = dojo.byId("userEmailId_temp").innerHTML;

      if(userEmail == "undefined" || typeof userEmail == "undefined"){
        userEmail = "";
      }

        }
      }));

      return userEmail;

    },


    clearForm:function(){
      var emailAddressTo = dojo.byId(this._eleCfg.emailThisAddressToId);
      if(emailAddressTo !== null){
        emailAddressTo.value="";
      }

      var emailThisAddressFrom = dojo.byId(this._eleCfg.emailThisAddressFromId);
      if(emailThisAddressFrom !== null){
        emailThisAddressFrom.value="";
      }

      var emailThisMsg = dojo.byId(this._eleCfg.emailThisMsgId);
      if(emailThisMsg !== null){
        emailThisMsg.value="";
      }

    },

    resetForm:function(){

      dojo.removeClass(this._eleCfg.emailThisAddressToId,"emailError");
      dojo.removeClass(this._eleCfg.emailThisAddressFromId,"emailError");
      dojo.addClass(this._eleCfg.emailThisAddressToErrorId,"hidden");
      dojo.addClass(this._eleCfg.emailThisAddressFromErrorId,"hidden");
      dojo.addClass(this._eleCfg.recaptchaError,"hidden");

    },


    includeRecaptchaJS:function(containerDiv){
      var that = this;

      var jsonArgs = {

          url: "http://www.google.com/recaptcha/api/js/recaptcha_ajax.js",
          checkString : "Recaptcha",
          load: dojo.hitch(this, function(){
            if(typeof recaptchaCalled == "undefined"){
              showRecaptcha();
            }else{
              Recaptcha.reload();
            }


          }),
          error: function(error){
            console.error("twitter feed couldn't be laoded");
          }
        };
        dojo.io.script.get(jsonArgs);
    },


    omniturerestorepixel: function() {
        // need to save pixel info for each panel
        var svlen=this.omniture.saveVars.length;
        for ( var f=0; f<svlen; f++) {
            this.omniture.pixel.setMetaData(this.omniture.saveVars[f],this.omniture.saveValues[f]);
        }
    },
    omnituresavepixel: function() {
        // need to save pixel info for each panel
        var svlen=this.omniture.saveVars.length;
        for ( var f=0; f<svlen; f++) {
            this.omniture.saveValues[f] = this.omniture.pixel.getMetaData(this.omniture.saveVars[f]);
        }
    },

    omniturefirepixel: function(errorFlag) {

     try{

      if(!this.omniture.pixel){
        this.omniture.pixel=dj.util.Tracking.omniture;
      }
      if(this.omniture.pixel._s === undefined || this.omniture.pixel._s === null){
        this.omniture.pixel.init();
      }
      var cType = this._cfg.type;
      if(cType !== undefined && cType === 'video'){
      var videoinfo = {};
      if(dj.context.eamilThisST && dj.context.eamilThisST.videoInfo){
    	  videoinfo = dj.context.eamilThisST.videoInfo;
      } else if(this._cfg.emailVideoInfo) {
    	  videoinfo = this._cfg.emailVideoInfo;
      }
      var newData = dj.util.EmailUtils.addVideoParameters(videoinfo);
      dj.util.EmailUtils._setOmnitureData(newData, this);
      }

      var getPageName = this.omniture.pixel.getMetaData("pageName");

        this.omniture.pixel.resetPixel();
        this.omnituresavepixel();

        var isBlogs = dj.util.EmailUtils.isBlog();

        if(isBlogs) {
          if(errorFlag){
            this.omniture.pixel.setMetaData("ctype",this.omniture.errCbtype);
          } else {
            this.omniture.pixel.setMetaData("ctype",this.omniture.cbtype);
          }
        } else if(cType !== undefined && cType === 'video') {
          if(errorFlag){
            this.omniture.pixel.setMetaData("ctype",this.omniture.errCvtype);
          } else {
            this.omniture.pixel.setMetaData("ctype",this.omniture.cvtype);
          }
          this.omniture.pixel._s.prop4="";
        } else if(cType !== undefined && cType === 'slideshow') {
            if(errorFlag){
                this.omniture.pixel.setMetaData("ctype",this.omniture.errCstype);
              } else {
                this.omniture.pixel.setMetaData("ctype",this.omniture.cstype);
              }
            this.omniture.pixel._s.prop4="";
        } else {
            if(errorFlag){
                this.omniture.pixel.setMetaData("ctype",this.omniture.errCtype);
              } else {
                this.omniture.pixel.setMetaData("ctype",this.omniture.ctype);
              }
            this.omniture.pixel._s.prop4="";
        }
        if(errorFlag){
          this.omniture.pixel._s.events=this.omniture.errEvents;
          this.omniture.pixel._s.emailEvent=this.omniture.errEvents;
          this.omniture.pixel.setMetaData("pageName",getPageName+this.omniture.errPageNameSuffix);
        } else {
          this.omniture.pixel._s.events=this.omniture.events;
          this.omniture.pixel._s.emailEvent=this.omniture.events;
          this.omniture.pixel.setMetaData("pageName",getPageName+this.omniture.pageNameSuffix);
        }

        this.omniture.pixel._s.prop21="";
        this.omniture.pixel.setMetaData("section",this.omniture.section);
        //this.omniture.pixel.setMetaData("aheadline",this.omniture.aheadline);

        var atype = this.omniture.pixel.getMetaData('atype');
        if(atype !== undefined && atype !== null && atype !== "") {

          var arr = [];
          arr = atype.split('_');
          if(arr !== undefined && arr.length > 1) {
            var atypeEnd = "";
            for(var i=1; i< arr.length ; i ++) {
              atypeEnd = atypeEnd + "_" + arr[i];
            }

            this.omniture.pixel.setMetaData("atype",arr[0]+this.omniture.atype+atypeEnd);
          }

        }
        this.omniture.pixel.setMetaData("author",this.omniture.author);


        this.omniture.pixel.firePixel(true);
        this.omniturerestorepixel();
     }catch(omError){
  	   console.log('error while makin om call for email clickability' +omError);
     }
    },

    getArticleLink:function(){
    	var articleLink = window.location.href;
    	try{
	    	if(typeof this._cfg.url !== "undefined" && this._cfg.url !== null && this._cfg.url !== ''){
	    		articleLink = this._cfg.url;
	    	}
    	}catch(urlErr){
    		articleLink = window.location.href;
    	}

      dj.util.User.isLoggedIn(function(isLoggedIn) {
        if (isLoggedIn) {
          if(typeof window.AT_VARS.articleEmailUrl != "undefined" && window.AT_VARS.articleEmailUrl !== ""){
            articleLink = window.AT_VARS.articleEmailUrl;
          }
        }else{
          if(typeof window.AT_VARS.articleUrl != "undefined" && window.AT_VARS.articleUrl !== ""){
            articleLink = window.AT_VARS.articleUrl;
          }
//          var canonicals=dojo.query('link[rel = canonical]');
//          if ( canonicals.length > 0 ) {
//              canonicalUrl = canonicals[0].href ? canonicals[0].href : "";
//              articleLink = canonicalUrl;
//          }
        }
      });
      return articleLink;
    },

    getClickURL: function() {
        if (self.clickURL) {
          return self.clickURL;
        }
        return document.location.href;
    },

    getEmailURL: function() {
    	  if (typeof window.AT_VARS!=="undefined" && window.AT_VARS.articleUrl) {
    	    var emailUrl = window.AT_VARS.articleUrl;
    	    if(window.AT_VARS.articleEmailUrl){
    	        emailUrl = window.AT_VARS.articleEmailUrl;
    	    }
    	    return emailUrl;
    	  }
    	  return this.getClickURL();
    },

    getClickTitle: function() {
    	  if (typeof window.AT_VARS!=="undefined" && window.AT_VARS.clickTitle) {
    	    return window.AT_VARS.clickTitle;
    	  }
    	  return document.title;
    }

};
dojo.provide("dj.widget.email.EmailThis");
dojo.require("dj.module.email.EmailThisForm");
dojo.require("dj.util.EmailUtils");

dojo.declare("dj.widget.email.EmailThis", [], {

  constructor : function (button,cfg,elementsCfg) {
    //if (window.console) console.log(" in login scrim ");
    this._cfg = dojo.mixin(this.DEFAULT_CONFIG, cfg);
    this._elementsCfg = {};
    this.omniture = {
            saveVars: ["pageName","section","atype","aheadline","author", "ctype"],
            saveValues: [],
            ctype: "tools_article_email",
            cbtype: "tools_blog_email",
            cstype: "tools_slideshow_email",
            cvtype: "tools_video_email",
            section: "Research and Tools",
            atype: "_Research and Tools",
            events: "event12",
            aheadline: "",
            author: "",
            pageNameSuffix: "_email"
          };
    if(typeof elementsCfg != "undefined"){
      this._elementsCfg = elementsCfg;
    }


  },

  //(null,{'type':'video','mod':'wsj_blog_email','url':url,'title':headline,'productId':'blogs'});
  DEFAULT_CONFIG : {
      buttonId:"atl.at.emailthis",
      type:"article",
      mod:"wsj_valetleft_email",
      url:"",
      title:"",      
      emailVideoInfo: {},
      agents: ['android', 'webos', 'iphone', 'blackberry', 'opera mini', 'iemobile', 'iPod'],
      productId:"wsj"

  },

  init:function(){
	  this.makeConnections();
  },

  makeConnections:function(){
   // dojo.connect(dojo.byId(this._cfg.buttonId), "onclick", this, function(e) {
	   var isBlogs = dj.util.EmailUtils.isBlog();
	   if(isBlogs) {
			  this._cfg.type = "blogs";
	   }
	   var isMobile = this._isMobile();
       dj.module.email.EmailThisForm.init(this._cfg,this._elementsCfg, isMobile);
       try{
    	   this.omniturefirepixel();
       }catch(omErr){
    	   console.log('error while makin om call for email clickability' +omErr);
       }
    //});
  },

  omniturerestorepixel: function() {
      // need to save pixel info for each panel
      var svlen=this.omniture.saveVars.length;
      for ( var f=0; f<svlen; f++) {
          this.omniture.pixel.setMetaData(this.omniture.saveVars[f],this.omniture.saveValues[f]);
      }
  },
  omnituresavepixel: function() {
      // need to save pixel info for each panel
      var svlen=this.omniture.saveVars.length;
      for ( var f=0; f<svlen; f++) {
          this.omniture.saveValues[f] = this.omniture.pixel.getMetaData(this.omniture.saveVars[f]);
      }
  },

  _isMobile: function() {
	  	var agents = this._cfg.agents;
	  	var flag = false;
	  	try{
		  	var navValue = navigator.userAgent.toLowerCase();
		  	for (var i = 0; i < agents.length; i++) {
		        if(navValue.indexOf(agents[i]) !== -1) {
		        	flag = true;
		            break;
		        }
		    }
	  	}catch(userError){
	  		console.log('Error while checking for userAgent' + userError);
	  		flag = false;
	  	}
	    return flag;
  },

  omniturefirepixel: function() {

    if(!this.omniture.pixel){
      this.omniture.pixel=dj.util.Tracking.omniture;
    }
    if(this.omniture.pixel._s === undefined || this.omniture.pixel._s === null){
      this.omniture.pixel.init();
    }
    var cType = this._cfg.type;
    if(cType !== undefined && cType === 'video'){
      var videoinfo = {};
      if(dj.context.eamilThisST && dj.context.eamilThisST.videoInfo){
    	  videoinfo = dj.context.eamilThisST.videoInfo;
      } else if(this._cfg.emailVideoInfo) {
    	  videoinfo = this._cfg.emailVideoInfo;
      }

      var newData = dj.util.EmailUtils.addVideoParameters(videoinfo);
      dj.util.EmailUtils._setOmnitureData(newData, this);
    }
    var getPageName = this.omniture.pixel.getMetaData("pageName");

      this.omniture.pixel.resetPixel();
      this.omnituresavepixel();
      var isBlogs = dj.util.EmailUtils.isBlog();
      if(isBlogs) {
        this.omniture.pixel.setMetaData("ctype",this.omniture.cbtype);
      } else if(cType !== undefined && cType === 'video') {
        this.omniture.pixel.setMetaData("ctype",this.omniture.cvtype);
        this.omniture.pixel._s.prop4="";
        this.omniture.pixel.setMetaData("aheadline",this.omniture.aheadline);
      } else if(cType !== undefined && cType === 'slideshow') {
        this.omniture.pixel.setMetaData("ctype",this.omniture.cstype);
        this.omniture.pixel._s.prop4="";
        this.omniture.pixel.setMetaData("aheadline",this.omniture.aheadline);
      } else {
        this.omniture.pixel.setMetaData("ctype",this.omniture.ctype);
        this.omniture.pixel._s.prop4="";
        this.omniture.pixel.setMetaData("aheadline",this.omniture.aheadline);
      }
      this.omniture.pixel._s.events="event12";
      this.omniture.pixel._s.prop21="";

	  var abasedocID= this.omniture.pixel.getMetaData("abasedocid") === undefined ? " ":this.omniture.pixel.getMetaData("abasedocid");
      this.omniture.pixel.setMetaData("abasedocid",abasedocID);
      if(typeof this.omniture.pixel._s.prop20 === undefined ||
    		  this.omniture.pixel._s.prop20 === null) {
    	  this.omniture.pixel._s.prop20 = "";
  	  }
      this.omniture.pixel._s.emailEvent=this.omniture.events;
      this.omniture.pixel.setMetaData("section",this.omniture.section);

      var atype = this.omniture.pixel.getMetaData('atype');
      if(atype !== undefined && atype !== null && atype !== "") {

        var arr = [];
        arr = atype.split('_');
        if(arr !== undefined && arr.length > 1) {
          var atypeEnd = "";
          for(var i=1; i< arr.length ; i ++) {
            atypeEnd = atypeEnd + "_" + arr[i];
          }

          this.omniture.pixel.setMetaData("atype",arr[0]+this.omniture.atype+atypeEnd);
        }

      }
      this.omniture.pixel.setMetaData("author",this.omniture.author);
      this.omniture.pixel.setMetaData("pageName",getPageName+"_email");

      this.omniture.pixel.firePixel(true);
      this.omniturerestorepixel();
  }

});

function showRecaptcha(element) {
  recaptchaCalled = true;
  Recaptcha.create("6LdsXtkSAAAAAO_SUY_Il1uV_TsP-37nbN2bMsik",
      "recaptcha_div",
      {
        theme: "clean",
        callback: Recaptcha.focus_response_field
      }
    );

}

dojo.provide("dj.module.video.taboolaVideo");dj.module.video.taboolaVideo={loaderscript:"http://cdn.taboolasyndication.com/libtrc/wsj-wsj/loader.js",count:0,init:function(a){that=this;console.log("taboolaVideo {init} count: "+that.count);if(!that.ifEmpty(a.loaderscript))that.loaderscript=a.loaderscript;try{if(that.count==0){var b=document.createElement("script");b.type="text/javascript";b.src=that.loaderscript;if(a.async!=="hide")b.async=true;document.body.appendChild(b);window._taboola=window._taboola||[];b={};if(that.ifEmpty(a.pagemod))b.home=a.pagetype;else b[a.pagemod]=a.pagetype;that.ifEmpty(a.trackingcode)||(b.tracking=a.trackingcode);_taboola.push(b);that.loadModule(a);that.count=1}else that.loadModule(a)}catch(c){console.log("{lazyLoadTaboola} "+c)}},loadModule:function(a){that=this;window._taboola=window._taboola||[];var b={mode:a.mod,placement:a.placement,container:a.taboolacontent};that.ifEmpty(a.linktarget)||(b.link_target=a.linktarget);that.ifEmpty(a.moduletrackingcode)||(b.tracking=a.moduletrackingcode);a=_taboola.push(b);console.log("{loadModule} "+a+" : "+b)},notifyTaboola:function(a,b,c,e){that=this;try{that.ifEmpty(c)||(c="false");console.log(" {notifyTaboola} "+a+" : "+b+" : "+e+" : "+c+" : "+that.count);if(that.count==0){var d=document.createElement("script");d.type="text/javascript";d.src=that.loaderscript;document.body.appendChild(d);that.loadVideo(a,b,e,c);that.count=1}else that.loadVideo(a,b,e,c)}catch(f){console.log("{notifyTaboola} "+f)}},notifyDynamicLoad:function(a,b,c,e){that=this;window._taboola=window._taboola||[];that.ifEmpty(e)||(e="videoPlay");a={notify:e,id:a,url:b};that.ifEmpty(c)||(a.tracking=c);c=_taboola.push(a);console.log(" {notifyDynamicLoad} :"+c+" : "+a)},loadLoaderJs:function(a,b,c,e,d,f){that=this;if(!that.ifEmpty(d))that.loaderscript=d;d=document.createElement("script");d.type="text/javascript";d.src=that.loaderscript;if(f!=="hide")d.async=true;document.body.appendChild(d);that.count=1;window._taboola=window._taboola||[];f={};if(!that.ifEmpty(a)&&!ifEmpty(b))f[a]=b;else f.video="unknown";if(that.ifEmpty(e))f.visible="false";else f[visible]=e;that.ifEmpty(c)||(f[tracking]=c);a=_taboola.push(f);console.log(" {loadLoaderJs} :"+a+" : "+f)},loadVideo:function(a,b,c,e){that=this;window._taboola=window._taboola||[];var d={video:a};that.ifEmpty(c)||(d.video_source=c);that.ifEmpty(e)||(d.visible=e);that.ifEmpty(b)||(d.tracking=b);b=_taboola.push(d);console.log(" loadVideo:: response: "+b+" : "+a+" : "+d+" : "+c+" : "+e)},ifEmpty:function(a){return a!==null&&a!==undefined&&a!==""?false:true}};dojo.provide("dj.widget.video.model.PlayerEvents");dj.widget.video.model.PlayerEvents={playVideo:"onPlayVideo",pauseVideo:"onPauseVideo",unpauseVideo:"onUnpauseVideo",getSeek:"onGetSeek",stopVideo:"onStopVideo",createAdvertisement:"onCreateAdvertisement",openMicroPopUpPlayer:"onOpenMicroPopUpPlayer",openPopUpPlayer:"onOpenPopUpPlayer",openEmbedPopup:"onOpenEmbedPopup",continueLoadVideo:"onContinueLoadVideo",playNextVideo:"onPlayNextVideo",openEmailScrimEmbed:"onOpenEmailScrimEmbed"};dojo.provide("dj.widget.video.model.PlayerTypes");(dj.widget.video.model.PlayerTypes={MicroPlayer:{width:272,height:153,swfFile:"WSJMediaPlayer.swf"},MicroPlayerHP:{width:264,height:149,swfFile:"WSJMediaPlayer.swf"},MicroPlayerE:{width:360,height:203,swfFile:"WSJMediaPlayer.swf"},MicroPlayerF:{width:512,height:288,swfFile:"WSJMediaPlayer.swf"},MainPlayer:{width:512,height:363,swfFile:"WSJMediaPlayer.swf"},MainPlayerG:{width:548,height:311,swfFile:"WSJMediaPlayer.swf"},AdPlayer:{width:336,height:280,swfFile:"adPlayer.swf"}}).prototype={};dojo.provide("dj.widget.video.model.Playlist");(dj.widget.video.model.Playlist=function(){this.videos=null;this.sectionID=this.query="";this.videoIndex=0}).prototype={};dojo.provide("dj.widget.video.model.SWFPlayer");(dj.widget.video.model.SWFPlayer=function(){this.objName="undefined";this.containerID=this.swfURL=this.id="";this.height=this.width=0;this.containermodule=this.videoGUID="";this.flashVersion="9.0.0";this.allowPlayerPopup=1;this.hideTools=0;this.plyMediaEnabled=1;this.host="video.wsj.com";this.allowScriptAccess="always";this.windowMode="opaque";this.playNextVideo=this.continueLoadVideo=this.openEmailScrimEmbed=this.openEmbedPopup=this.openPopUpPlayer=this.createAdvertisement=this.stopVideo=this.getSeek=this.unpauseVideo=this.pauseVideo=this.playVideo=this.eventNamespace=this.configURL="";this.chainVideos=1;this.enableVideoModuleChaining=0}).prototype={};dojo.provide("dj.widget.video.view.BasePlayer");dojo.declare("dj.widget.video.view.BasePlayer",null,{constructor:function(a){this.controller=null;this.configuration={name:"",preloaderClassName:"videoObjectLoading"};dojo.mixin(this.configuration,a);this.playerCreated=false},init:function(a){this.controller=a},render:function(){console.error("{BasePlayer} 'render' must be overritten")},openPopUpPlayer:function(){console.error("{BasePlayer} 'openPopUpPlayer' must be overritten")}});dojo.provide("dj.util.VideoUtils");dojo.require("swfobject.swfobject_2_2.swfobject");dojo.require("dj.widget.email.EmailThis");(function(){dj.util.VideoUtils={formatDuration:function(a){if(a<60)return"0:"+this.formatSeconds(a);for(var b=0;a>59;){a-=60;b++}return b+":"+this.formatSeconds(a)},formatSeconds:function(a){return a>9?a:"0"+a},nullOrUndefined:function(a){return a===null||a=="undefined"},emptyOrNull:function(a){if(!this.nullOrUndefined(a))return a.length===0;return true},nonSupportingFlashPlayer:function(a){dojo.byId(a).innerHTML='<div class="noFlash"><p>This content can not be displayed because your browser does not support the Adobe Flash player required to view it.</p></div>'},hasValidFlashVersion:function(){var a=swfobject.getFlashPlayerVersion();if(a)return a.major>=9;else{console.error("{VideoUtils} - flashVersion is undefined.");return false}},createSWFPlayer:function(a){if(this.hasValidFlashVersion()){var b={objName:a.objName,allowPlayerPopup:a.allowPlayerPopup,hideTools:a.hideTools,plyMediaEnabled:a.plyMediaEnabled,movieWidth:a.width,movieHeight:a.height,host:a.host,PLAYER_ID:a.id,containermodule:a.containermodule,playVideo:this.addEventNamespace(a.eventNamespace,a.playVideo),pauseVideo:this.addEventNamespace(a.eventNamespace,a.pauseVideo),unpauseVideo:this.addEventNamespace(a.eventNamespace,a.unpauseVideo),getSeek:this.addEventNamespace(a.eventNamespace,a.getSeek),stopVideo:this.addEventNamespace(a.eventNamespace,a.stopVideo),createAdvertisement:this.addEventNamespace(a.eventNamespace,a.createAdvertisement),openPopUpPlayer:this.addEventNamespace(a.eventNamespace,a.openPopUpPlayer),openEmbedPopup:this.addEventNamespace(a.eventNamespace,a.openEmbedPopup),openEmailScrimEmbed:this.addEventNamespace(a.eventNamespace,a.openEmailScrimEmbed),openMicroPopUpPlayer:this.addEventNamespace(a.eventNamespace,a.openMicroPopUpPlayer),continueLoadVideo:this.addEventNamespace(a.eventNamespace,a.continueLoadVideo),playNextVideo:this.addEventNamespace(a.eventNamespace,a.playNextVideo),enableVideoModuleChaining:a.enableVideoModuleChaining};if(a.swfURL=="/media/swf/WSJMediaPlayer.swf"){a.chainVideos=1;var c=dojo.getObject("dj.context.video.chainVideos");if(c!=undefined&&c===false)a.chainVideos=0;b.chainVideos=a.chainVideos}try{swfobject.embedSWF(dj.context.core.cdnPrefix+
a.swfURL,a.containerID,a.width,a.height,a.flashVersion,"",b,{allowscriptaccess:a.allowScriptAccess,wmode:"opaque"},{id:a.id})}catch(e){console.error("Error on embending "+e)}}else this.nonSupportingFlashPlayer(a.containerID)},addEventNamespace:function(a,b){return b===null||b===""?b:a+"."+b},popUpPlayer:function(a){var b="/public/page/video-popup.html";if(dj.context.videoCenter.popUpPageURL)b=dj.context.videoCenter.popUpPageURL;dj.context.videoCenter.height&&dj.context.videoCenter.width?window.open(b+"?currentPlayingLocation="+a.playLocation+"&currentlyPlayingCollection="+escape(a.collection)+"&currentlyPlayingVideoId="+a.videoID,"popUpPlayer","height="+dj.context.videoCenter.height+",width="+dj.context.videoCenter.width+",left="+(screen.width-Number(a.width))/2+",top="+(screen.height-Number(a.height))/2+",resizable=no,scrollbars=no,toolbar=no,status=no"):window.open(b+"?currentPlayingLocation="+a.playLocation+"&currentlyPlayingCollection="+escape(a.collection)+"&currentlyPlayingVideoId="+a.videoID,"popUpPlayer","height=840,width=422,left="+(screen.width-Number(a.width))/2+",top="+(screen.height-Number(a.height))/2+",resizable=yes,scrollbars=no,toolbar=no,status=no")},embedPopUp:function(a){console.log("videoutils embedPopUp.");var b=a.url,c=a.shortUrl;a=a.guidval;a=a.replace("{","");a=a.replace("}","");if(c!==undefined&&c!==null&&""!==c)b=c;c="/public/page/videoembedcode.html";if(dj.context.videoCenter.EmbedPageURL)c=dj.context.videoCenter.EmbedPageURL;window.open(c+"?url="+b+"&guidval="+a,"popUpPlayer","height=372,width=635,left=100,top=100,resizable=yes,scrollbars=yes,toolbar=no,status=no")},openEmailScrimEmbed:function(a,b,c){console.log("Inside openEmailScrimEmbed");a=a;if(a.indexOf(".html")>-1)a=a.substring(0,a.indexOf(".html")+5);else if(a.indexOf("?mod")>-1)a=a.substring(0,a.indexOf("?mod"));window.open("/public/page/videoEmailThisScrim.html?url="+a+"&guid="+c+"&title="+b,"videoEmailThis","height=700,width=635,left=100,top=100,resizable=yes,scrollbars=yes,toolbar=no,status=no");return true},isGUID:function(a){return a.match(/{\w{8}-\w{4}-\w{4}-\w{4}-\w{12}}/)},normalizeGuid:function(a){return this.isGUID(a)?a:"{"+a+"}"},omnitureEncoding:function(a,b,c){if(a=="News"){if(b=="Politics"&&c=="s")return"Politics & Campaign";if(this.emptyOrNull(b))return"US"}if(a=="Management"){if(this.emptyOrNull(b)&&c=="c")return"Business";if(this.emptyOrNull(b)&&c=="s")return"Management";if(b=="Business Insight")return c=="c"?"Business":"Business Insight";return"Business"}if(a=="Lifestyle"&&c=="c")return"Life & Style";if(a=="Special Packages"){if(b=="Journal Reports"&&c=="c")return"Special";if(b=="Journal Reports"&&c=="s")return"In-Depth Reports";if(b=="Journal Women"&&c=="c")return"Careers";if(b=="Journal Women"&&c=="s")return"Journal Women"}if(c=="s"&&this.emptyOrNull(b))return a;if(c=="s")return b;if(c=="c")return a},isVideoSupported:function(){if(typeof this._isHtml5==="undefined"){var a=document.createElement("video")||false;this._isH264=(this._isHtml5=a&&typeof a.canPlayType!=="undefined")&&(a.canPlayType('video/mp4; codecs="avc1.42E01E, mp4a.40.2"')==="maybe"||a.canPlayType('video/mp4; codecs="avc1.42E01E, mp4a.40.2"')==="probably");this._isOgg=this._isHtml5&&(a.canPlayType('video/ogg; codecs="theora, vorbis"')==="maybe"||a.canPlayType('video/ogg; codecs="theora, vorbis"')==="probably")}return this._isHtml5},isOggTheoraVideoSupported:function(){return this.isVideoSupported()&&this._isOgg},isH264BaselineVideoSupported:function(){return this.isVideoSupported()&&this._isH264},callThroughDispatch:function(a,b){var c=dojo.create("a",{is:"false"});dojo.place(c,dojo.body());var e=dj.util.Element.identify(c);dojo.connect(c,"click",function(d){dojo.stopEvent(d);if(c.getAttribute("is")!=="true"){c.setAttribute("is","true");a.call(b)}});setTimeout(dojo.hitch(this,function(){this._doEventDispatch(e)}),400)},_doEventDispatch:function(a){var b;a=dojo.byId(a);if(document.createEvent){b=document.createEvent("MouseEvents");if(b.initMouseEvent)b.initMouseEvent("click",true,true,window,0,0,0,0,0,false,false,false,false,0,null);else b=false}b?a.dispatchEvent(b):a.click&&a.click()}}})();dojo.provide("dj.util.Video");dojo.require("dj.lang");dojo.require("dj.util.Cookie");dojo.require("dj.util.Observer");dojo.require("dj.util.Omniture");dojo.require("dj.util.Page");dojo.require("dj.util.Region");dojo.require("dj.util.User");dojo.require("dj.util.Query");dojo.require("dj.util.Element");(function(){var a=dj.util,b=dj.util.Page,c=new a.Observer(dj.util.Video),e={};a.Video={unpauseVideo:function(d,f){c.fireByName("unpauseVideo",d,f)},pauseVideo:function(d,f){c.fireByName("pauseVideo",d,f)},playVideo:function(d,f){c.fireByName("playVideo",d,f)},getSeek:function(d,f){c.fireByName("getSeek",d,f)},stopVideo:function(d,f){c.fireByName("stopVideo",d,f)},collapsePlayer:function(d,f){c.fireByName("collapsePlayer",d,f)},expandPlayer:function(d,f){c.fireByName("expandPlayer",d,f)},isVideoPlayerCollapsed:function(d){var f=this._getOrCreatePlayer(d);if(f.isCollapsed)return true;var g=a.Cookie.getGroupCookie("DJCOOKIE","PLAYERCOLLAPSED_"+d)==="yes";g&&this._collapsePlayerCallback(d);f.isCollapsed=g;return f.isCollapsed},subscribe:function(d,f,g){c.subscribeByName(d,f,g)},_getOrCreatePlayer:function(d){e[d]||(e[d]={isCollapsed:false,largestHeight:25,smallestHeight:25});return e[d]},handlePageRefresh:function(){var d=a.Page;this._subOnOff(function(f){try{dojo.query("div [ data-widget-playerid]");var g=true;dojo.forEach(dojo.query("div [ data-widget-playerid]"),function(k){k=dj.util.Element.getData(k,"widget-playerid");if(k!==undefined&&k!==null&&k!==""&&k.indexOf(f)===-1)g=false});g&&d.enableRefresh()}catch(h){console.log("Error while enabling the page refresh"+h);d.enableRefresh()}},function(){d.disableRefresh()})},handleModuleRefresh:function(d,f){f=f==null?"refresh":f;this._subOnOff(function(g){var h=null,k=dojo.byId(g);if(k==null)try{if(navigator.appVersion.indexOf("MSIE 7.")!==-1){var l=dojo.query("."+f);dojo.some(l,function(n){var s=dj.util.Element.getData(n,"widget-playerid");if(s!=null&&s.indexOf(g)!==-1){k=n;return false}})}else k=dojo.query('object param[ value*= "'+g+'"]')[0]}catch(m){}if(k!=null)for(;k.parentNode!=null;){k=k.parentNode;if(dojo.hasClass(k,f)){h=k;break}}if(h!=null){l=null;try{l=dj.util.Element.getData(h,"widget-playerid")}catch(q){}if(l==null||l===""){b.enableModuleRefresh(h.id);dj.module[h.id+"_updater"]&&dj.module[h.id+"_updater"].start()}else if(l.indexOf("||||")===-1&&l==="||"+g+"||"){dojo.attr(h,"data-widget-playerid","");b.enableModuleRefresh(h.id);dj.module[h.id+"_updater"]&&dj.module[h.id+"_updater"].start()}else if(l.indexOf("||||")!==-1){l=l.replace("||"+g+"||","");dojo.attr(h,"data-widget-playerid",l)}}else{b.enableModuleRefresh(d);dj.module[d+"_updater"]&&dj.module[d+"_updater"].start()}},function(g){var h=null,k=dojo.byId(g);if(k==null)try{if(navigator.appVersion.indexOf("MSIE 7.")!==-1){var l=dojo.query("object param");dojo.some(l,function(n){if(n.value!=null&&n.value!=undefined)if(n.value.indexOf(g)!==-1){k=n;return false}})}else k=dojo.query('object param[ value*= "'+g+'"]')[0]}catch(m){}if(k!=null)for(;k.parentNode!=null;){k=k.parentNode;if(dojo.hasClass(k,f)){h=k;break}}if(h!=null){b.disableModuleRefresh(h.id);l=null;try{l=dj.util.Element.getData(h,"widget-playerid")}catch(q){}if(l==null||l==="")dojo.attr(h,"data-widget-playerid","||"+g+"||");else l.indexOf(g)===-1&&dojo.attr(h,"data-widget-playerid",l+"||"+g+"||")}else b.disableModuleRefresh(d)})},handleVideoPlayer:function(){this.subscribe("collapsePlayer",this._collapsePlayerCallback,this);this.subscribe("expandPlayer",this._expandPlayerCallback,this)},_getPlayerAndUpdateHeights:function(d){var f=this._getOrCreatePlayer(d);f.node=dojo.byId(d);f.largestHeight=f.node.height>f.largestHeight?f.node.height:f.largestHeight;f.smallestHeight=f.node.height<f.smallestHeight?f.node.height:f.smallestHeight;return f},_collapsePlayerCallback:function(d){var f=this._getPlayerAndUpdateHeights(d);if(!f.isCollapsed){f.isCollapsed=true;var g=dj.util.Query.up(f.node,"div");g!==dojo.doc&&dojo.style(g,{width:"",height:""});dojo.anim(f.node,{height:{end:f.smallestHeight}});a.Cookie.setGroupCookie("DJCOOKIE","PLAYERCOLLAPSED_"+d,"yes",1/24)}},_expandPlayerCallback:function(d){var f=this._getPlayerAndUpdateHeights(d);if(f.isCollapsed){f.isCollapsed=false;dojo.anim(f.node,{height:{end:f.largestHeight}});a.Cookie.deleteGroupCookie("DJCOOKIE","PLAYERCOLLAPSED_"+d)}},handleNewsHubPageRefresh:function(){this.subscribe("stopVideo",function(){location.pathname=location.pathname},this)},_subOnOff:function(d,f){this.subscribe("unpauseVideo",f,this);this.subscribe("pauseVideo",f,this);this.subscribe("playVideo",f,this);this.subscribe("getSeek",f,this);this.subscribe("stopVideo",d,this)},formatduration:function(d){var f=Math.floor(d/60);d=d%60;if(d<10)d="0"+d;return""+f+":"+d},getVideoDetails:function(d){if(!d.id)return"No Id.";var f="/api-video/get_video_info.asp?guid="+d.id;f+=d.fields?"&fields="+d.fields:"&fields=all";dojo.getObject("dj.util.Video.jsonData",true);dj.util.Video.getVideoData(f,{context:this,handleAs:"json",sync:true,responseType:"application/json",callback:function(g){a.Video.handleGetVideoDetails(g,d.id)},errorCallback:function(){console.error("Failed while executing util.Video.getVideoDetails")}});return a.Video.jsonData[d.id]},handleGetVideoDetails:function(d,f){a.Video.jsonData[f]=d},getVideoData:function(d,f){f.responseType=!f.responseType?"text/xml":f.responseType;var g=f.responseType.indexOf("json")>-1;this._sendXhrRequest(d,f,{requestMethod:"GET",handleAs:g?"json":"xml",appendCacheBuster:true,requestHeaders:{Accept:f.responseType},sync:f.sync?true:false})},postVideoData:function(d,f,g){this._sendXhrRequest(d,g,{requestMethod:"POST",content:dojo.toJson(f),requestHeaders:{"X-HTTP-Method-Override":"POST","Content-Type":"application/json"},sync:g.sync?true:false})},putVideoData:function(d,f,g){this._sendXhrRequest(d,g,{requestMethod:"PUT",content:dojo.toJson(f),requestHeaders:{"X-HTTP-Method-Override":"PUT","Content-Type":"application/json"},sync:g.sync?true:false})},deleteDashboardData:function(d,f,g){this._sendXhrRequest(d,g,{requestMethod:"POST",content:dojo.toJson(f),requestHeaders:{"X-HTTP-Method-Override":"DELETE","Content-Type":"application/json"},sync:g.sync?true:false})},_sendXhrRequest:function(d,f,g){var h=dj.lang.cloneMixin({callback:function(){}},f);f=dj.lang.cloneMixin({requestHeaders:{Accept:"application/json"},handleAs:"json",appendCacheBuster:false,sync:false},g);if(f.appendCacheBuster)d=this._appendCacheBuster(d);return this._getRequestByMethod(f.requestMethod)({url:d,headers:f.requestHeaders,handleAs:f.handleAs,postData:f.content,sync:f.sync,load:function(k,l){h.context?h.callback.apply(h.context,[k,l.xhr,h]):h.callback.apply(this,[k,l.xhr,h])},error:function(k,l){console.error("HTTP status code: %s, response: %o",l.xhr.status,data);typeof h.errorCallback!=="undefined"?h.errorCallback.apply(h.context,[l.xhr.status,l.xhr,h]):h.callback.apply(h.context,[l.xhr.status,l.xhr,h])}})},_appendCacheBuster:function(d){var f=Math.floor(1E7*Math.random());d+=d.indexOf("?")>-1?"&cb="+f:"?cb="+f;return d},_getRequestByMethod:function(d){return d=="GET"?dojo.xhrGet:dojo.xhrPost},getUrlParam:function(d,f){f=f.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var g=RegExp("[\\?&]"+f+"=([^&#]*)").exec(d);return g===null?"":g[1]},nonSupportingFlashPlayer:function(d){dojo.byId(d).innerHTML="<p>This content can not be displayed because your browser does not support the Adobe Flash player required to view it.</p>"},omnitureEncoding:function(d,f,g){if(d=="News"){if(f=="Politics"&&g=="s")return"Politics & Campaign";if(!this.isNotBlankOrNull(f)&&g=="c")return"US";if(!this.isNotBlankOrNull(f)&&g=="s")return"US"}if(d=="Management"){if(!this.isNotBlankOrNull(f)&&g=="c")return"Business";if(!this.isNotBlankOrNull(f)&&g=="s")return"Management";if(f=="Business Insight"&&g=="c")return"Business";if(f=="Business Insight"&&g=="s")return"Business Insight";return"Business"}if(d=="Lifestyle")return"Life & Style";if(d=="Special Packages"){if(f=="Journal Reports"&&g=="c")return"Special";if(f=="Journal Reports"&&g=="s")return"In-Depth Reports";if(f=="Journal Women"&&g=="c")return"Careers";if(f=="Journal Women"&&g=="s")return"Journal Women"}if(g=="s"&&!this.isNotBlankOrNull(f))return d;if(g=="s")return f;if(g=="c")return d},isNotBlankOrNull:function(d){return d!==""&&d!==null&&typeof d!="undefined"},setupConfig:function(){var d={};d.emailURL="http://www.emailthis.clickability.com/et/emailThis?clickMap=create&fb=Y&url=@VIDEO_LINK_URL&title=@VIDEO_TITLE&random=@RANDOM_NUMBER&partnerID=@EMAIL_PARTNER_ID&image=@VIDEO_STILL_URL&expire=&summary=@VIDEO_DESCRIPTION";d.domainName="wsj";d.embedConfigURL="http://wsj.vo.llnwd.net/o28/players/";d.popUpPageUrl="/public/page/video-popup.html";if(dj.context.videoCenter.popUpPageURL)d.popUpPageUrl=dj.context.videoCenter.popUpPageURL;var f=this.getUrlParam(window.location.href,"site"),g="";try{g=dj.context.videoCenter.host}catch(h){console.error("Error while getting site value from context. "+h.message)}d.site=this.isNotBlankOrNull(f)?f:g;d.msrc=this.getUrlParam(window.location.href,"msrc");d.playFromRegisteredVideos=false;d.pageSize=12;d.browsingGroup="collection";d.playingGroup="collection";d.skipCollection=true;d.prop24="";d.prop25="";d.prop27="";try{if(typeof setEdition==="function")d.prop24=setEdition(dj.util.Region.getViewByRegion())}catch(k){console.error("cookie read error while fetching prop24 : "+k)}try{d.prop25=dj.util.Cookie.getCookie("TR")}catch(l){console.error("cookie read error while fetching prop25 : "+l)}try{d.cookieUserType=dj.util.Cookie.getCookie("user_type")}catch(m){console.error("cookie read error while fetching cookieUserType : "+
m)}try{dj.util.User.isLoggedIn(function(n){if(n)dj.util.User.isSubLoggedIn(function(s){d.prop27=s?"WSJ_sub_yes":"WSJ_mem_yes"});else d.prop27=d.cookieUserType===null||d.cookieUserType!=="subscribed"?"WSJ_free":"WSJ_reg_yes"})}catch(q){console.error("cookie read error while fetching prop27")}return d}}})();dojo.provide("dj.widget.video.view.SimplePlaylist");dojo.require("dj.util.VideoUtils");(dj.widget.video.view.SimplePlaylist=function(a){this.controller={};this.configuration={containerID:"nextVideo",titleID:"sectionTitle"};dojo.mixin(this.configuration,a);this.container=dojo.byId(this.configuration.containerID);this.title=dojo.byId(this.configuration.titleID)}).prototype={init:function(a){this.controller=a;this.addEvents()},addEvents:function(){var a=this;dj.lang.addLiveEvent("#nextVideo a","click",function(b){dojo.stopEvent(b);a.controller.videoSelected()})},render:function(){var a=this.controller.getNextVideo();if(a){this.title.innerHTML=a["wsj-subsection"]&&a["wsj-subsection"]!="null"?unescape(a["wsj-subsection"]):a["wsj-section"]&&a["wsj-section"]!="null"?unescape(a["wsj-section"]):this.controller.playlist.sectionID?this.controller.playlist.sectionID:"";var b='<a id="'+a.id+"~"+this.controller.playlist.videoIndex+'" href="" style="background-image: url('+a.thumbnailURL+')" class="preview"><span>&nbsp;</span></a>';b+='<h2><a id="'+a.id+"~"+this.controller.playlist.videoIndex+'" class="previewText" href="">'+a.name+"</a></h2>";b+="<small>"+dj.util.VideoUtils.formatDuration(a.duration)+"</small>";b+="<p>"+a.description+"</p>";this.container.innerHTML=b}}};dojo.provide("dj.util.VideoTracking");dojo.require("dj.util.VideoUtils");dojo.require("dj.util.Tracking");dj.util.VideoTracking={init:function(){if(typeof this.omniture!=="object")this.omniture=dj.util.Tracking.omniture},fire:function(a){try{this.init();var b=this._getOmnitureObject(a),c=this._getCurrentOmnitureObject(b);this._setOmnitureData(b);this._firePixel();this._setOmnitureData(c)}catch(e){console.error("{VideoTracking} ",e)}},_getOmnitureObject:function(a){var b=a.appName.toUpperCase(),c=function(e){return b+"_"+e.join("_")};return{pageName:c(["Video",a.name]),section:"Video",subsection:c([a.section]),atype:c(["Video_Video",a.section]),apage:c(["Video_Video",a.subsection]),aheadline:"video_"+a.name,basesection:c([a.subsection]),abasedocid:a.id,ctype:a.appType,csource:a.provider+" video",caccess:"free",qsymbol:a.adZone}},_getCurrentOmnitureObject:function(a){var b={},c;for(c in a)if(a.hasOwnProperty(c))b[c]=this.omniture.getMetaData(c);return b},_setOmnitureData:function(a){for(var b in a)a.hasOwnProperty(b)&&this.omniture.setMetaData(b,a[b])},_firePixel:function(){this.omniture.firePixel(true)}};dojo.provide("dj.widget.video.view.FullBrowser");dojo.require("dj.lang");dojo.require("dj.util.VideoUtils");dojo.declare("dj.widget.video.view.FullBrowser",null,{DEFAULT_CONFIG:{videoThumbsHolder:"videoThumbsHolder",navPageNumbers:"navPageNumbers",videoSearchInput:"videoSearchInput",videoSearchButton:"videoSearchButton",navSearchResults:"navSearchResults",searchResultLabels:"searchResultLabels",defaultSearchType:"wsj-fulltext",searchQueryLabel:"searchTerm",searchForm:"searchForm",thumbnailItemsPerPage:12,thumbnailItemsPerRow:4},constructor:function(a){this.controller=null;this.configuration=dojo.mixin(dojo.clone(this.DEFAULT_CONFIG),a);this.videoSearchInput=dojo.byId(this.configuration.videoSearchInput);this.videoSearchButton=dojo.byId(this.configuration.videoSearchButton);this.navSearchResults=dojo.byId(this.configuration.navSearchResults);this.searchQueryLabel=dojo.byId(this.configuration.searchQueryLabel);this.searchResultLabels=dojo.byId(this.configuration.searchResultLabels);this.searchForm=dojo.byId(this.configuration.searchForm);this.navPageNumbers=dojo.byId(this.configuration.navPageNumbers);this.videoThumbsHolder=dojo.byId(this.configuration.videoThumbsHolder);this.rssLinkPrefix="rss_"},init:function(a){this.controller=a;this.addEvents()},addEvents:function(){var a=this;dj.lang.addLiveEvent(".nav_collection","click",function(b){dojo.stopEvent(b);b=b.srcElement||b.target;if(b.tagName!=="A"&&b.tagName!=="a")b=b.parentNode;var c=b.parentNode.id.split("~");a.navigationExpand(b);a.controller.requestVideos([c[0],c[1],b.id],1,false)});dj.lang.addLiveEvent(".nav_subcollection","click",function(b){dojo.stopEvent(b);b=b.srcElement||b.target;var c=b.parentNode.id.split("~");a.navigationSelectSub(b);a.controller.requestVideos([c[0],c[1],b.id],1,false)});dj.lang.addLiveEvent(".navToPage","click",function(b){dojo.stopEvent(b);a.controller.render((b.srcElement||b.target).id)});dj.lang.addLiveEvent(".navPrevious","click",function(b){dojo.stopEvent(b);a.controller.render(--a.controller.currentPage)});dj.lang.addLiveEvent(".navNext","click",function(b){dojo.stopEvent(b);a.controller.render(++a.controller.currentPage)});dojo.connect(a.videoSearchButton,"onclick",a,function(b){dojo.stopEvent(b);a.videoSearchInput.value!=a.videoSearchInput.defaultValue&&a.search(a.videoSearchInput.value)});dojo.connect(a.videoSearchInput,"onblur",a,function(b){b=b.srcElement||b.target;if(b.value==="")b.value=b.defaultValue});dojo.connect(a.videoSearchInput,"onfocus",a,function(b){b=b.srcElement||b.target;if(b.value===b.defaultValue)b.value=""});dojo.connect(a.searchForm,"onsubmit",a,function(b){dojo.stopEvent(b);a.videoSearchInput.value!=a.videoSearchInput.defaultValue&&a.search(a.videoSearchInput.value)});dj.lang.addLiveEvent(".videoListMed .preview, .videoListMed .previewText","click",function(b){dojo.stopEvent(b);b=(b.srcElement||b.target).id.split("~");a.controller.selectVideo(b[0],b[1])});dj.lang.addLiveEvent(".sortOption","click",function(b){dojo.stopEvent(b);a.sort((b.srcElement||b.target).parentNode.id)})},render:function(){if(dj.util.VideoUtils.nullOrUndefined(this.controller))console.error("No controller specified for FullBrowser view");else{this.renderThumbnails();this.renderNavigation();this.renderRSSLink(this.controller.currentSection);dojo.byId(this.controller.currentSection)&&this.controller.currentType==="wsj-section"&&this.navigationExpand(dojo.byId(this.controller.currentSection))}},renderThumbnails:function(){var a="",b=this.configuration.thumbnailItemsPerPage*(this.controller.currentPage-1),c=b+this.configuration.thumbnailItemsPerPage;c=c>this.controller.browserPlayList.items.length?this.controller.browserPlayList.items.length:c;for(var e=b;e<c;e++){if(e%this.configuration.thumbnailItemsPerRow===0){if(e!=b)a+="</ul>";a+=c-e<=this.configuration.thumbnailItemsPerRow?'<ul class="newsItem video videoListMed last">':'<ul class="newsItem video videoListMed">';firstClass="listFirst"}a+='<li id="li_'+this.controller.browserPlayList.items[e].id+'" class="'+firstClass+'"><a id="'+this.controller.browserPlayList.items[e].id+"~"+e+'" href="" style="background-image:url('+this.controller.browserPlayList.items[e].thumbnailURL+')" class="preview"><span>&nbsp;</span></a>';var d=firstClass="";d=this.controller.sortBy=="date"?this.controller.browserPlayList.items[e].formattedCreationDate:dj.util.VideoUtils.formatDuration(this.controller.browserPlayList.items[e].duration);a+='<h2><a class="previewText" id="'+this.controller.browserPlayList.items[e].id+"~"+e+'" href="">'+this.controller.browserPlayList.items[e].name+"</a></h2><small>"+d+"</small></li>"}this.videoThumbsHolder.innerHTML=a},highligthThumbnail:function(a){dojo.query(".nowPlaying").removeClass("nowPlaying");dojo.byId("li_"+a)&&dojo.addClass(dojo.byId("li_"+
a),"nowPlaying")},navigationSelectSub:function(a){this.navigationDeselectCollection();this.navigationDeselectSubCollection();dojo.addClass(a,"selected")},navigationExpand:function(a){this.navigationCollapseAll();this.hideSearchLabels();this.navigationDeselectSubCollection();dojo.addClass(a,"collection-selected");if(dojo.hasClass(a.parentNode,"expand")){dojo.removeClass(a.parentNode,"expand");dojo.addClass(a.parentNode,"expanded")}else dojo.addClass(a.parentNode,"noSubCollection-expanded")},navigationCollapseAll:function(){for(var a=dojo.query(".sidenav li.expanded"),b=0;b<a.length;b++){dojo.removeClass(a[b],"expanded");dojo.addClass(a[b],"expand")}a=dojo.query(".sidenav li.noSubCollection-expanded");for(b=0;b<a.length;b++)dojo.removeClass(a[b],"noSubCollection-expanded");this.navigationDeselectCollection()},navigationDeselectCollection:function(){dojo.query("a.collection-selected").removeClass("collection-selected")},navigationDeselectSubCollection:function(){dojo.query("a.selected").removeClass("selected")},renderRSSLink:function(a){dojo.query(".videoRSS").addClass("hidden");if(dojo.byId(this.rssLinkPrefix+a))dojo.removeClass(this.rssLinkPrefix+a,"hidden");else{a=a.replace(/[\s]/g,"+");dojo.byId(this.rssLinkPrefix+a)&&dojo.removeClass(this.rssLinkPrefix+a,"hidden")}},hideSearchLabels:function(){dojo.addClass(this.navSearchResults,"hidden");dojo.addClass(this.searchResultLabels,"hidden")},showSearchLabels:function(){},renderNavigation:function(){var a="";a+=this.controller.currentPage===1?'<span class="nav_prev">&laquo;</span>':'<a class="nav_prev navPrevious" href="#">&laquo;</a>';for(var b=this.controller.browserPlayList.items.length,c=0;b>0;){c++;b-=this.configuration.thumbnailItemsPerPage;a+=this.controller.currentPage==c?"<li><span>"+c+"</span></li>":'<li><a class="navToPage" id="'+c+'" href="#">'+c+"</a></li>"}a+=c==this.controller.currentPage?'<a class="nav_next"><span class="next_type">More Video </span>&raquo;</a>':'<a class="nav_next navNext" href="#"><span class="next_type">More Video </span>&raquo;</a>';this.navPageNumbers.innerHTML=a},search:function(a){this.controller.requestVideos([this.configuration.defaultSearchType,a,""],1,true);this.searchQueryLabel.innerHTML=a;this.navigationCollapseAll();this.showSearchLabels()},sort:function(a){this.controller.requestVideos([this.controller.currentType,this.controller.currentQuery,""],1,true,a);for(var b=dojo.query(".sortOption"),c=0;c<b.length;c++)dojo.removeClass(b[c].parentNode,"selected");dojo.addClass(dojo.byId(a).parentNode,"selected")},renderLoading:function(){this.videoThumbsHolder.innerHTML='<div style="width:100%;height:250px;padding-top:200px;text-align:center"><img src="/static_html_files/video/VideoCenterPreloader.gif" /><br />Loading</div>'}});dojo.provide("dj.module.videoModule");dojo.require("dj.lang");dojo.require("dj.util.Video");dojo.require("dj.widget.panels.PanelsFactory");dj.module.videoModule={init:function(a){this.cfg=dj.lang.deepMixin({videoModuleContainerId:"videoModule",autonomyVideoClassName:"autonomy_video"},a);a=dojo.byId(this.cfg.videoModuleContainerId);if(a===null)console.log("{VideoModule} is undefined.");else{dojo.hasClass(a,this.cfg.autonomyVideoClassName)&&this._setupAutonomyVideo(a);this._setupVideo(a)}},_setupVideo:function(a){this.panels=dj.widget.panels.PanelsFactory.create(a,{core:{},carousel:{}})},_setupAutonomyVideo:function(a){a=dojo.query(".preview",a);for(var b=null,c=0,e=a.length;c<e;c++){var d=a[c];b=d.id;b=b.split(":")[1].replace(/_/g,"-");b=dj.util.Video.getVideoDetails({id:b,fields:"thumbnailURLSmall"});if(b!=="undefined"){var f="url("+b.thumbnailURLSmall+")";if(f!==null)d.style.backgroundImage=f}else{console.log("getSmallThumnailURL is "+f);d.style.backgroundImage="/img/bb/BB_DBlogo.gif"}}}};dojo.provide("dj.widget.video.controller.AdPlayer");dojo.require("dj.lang");dojo.require("dj.util.Observer");dojo.require("dj.widget.video.model.PlayerTypes");(dj.widget.video.controller.AdPlayer=function(a,b){this.observer=a||new dj.util.Observer(dj.widget.video.controller.AdPlayer);this.configuration={flashPlayerPath:"/media/swf/",playerType:dj.widget.video.model.PlayerTypes.AdPlayer,containerID:"advertisement",playerID:""};dojo.mixin(this.configuration,b)}).prototype={init:function(a){this.view=a;this.view.init(this)},render:function(){this.view.render()},loadAd:function(a){this.view.loadAd(a.imageURL,a.linkURL)}};dojo.provide("dj.widget.video.controller.Playlist");dojo.require("dj.lang");dojo.require("dj.util.Observer");dojo.require("dj.util.VideoUtils");(dj.widget.video.controller.Playlist=function(a,b){this.observer=a||new dj.util.Observer(dj.widget.video.VideoPlaylist);this.configuration={};this.playlist=new dj.widget.video.model.Playlist;dojo.mixin(this.configuration,b)}).prototype={init:function(a){this.view=a;this.view.init(this)},render:function(a){if(dj.util.VideoUtils.nullOrUndefined(this.view))console.error("No view specified for VideoPlaylist");else{this.playlist=a||this.playlist;if(isNaN(this.playlist.videoIndex))this.playlist.videoIndex=-1;this.view.render()}},setPlaylist:function(a){this.playlist=a},getCurrentVideo:function(){return this.playlist.videos.items[this.playlist.videoIndex]},videoSelected:function(){this.observer.fireByName("onVideoSelected",this.getCurrentVideo().id)},getNextVideo:function(){if(isNaN(this.playlist.videoIndex))this.playlist.videoIndex=0;if(this.playlist.videoIndex+1>=this.playlist.videos.items.length)this.playlist.videoIndex=0;else this.playlist.videoIndex++;return this.getCurrentVideo()},getNextVideoID:function(){return this.playlist.videos.items[this.playlist.videoIndex].id},gerPriorVideoID:function(){return this.playlist.videoIndex-1>=0?this.playlist.videos.items[this.playlist.videoIndex-1].id:null}};dojo.provide("dj.widget.video.VideoCenter");dojo.require("dj.lang");dojo.require("dj.util.Ads");dojo.require("dj.util.Cookie");dojo.require("dj.util.Omniture");dojo.require("dj.util.Region");dojo.require("dj.util.Tracking");dojo.require("dj.util.User");dojo.require("dj.util.Video");dojo.require("swfobject.swfobject_2_2.swfobject");dojo.getObject("dj.context.video",true);dojo.declare("dj.widget.video.VideoCenter",null,{constructor:function(a,b){this.version="1.0.2";this.videoUtil=dj.util.Video;this.usrActnHash={"":this.handleResponse,toBrowse:this.handleBrowsingResults,toSearch:this.handleSearchResults,current:this.handleCurrent,next:this.handleNext};this.microPlayers=[];this.microPlayersObjects={};this.videoIdMicroPlayerIdMap={};this.popUpWindow="";this.flashPlayerPath=dj.context.core.cdnPrefix+"/media/swf/";this.collectionsXMLPath="/static_html_files/";this.videoCenterPageUrl="/video-center";this.popUpPageUrl="/public/page/video-popup.html";this.objName=b;this.videoPlayerDivId="video_player";this.sideNavUlId="video_sidenav";this.topNavUlId="video_topnav";this.nextVideoDivId="next_video";this.videoResultsDivId="video_results";this.searchDivId="video_search";this.advertisementDivId="advertisement";this.collectionsSelectId="collectionsSelectId";this.videoSummaryDivId="video_headline";this.registeredVideosDivId="registered_videos";if(this.videoUtil.isNotBlankOrNull(a)){this.videoPlayerDivId=a.videoPlayerDivId?a.videoPlayerDivId:"video_player";this.sideNavUlId=a.sideNavUlId?a.sideNavUlId:"video_sidenav";this.topNavUlId=a.topNavUlId?a.topNavUlId:"video_topnav";this.nextVideoDivId=a.nextVideoDivId?a.nextVideoDivId:"next_video";this.videoResultsDivId=a.videoResultsDivId?a.videoResultsDivId:"video_results";this.searchDivId=a.searchDivId?a.searchDivId:"video_search";this.advertisementDivId=a.advertisementDivId?a.advertisementDivId:"advertisement";this.videoSummaryDivId=a.videoSummaryDivId?a.videoSummaryDivId:"video_headline";this.registeredVideosDivId=a.registeredVideosDivId?a.registeredVideosDivId:""}this.xmlDoc="";this.defaultCollectionName="News";this.rssUrlsObject={};this.contentUrlsObject={};this.collectionNamesArray=[];this.subcollectionsObject={};this.urlKeysCollectionMap={};this.urlKeysSubCollectionMap={};this.currentlyPlayingVideoId="";this.currentlyPlayingVideoIds=[];this.visibleSubCollectionId=this.visibleCollectionId=this.nextVideoId=this.currentlyPlayingSubCollection=this.currentlyPlayingCollection="";this.sortOrder="relevancy";this.currentSearchText="";this.isVideoResultsInSideNav=false;this.currentPlayingJsonObject={};this.currentBrowsingJsonObject={};this.currentSearchJsonObject={};this.currentVideoDetailsJsonObject={};this.nextVideoDetailsJsonObject={};this.registeredVideos=[];this.registeredVideosIds=[];this.cookieUserType=this.bookMarkedLocation=this.bookMarkedId=this.sourceApplicationName=this.userAction=this.relatedVideosCollection="";dj.lang.mixin(this,this.videoUtil.setupConfig())},loadVideo:function(a,b,c){console.info("video.js v"+this.version);if(this.videoUtil.isNotBlankOrNull(c))this.domainName=c;this.sourceApplicationName=b;if(this.videoUtil.isNotBlankOrNull(a))this.currentlyPlayingVideoId=a.indexOf("{")==-1?"{"+a+"}":a;swfobject.getFlashPlayerVersion().major>=9?this.createFlashPlayer():dj.util.Video.nonSupportingFlashPlayer(this.videoPlayerDivId)},continueLoadVideo:function(){this.loadCollectionsDoc(this,this.handleLoadVideo)},handleLoadVideo:function(a,b){this.xmlDoc=b.responseXML.documentElement;this.parseInformationFromXmlDoc();if(this.sourceApplicationName=="articlePage"){var c=this.visibleCollectionId="";if(this.videoUtil.isNotBlankOrNull(this.currentlyPlayingVideoId))c=this.registeredVideos[this.registeredVideosIds.indexOf(this.currentlyPlayingVideoId)];else if(this.videoUtil.isNotBlankOrNull(this.bookMarkedId)){this.currentlyPlayingVideoId=this.bookMarkedId;c=this.registeredVideos[this.registeredVideosIds.indexOf(this.currentlyPlayingVideoId)];c.seekTime=this.bookMarkedLocation}else{c=this.registeredVideos[0];this.currentlyPlayingVideoId=c.id}this.playVideoByParam(c);this.relatedVideosCollection=this.videoUtil.isNotBlankOrNull(this.registeredVideos[0]["wsj-section"])?this.registeredVideos[0]["wsj-section"]:this.defaultCollectionName;this.currentlyPlayingCollection=this.registeredVideos[0]["wsj-section"];if(this.currentlyPlayingCollection=="Lifestyle")this.currentlyPlayingCollection="Life & Style";this.getVideos(this.validateContentUrl(this.contentUrlsObject[this.currentlyPlayingCollection])+"&count=60","",this,this.finishHandleLoadVideo)}else{if(typeof AT_VARS!="undefined"&&AT_VARS.baseDocId)this.currentlyPlayingVideoId="{"+AT_VARS.baseDocId+"}";if(this.videoUtil.isNotBlankOrNull(this.currentlyPlayingVideoId)){this.playVideoByVideoId(this.currentlyPlayingVideoId);this.currentlyPlayingCollection=this.currentVideoDetailsJsonObject["wsj-section"];this.currentlyPlayingSubCollection=this.currentVideoDetailsJsonObject["wsj-subsection"];if(this.videoUtil.isNotBlankOrNull(this.currentlyPlayingSubCollection)){this.currentlyPlayingCollection=this.visibleCollectionId=this.collectionNameForSubcollection(this.currentlyPlayingSubCollection);this.getVideos(this.validateContentUrl(this.contentUrlsObject[this.currentlyPlayingSubCollection])+"&count=60","",this,this.finishHandleLoadVideo)}else{if(!this.videoUtil.isNotBlankOrNull(this.currentlyPlayingCollection))this.currentlyPlayingCollection=this.defaultCollectionName;this.getVideos(this.validateContentUrl(this.contentUrlsObject[this.currentlyPlayingCollection])+"&count=60","",this,this.finishHandleLoadVideo)}}else{c=window.location.pathname;this.currentlyPlayingCollection=this.defaultCollectionName;if(c.indexOf(".")!=-1){c=c.split(".")[0].split("/").pop();if(this.urlKeysCollectionMap[c])this.currentlyPlayingCollection=this.urlKeysCollectionMap[c];if(this.urlKeysSubCollectionMap[c]){this.currentlyPlayingSubCollection=this.urlKeysSubCollectionMap[c];this.currentlyPlayingCollection=this.visibleCollectionId=this.collectionNameForSubcollection(this.currentlyPlayingSubCollection)}}c=dojo.hitch(this,function(){this.currentlyPlayingVideoId=this.currentPlayingJsonObject.items[0].id;this.playVideoByVideoId(this.currentlyPlayingVideoId);this.finishHandleLoadVideo()});this.videoUtil.isNotBlankOrNull(this.currentlyPlayingSubCollection)?this.getVideos(this.validateContentUrl(this.contentUrlsObject[this.currentlyPlayingSubCollection])+"&count=60","",null,c):this.getVideos(this.validateContentUrl(this.contentUrlsObject[this.currentlyPlayingCollection])+"&count=60","",null,c)}}},finishHandleLoadVideo:function(){this.populateSideNav();this.populateTopNav();if(this.videoUtil.isNotBlankOrNull(this.currentlyPlayingSubCollection)){this.updateSideNavAppearance("subcollection",this.currentlyPlayingSubCollection);this.visibleSubCollectionId=this.currentlyPlayingSubCollection;this.playingGroup=this.browsingGroup="subcollection"}else{this.updateSideNavAppearance("collection",this.currentlyPlayingCollection);this.visibleCollectionId=this.currentlyPlayingCollection}this.currentBrowsingJsonObject=this.currentPlayingJsonObject;if(this.sourceApplicationName=="articlePage"&&this.registeredVideosIds.length>0){this.createRegisteredVideosThumbnails();this.updateVideoThumbnailVisual("","reg"+this.currentlyPlayingVideoId)}this.updateTopNavAppearance("",this.currentlyPlayingCollection);this.createNextVideo();this.createSearch();this.createAdvertisementFramework();this.populateMoreVideos(1);this.loadPagination(1);this.updateRssFeed(this.visibleSubCollectionId!==""?this.visibleSubCollectionId:this.visibleCollectionId)},validateContentUrl:function(a){if(this.videoUtil.isNotBlankOrNull(a))return a;else{this.currentlyPlayingCollection=this.defaultCollectionName;return this.contentUrlsObject[this.defaultCollectionName]}},createAdvertisementFramework:function(){if(this.advertisementDivId)if(swfobject.getFlashPlayerVersion().major>=9){var a={w:"336",h:"280"};swfobject.embedSWF(this.flashPlayerPath+"adPlayer.swf",this.advertisementDivId,a.w,a.h,"9.0.0","",{objName:this.getName(),movieWidth:a.w,movieHeight:a.h,host:location.host},{allowscriptaccess:"always",wmode:"opaque"},{})}else dj.util.Video.nonSupportingFlashPlayer(this.advertisementDivId)},collectionNameForSubcollection:function(a){for(var b=0,c=this.collectionNamesArray.length;b<c;++b)if(this.subcollectionsObject[this.collectionNamesArray[b]].indexOf(a)!=-1)return this.collectionNamesArray[b]},pauseMicroPlayers:function(){try{for(var a=0,b=this.microPlayers.length;a<b;++a)swfobject.getObjectById(this.microPlayers[a]).pauseVideo()}catch(c){console.error("Error while pausing microPlayers. "+c.message)}},setBookMark:function(){try{this.bookMarkedId=this.currentlyPlayingVideoId;this.bookMarkedLocation=Math.floor(swfobject.getObjectById("flashPlayer").getSeek());swfobject.getObjectById("flashPlayer").pauseVideo()}catch(a){console.error("Error while setting the bookmark. "+a.message)}},updateVideoThumbnailVisual:function(a,b){if(a!==""&&dojo.byId("li_"+a))dojo.byId("li_"+a).className="";if(b!==""&&dojo.byId("li_"+b))dojo.byId("li_"+b).className="nowPlaying"},parseInformationFromXmlDoc:function(){for(var a=this.xmlDoc.getElementsByTagName("collection"),b=0,c=a.length;b<c;++b){var e=a[b];this.urlKeysCollectionMap[e.getAttribute("urlkey")]=e.getAttribute("name");this.contentUrlsObject[e.getAttribute("name")]=e.getAttribute("contenturl");this.rssUrlsObject[e.getAttribute("name")]=e.getAttribute("rssurl");this.collectionNamesArray[this.collectionNamesArray.length]=e.getAttribute("name");for(var d=e.getElementsByTagName("subcollection"),f=[],g=0,h=d.length;g<h;++g){var k=d[g];this.urlKeysSubCollectionMap[k.getAttribute("urlkey")]=k.getAttribute("name");this.contentUrlsObject[k.getAttribute("name")]=k.getAttribute("contenturl");this.rssUrlsObject[k.getAttribute("name")]=k.getAttribute("rssurl");f[g]=k.getAttribute("name")}this.subcollectionsObject[e.getAttribute("name")]=f}},createFlashPlayer:function(){if(dojo.byId(this.videoPlayerDivId))try{var a={w:"512",h:"363"};swfobject.embedSWF(this.flashPlayerPath+"main.swf",this.videoPlayerDivId,a.w,a.h,"9.0.0","",{objName:this.getName(),allowPlayerPopup:"1",plyMediaEnabled:"1",movieWidth:a.w,movieHeight:a.h,host:location.host},{allowscriptaccess:"always",wmode:"opaque"},{id:"flashPlayer"})}catch(b){console.error("Error occured createFlashPlayer.."+
b.message);dojo.byId(this.videoPlayerDivId).innerHTML="Couldn't load the flash player. \n Error message is: "+b.message}},convertCurrentPlayingJsonToIdsArray:function(){this.currentlyPlayingVideoIds=[];if(this.currentPlayingJsonObject.items.length>0)for(var a=0,b=this.currentPlayingJsonObject.items.length;a<b;++a)this.currentlyPlayingVideoIds[a]=this.currentPlayingJsonObject.items[a].id},populateVideoSummary:function(a,b,c){if(dojo.byId(this.videoSummaryDivId)){var e="";try{e+="<h2>"+a+" <small>"+
c.split(" ")[0]+"</small>";e+="</h2>";e+="<p>"+b+"</p>"}catch(d){console.error("Error occured in populateVideoSummary."+d.message);e+="Couldn't get video summary."}dojo.byId(this.videoSummaryDivId).innerHTML=e}},createAdvertisement:function(a,b){try{swfobject.getObjectById(this.advertisementDivId).loadAd(a,b)}catch(c){console.error("Error while loading ad in createAdvertisement : "+c)}},createNextVideo:function(){var a="Loading...";try{this.nextVideoId=this.getNextVideoId();if(this.nextVideoId!=="")this.getVideos("/api-video/get_video_info.asp?guid="+this.nextVideoId+"&fields=all","next");else a="No more videos."}catch(b){console.error("Error occured while executing createNextVideo() - "+b.message);a+="Couldn't determine next video details."}if(dojo.byId(this.nextVideoDivId))dojo.byId(this.nextVideoDivId).innerHTML=a},populateNextVideo:function(){var a="";try{var b=this.videoUtil.isNotBlankOrNull(this.currentlyPlayingSubCollection)?this.currentlyPlayingSubCollection:this.currentlyPlayingCollection;a+=this.currentlyPlayingCollection=="Search Results"?"<h3>Next in Video "+this.currentlyPlayingCollection+"</h3>":"<h3>Next in "+b+" Video</h3>";a+='<ul class="newsItem video">';a+="<li>";a+='<a href="javascript:'+this.getName()+".nextVideoThumbnailClicked('"+this.nextVideoDetailsJsonObject.id+'\')" style="background-image: url('+this.nextVideoDetailsJsonObject.thumbnailURL+')" class="preview"><span>&nbsp;</span></a>';a+='<h2><a href="javascript:'+this.getName()+".nextVideoThumbnailClicked('"+this.nextVideoDetailsJsonObject.id+"')\">"+this.nextVideoDetailsJsonObject.name+"</a></h2>";var c=Math.floor(this.nextVideoDetailsJsonObject.duration/60),e=this.nextVideoDetailsJsonObject.duration%60;if(e<10)e="0"+e;a+="<small>"+c+":"+e+"</small>";a+="<p>"+this.nextVideoDetailsJsonObject.description+"</p>";a+="</li>";a+="</ul>"}catch(d){console.error("Error occured while executing populateNextVideo() - "+d.message);a+="Couldn't populate next video details."}if(dojo.byId(this.nextVideoDivId))dojo.byId(this.nextVideoDivId).innerHTML=a},nextVideoThumbnailClicked:function(a){this.userAction="";this.populateMoreVideos(1);this.loadPagination(1);this.updateVideoThumbnailVisual(this.currentlyPlayingVideoId,a);this.currentlyPlayingVideoId=a;this.playVideoByVideoId(a);this.createNextVideo();this.videoUtil.isNotBlankOrNull(this.currentlyPlayingSubCollection)?this.updateSideNavAppearance("subcollection",this.currentlyPlayingSubCollection):this.updateSideNavAppearance("collection",this.currentlyPlayingCollection)},createSearch:function(){var a="";a+='<form id="searchForm" onSubmit="javascript:'+this.getName()+'.searchButtonClicked();return false;" class="" method="post" accept-charset="utf-8">';a+="<fieldset>";a+="<legend>Search Videos</legend>";a+='<div class="ctl">';a+='<label for="frmSearchSectCtl01">Search Videos</label>';a+='<input type="text" name="frmSearchSectCtl01" value="Search Video" id="frmSearchSectCtl01" class="text" onFocus="'+this.getName()+'.searchInputBoxFocused();"/>';a+="</div>";a+='<div class="ctl">';a+='<label for="frmSearchSectSub">Search</label>';a+='<button id="searchButton" type="submit">Search</button>';a+="</div>";a+="</fieldset>";a+="</form>";if(dojo.byId(this.searchDivId))dojo.byId(this.searchDivId).innerHTML=a},searchInputBoxFocused:function(){dojo.byId("frmSearchSectCtl01").value="";dojo.byId("searchForm").className=""},searchButtonClicked:function(){var a=dojo.byId("frmSearchSectCtl01").value.replace(/^\s+|\s+$/,"");if(a===""){dojo.byId("searchForm").className="search_error";dojo.byId("frmSearchSectCtl01").value="Please enter search terms";dojo.byId("searchButton").focus();return false}this.currentSearchText=a;this.sortOrder="relevancy";if(!this.isVideoResultsInSideNav){this.insertVideoResultsInSideNav();this.isVideoResultsInSideNav=true}this.updateVideoResultsInSideNav(this.currentSearchText);this.updateSideNavAppearance("collection","Search Results");this.performSearch("/api-video/find_all_videos.asp?type=wsj-fulltext&query="+a);dojo.byId("searchButton").focus()},insertVideoResultsInSideNav:function(){var a="";a+='<li id="Search Results" class="noSubCollection">';a+="</li>";a+=dojo.byId(this.sideNavUlId).innerHTML;dojo.byId(this.sideNavUlId).innerHTML=a},updateVideoResultsInSideNav:function(a){this.contentUrlsObject["Search Results"]="/api-video/find_all_videos.asp?type=wsj-fulltext&query="+a+"&fields=id,name,description,duration,thumbnailURL,videoURL,formattedCreationDate,wsj-section,wsj-subsection";a="";a+='<a id="a_Search Results" class="" href="javascript:'+this.getName()+".sideNavClicked('collection','Search Results');\">";a+="Search Results</a>";dojo.byId("Search Results").innerHTML=a},performSearch:function(a){this.userAction="toSearch";dojo.byId(this.videoResultsDivId).innerHTML='<p class="noResults"> Loading ... </p>';this.getVideos(a+"&fields=id,name,description,duration,thumbnailURL,videoURL,formattedCreationDate,wsj-section,wsj-subsection&count=60",this.userAction)},loadPagination:function(a){var b="";if(this.userAction=="toBrowse"){if(typeof this.currentBrowsingJsonObject!="undefined")b=this.currentBrowsingJsonObject.items}else if(this.userAction=="toSearch"){if(typeof this.currentSearchJsonObject!="undefined")b=this.currentSearchJsonObject.items}else b=this.currentPlayingJsonObject.items;a=Number(a);b=Math.max(Math.floor(b.length/this.pageSize),Math.ceil(b.length/this.pageSize));var c="";c+=a==1?'<li id="previous" class="listFirst"><span>Previous</span></li>':'<li id="previous" class="listFirst"><a href="javascript:'+this.getName()+".paginationClicked('"+(a-1)+"')\">Previous</a></li>";for(var e=1;e<=b;e++)c+=a==e?"<li><span>"+e+"</span></li>":'<li><a href="javascript:'+this.getName()+".paginationClicked('"+
e+"')\" >"+e+"</a></li>";c+=a>=b?'<li id="next"><span>Next</span></li>':'<li id="next"><a href="javascript:'+this.getName()+".paginationClicked('"+(a+1)+"')\">Next</a></li>";dojo.byId("pagination").innerHTML=c},paginationClicked:function(a){this.populateMoreVideos(a);this.loadPagination(a);this.updateRssFeed(this.visibleSubCollectionId!==""?this.visibleSubCollectionId:this.visibleCollectionId)},getVideos:function(a,b,c,e){var d=dojo.hitch(this,function(g,h,k,l,m){setTimeout(this.getVideos(h,k,l,m,g),1E4)}),f=this;dj.util.Video.getVideoData(a,{handleAs:"json",responseType:"application/json",callback:function(g){f.usrActnHash[b].apply(f,[g]);if(e)c?e.apply(c):e()},errorCallback:function(g){console.warn("faled to getVideos:"+g+", fetching "+a);d(g,a,b,c,e)}})},handleResponse:function(a){this.currentPlayingJsonObject=a;this.convertCurrentPlayingJsonToIdsArray()},handleBrowsingResults:function(a){this.currentBrowsingJsonObject=a;this.populateMoreVideos(1);this.loadPagination(1);this.updateRssFeed(this.visibleSubCollectionId!==""?this.visibleSubCollectionId:this.visibleCollectionId)},handleSearchResults:function(a){this.currentSearchJsonObject=a;this.populateMoreVideos(1);this.loadPagination(1)},handleCurrent:function(a){this.currentVideoDetailsJsonObject=a;this.currentlyPlayingCollection=this.currentVideoDetailsJsonObject["wsj-section"];this.currentlyPlayingSubCollection=this.currentVideoDetailsJsonObject["wsj-subsection"];this.playVideoByParam(this.currentVideoDetailsJsonObject);this.populateVideoSummary(this.currentVideoDetailsJsonObject.name,this.currentVideoDetailsJsonObject.description,this.currentVideoDetailsJsonObject.formattedCreationDate)},handleNext:function(a){this.nextVideoDetailsJsonObject=a;this.populateNextVideo()},populateSideNav:function(){for(var a="",b=this.xmlDoc.getElementsByTagName("collection"),c=0,e=b.length;c<e;++c){var d=b[c],f=d.getElementsByTagName("subcollection"),g=f.length;a+=g>0?'<li class="expand" id="'+d.getAttribute("name")+'"><a id="a_'+d.getAttribute("name")+'" class="" href="javascript:'+this.getName()+".sideNavClicked('"+d.nodeName+"','"+d.getAttribute("name")+"');\">"+d.getAttribute("name")+"</a>":'<li class="noSubCollection" id="'+d.getAttribute("name")+'"><a id="a_'+d.getAttribute("name")+'" class="" href="javascript:'+this.getName()+".sideNavClicked('"+d.nodeName+"','"+d.getAttribute("name")+"');\">"+d.getAttribute("name")+"</a>";if(g>0){a+="<ul id=Sub"+d.getAttribute("name")+">";d=0;for(g=f.length;d<g;++d){var h=f[d];a+='<li><a id="a_'+h.getAttribute("name")+'" class="current" href="javascript:'+
this.getName()+".sideNavClicked('"+h.nodeName+"','"+h.getAttribute("name")+"');\">"+h.getAttribute("name")+"</a></li>"}a+="</ul>"}a+="</li>"}dojo.byId(this.sideNavUlId).innerHTML=a},populateTopNav:function(){if(dojo.byId(this.topNavUlId)){for(var a="",b=this.xmlDoc.getElementsByTagName("collection"),c=0,e=b.length;c<e;++c){var d=b[c],f=d.getAttribute("name");if(f!="Most Popular Today"&&f!="Management"&&f!="Special Packages"){var g=f;g="navlink_"+g.toLowerCase().replace(/\s+/g,"_");a+=c=="1"?'<li class="listFirst">':"<li>";a+="<a class="+g+' id="a_topnav_'+f+'" href="javascript:'+this.getName()+".topNavClicked('"+d.nodeName+"','"+f+"');\">"+f+"</a>";a+="</li>"}}dojo.byId(this.topNavUlId).innerHTML=a}},topNavClicked:function(a,b){this.userAction="";this.updateSideNavAppearance(a,b);this.updateTopNavAppearance(a,b);this.currentlyPlayingCollection=b;this.getVideos(this.validateContentUrl(this.contentUrlsObject[this.currentlyPlayingCollection])+"&count=60","",this,this.handleTopNavGetVideos)},handleTopNavGetVideos:function(){this.visibleCollectionId=this.currentlyPlayingCollection;this.currentBrowsingJsonObject=this.currentPlayingJsonObject;this.currentlyPlayingVideoId=this.currentPlayingJsonObject.items[0].id;this.playVideoByVideoId(this.currentlyPlayingVideoId);this.populateMoreVideos(1);this.loadPagination(1);this.playingGroup=this.browsingGroup="collection";this.createNextVideo()},updateTopNavAppearance:function(a,b){var c=this.currentlyPlayingCollection;if(c=="Lifestyle")c="Life & Style";if(dojo.byId("a_topnav_"+c)){var e=dojo.byId("a_topnav_"+
c).className.replace("selected ","");dojo.byId("a_topnav_"+c).className=e}if(dojo.byId("a_topnav_"+b)){c="selected navlink_"+b.toLowerCase().replace(/\s+/g,"_");dojo.byId("a_topnav_"+b).className=c}},sideNavClicked:function(a,b){this.userAction="";if(this.videoUtil.isNotBlankOrNull(this.contentUrlsObject[b])){this.browsingGroup=a;if(b=="Search Results"){this.userAction="toSearch";this.sortOrder="relevancy"}else if(a=="subcollection"&&b!=this.currentlyPlayingSubCollection||a=="collection"&&b!=this.currentlyPlayingCollection)this.userAction="toBrowse";this.updateSideNavAppearance(a,b);dojo.byId(this.videoResultsDivId).innerHTML='<p class="noResults"> Loading ... </p>';if(this.videoUtil.isNotBlankOrNull(this.userAction))this.getVideos(this.contentUrlsObject[b]+"&count=60",this.userAction);else{this.populateMoreVideos(1);this.loadPagination(1)}}else this.updateSideNavAppearance(a,b)},searchLinkClicked:function(a,b){this.sortOrder=b;this.performSearch(a)},populateMoreVideos:function(a){var b="";if(this.userAction=="toBrowse"){if(typeof this.currentBrowsingJsonObject!="undefined")b=this.currentBrowsingJsonObject.items}else if(this.userAction=="toSearch"){if(typeof this.currentSearchJsonObject!="undefined")b=this.currentSearchJsonObject.items}else b=this.currentPlayingJsonObject.items;var c=(a-1)*12,e=Math.min(a*12-1,b.length-1);a="";if(this.userAction=="toSearch"&&b.length>0){a+='<ul class="sort"><li class="listFirst">Sort by:</li>';var d="/api-video/find_all_videos.asp?type=wsj-fulltext&query="+this.currentSearchText;if(this.sortOrder=="relevancy"){a+='<li class="selected"><span>relevance</span></li>';a+='<li class="listLast"><a href="javascript:'+this.getName()+".searchLinkClicked('"+d+"&sort=date+desc','date')\">Date</a></li>"}else{a+='<li><a href="javascript:'+this.getName()+".searchLinkClicked('"+d+"&sort=relevancy','relevancy')\">Relevance</a></li>";a+='<li class="listLast selected"><span>Date</span></li>'}a+="</ul>";a+='<p class="resultsLabel">'+(c+1)+" - "+(e+1)+" results out of "+b.length+" for: "+this.currentSearchText+"</p>"}if(this.userAction=="toSearch"&&b.length===0){a+='<p class="noResults"> No content matches your search terms. Please try again. </p>';dojo.byId(this.videoResultsDivId).innerHTML=a;return false}a+='<ul class="newsItem video videoListMed">';for(c=c;c<e+1;c++){d=b[c];a+='<li id="li_'+d.id+'" class="">';a+='<a href="javascript:'+this.getName()+".videoThumbnailClicked('"+d.id+'\')" id="'+d.id+'" style="background-image: url('+unescape(d.thumbnailURL)+');" class="preview"><span>&nbsp;</span></a>';a+='<h2><a href="javascript:'+this.getName()+".videoThumbnailClicked('"+d.id+"')\">"+d.name+"</a></h2>";var f=Math.floor(d.duration/60),g=d.duration%60;if(g<10)g="0"+g;a+="<small>"+f+":"+g+"</small>";if(this.videoUtil.isNotBlankOrNull(d.formattedCreationDate))a+="<small> "+d.formattedCreationDate.split(" ")[0]+"</small>";a+="</li>";if((c+1)%4===0)a+='<li class="rowEnd"></li>'}a+="</ul>";a+='<ul id="pagination" class="pagination">';a+="</ul>";if(this.userAction!="toSearch"){b=this.videoUtil.isNotBlankOrNull(this.visibleSubCollectionId)?this.visibleSubCollectionId:this.visibleCollectionId;a+='<a target="_blank" id="rssFeed" class="rss" href="">'+
b+" Video Feed</a>"}dojo.byId(this.videoResultsDivId).innerHTML=a;this.playFromRegisteredVideos||this.updateVideoThumbnailVisual("",this.currentlyPlayingVideoId)},updateRssFeed:function(a){if(dojo.byId("rssFeed"))dojo.byId("rssFeed").href=this.rssUrlsObject[a]},videoThumbnailClicked:function(a){var b="";if(this.sourceApplicationName=="articlePage"){this.playFromRegisteredVideos=false;this.updateVideoThumbnailVisual("reg"+this.currentlyPlayingVideoId,"");b=this.videoUtil.getVideoDetails({id:a,fields:"linkRelativeURL,wsj-section"})}if(b!==""&&(this.relatedVideosCollection!=b["wsj-section"]||this.visibleCollectionId=="Search Results"))window.location.href=b.linkRelativeURL+".html";else{this.playingGroup=this.browsingGroup;if(this.userAction=="toSearch")this.currentPlayingJsonObject=this.currentSearchJsonObject;else if(this.userAction=="toBrowse")this.currentPlayingJsonObject=this.currentBrowsingJsonObject;this.convertCurrentPlayingJsonToIdsArray();this.updateTopNavAppearance("",this.visibleCollectionId);this.currentlyPlayingCollection=this.visibleCollectionId;this.currentlyPlayingSubCollection=this.visibleSubCollectionId;this.updateVideoThumbnailVisual(this.currentlyPlayingVideoId,a);this.currentlyPlayingVideoId=a;this.playVideoByVideoId(a);this.createNextVideo()}dojo.byId("flashPlayer")&&window.scrollTo(0,dojo.position(dojo.byId("flashPlayer"),true).y)},playNextVideo:function(){if(this.nextVideoId!==""){this.updateVideoThumbnailVisual("reg"+this.currentlyPlayingVideoId,"reg"+this.nextVideoDetailsJsonObject.id);this.updateVideoThumbnailVisual(this.currentlyPlayingVideoId,this.nextVideoDetailsJsonObject.id);this.currentlyPlayingVideoId=this.nextVideoDetailsJsonObject.id;this.playVideoByParam(this.nextVideoDetailsJsonObject);this.populateVideoSummary(this.nextVideoDetailsJsonObject.name,this.nextVideoDetailsJsonObject.description,this.nextVideoDetailsJsonObject.formattedCreationDate);this.createNextVideo()}},getNextVideoId:function(){if(this.sourceApplicationName=="articlePage"){if(this.playFromRegisteredVideos&&this.registeredVideosIds.indexOf(this.currentlyPlayingVideoId)<this.registeredVideosIds.length-1)return this.registeredVideosIds[this.registeredVideosIds.indexOf(this.currentlyPlayingVideoId)+1];if(this.playFromRegisteredVideos&&this.registeredVideosIds.indexOf(this.currentlyPlayingVideoId)==this.registeredVideosIds.length-1){this.playFromRegisteredVideos=false;return this.currentlyPlayingVideoIds[0]}if(this.currentlyPlayingVideoIds.indexOf(this.currentlyPlayingVideoId)<this.currentlyPlayingVideoIds.length-1)return this.currentlyPlayingVideoIds[this.currentlyPlayingVideoIds.indexOf(this.currentlyPlayingVideoId)+
1];if(this.currentlyPlayingVideoIds.indexOf(this.currentlyPlayingVideoId)==this.currentlyPlayingVideoIds.length-1)return""}else{if(this.currentlyPlayingVideoIds.indexOf(this.currentlyPlayingVideoId)==-1)return this.currentlyPlayingVideoIds[0];if(this.currentlyPlayingVideoIds.indexOf(this.currentlyPlayingVideoId)<this.currentlyPlayingVideoIds.length-1)return this.currentlyPlayingVideoIds[this.currentlyPlayingVideoIds.indexOf(this.currentlyPlayingVideoId)+1];if(this.currentlyPlayingVideoIds.indexOf(this.currentlyPlayingVideoId)==this.currentlyPlayingVideoIds.length-1){if(this.currentlyPlayingCollection=="Search Results")return"";if(this.playingGroup!==""&&this.playingGroup=="collection")return this.getVideoIdFromNextCollection();if(this.playingGroup!==""&&this.playingGroup=="subcollection")return this.getVideoIdFromNextSubCollection()}}},getVideoIdFromNextSubCollection:function(){var a=this.subcollectionsObject[this.currentlyPlayingCollection];if(a.indexOf(this.currentlyPlayingSubCollection)!=a.length-1){this.currentlyPlayingSubCollection=a[a.indexOf(this.currentlyPlayingSubCollection)+1];this.getVideos(this.contentUrlsObject[this.currentlyPlayingSubCollection]+"&count=60","",this,handleGetVideoIdFromNextSubColection)}else{this.currentlyPlayingSubCollection="";return this.getVideoIdFromNextCollection()}},handleGetVideoIdFromNextSubColection:function(){return this.currentPlayingJsonObject.items.length===0?this.getVideoIdFromNextSubCollection():this.currentPlayingJsonObject.items[0].id},getVideoIdFromNextCollection:function(){if(this.collectionNamesArray.indexOf(this.currentlyPlayingCollection)!=this.collectionNamesArray.length-1){if(this.skipCollection)this.currentlyPlayingCollection=this.collectionNamesArray[this.collectionNamesArray.indexOf(this.currentlyPlayingCollection)+1];this.skipCollection=true;this.getVideos(this.contentUrlsObject[this.currentlyPlayingCollection]+"&count=60","",this,handleGetVideoIdFromNextCollection)}else{this.currentlyPlayingCollection=this.defaultCollectionName;this.skipCollection=false;return this.getVideoIdFromNextCollection()}},handleGetVideoIdFromNextCollection:function(){return this.currentPlayingJsonObject.items.length===0?this.getVideoIdFromNextCollection():this.currentPlayingJsonObject.items[0].id},loadCollectionsDoc:function(a,b){dj.util.Video.getVideoData(this.collectionsXMLPath+"video-collections.xml",{context:a,callback:b,responseType:"text/xml",errorCallback:function(){console.error("Failure while loading video Collection xml.")}})},updateSideNavAppearance:function(a,b){if(this.visibleSubCollectionId!=="")if(dojo.byId("a_"+this.visibleSubCollectionId))if(dojo.byId("a_"+this.visibleSubCollectionId).className=="subcollection-selected")dojo.byId("a_"+this.visibleSubCollectionId).className="current";if(a=="collection"){if(this.visibleCollectionId!==""){var c=dojo.byId(this.visibleCollectionId),e=dojo.byId("a_"+this.visibleCollectionId);if(c.className=="expanded")c.className="expand";else if(c.className!="expand")c.className="noSubCollection";e.className=""}if(dojo.byId(b).className=="expand"){dojo.byId(b).className="expanded";dojo.byId("a_"+b).className="collection-selected"}else{dojo.byId(b).className="noSubCollection-expanded";dojo.byId("a_"+b).className="selected"}this.visibleCollectionId=b;this.visibleSubCollectionId=""}if(a=="subcollection"){if(this.videoUtil.isNotBlankOrNull(dojo.byId("a_"+b)))dojo.byId("a_"+b).className="subcollection-selected";if(this.videoUtil.isNotBlankOrNull(dojo.byId(this.visibleCollectionId)))dojo.byId(this.visibleCollectionId).className="expanded";if(this.videoUtil.isNotBlankOrNull(dojo.byId("a_"+this.visibleCollectionId)))dojo.byId("a_"+this.visibleCollectionId).className="";this.visibleSubCollectionId=b}},getName:function(){return this.objName},playVideoByVideoId:function(a){this.getVideos("/api-video/get_video_info.asp?guid="+a+"&fields=all","current")},playVideoByParam:function(a){var b=(new dj.util.Ads).getRegisteredAdsZone(""),c=this.videoUtil.isNotBlankOrNull(this.currentlyPlayingSubCollection)?this.currentlyPlayingSubCollection:this.currentlyPlayingCollection;if(b!="default"&&b!="")a.adZone=b;a.lineup=c;a.emailPartnerID=110626;a.site=this.site;a.msrc=this.msrc;a.adFrmt="frmt=2;";a.playerName=this.sourceApplicationName=="articlePage"?"video_articletab":"video_videocenter";a.embedPlayerURL=this.flashPlayerPath+"main.swf";a.embedConfigURL=this.embedConfigURL;a.embedPlayerID="1000";a.embedName="flashPlayer";a.embedBaseURL=this.flashPlayerPath;a.embedHeight=363;a.embedWidth=512;a.larsID=91;a.larsAdTrackingID=1259;a.prop5=window.location.href.split("?")[0];a.prop6=window.location.href;a.prop10=this.videoUtil.getUrlParam(window.location.href,"mod");a.campaign=this.videoUtil.getUrlParam(window.location.href,"mod");a.prop11=this.videoUtil.getUrlParam(window.location.href,"reflink");a.prop19=this.sourceApplicationName=="articlePage"?"video_tab":"video";a.prop24=this.prop24;a.prop25=this.prop25;a.prop27=this.prop27;b=this.videoUtil.omnitureEncoding(this.currentlyPlayingCollection,this.currentlyPlayingSubCollection,"s");c=this.videoUtil.omnitureEncoding(this.currentlyPlayingCollection,this.currentlyPlayingSubCollection,"c");a.prop2="WSJ_"+c;a.prop3="WSJ_Video_Video_"+c;a.prop22="WSJ_Video_Video_"+b;a.prop26="WSJ_"+b;a.emailURL=this.emailURL;swfobject.getObjectById("flashPlayer").playVideo(dojo.toJson(a))},openPopUpPlayer:function(){var a=Math.floor(swfobject.getObjectById("flashPlayer").getSeek()),b=this.currentlyPlayingCollection;if(b=="Special Packages"||b=="Search Results")b=this.currentVideoDetailsJsonObject["wsj-section"];this.popUpWindow=window.open(this.popUpPageUrl+"?currentPlayingLocation="+a+"&currentlyPlayingCollection="+escape(b)+"&currentlyPlayingVideoId="+this.currentlyPlayingVideoId,"popUpPlayer","height=840,width=422,left="+(screen.width-Number("422"))/2+",top="+(screen.height-Number("840"))/2+",resizable=yes,scrollbars=no,toolbar=no,status=no")},focusPopUp:function(){this.popUpWindow&&this.popUpWindow.focus()},createRegisteredVideosThumbnails:function(){if(this.registeredVideosIds.length>0){for(var a="",b=0,c=this.registeredVideosIds.length;b<c;++b){var e=this.registeredVideos[b];if(e){a+='<li id="li_reg'+e.id+'" class="">';a+='<a href="javascript:'+this.getName()+".regVideoThumbnailClicked('"+
e.id+"','"+unescape(e.videoURL)+'\')" id="'+e.id+'" style="background-image: url('+unescape(e.thumbnailURL)+');" class="preview"><span>&nbsp;</span></a>';a+='<h2><a href="javascript:'+this.getName()+".regVideoThumbnailClicked('"+e.id+"','"+unescape(e.videoURL)+"')\">"+e.name+"</a></h2>";var d=Math.floor(e.duration/60);e=e.duration%60;if(e<10)e="0"+e;a+="<small>"+d+":"+e+"</small>";a+="</li>";if((b+1)%4===0)a+='<li class="rowEnd"></li>'}}dojo.byId(this.registeredVideosDivId).innerHTML=a}},regVideoThumbnailClicked:function(a){this.playFromRegisteredVideos=true;this.updateVideoThumbnailVisual("reg"+this.currentlyPlayingVideoId,"reg"+a);this.updateVideoThumbnailVisual(this.currentlyPlayingVideoId,"");this.currentlyPlayingVideoId=a;this.playVideoByVideoId(a);this.createNextVideo()},registerVideo:function(a){this.playFromRegisteredVideos=true;if(a.indexOf("{")==-1)a="{"+a+"}";if(dojo.indexOf(this.registeredVideosIds,a)==-1){this.registeredVideosIds[this.registeredVideosIds.length]=a;this.registeredVideos[this.registeredVideos.length]=this.videoUtil.getVideoDetails({id:a,fields:"all"})}},loadSoloVideo:function(a,b){if(a.indexOf("{")==-1)a="{"+a+"}";var c="MicroPlayer_"+Math.floor(Math.random()*1E6);this.microPlayers[this.microPlayers.length]=c;this.videoIdMicroPlayerIdMap[a]=c;if(!dj.context.video)dj.context.video={};if(!dj.context.video.soloVideos)dj.context.video.soloVideos=[];dj.context.video.soloVideos[a]=this;if(swfobject.getFlashPlayerVersion().major>=9){var e={w:"272",h:"180"};swfobject.embedSWF(this.flashPlayerPath+"microPlayer.swf",b,e.w,e.h,"9.0.0","",{objName:"dummy",videoGUID:a,allowPlayerPopup:"1",plyMediaEnabled:"1",movieWidth:e.w,movieHeight:e.h,host:location.host},{allowscriptaccess:"always",wmode:"opaque"},{id:c})}else dj.util.Video.nonSupportingFlashPlayer(b)},getJSON:function(a){var b="/api-video/get_video_info.asp?guid="+a;b+="&fields=all";dj.util.Video.getVideoData(b,{context:this,handleAs:"json",sync:true,responseType:"application/json",callback:this.handleGetJSON,errorCallback:function(){console.error("Failed while executing video.VideoCenter.getJSON")}});this.microPlayersObjects[a]=this.jsonData;return dojo.toJson(this.jsonData)},handleGetJSON:function(a){this.jsonData=a;a=(new dj.util.Ads).getRegisteredAdsZone("");if(a!="default"&&a!="")this.jsonData.adZone=a;this.jsonData.emailPartnerID=110626;this.jsonData.site=this.site;this.jsonData.msrc=this.msrc;this.jsonData.adFrmt="frmt=0;";this.jsonData.playerName="video_articleembed";this.jsonData.videoCenterURL="http://"+window.location.host+"/video-center";this.jsonData.embedPlayerURL=this.flashPlayerPath+"microPlayer.swf";this.jsonData.embedConfigURL=this.embedConfigURL;this.jsonData.embedPlayerID="1000";this.jsonData.embedName="microflashPlayer";this.jsonData.embedBaseURL=this.flashPlayerPath;this.jsonData.embedHeight=180;this.jsonData.embedWidth=272;this.jsonData.larsID=91;this.jsonData.larsAdTrackingID=1259;this.jsonData.prop5=window.location.href.split("?")[0];this.jsonData.prop6=window.location.href;this.jsonData.prop10=this.videoUtil.getUrlParam(window.location.href,"mod");this.jsonData.campaign=this.videoUtil.getUrlParam(window.location.href,"mod");this.jsonData.prop11=this.videoUtil.getUrlParam(window.location.href,"reflink");this.jsonData.prop19="video_emb";this.jsonData.prop24=this.prop24;this.jsonData.prop25=this.prop25;this.jsonData.prop27=this.prop27;a=this.videoUtil.omnitureEncoding(this.jsonData["wsj-section"],this.jsonData["wsj-subsection"],"s");var b=this.videoUtil.omnitureEncoding(this.jsonData["wsj-section"],this.jsonData["wsj-subsection"],"c");this.jsonData.prop2="WSJ_"+b;this.jsonData.prop3="WSJ_Video_Video_"+b;this.jsonData.prop22="WSJ_Video_Video_"+a;this.jsonData.prop26="WSJ_"+a;this.jsonData.emailURL=this.emailURL;a="0";try{if(pID.indexOf("0_0_WH")!=-1)a="1"}catch(c){console.error("pID read error")}this.jsonData.suppressAds=a},updateTitle:function(){var a=dj.lang.query("#videoPlayerDescription h2")[0].innerHTML;a=a.substring(0,a.indexOf("<small>")-1);document.title=document.title.replace("Article",a)}});dojo.declare("dj.widget.video.video",dj.widget.video.VideoCenter,{constructor:function(){dojo.deprecated("dj.widget.video.video","Use dj.widget.video.VideoCenter, remove alias when MST JSEXECs updated","1.0")}});dojo.provide("dj.widget.video.view.AdPlayer");dojo.require("dj.util.VideoUtils");dojo.require("dj.widget.video.model.SWFPlayer");(dj.widget.video.view.AdPlayer=function(a){this.controller={};this.configuration={name:"adPlayer",width:300,height:250};dojo.mixin(this.configuration,a);this.container=dojo.byId(this.configuration.containerID)}).prototype={init:function(a){this.controller=a},render:function(){var a=this.controller.configuration;this._setDefaultSize(a.containerID);if(!this.playerCreated){this.playerCreated=true;var b=new dj.widget.video.model.SWFPlayer;b.id=a.playerID;console.log("******* conf.playerID ********* "+
a.playerID);b.swfURL=a.flashPlayerPath+a.playerType.swfFile;b.containerID=a.containerID;b.width=a.playerType.width;b.height=a.playerType.height;b.host=a.host;dj.util.VideoUtils.createSWFPlayer(b)}},loadAd:function(a,b){swfobject.getObjectById(this.controller.configuration.playerID).loadAd(a,b)},_setDefaultSize:function(a){(a=dojo.byId(a))&&dojo.style(a,{width:this.configuration.width+"px",height:this.configuration.height+"px"})}};dojo.provide("dj.widget.video.controller.Browser");dojo.require("dj.lang");dojo.require("dj.util.Observer");dojo.require("dj.util.VideoUtils");dojo.require("dj.widget.video.model.Playlist");(dj.widget.video.controller.Browser=function(a,b){this.observer=a||new dj.util.Observer(dj.widget.video.VideoBrowser);this.configuration={videoCollectionAPIURL:"/api-video/find_all_videos.asp",maxVideoRequestCount:60,collectionQueryCount:60,searchQueryCount:60,defaultType:"wsj-section",defaultQuery:"News",defaultSelectionID:"News"};this.addToConfig(b);this.currentSection=this.currentVideoID=this.currentQuery=this.currentType="";this.browserPlayList=null;this.currentPage=1;this.firstLoad=true;this.sortBy="";this.sorting={BY_RELEVANCE:"RELEVANCE",BY_DATE:"DATE"}}).prototype={init:function(a){this.view=a;this.view.init(this)},addToConfig:function(a){dojo.mixin(this.configuration,a)},requestDefaultVideos:function(){this.requestVideos([this.configuration.defaultType,this.configuration.defaultQuery,this.configuration.defaultSelectionID],this.currentPage,false)},selectVideo:function(a,b){b=parseInt(b,10);this.currentVideoID=a;this.highligthThumbnail(a);var c=new dj.widget.video.model.Playlist;c.videos=this.browserPlayList;c.query=this.currentQuery;c.sectionID=this.currentSection;c.videoIndex=b;this.observer.fireByName("onVideoSelected",a,c)},getVideoIndex:function(a){for(var b=0;b<this.browserPlayList.items.length;b++)if(a==this.browserPlayList.items[b].id)return b;return null},selectVideoByIndex:function(a){a=parseInt(a,10);this.selectVideo(this.browserPlayList.items[a].id,a)},selectVideoByID:function(a){this.selectVideo(a,this.getVideoIndex(a))},highligthThumbnail:function(a){this.view.highligthThumbnail(a)},requestVideos:function(a,b,c,e){if(!(a.length<3)){var d=a[0],f=a[1],g=a[2];if(!(d===""||f==="")){this.view.renderLoading();a="";if(d!=this.currentType||f!=this.currentQuery||e){this.currentType=d;this.currentQuery=f;a=c?this.configuration.videoCollectionAPIURL+"?count="+this.configuration.searchQueryCount+"&type="+this.currentType+"&query="+this.currentQuery+"&fields=id,name,description,duration,thumbnailURL,videoURL,formattedCreationDate,wsj-section,wsj-subsection":d=="doctype"?this.configuration.videoCollectionAPIURL+"?count="+this.configuration.collectionQueryCount+"&doctype="+this.currentQuery+"&fields=id,name,description,duration,thumbnailURL,videoURL,formattedCreationDate,wsj-section,wsj-subsection":this.configuration.videoCollectionAPIURL+"?count="+this.configuration.collectionQueryCount+"&type="+this.currentType+"&query="+this.currentQuery+"&fields=id,name,description,duration,thumbnailURL,videoURL,formattedCreationDate,wsj-section,wsj-subsection";if(e){a+="&sort="+e;this.sortBy=e}var h=this;dojo.xhrGet({url:a,handleAs:"json",preventCache:true,headers:{Accept:"application/json"},load:function(k){h.browserPlayList=k;h.currentSection=g;h.render(b);if(h.firstLoad){h.firstLoad=false;h.observer.fireByName("onFirstLoad")}h.observer.fireByName("onCollectionLoad",{type:h.currentType,query:h.currentQuery,sectionID:g});return k},error:function(k){console.error("Could not load the playlist for "+d+" - "+f);return k}})}else this.render(b)}}},render:function(a){if(a!=this.currentPage)this.currentPage=a;this.view.render()}};dojo.provide("dj.widget.video.Video");dojo.require("dj.lang");dojo.require("dj.util.Video");dojo.require("dj.util.Ads");dojo.require("swfobject.swfobject_1_5.swfobject");dojo.require("swfobject.swfobject_2_2.swfobject");dojo.require("dj.widget.video.VideoCenter");dojo.require("dj.util.Element");dojo.getObject("dj.module.video",true);dojo.declare("dj.widget.video.Video",null,{config:{thumbnail:{divclass:"headlineSummary video",onclickprefix:"dj.module.articleVideoPlayer.tabplay(",onclicksuffix:");",hrefprefix:"#articleTabs_video-"},bc:{src:"http://wsj.vo.llnwd.net/o28/plymedia/SWF/BrightPLYembed.swf",flashVars:"playerId=452319854&viewerSecureGatewayURL=https://services.brightcove.com/services/amfgateway&servicesURL=http://services.brightcove.com/services&cdnURL=http://admin.brightcove.com&domain=embed&autoStart=false&showTicker=true&flashId=flashObj&videoId=",base:"http://wsj.vo.llnwd.net/o28/plymedia/SWF",bgcolor:"#000000",name:"BrightPLYembed",pluginspage:"http://www.macromedia.com/shockwave/download/index.cgi?P1_Prod_Version=ShockwaveFlash",flashversion:"8"}},constructor:function(a,b,c,e,d){if(a){this.parent=dojo.byId(a);if(typeof dojo.query("div[data-dj-live-widget]",this.parent)[0]==="object")console.info("{Video} %o will be handled by the video.MicroPlayer.",a);else{this.microPlayers=[];this.microPlayersObjects={};this.videoIdMicroPlayerIdMap={};this.videoUtil=dj.util.Video;dj.util.Element.identify(this.parent);c=this.videoUtil.setupConfig();dj.lang.mixin(this,c);this.flashPlayerPath=dj.context.core.cdnPrefix+"/media/swf/";this.parentid=a;if(this.parent){this.v=b;this.w=c=264;this.h=e=254;this.c=d;b&&this.load(b,c,e,d)}else console.log("id "+a+" not found")}}},createwrapper:function(a,b){this.div=dojo.create("div",{id:this.vidid});if(b&&!this.isguid(a)){this.tryw=""+b+"px";this.div.style.width=this.tryw}this.parent.appendChild(this.div)},createvideobc:function(a,b,c,e){dojo.deprecated("dj.widget.video.Video.createvideobc","If brightcove is not supported, remove this method","2.0");this.so=new SWFObject(this.config.bc.src,a,b,c,this.config.bc.flashversion,this.config.bc.bgcolor);this.so.setAttribute("id","video_"+this.vidid);this.so.addParam("base",this.config.bc.base);this.so.addParam("flashVars",this.config.bc.flashVars+a+"&");this.so.addParam("seamlesstabbing","false");this.so.addParam("swLiveConnect","true");this.so.addParam("name",this.config.bc.name);this.so.addParam("pluginspage",this.config.bc.pluginspage);this.so.addParam("wmode","opaque");this.so.write(this.div);e&&this.div.appendChild(dojo.create("p",{"class":"targetCaption",innerHTML:e}))},createvideoguid:function(a){this.loadSoloVideo(a,this.vidid);this.c&&this.parent.appendChild(dojo.create("p",{"class":"targetCaption",innerHTML:this.c}))},createvideo:function(a,b,c,e){this.isguid(a)?this.createvideoguid(a):this.createvideobc(a,b,c,e)},load:function(a,b,c,e){if(!this.div){this.newId();this.createwrapper(a,b,c);this.createvideo(a,b,c,e)}},createthumbnail:function(a){if(this.guidvideo)if(this.guidvideo.details){a||console.warn("no playObserver");var b=dojo.create("div",{"class":"videoTree"});this.div.appendChild(b);var c=dojo.create("div",{"class":"videoFrame"});b.appendChild(c);b=dojo.create("a",{href:"#"});dojo.connect(b,"onclick",this,function(e){a.fire(this.v);dojo.stopEvent(e)});c.appendChild(b);c=dojo.create("img",{src:this.guidvideo.details.thumbnailURLSmall,width:"115",height:"65",alt:"video"});b.appendChild(c);c=dojo.create("span",{"class":"videoBug"});c.innerHTML="&nbsp;";b.appendChild(c);b=dojo.create("h3",{"class":"first"});this.div.appendChild(b);c=dojo.create("a",{href:"#",innerHTML:this.guidvideo.details.name});dojo.connect(c,"onclick",this,function(e){a.fire(this.v);dojo.stopEvent(e)});b.appendChild(c);this.div.appendChild(dojo.create("small",{innerHTML:this.videoUtil.formatduration(this.guidvideo.details.duration)}));this.div.appendChild(dojo.create("p",{"class":"targetCaption",innerHTML:this.guidvideo.details.description}))}else console.error("no guidvideo.details");else console.error("no guidvideo")},loadthumbnail:function(a,b,c,e){this.v=a;if(this.isguid(a)){this.getvideodetails();this.newId();this.createwrapper(a,b,c);this.createthumbnail(e)}else console.error("cannot create tumbnail to old video")},getguidvideo:function(){try{if(!this.guidvideo)this.guidvideo=new dj.widget.video.VideoCenter;return this.guidvideo}catch(a){console.error("could not instantiate dj.widget.video.VideoCenter")}return null},getvideodetails:function(){if(this.getguidvideo())this.guidvideo.details=this.videoUtil.getVideoDetails({id:this.v,fields:"name,id,duration,description,thumbnailURL,thumbnailURLSmall"})},setBookMark:function(){this.getguidvideo()&&this.guidvideo.setBookMark()},pauseMicroPlayer:function(){this.getguidvideo()&&this.guidvideo.pauseMicroPlayers()},isguid:function(a){a=""+a;if(a.substring(0,1)!="{")a="{"+a;return a.substring(0,1)=="{"&&a.substring(9,10)=="-"&&a.substring(14,15)=="-"&&a.substring(19,20)=="-"?true:false},newId:function(){this.vidid="videodiv_"+Math.floor(Math.random()*999999)},loadSoloVideo:function(a,b){var c=this.videoUtil.setupConfig();dj.lang.mixin(this,c);if(a.indexOf("{")==-1)a="{"+a+"}";c="MicroPlayer_"+Math.floor(Math.random()*1E6);this.microPlayers[this.microPlayers.length]=c;this.videoIdMicroPlayerIdMap[a]=c;dojo.getObject("dj.context.video",true);if(!dj.context.video.soloVideos)dj.context.video.soloVideos=[];dj.context.video.soloVideos[a]=this;var e=1,d=dojo.getObject("dj.context.video.chainVideos");if(d!=undefined&&d===false)e=0;if(swfobject.getFlashPlayerVersion().major>=9){d={w:"272",h:"180"};swfobject.embedSWF(this.flashPlayerPath+"microPlayer.swf",b,d.w,d.h,"9.0.0","",{objName:"dummy",videoGUID:a,allowPlayerPopup:"1",plyMediaEnabled:"1",movieWidth:d.w,movieHeight:d.h,host:location.host,chainVideos:e},{allowscriptaccess:"always",wmode:"opaque"},{id:c})}else dj.util.Video.nonSupportingFlashPlayer(b)},openMicroPopUpPlayer:function(a){var b=Math.floor(swfobject.getObjectById(this.videoIdMicroPlayerIdMap[a]).getSeek()),c=this.microPlayersObjects[a]["wsj-section"];if(c=="Lifestyle")c="Life & Style";this.popUpWindow=window.open(this.popUpPageUrl+"?currentPlayingLocation="+b+"&currentlyPlayingCollection="+escape(c)+"&currentlyPlayingVideoId="+a,"popUpPlayer","height=660,width=512,left="+(screen.width-Number("512"))/2+",top="+(screen.height-Number("660"))/2+",resizable=yes,scrollbars=no,toolbar=no,status=no")},getJSON:function(a){var b="/api-video/get_video_info.asp?guid="+a;b+="&fields=all";dj.util.Video.getVideoData(b,{context:this,handleAs:"json",sync:true,responseType:"application/json",callback:this.handleGetJSON,errorCallback:function(){console.error("Failed while executing video.Video.getJSON")}});this.microPlayersObjects[a]=this.jsonData;return dojo.toJson(this.jsonData)},handleGetJSON:function(a){this.jsonData=a;a=(new dj.util.Ads).getRegisteredAdsZone("");if(a!="default"&&a!="")this.jsonData.adZone=a;this.jsonData.emailPartnerID=110626;this.jsonData.site=this.site;this.jsonData.msrc=this.msrc;this.jsonData.adFrmt="frmt=0;";this.jsonData.playerName="video_articleembed";this.jsonData.videoCenterURL="http://"+window.location.host+"/video-center";this.jsonData.embedPlayerURL=this.flashPlayerPath+"microPlayer.swf";this.jsonData.embedConfigURL=this.embedConfigURL;this.jsonData.embedPlayerID="1000";this.jsonData.embedName="microflashPlayer";this.jsonData.embedBaseURL=this.flashPlayerPath;this.jsonData.embedHeight=180;this.jsonData.embedWidth=272;this.jsonData.larsID=91;this.jsonData.larsAdTrackingID=1259;this.jsonData.prop5=window.location.href.split("?")[0];this.jsonData.prop6=window.location.href;this.jsonData.prop10=this.videoUtil.getUrlParam(window.location.href,"mod");this.jsonData.campaign=this.videoUtil.getUrlParam(window.location.href,"mod");this.jsonData.prop11=this.videoUtil.getUrlParam(window.location.href,"reflink");this.jsonData.prop19="video_emb";this.jsonData.prop24=this.prop24;this.jsonData.prop25=this.prop25;this.jsonData.prop27=this.prop27;a=this.videoUtil.omnitureEncoding(this.jsonData["wsj-section"],this.jsonData["wsj-subsection"],"s");var b=this.videoUtil.omnitureEncoding(this.jsonData["wsj-section"],this.jsonData["wsj-subsection"],"c");this.jsonData.prop2="WSJ_"+b;this.jsonData.prop3="WSJ_Video_Video_"+b;this.jsonData.prop22="WSJ_Video_Video_"+a;this.jsonData.prop26="WSJ_"+a;this.jsonData.emailURL=this.emailURL;this.jsonData.suppressAds=pID&&pID.indexOf("0_0_WH")!=-1?"1":"0"}});dojo.provide("dj.widget.video.controller.Player");dojo.require("dj.lang");dojo.require("dj.util.Observer");dojo.require("dj.util.User");dojo.require("dj.util.Region");dojo.require("dj.util.Omniture");dojo.require("dj.util.Cookie");dojo.require("dj.util.Page");dojo.require("dj.widget.video.model.PlayerTypes");dojo.require("dj.module.video.taboolaVideo");dojo.require("dj.util.ie9.pin");dojo.provide("dj.util.VideoUtils");dojo.declare("dj.widget.video.controller.Player",null,{DEFAULT_CONFIG:{flashPlayerPath:"/media/swf/",playerType:dj.widget.video.model.PlayerTypes.MainPlayer,containerID:"videoPlayer",descriptionID:"videoPlayerDescription",playerID:"",videoAPIURL:"/api-video/get_video_info.asp",embedConfURL:"http://wsj.vo.llnwd.net/o28/players/",eventNamespace:"",host:location.host,applications:["video","video_popup","video_tab","video_emb","video_home"],applicationID:0,loadWaitTime:1E3,loadWaitCount:10,dataset:{},adFormat:"frmt=2;",videoPageValue:"videoPlay",videotrackId:"",enableVideoModuleChaining:0},constructor:function(a,b){this.observer=a||new dj.util.Observer(dj.widget.video.VideoPlayer);this.configuration=dojo.mixin(dojo.clone(this.DEFAULT_CONFIG),b);this.videoInformation={};this.view=this.seekTime=null;this.readyForEvents=false;this.playedOn=null;var c=dj.util.Page.getQueryParam("site"),e="";try{e=dj.context.videoCenter.host}catch(d){console.error("{Player} error while getting site value from context. ",d.message)}this.site=c?c:e;this.msrc=dj.util.Page.getQueryParam("msrc")},init:function(a,b,c,e){if(c)this.seekTime=c;this.view=a;if(e&&e!="")this.playedOn=e;this.view.init(this);if(b)e&&e!=""?this.playVideo(b,e):this.playVideo(b);this.loadRetriesLeft=this.configuration.loadWaitCount},playVideo:function(a,b){if(b)this.playedOn=b;this.loadRetriesLeft=this.configuration.loadWaitCount;this.view.renderPreloader&&this.view.renderPreloader();this.queryVideo(a)},queryVideo:function(a){var b=this;dojo.xhrGet({url:this.configuration.videoAPIURL+"?guid="+a+"&fields=all",handleAs:"json",preventCache:true,headers:{Accept:"application/json"},load:function(c){b.videoID=a;b.videoInformation=c;b.render();b.loadVideo();b.observer.fireByName("onVideoLoaded",a,c,b.playedOn);return c},error:function(c){console.error("{Player} could not load video: '%s'. Response: %o",a,c);return c}})},render:function(){return this.view.render()},loadVideo:function(){if(this.loadRetriesLeft==0)console.info("{Player} number of Load Retries expired");else{var a=this;if(this.readyForEvents)this._startPlaying();else{this.loadRetriesLeft--;setTimeout(function(){a.loadVideo()},this.configuration.loadWaitTime)}}},_startPlaying:function(){try{var a=dj.context.core.urlPrefix+"/video/"+this.videoInformation.guid+".html";dj.module.video.taboolaVideo.notifyDynamicLoad(a,a,this.configuration.videotrackId,this.configuration.videoPageValue)}catch(b){console.log("Error while Taboola notification, ignore if not a taboola recommended module: "+b)}this.view.play(this.addVideoParameters(this.videoInformation))},videoPlayed:function(){},videoPaused:function(){},videoUnPaused:function(){},videoPopUp:function(){},getCurrentVideoID:function(){return this.videoID},getVideoData:function(a){return this.videoInformation[a]},addVideoParameters:function(a){try{var b="WSJ_";a||(a={});if(this.seekTime){a.seekTime=this.seekTime;this.seekTime=null}a.emailPartnerID=110626;a.site=this.site;a.msrc=this.msrc;a.adFrmt=this.configuration.adFormat;a.playerName=this.view.configuration.name;a.embedPlayerURL=dj.context.core.cdnPrefix+
this.configuration.flashPlayerPath+this.configuration.playerType.swfFile;a.embedConfigURL=this.configuration.embedConfURL;a.embedPlayerID="1000";a.embedName=this.configuration.playerID;a.embedBaseURL=dj.context.core.cdnPrefix+this.configuration.flashPlayerPath;a.embedHeight=this.configuration.playerType.height;a.embedWidth=this.configuration.playerType.width;a.larsID=91;a.larsAdTrackingID=1259;if(this.configuration.applicationID===3)a.playerName="video_articleembed";if(this.playedOn)a.lineupID=unescape(this.playedOn).toLowerCase().replace(/[^a-zA-Z0-9]/g,"");try{a.prop59=dj.util.Cookie.getCookie("referrerURL");if(a.prop59===undefined||""===a.prop59||a.prop59===null){var c=document.referrer;try{if(c!==undefined&&""!==c){c=c.substring(c.indexOf("http://")+7);a.prop59=c.substring(0,c.indexOf("/"))}}catch(e){}}a.prop60=dj.util.Cookie.getCookie("sitereferrer")?dj.util.Cookie.getCookie("sitereferrer"):document.referrer}catch(d){}a.prop62=b+"embed";a.prop48=dj.util.ie9.pin.siteMode();var f=dj.util.Region.getViewByRegion();try{a.prop24=dj.util.Omniture.editionToNameMap[f.toLowerCase()]}catch(g){}a.pageName="WSJLive_Video_article type_"+a.titletag;a.prop1="Video";a.prop13=a.adZone;a.prop20="video_"+a.guid;a.prop21="WSJLive_"+a.author;a.prop23="video_"+a.formattedCreationDate;a.prop27="";try{dj.util.User.isLoggedIn(function(u){if(u)dj.util.User.isSubLoggedIn(function(p){if(p)dj.util.User.hasRole("WSJ-PRO",function(o){if(o){b="WSJPRO_";a.prop27="WSJ_proc_sub_yes"}else dj.util.User.hasRole("WSJ-ENT",function(t){if(t){b="WSJPRO_";a.prop27="WSJ_proe_sub_yes"}else a.prop27="WSJ_sub_yes"})});else a.prop27="WSJ_mem_yes"});else a.prop27=a.cookieUserType===null||a.cookieUserType!=="subscribed"?"WSJ_free":"WSJ_reg_yes"})}catch(h){try{a.prop27=a.cookieUserType===null||a.cookieUserType!=="subscribed"?"WSJ_free":"WSJ_reg_yes"}catch(k){}}var l=dj.util.VideoUtils.omnitureEncoding(a["wsj-section"],a["wsj-subsection"],"s"),m=dj.util.VideoUtils.omnitureEncoding(a["wsj-section"],a["wsj-subsection"],"c");a.appName=b.substring(0,b.length-1);a.appType=this.configuration.applications[this.configuration.applicationID];a.section=m;a.subsection=l;a.prop2="WSJLive_"+m;a.prop3="WSJLive_Video_"+m;a.prop4="WSJLive_Video_"+m+"_"+a.titletag+"_"+a.duration;a.prop26="WSJLive_"+l;a.prop5=window.location.href.split("?")[0];a.prop6=window.location.href;a.prop7="off";a.prop8="video_"+a.doctypeID;a.prop9="free";try{a.prop10=dj.util.Page.getQueryParam("mod")&&""!=dj.util.Page.getQueryParam("mod")?dj.util.Page.getQueryParam("mod"):dj.util.Page.getQueryParam("link")}catch(q){}a.campaign=a.prop10;c=document.referrer;a.prop25=dj.util.Cookie.getCookie("TR");try{a.cookieUserType=dj.util.Cookie.getCookie("user_type")}catch(n){console.error("cookie read error while fetching cookieUserType : "+n)}var s=typeof pID==="string"&&pID.indexOf("0_0_WH")!=-1?"1":"0";a.suppressAds=s}catch(w){}return a},addVideoParametersOld:function(a){var b="WSJ_";a||(a={});if(this.seekTime){a.seekTime=this.seekTime;this.seekTime=null}a.emailPartnerID=110626;a.site=this.site;a.msrc=this.msrc;a.adFrmt=this.configuration.adFormat;a.playerName=this.view.configuration.name;a.embedPlayerURL=dj.context.core.cdnPrefix+this.configuration.flashPlayerPath+this.configuration.playerType.swfFile;a.embedConfigURL=this.configuration.embedConfURL;a.embedPlayerID="1000";a.embedName=this.configuration.playerID;a.embedBaseURL=dj.context.core.cdnPrefix+this.configuration.flashPlayerPath;a.embedHeight=this.configuration.playerType.height;a.embedWidth=this.configuration.playerType.width;a.larsID=91;a.larsAdTrackingID=1259;if(this.playedOn)a.lineupID=unescape(this.playedOn).toLowerCase().replace(/[^a-zA-Z0-9]/g,"");if(typeof setEdition==="function")a.prop24=setEdition(dj.util.Region.getViewByRegion());a.prop27="";try{dj.util.User.isLoggedIn(function(g){if(g)dj.util.User.isSubLoggedIn(function(h){if(h)dj.util.User.hasRole("WSJ-PRO",function(k){if(k){b="WSJPRO_";a.prop27="WSJ_proc_sub_yes";a.prop8="WSJ Professional Enterprise";a.prop9="premium";a.prop24="Edition_US_Professional_Consumer"}else dj.util.User.hasRole("WSJ-ENT",function(l){if(l){b="WSJPRO_";a.prop27="WSJ_proe_sub_yes";a.prop8="WSJ Professional Enterprise";a.prop9="premium";a.prop24="Edition_US_Professional"}else a.prop27="WSJ_sub_yes"})});else a.prop27="WSJ_mem_yes"});else a.prop27=a.cookieUserType===null||a.cookieUserType!=="subscribed"?"WSJ_free":"WSJ_reg_yes"})}catch(c){console.info(c)}var e=dj.util.VideoUtils.omnitureEncoding(a["wsj-section"],a["wsj-subsection"],"s"),d=dj.util.VideoUtils.omnitureEncoding(a["wsj-section"],a["wsj-subsection"],"c");a.appName=b.substring(0,b.length-1);a.appType=this.configuration.applications[this.configuration.applicationID];a.section=d;a.subsection=e;a.prop2=b+d;a.prop3=b+"Video_Video_"+d;a.prop22=b+"Video_Video_"+e;a.prop26=b+e;a.prop5=window.location.href.split("?")[0];a.prop6=window.location.href;a.prop10=dj.util.Page.getQueryParam("mod");a.campaign=dj.util.Page.getQueryParam("mod");a.prop11=dj.util.Page.getQueryParam("reflink");a.prop19=a.youtubeID?a.appType+"_youtube":a.appType;a.prop25=dj.util.Cookie.getCookie("TR");try{a.cookieUserType=dj.util.Cookie.getCookie("user_type")}catch(f){console.error("cookie read error while fetching cookieUserType : "+
f)}e=typeof pID==="string"&&pID.indexOf("0_0_WH")!=-1?"1":"0";a.suppressAds=e;return a}});dojo.provide("dj.widget.video.view.LargePlayer");dojo.require("dj.util.VideoUtils");dojo.require("dj.widget.video.model.PlayerEvents");dojo.require("dj.widget.video.model.SWFPlayer");dojo.declare("dj.widget.video.view.LargePlayer",null,{constructor:function(a){this.controller=null;this.configuration={name:"largePlayer"};dojo.mixin(this.configuration,a);this.playerCreated=false},init:function(a){this.controller=a;this.descriptionContainer=dojo.byId(this.controller.configuration.descriptionID);this.render()},render:function(){var a=this.controller.configuration;if(!this.playerCreated){this.playerCreated=true;var b=new dj.widget.video.model.SWFPlayer;b.id=a.playerID;b.swfURL=a.flashPlayerPath+
a.playerType.swfFile;b.containerID=a.containerID;b.width=a.playerType.width;b.height=a.playerType.height;b.eventNamespace=a.eventNamespace;b.host=a.host;a=dj.widget.video.model.PlayerEvents;for(var c in a)if(a.hasOwnProperty(c))b[c]=c;dj.util.VideoUtils.createSWFPlayer(b)}this.renderDescription()},play:function(a){var b=swfobject.getObjectById(this.controller.configuration.playerID);b&&typeof b.playVideo=="function"?b.playVideo(dojo.toJson(a)):console.error("{Player} video Player still not loaded")},renderDescription:function(){if(this.controller.videoInformation.name){var a="<h2>"+this.controller.videoInformation.name+" <small>"+this.controller.videoInformation.formattedCreationDate+"</small></h2>",b=this.controller.videoInformation.relatedLinkText,c=this.controller.videoInformation.relatedLinkHref,e="";if(b&&c&&b!=""&&c!="")e=" <a class='extLink' href='"+c+"'>"+this.controller.videoInformation.relatedLinkText+"</a>";a+="<p>"+this.controller.videoInformation.description+e+"</p>";this.descriptionContainer.innerHTML=a}}});dojo.provide("dj.widget.video.view.MainPlayer");dojo.require("dj.util.VideoUtils");dojo.require("dj.widget.video.model.SWFPlayer");dojo.require("dj.widget.video.model.PlayerEvents");(dj.widget.video.view.MainPlayer=function(a){this.controller=null;this.configuration={name:"mainPlayer",allowPopUp:1,hideVideoTools:0};dojo.mixin(this.configuration,a);this.playerCreated=false}).prototype={init:function(a){this.controller=a;this.render()},render:function(){var a=this.controller.configuration;if(!this.playerCreated){this.playerCreated=true;var b=new dj.widget.video.model.SWFPlayer;b.id=a.playerID;b.swfURL=a.flashPlayerPath+a.playerType.swfFile;b.allowPlayerPopup=this.configuration.allowPopUp;b.hideTools=this.configuration.hideVideoTools;b.containerID=a.containerID;b.width=a.playerType.width;b.height=a.playerType.height;b.eventNamespace=a.eventNamespace;b.enableVideoModuleChaining=a.enableVideoModuleChaining;var c=dj.widget.video.model.PlayerEvents,e;for(e in c)if(c.hasOwnProperty(e))b[e]=e;b.host=a.host;dj.util.VideoUtils.createSWFPlayer(b)}},play:function(a){var b=swfobject.getObjectById(this.controller.configuration.playerID);b&&typeof b.playVideo=="function"?b.playVideo(dojo.toJson(a)):console.error("{Player} video Player still not loaded")}};dojo.provide("dj.widget.video.controller.MicroPlayer");dojo.require("dj.widget.video.controller.Player");dojo.require("dj.widget.video.model.PlayerEvents");dojo.require("dj.util.Ads");dojo.declare("dj.widget.video.controller.MicroPlayer",dj.widget.video.controller.Player,{constructor:function(){this.configuration.applicationID=3;this._events=dj.widget.video.model.PlayerEvents},init:function(a,b,c,e){this.videoInformation.id=b;if(!e){this._setupFlashToJsListeners();this._setupInternalEvents()}this.inherited(arguments)},getEventNamespace:function(){return"dj.context.video.soloVideos['"+this.videoInformation.id+"']"},subscribeByName:function(a,b,c){this.observer.subscribeByName(a,b,c)},addVideoParameters:function(a){a=this.inherited(arguments);var b=(new dj.util.Ads).getRegisteredAdsZone("");a.adZone=b!="default"&&b!=""?b:a.adZone;a.adFrmt="frmt=0;";a.videoCenterURL="http://"+window.location.host+"/video-center";return a},_setupInternalEvents:function(){this.observer.subscribeByName(this._events.continueLoadVideo,function(){this.readyForEvents=true},this);this.observer.subscribeByName(this._events.openMicroPopUpPlayer,function(){this.view.openPopUpPlayer()},this);this.observer.subscribeByName(this._events.openEmailScrimEmbed,function(){try{console.log("openEmailScrimEmbed event");this.view.openEmailScrimEmbed();return true}catch(a){console.log("****** Error while opening email scrim for embeded video *********"+a);return true}},this);this.observer.subscribeByName(this._events.openEmbedPopup,function(){try{console.log("openEmbedPopup event");this.view.openEmbedPopup();return true}catch(a){console.log("Error: openEmbedPopup event");return true}},this)},_setupFlashToJsListeners:function(){var a=this.observer,b=this._events,c={},e;for(e in b)b.hasOwnProperty(e)&&function(d,f){c[d]=function(){a.fireByName(f);return true}}(e,b[e]);dojo.getObject("dj.context.video.soloVideos",true);dj.context.video.soloVideos[this.videoInformation.id]=c}});dojo.provide("dj.widget.video.view.Mp4MicroPlayer");dojo.require("dj.widget.video.view.BasePlayer");dojo.require("dj.widget.video.model.PlayerEvents");dojo.require("dj.util.VideoTracking");dojo.declare("dj.widget.video.view.Mp4MicroPlayer",dj.widget.video.view.BasePlayer,{renderPreloader:function(){this.oCnt=dojo.byId(this.controller.configuration.playerID);dojo.addClass(this.oCnt,this.configuration.preloaderClassName)},render:function(){if(!this.playerCreated){this.playerCreated=true;var a=dj.widget.video.model.PlayerEvents;this.controller.observer.fireByName(a.continueLoadVideo);this.controller.observer.fireByName(a.playVideo);this.controller.readyForEvents=true}},play:function(a){dj.util.VideoTracking.fire(a);var b=a.video320kMP4Url;b?setTimeout(function(){document.location=b},500):console.error("{view.MicroPlayer} no videoUri specified")}});dojo.provide("dj.widget.video.view.SwfMicroPlayer");dojo.require("dj.widget.video.view.BasePlayer");dojo.require("dj.util.VideoUtils");dojo.require("dj.widget.video.model.PlayerEvents");dojo.require("dj.widget.video.model.SWFPlayer");dojo.declare("dj.widget.video.view.SwfMicroPlayer",dj.widget.video.view.BasePlayer,{renderPreloader:function(){this.oCnt=dojo.byId(this.controller.configuration.playerID);console.log("this.oCnt:"+this.oCnt);console.log("this.configuration.preloaderClassName:"+this.configuration.preloaderClassName);dojo.addClass(this.oCnt,this.configuration.preloaderClassName)},render:function(){if(!this.playerCreated){this.playerCreated=true;var a=this.controller.configuration,b=new dj.widget.video.model.SWFPlayer;b.id=a.playerID;console.log("************ conf.playerID *********** "+a.playerID);b.swfURL=a.flashPlayerPath+a.playerType.swfFile;b.containerID=a.containerID;b.width=a.playerType.width;b.height=a.playerType.height;b.host=a.host;b.allowPlayerPopup=1;if(dj.context.videoCenter.showHideVideoTools)b.hideTools=dj.context.videoCenter.showHideVideoTools;b.eventNamespace=this.controller.getEventNamespace();a=dj.widget.video.model.PlayerEvents;for(var c in a)if(a.hasOwnProperty(c))b[c]=c;this._wrapPlayerInContainer();this._replacePlayerWithSwf(b)}},play:function(a){if((this._playerObject=swfobject.getObjectById(this.controller.configuration.playerID))&&typeof this._playerObject.playVideo=="function"){this._playerObject.playVideo(dojo.toJson(a));this._pollForVideoEvents()}else console.error("{Player} video Player still not loaded")},openPopUpPlayer:function(){dj.util.VideoUtils.popUpPlayer({playLocation:Math.floor(swfobject.getObjectById(this.controller.configuration.playerID).getSeek()),collection:this.controller.getVideoData("wsj-section"),videoID:this.controller.getVideoData("id"),height:this.controller.configuration.playerType.height,width:this.controller.configuration.playerType.width})},openEmbedPopup:function(){console.log("call openEmbedPopup");dj.util.VideoUtils.embedPopUp({url:this.controller.getVideoData("linkURL"),guidval:this.controller.videoID,shortUrl:this.controller.getVideoData("linkShortURL")});return true},openEmailScrimEmbed:function(){dj.context.eamilThisST=dj.context.eamilThisST||{};dj.context.eamilThisST.videoInfo=this.controller.videoInformation;var a=this.controller.getVideoData("linkShortURL"),b=this.controller.getVideoData("name");return dj.util.VideoUtils.openEmailScrimEmbed(a,b,this.controller.videoID)},_replacePlayerWithSwf:function(a){dj.util.VideoUtils.createSWFPlayer(a)},_wrapPlayerInContainer:function(){var a=dojo.byId(this.controller.configuration.containerID);dojo.position(a);var b=document.createElement("div"),c=dojo.position(a);dojo.style(b,{width:c.w+"px",height:c.h+"px"});dojo.addClass(b,a.className);dojo.place(b,a,"before");dojo.place(a,b,"first")},_pollForVideoEvents:function(){if(!(!this._playerObject||typeof this._playerObject.getSeek!=="function")){var a=dj.widget.video.model.PlayerEvents,b=this,c=this.controller.videoInformation.duration,e=b._playerObject.getSeek()||0,d=3,f=true;clearInterval(this.ival);this.ival=setInterval(function(){if(typeof b._playerObject.getSeek!=="function")clearInterval(b.ival);else{var g=b._playerObject.getSeek(),h=g===e?d+1:0;if(f){f=false;b.controller.observer.fireByName(a.playVideo);console.log("Playing Video")}else d>3&&h==0&&b.controller.observer.fireByName(a.unpauseVideo);d=h;e=g;if(d==3)if(c-e<=1){b.controller.observer.fireByName(a.stopVideo);clearInterval(b.ival)}else b.controller.observer.fireByName(a.pauseVideo)}},250)}},destructor:function(){clearInterval(this.ival)}});dojo.provide("dj.widget.video.view.Html5MicroPlayer");dojo.require("dj.widget.video.view.Mp4MicroPlayer");dojo.provide("dj.widget.video.model.PlayerEvents");dojo.require("dj.util.VideoUtils");dojo.declare("dj.widget.video.view.Html5MicroPlayer",dj.widget.video.view.Mp4MicroPlayer,{play:function(a){var b=a.video320kMP4Url;if(b){this._createVideoObject(a.videoStillURL,b);this._subscribeToVideoEvents();dojo.removeClass(this.oCnt,this.configuration.preloaderClassName);dojo.empty(this.oCnt);dojo.place(this._video,this.oCnt);dj.util.VideoTracking.fire(a);this._playing=false;dj.util.VideoUtils.callThroughDispatch(function(){this._video.play()},this)}else console.error("{view.MicroPlayer} no videoUri specified")},_createVideoObject:function(a,b){var c=dojo.position(this.oCnt);this._video=dojo.create("video",{poster:a,src:b,controls:true,width:c.w,height:c.h})},_subscribeToVideoEvents:function(){var a=dj.widget.video.model.PlayerEvents,b=this.controller.observer;dojo.connect(this._video,"onplay",function(){b.fireByName(a.playVideo)});dojo.connect(this._video,"onpause",function(){b.fireByName(a.pauseVideo)});dojo.connect(this._video,"onended",function(){b.fireByName(a.stopVideo)})}});dojo.provide("dj.widget.video.view.Html5LargePlayer");dojo.require("dj.widget.video.view.LargePlayer");dojo.require("dj.util.Element");dojo.require("dj.util.VideoTracking");dojo.declare("dj.widget.video.view.Html5LargePlayer",dj.widget.video.view.LargePlayer,{render:function(){var a=this.controller.videoInformation;if(null!=a){this.oCnt=dojo.query(".js_videoPlayer .embedContainer")[0];if(typeof this.oCnt==="undefined")throw Error("{Html5LargePlayer} video-center embed container does not exist.");dojo.empty(this.oCnt);this._createVideoObject(a.videoStillURL,a.video320kMP4Url);dojo.place(this._video,this.oCnt);this._subscribeToVideoEvents();this.renderDescription();this.controller.readyForEvents=true}},play:function(a){dj.util.VideoUtils.callThroughDispatch(function(){this._video.play()},this);dj.util.VideoTracking.fire(a)},_createVideoObject:function(a,b){var c=this.controller.configuration;this._video=dojo.create("video",{poster:a,src:b,controls:"true",width:c.playerType.width,height:c.playerType.height})},_subscribeToVideoEvents:function(){var a=dojo.getObject(this.controller.configuration.eventNamespace);dojo.connect(this._video,"onended",function(){a.playNextVideo()})}});dojo.provide("dj.module.video.standAloneVideo");dojo.require("dj.util.Video");dojo.require("dj.module.videoModule");dojo.require("dj.lang");dojo.require("dj.widget.video.controller.MicroPlayer");dojo.require("dj.widget.video.controller.Player");dojo.require("dj.widget.video.model.PlayerEvents");dojo.require("dj.util.Element");dj.module.video.standAloneVideo={init:function(a){this.configuration={standAloneVideoClass:"",thumbnailVideoClass:"",nowPlayingCopy:"now playing"};dojo.mixin(this.configuration,a);that=this;var b=this.configuration.standAloneVideoClass;a=this.configuration.thumbnailVideoClass;var c=dojo.query("#"+b)[0];if(c)try{var e=dj.util.Element.getData(c,"guid"),d=dj.util.Video.getVideoDetails({id:e,fields:"formattedLastModifiedDate,duration,wsj-section,wsj-subsection"});dojo.query(".video #videoMetaStrap .videoCategory")[0].innerHTML=that.getCategory(d);dojo.query(".video #videoMetaStrap .videoDateStamp")[0].innerHTML=that.getVideoDate(d.formattedLastModifiedDate);dojo.query(".video #videoMetaStrap .videoDuration")[0].innerHTML=that.getDuration(d.duration)}catch(f){console.error(f)}try{var g=dojo.query("."+a);dojo.forEach(g,function(k,l){var m=dj.util.Element.getData(k,"guid");m=dj.util.Video.getVideoDetails({id:m,fields:"duration,wsj-section,wsj-subsection"});dojo.query(".video #desc .videoCategory")[l].innerHTML=that.getCategory(m);dojo.query(".video #desc .videoDuration")[l].innerHTML=that.getDuration(m.duration)})}catch(h){console.error(h)}dojo.addLiveEvent("."+a,"click",function(){var k=dojo.query("#"+b+" img")[0],l=this.id.split("|"),m=dojo.byId(b),q=dojo.query("#"+l[0]+"> span")[0];l=dojo.query("#"+l[0]+"> span > span")[0];try{var n=dojo.query(".video .videoVerticalList .nowPlaying");if(n!==null&&n!==undefined&&n.length>0){var s=n[0].id;console.log("nowPlayId: "+s);dojo.removeClass(dojo.byId(s),"nowPlaying");dojo.byId(s+"_inner").innerHTML=""}dojo.addClass(q,"nowPlaying");l.innerHTML=this.configuration.nowPlayingCopy}catch(w){console.log("now playing not found")}if(k){m.setAttribute("data-guid",q.getAttribute("guid"));k.setAttribute("src",q.getAttribute("image"));console.log("data-fuid"+m.getAttribute("data-guid"))}else{m=dojo.query(".video .videoObjectBox")[0];dojo.removeClass(m,"videoObjectLoading");m.setAttribute("id",b);m.setAttribute("data-dj-live-widget","video.MicroPlayer");m.setAttribute("data-guid",q.getAttribute("guid"));m.setAttribute("data-video-info","");m.innerHTML="<a href='#' class='videoClickThru'><span class='videoHint'>Click to Play</span><img width='272' height='152' src='"+q.getAttribute("image")+"'/></a>"}k=q.getAttribute("guid");if(k!==undefined)try{var u=dj.util.Video.getVideoDetails({id:k,fields:"formattedLastModifiedDate,duration,wsj-section,wsj-subsection"});dojo.query(".video #videoMetaStrap .videoDateStamp")[0].innerHTML=that.getVideoDate(u.formattedLastModifiedDate);dojo.query(".video #videoMetaStrap .videoCategory")[0].innerHTML=that.getCategory(u);dojo.query(".video #videoMetaStrap .videoDuration")[0].innerHTML=that.getDuration(u.duration);dojo.query(".video #videoDesc > h2")[0].innerHTML=q.getAttribute("title")}catch(p){console.log(p)}q=dojo.byId(b);that.fireEvent(q,"click")})},getDuration:function(a){var b=Math.floor(a/3600),c=a%3600;a=Math.floor(c/60);c=Math.ceil(c%60);return b>0?b+":"+a+":"+c:a>0?c<10?a+":0"+c:a+":"+c:c},getVideoDate:function(a){if(a!==null&&a!=="")a=a.substring(a.indexOf("/")-2,a.lastIndexOf("/")+5);return a},getCategory:function(a){var b=a["wsj-subsection"];if(b===null||b==="")b=a["wsj-section"];return b}};dojo.provide("dj.module.video.playlistPlayer");dojo.require("dj.util.Observer");dojo.require("dj.widget.video.view.MainPlayer");dojo.require("dj.widget.video.controller.Player");dojo.require("dj.widget.video.view.Html5MicroPlayer");dojo.require("dj.widget.video.model.PlayerTypes");dojo.require("dj.lang");dojo.require("dj.util.Element");dojo.require("dj.util.Video");dj.module.video.playlistPlayer={init:function(a){this.configuration={playerContainerID:"standAloneVideoPlayer",playerContainerClass:"videoObjectBox",playerID:"standAloneVideoPlayer",descriptionID:"videoDesc",standAloneVideoClass:"standAloneVideo",thumbnailVideoClass:"preview-thumb",chainVideoModule:false,linupId:"module",playerName:"homepage",adFormat:"frmt=0;",applicationID:4,enableRefreshAfter:3,addRemoveClass:"nowPlaying",wrapperClass:".nowPlayingWrapper",hiddenClass:"hidden",playButtonClass:"playButtonClass",hideVideoTools:0,playerType:dj.widget.video.model.PlayerTypes.MicroPlayerHP,host:"video.wsj.com",nowPlayingCopy:"now playing"};dojo.deepMixin(this.configuration,a);this.observer=new dj.util.Observer(dj.module.video.playlistPlayer);this.createVideoPlayer();this.displayDataForThumbnails();this.subscribeToEvents();this.addEvents();this.calculateVideos();this.videoPlayCount=1},calculateVideos:function(){this.videos=dojo.query(".preview-thumb");this.videosIndex=0},subscribe:function(a,b,c){this.observer.subscribeByName(a,b,c)},subscribeToEvents:function(){this.subscribe("onVideoLoaded",this.videoLoaded,this)},videoLoaded:function(a,b){var c=dojo.query(".videoObjectData .videoDateStamp")[0],e=dojo.query(".videoObjectData #videoMetaStrap .videoCategory")[0],d=dojo.query(".videoObjectData #videoMetaStrap .videoDuration")[0];if(c)c.innerHTML=this.getVideoDate(b.formattedLastModifiedDate);if(e)e.innerHTML=this.getCategory(b);if(d)d.innerHTML=this.getDuration(b.duration);c=dj.context.core.urlPrefix.indexOf("wallstreetjournal.de")>-1?"<a href='#' class='js_playvideo' data-guid='"+b.id+"'>":"<a href='"+b.linkURL+"'>";dojo.query("#"+this.configuration.descriptionID+" > h2")[0].innerHTML=c+b.name;try{var f=dojo.byId("video_wrapper_"+a);if(f!=null&&f!==undefined){dojo.query(this.configuration.wrapperClass).addClass(this.configuration.hiddenClass);dojo.query(this.configuration.playButtonClass).removeClass(this.configuration.hiddenClass);dojo.removeClass(f,this.configuration.hiddenClass);dojo.addClass(dojo.byId("video_playButton_"+
a),this.configuration.hiddenClass)}dojo.query(".nowPlaying").removeClass(this.configuration.addRemoveClass);dojo.forEach(dojo.query(".js_nowplaying"),function(l){l.innerHTML="&nbsp;"});var g=dojo.byId("video_anchor_"+a);g&&dojo.addClass(g,this.configuration.addRemoveClass);var h=dojo.byId("video_playing_"+a);if(h)h.innerHTML=this.configuration.nowPlayingCopy}catch(k){console.log("Error: "+k)}},addEvents:function(){var a=this;dj.lang.addLiveEvent(".js_playvideo","click",function(b){dojo.stopEvent(b);b=dj.util.Element.getData(b.srcElement||b.target,"guid");if(a.configuration.chainVideoModule)dj.context.page.disablePageRefresh=true;for(i=0;i<a.videos.length;i++){var c=dj.util.Element.getData(a.videos[i],"guid");if(b==c){a.videosIndex=i;break}}a.toggleFBTwitterClasses(a.videosIndex);a.videoPlayer.init(a.videoPlayerView);a.videoPlayer.playVideo(b,a.configuration.linupId)})},createVideoPlayer:function(){this.videoPlayer=new dj.widget.video.controller.Player(this.observer,{playerType:this.configuration.playerType,containerID:this.configuration.playerContainerID,eventNamespace:"dj.module.video.playlistPlayer",playerID:this.configuration.playerID,adFormat:this.configuration.adFormat,applicationID:this.configuration.applicationID,showVideoTools:this.configuration.showVideoTools,enableVideoModuleChaining:this.configuration.chainVideoModule?1:0,host:this.configuration.host});this.videoPlayerView=dj.util.VideoUtils.hasValidFlashVersion()?new dj.widget.video.view.MainPlayer({name:this.configuration.playerName,hideVideoTools:this.configuration.hideVideoTools}):new dj.widget.video.view.Html5MicroPlayer({name:this.configuration.playerContainerClass})},displayDataForThumbnails:function(){var a=this,b=this.configuration.thumbnailVideoClass,c=dojo.query("#"+this.configuration.standAloneVideoClass)[0];if(c)try{var e=dojo.query(".video #videoMetaStrap .videoDateStamp")[0],d=dojo.query(".video #videoMetaStrap .videoDuration")[0],f=dj.util.Element.getData(c,"timestamp"),g=dj.util.Element.getData(c,"duration");if(e)e.innerHTML=a.getVideoDate(f);if(d)d.innerHTML=a.getDuration(g)}catch(h){console.error(h)}try{var k=dojo.query("."+b);dojo.forEach(k,function(m,q){var n=dj.util.Element.getData(m,"duration");dojo.query(".video #desc .videoDuration")[q].innerHTML=a.getDuration(n)})}catch(l){console.error(l)}},getDuration:function(a){var b=Math.floor(a/3600),c=a%3600;a=Math.floor(c/60);c=Math.ceil(c%60);return b>0?b+":"+a+":"+c:a>0?c<10?a+":0"+c:a+":"+c:c},getVideoDate:function(a){if(a!==null&&a!=="")a=a.substring(a.indexOf("/")-2,a.lastIndexOf("/")+5);return a},getCategory:function(a){var b=a["wsj-subsection"];if(b===null||b==="")b=a["wsj-section"];return b},toggleFBTwitterClasses:function(a){for(j=0;j<this.videos.length;j++)if(j==a){dojo.removeClass(dojo.byId("facebook_"+j),"hidden");dojo.removeClass(dojo.byId("twitter_"+j),"hidden")}else{dojo.addClass(dojo.byId("facebook_"+j),"hidden");dojo.addClass(dojo.byId("twitter_"+j),"hidden")}},playNextVideo:function(){if(this.configuration.chainVideoModule){this.videoPlayCount++;if(this.videoPlayCount>this.configuration.enableRefreshAfter)dj.context.page.disablePageRefresh=false;if(this.videosIndex==this.videos.length-1)this.videosIndex=-1;this.videosIndex+=1;if(this.videos[this.videosIndex]!==undefined){this.videoPlayer.playVideo(dj.util.Element.getData(this.videos[this.videosIndex],"guid"));this.toggleFBTwitterClasses(this.videosIndex)}}},createAdvertisement:function(a,b){console.log("Response from createAdvertisement : %s, %s",a,b)},openMicroPopUpPlayer:function(){dj.util.VideoUtils.popUpPlayer({playLocation:Math.floor(swfobject.getObjectById(this.videoPlayer.configuration.playerID).getSeek()),collection:this.videoPlayer.getVideoData("wsj-section"),videoID:this.videoPlayer.videoID,height:this.videoPlayer.configuration.playerType.height,width:this.videoPlayer.configuration.playerType.width})},openEmbedPopup:function(){dj.util.VideoUtils.embedPopUp({url:this.videoPlayer.getVideoData("linkURL"),guidval:this.videoPlayer.videoID,shortUrl:this.videoPlayer.getVideoData("linkShortURL")});return true},openEmailScrimEmbed:function(a,b){urlValue=a===undefined?this.videoPlayer.getVideoData("linkShortURL"):a;titleValue=b===undefined?this.videoPlayer.getVideoData("name"):b;dj.util.VideoUtils.openEmailScrimEmbed(urlValue,titleValue,this.videoPlayer.videoID);return true},continueLoadVideo:function(){this.videoPlayer.readyForEvents=true},openPopUpPlayer:function(){dj.util.VideoUtils.popUpPlayer({playLocation:Math.floor(swfobject.getObjectById(this.videoPlayer.configuration.playerID).getSeek()),collection:this.videoPlayer.getVideoData("wsj-section"),videoID:this.videoPlayer.videoID,height:this.videoPlayer.configuration.playerType.height,width:this.videoPlayer.configuration.playerType.width})}};dojo.provide("dj.widget.video.MicroPlayer");dojo.require("dj.widget.video.controller.MicroPlayer");dojo.require("dj.util.Video");dojo.require("dj.util.VideoUtils");dojo.require("dj.widget.video.model.PlayerEvents");dojo.require("dj.widget.video.view.SwfMicroPlayer");dojo.require("dj.widget.video.view.Mp4MicroPlayer");dojo.require("dj.widget.video.view.Html5MicroPlayer");dojo.declare("dj.widget.video.MicroPlayer",null,{constructor:function(a,b){this.containerId=a;this.dataset=b},loadVideo:function(){this._createView();this._createController();this._connectPageAndControllerEvents();this.dataset.guid=dj.util.VideoUtils.normalizeGuid(this.dataset.guid);this.controller.init(this.view,this.dataset.guid,0)},reloadVideo:function(a){this.dataset=a;this.dataset.guid=dj.util.VideoUtils.normalizeGuid(this.dataset.guid);this.controller.init(this.view,this.dataset.guid,0,true)},_createView:function(){this.view=dj.util.VideoUtils.hasValidFlashVersion()?new dj.widget.video.view.SwfMicroPlayer:dj.util.VideoUtils.isH264BaselineVideoSupported()?new dj.widget.video.view.Html5MicroPlayer:new dj.widget.video.view.Mp4MicroPlayer},_createController:function(){this.controller=new dj.widget.video.controller.MicroPlayer(null,{containerID:this.containerId,playerID:this.containerId,playerType:this._getPlayerType(this.dataset.videoSize),dataset:this.dataset})},_getPlayerType:function(a){return playerType=a==="E"?dj.widget.video.model.PlayerTypes.MicroPlayerE:a==="F"?dj.widget.video.model.PlayerTypes.MicroPlayerF:dj.widget.video.model.PlayerTypes.MicroPlayer},_connectPageAndControllerEvents:function(){var a=this.dataset.guid,b=dj.widget.video.model.PlayerEvents,c=dj.util.Video;this.controller.subscribeByName(b.playVideo,function(){c.playVideo(a)});this.controller.subscribeByName(b.pauseVideo,function(){c.pauseVideo(a)});this.controller.subscribeByName(b.stopVideo,function(){c.stopVideo(a)})},openEmailScrimEmbed:function(){console.log("Micro player openEmailScrimEmbed function");return this.view.openEmailScrimEmbed()},destructor:function(){this.view.destructor()}});dojo.provide("dj.module.video.liveMicroPlayer");dojo.require("dj.util.liveWidget");dojo.require("dj.util.Element");dojo.require("dj.widget.video.MicroPlayer");dj.module.video.liveMicroPlayer={init:function(){if(!this._isInit){this._isInit=true;this._setupLiveWidget()}},destroy:function(){dj.util.liveWidget.unregister("video.MicroPlayer")},_setupLiveWidget:function(){dj.util.liveWidget.register("video.MicroPlayer",function(a,b){dojo.stopEvent(a.event);this._initMicroPlayer(dj.util.Element.identify(a.domNode),b)},this)},_initMicroPlayer:function(a,b){(new dj.widget.video.MicroPlayer(a,b)).loadVideo()}};dojo.provide("dj.module.video.VideoCenter");dojo.require("dj.util.Observer");dojo.require("dj.widget.video.controller.Player");dojo.require("dj.widget.video.controller.AdPlayer");dojo.require("dj.widget.video.controller.Browser");dojo.require("dj.widget.video.controller.Playlist");dojo.require("dj.widget.video.view.SimplePlaylist");dojo.require("dj.widget.video.view.FullBrowser");dojo.require("dj.widget.video.view.AdPlayer");dojo.require("dj.widget.video.view.LargePlayer");dojo.require("dj.widget.video.view.Html5LargePlayer");dojo.require("dj.widget.video.model.PlayerTypes");dojo.require("dj.util.VideoUtils");(function(){dj.module.video.VideoCenter={init:function(a){this.configuration={videoCenterContainerID:"masterVideoCenter",advertisingSectionLabelID:"advertisingSectionLabel",specialAdCollection:"WSJ Business Center",host:"video.wsj.com",loadWaitTime:2E3,playerName:"video_videocenter",defaultType:"wsj-section",defaultQuery:"News",videoID:"",defaultSelectionID:"News",eventCallbacks:[]};dojo.deepMixin(this.configuration,a);this.videoCenterContainer=dojo.byId(this.configuration.videoCenterContainerID);this.advertisingSectionLabel=dojo.byId(this.configuration.advertisingSectionLabelID);this.observer=new dj.util.Observer(dj.module.video.VideoCenter);this.subscribeToEvents();this.addEvents();this.videoLoadsFirst=false;a=null;if(this.configuration.videoID!="undefined"&&this.configuration.videoID!=""){var b="{"+this.configuration.videoID+"}";if(dj.util.VideoUtils.isGUID(b))this.videoLoadsFirst=true;else b=null}else if(typeof AT_VARS!="undefined"&&AT_VARS.baseDocId){b="{"+AT_VARS.baseDocId+"}";if(dj.util.VideoUtils.isGUID(b))this.videoLoadsFirst=true;else b=null}else{var c=/(\/.*\/)*(.*)(.html)/.exec(location.pathname);if(c&&c.length>1)if(URL_KEYS[c[2]])a={defaultType:URL_KEYS[c[2]].type,defaultQuery:URL_KEYS[c[2]].query,defaultSelectionID:URL_KEYS[c[2]].section}}this.videoPlayer=new dj.widget.video.controller.Player(this.observer,{playerID:"flashPlayer",eventNamespace:"dj.module.video.VideoCenter",host:this.configuration.host,loadWaitTime:this.configuration.loadWaitTime});this.adPlayer=new dj.widget.video.controller.AdPlayer(this.observer,{playerID:"videoAd",host:this.configuration.host});this.videoPlaylist=new dj.widget.video.controller.Playlist(this.observer);this.videoBrowser=a?new dj.widget.video.controller.Browser(this.observer,a):new dj.widget.video.controller.Browser(this.observer,{defaultType:this.configuration.defaultType,defaultQuery:this.configuration.defaultQuery,defaultSelectionID:this.configuration.defaultSelectionID});this.scrollToPlayer=this.fromTopNav=false;this.adPlayer.init(new dj.widget.video.view.AdPlayer);this.videoPlayer.init(dj.util.VideoUtils.hasValidFlashVersion()?new dj.widget.video.view.LargePlayer({name:this.configuration.playerName}):new dj.widget.video.view.Html5LargePlayer({name:this.configuration.playerName}),b);this.videoPlaylist.init(new dj.widget.video.view.SimplePlaylist);this.videoBrowser.init(new dj.widget.video.view.FullBrowser);this.videoLoadsFirst||this.videoBrowser.requestDefaultVideos();this.adPlayer.render()},subscribe:function(a,b,c){this.observer.subscribeByName(a,b,c)},subscribeToEvents:function(){this.subscribe("onVideoSelected",this.videoSelected,this);this.subscribe("onCollectionLoad",this.collectionLoad,this);this.subscribe("onFirstLoad",this.firstLoad,this);this.subscribe("onVideoLoaded",this.videoLoaded,this);for(var a=this.configuration.eventCallbacks,b=a.length-1;b>=0;b--)this.subscribe(a[b].event,a[b].callback,this)},addEvents:function(){var a=this;dj.lang.addLiveEvent(".video_topNav","click",function(b){dojo.stopEvent(b);var c=(b.srcElement||b.target).id.split("-");b="wsj-section";var e=c[1],d=e;c=c[1].split("~");if(c.length>1){b=c[0];e=c[1];d=c[2]}b=[b,e,d];a.fromTopNav=true;a.videoBrowser.requestVideos(b,1)})},videoLoaded:function(a){if(this.videoLoadsFirst){var b=this.videoPlayer.getVideoData("wsj-section");this.videoBrowser.addToConfig({defaultQuery:b,defaultSelectionID:b});this.videoBrowser.requestDefaultVideos()}this.videoBrowser.highligthThumbnail(a);document.title=this.videoPlayer.videoInformation.titletag!=""?"Video - "+this.videoPlayer.videoInformation.titletag+" - WSJ.com":"Video - "+this.videoPlayer.videoInformation.name+" - WSJ.com"},videoSelected:function(a,b){this.scrollToPlayer&&this.scrollToElement(dojo.byId(this.videoPlayer.configuration.playerID));this.scrollToPlayer=true;if(this.videoLoadsFirst)this.videoLoadsFirst=false;else this.videoPlayer.playVideo(a,unescape(this.videoBrowser.currentSection));this.videoPlaylist.render(b)},collectionLoad:function(){},firstLoad:function(){this.videoLoadsFirst?this.videoBrowser.selectVideoByID(this.videoPlayer.getCurrentVideoID()):this.videoBrowser.selectVideoByIndex(0)},playNextVideo:function(){var a=this.videoPlaylist.getNextVideoID();this.videoPlayer.playVideo(a,unescape(this.videoBrowser.currentSection));this.videoPlaylist.render();this.videoBrowser.highligthThumbnail(a)},createAdvertisement:function(a,b){this.adPlayer.loadAd({imageURL:a,linkURL:b})},openPopUpPlayer:function(){dj.util.VideoUtils.popUpPlayer({playLocation:Math.floor(swfobject.getObjectById(this.videoPlayer.configuration.playerID).getSeek()),collection:this.videoPlayer.getVideoData("wsj-section"),videoID:this.videoPlayer.videoID,height:this.videoPlayer.configuration.playerType.height,width:this.videoPlayer.configuration.playerType.width})},openEmbedPopup:function(){dj.util.VideoUtils.embedPopUp({url:this.videoPlayer.getVideoData("linkURL"),guidval:this.videoPlayer.videoID,shortUrl:this.videoPlayer.getVideoData("linkShortURL")});return true},openEmailScrimEmbed:function(a,b){urlValue=a===undefined?this.videoPlayer.getVideoData("linkShortURL"):a;titleValue=b===undefined?this.videoPlayer.getVideoData("name"):b;dj.util.VideoUtils.openEmailScrimEmbed(urlValue,titleValue,this.videoPlayer.videoID);return true},continueLoadVideo:function(){this.videoPlayer.readyForEvents=true},scrollToElement:function(a){for(var b=0,c=0;a!=null;){b+=a.offsetLeft;c+=a.offsetTop;a=a.offsetParent}window.scrollTo(b,c)}}})();
dojo.provide("dj.widget.autocomplete.autoCompleteViewTemplate");dj.widget.autocomplete.autoCompleteViewTemplate=function(){this._viewTemplate="";this._viewTemplateConsumers=[];this._isTemplateLoading=this._isTemplateLoaded=false;var a=this;this._templateNodeSelector="#__autocomplete_view_template";this._fetchViewTemplate=function(){var b=dojo.query(a._templateNodeSelector)[0];a._isTemplateLoading=false;a._viewTemplate=b.defaultValue;a._isTemplateLoaded=true;a._handleViewTemplateLoad(b.defaultValue)};this._handleViewTemplateLoad=function(b){for(var c=0,e,d=a._viewTemplateConsumers.length;c<d;c++){e=a._viewTemplateConsumers[c];e.call(e,b)}a._viewTemplateConsumers=[]};return{getTemplate:function(b){if(a._isTemplateLoaded)b.call(b,a._viewTemplate);else{a._viewTemplateConsumers.push(b);if(!a._isTemplateLoading){a._isTemplateLoading=true;a._fetchViewTemplate()}}},setTemplateNodeSelector:function(b){a._templateNodeSelector=b}}}();dojo.provide("dj.widget.autocomplete.LandingPageGenerator");dojo.declare("dj.widget.autocomplete.LandingPageGenerator",[],{constructor:function(a,b,c,e){this._cfg=dojo.mixin(this.DEFAULT_CONFIG,e);this.autoCompleteViewCfg=a;this.suggestionContext=b;this.selectedSuggestionObject=c;this.baseDomain="http://"+document.domain},DEFAULT_CONFIG:{companyResearchBaseUrl:"quotes.f.dev.wsj.com",keywordException:["obama","putin","china","fbi","cia","fda","nano","g20","g-20","bay","egan","acme","gold","cost","gas","beer","drug","oil","dog","cpi","gdp","dna","etf","jazz","etfs","auto","fed","taxes","tax","rome","cdc"]},goToQuotesPage:function(a){if(this.isValidateQuoteSearchBox()){var b=this.suggestionContext.searchText,c=this.isSearchOverride(a);if(typeof a!="undefined"&&(c||!this.isQuoteInput(b)))this.doKeyWordSearch();else if(this.isIndex())this.doRedirectIndexPage();else typeof a=="undefined"||this.isQuoteInput(b)?this.doViewQuote():this.doKeyWordSearch()}},isQuoteInput:function(a){if(a.match(",")){if(dj.module.autocomplete&&dj.module.autocomplete.oldSearchResultArr){a=a.split(",");for(var b=0;b<a.length;b++)for(var c=a[b],e=0;e<dj.module.autocomplete.oldSearchResultArr.length;e++){var d=dj.module.autocomplete.oldSearchResultArr[e];d.term==c&&this.isTickerMatch(c,d.resultset)}a.length==b&&this.isTickerMatch(a[a.length-1],dj.module.autocomplete.companiesArray);if(dj.module.autocomplete.multipleTickerCompArr){if(dj.module.autocomplete.multipleTickerCompArr&&dj.module.autocomplete.multipleTickerCompArr.length>0)return true}else return false}}else if(typeof dj.module.autocomplete!="undefined"&&typeof dj.module.autocomplete.companiesArray!="undefined")return this.isTickerMatch();return false},isTickerMatch:function(a,b){if(typeof a=="undefined")a=this.suggestionContext.searchText;if(typeof b=="undefined")b=dj.module.autocomplete.companiesArray;for(var c=0;c<b.length;c++){var e=b[c].ticker;e=e.substring(e.indexOf(":")+1,e.length);if(a.toUpperCase()==e){this.selectedSuggestionObject=b[c];if(!dj.module.autocomplete.multipleTickerCompArr)dj.module.autocomplete.multipleTickerCompArr=[];dj.module.autocomplete.multipleTickerCompArr.push(e,b[c]);return true}}return false},isValidateQuoteSearchBox:function(){var a=false;if(typeof this.suggestionContext.searchText==="undefined")alert("Please Enter a Symbol or Keyword.");else a=true;return a},isSearchOverride:function(){var a=this.suggestionContext.searchText,b=false;a=a.replace(/^\s+|\s+$/g,"").toUpperCase();a=a.replace(/,+/gi,"");for(var c=this._cfg.keywordException.length,e=0;e<c;e++){var d=this._cfg.keywordException[e];d=d.replace(/^\s+|\s+$/g,"").toUpperCase();if(d==a)b=true}return b},doKeyWordSearch:function(a,b){var c=this.suggestionContext.searchText;if(typeof a!="undefined")c=a;c=unescape(c);c=c.replace(/^\"\'\s+|\s+$/g,"").replace(/,$|\.,$/,"");if(typeof b=="undefined")b="DNH_S";c=c.replace(/ /g,"+");var e=dj.context.core.searchAppUrl;if(typeof e=="undefined"||dojo.trim(e)=="")e="/search/term.html?KEYWORDS=";var d=dj.context.core.urlPrefix,g=/jpbeta.wsj.com/,l=/tr(.f.dev|.s.dev|).wsj.com/,m=/(f.dev.|s.dev.|)wsj.com.tr/;this.doOpenWindow(d.match(/jp(.f.dev|.s.dev|).wsj.com/)||d.match(g)||d.match(l)||d.match(m)?dj.context.core.urlPrefix+e+encodeURIComponent(c)+"&mod="+b:dj.context.core.urlPrefix+e+escape(c)+"&mod="+b)},doPrivateCompaniesSearch:function(a,b){a=a.replace(/ /g,"+");var c=dj.context.core.searchAppUrl;if(typeof c=="undefined"||dojo.trim(c)=="")c="/search/term.html?KEYWORDS=";this.doOpenWindow(dj.context.core.urlPrefix+c+'"'+escape(a)+'"&mod='+b)},doOpenWindow:function(a){if(this.autoCompleteViewCfg.target&&this.autoCompleteViewCfg.target==="_blank")window.open(a);else document.location=a},isIndex:function(){return typeof this.selectedSuggestionObject!="undefined"?this.selectedSuggestionObject.type==="Index":false},isMutualFund:function(){return this.selectedSuggestionObject.type==="Fund"},doRedirectIndexPage:function(){var a=dj.context.core.quotesUrlPrefix,b=this.selectedSuggestionObject.ticker;b=b.substring(b.indexOf(":")+1,b.length);var c=this.selectedSuggestionObject.country;a=c!="US"?a+"/index/"+c+"/"+b+"?mod=DNH_S":a+"/index/"+b+"?mod=DNH_S";a+="?mod=DNH_S_cq";this.doOpenWindow(a)},doViewQuote:function(){if(this.suggestionContext.searchText.match(","))this.doMultipleQuoteSearch();else{var a=dj.context.core.quotesUrlPrefix+"/",b=this.selectedSuggestionObject.ticker;b=b.substring(b.indexOf(":")+1,b.length);b=b.replace(/\./g,"");if(this.selectedSuggestionObject.country==="US")a+=b;else a=a+this.selectedSuggestionObject.country+"/"+this.selectedSuggestionObject.exchangeIsoCode+"/"+b;a+="?mod=DNH_S_cq";this.doOpenWindow(a)}},doMultipleQuoteSearch:function(){var a=this.suggestionContext.searchText.split(","),b="",c="";for(i=0;i<a.length;i++){tempSymb=a[i];tempSymb=dojo.trim(tempSymb);c+="usstock usfund,";b=b+tempSymb+","}b=b.substring(0,b.length-1);c=c.substring(0,c.length-1);b=b.replace(/\+/g,"%2B");b=b.replace(/\./g,"");a=false;if(typeof loggedIn!="undefined")a=loggedIn;var e=dj.context.core.urlPrefix,d=/(f.dev.|s.dev.|)wsj.com.tr/;this.doOpenWindow(e.match(/tr(.f.dev|.s.dev|).wsj.com/)||e.match(d)?"http://online.wsj.com"+(a?"":"/public")+"/quotes/main.html?symbol="+
b+"&type="+c+"&mod=DNH_S":dj.context.core.urlPrefix+(a?"":"/public")+"/quotes/main.html?symbol="+b+"&type="+c+"&mod=DNH_S")},goToTopicsOrPINPage:function(){var a="http://topics.wsj.com/",b="A",c="abc";if(typeof this.selectedSuggestionObject.type!="undefined"){if(this.selectedSuggestionObject.name!=null&this.selectedSuggestionObject.name!=""){b=this.selectedSuggestionObject.name.substring(0,1).toUpperCase();c=this.selectedSuggestionObject.name.replace(/ /g,"-").toLowerCase()}var e=this.selectedSuggestionObject.type;if(e=="company")e="organization";a=a+e+"/"+b+"/"+c+"/"+this.selectedSuggestionObject.code}else if(typeof this.selectedSuggestionObject.fullName!="undefined"){if(this.selectedSuggestionObject.lastName!=null&this.selectedSuggestionObject.lastName!="")b=this.selectedSuggestionObject.lastName.substring(0,1).toUpperCase();if(this.selectedSuggestionObject.fullName!=null&this.selectedSuggestionObject.fullName!="")c=this.selectedSuggestionObject.fullName.replace(/ /g,"-").toLowerCase();a=a+"person/"+b+"/"+
c+"/"+this.selectedSuggestionObject.code}a+="?mod=DNH_S_tp";this.doOpenWindow(a)},doFeaturesSearch:function(a){if(typeof a=="undefined")a="DNH_S_features";var b=this.selectedSuggestionObject.url;if(b.indexOf("http")==-1||b.indexOf("http")!=0||b.indexOf("/")==0)b=dj.context.core.urlPrefix+b;b=b.indexOf("?")>-1?b+"&mod="+a:b+"?mod="+a;this.doOpenWindow(b)}});dojo.provide("dj.widget.autocomplete.SuggestCategoryDisplayModel");dojo.require("dj.lang");(dj.widget.autocomplete.SuggestCategoryDisplayModel=function(a){this._options=dj.lang.cloneMixin(this.OPTIONS_CONFIG,a)}).prototype={constructor:dj.widget.autocomplete.SuggestCategoryDisplayModel,OPTIONS_CONFIG:{subHeading1:"",subHeading2:"",noOfColumns:1,columnToObjMap:[],maxNoOfSuggestionsToDisplay:5,subHeading1DisplayFlag:false,subHeading2DisplayFlag:false,subHeading1Class:"hdrSearchListComp"},getSubHeading1:function(){return this._options.subHeading1},setSubHeading1:function(a){this._options.subHeading1=a},getSubHeading1Class:function(){return this._options.subHeading1Class},setSubHeading1Class:function(a){this._options.subHeading1Class=a},isSubHeading1Visible:function(){return this._options.subHeading1DisplayFlag},getSubHeading2:function(){return this._options.subHeading2},setSubHeading2:function(a){this._options.subHeading2=a},isSubHeading2Visible:function(){return this._options.subHeading2DisplayFlag},addColumnAccessorMapping:function(a,b){this._validateColumnIndex(a);this._options.columnToObjMap[a]=b},getNumberOfColumns:function(){return this._options.noOfColumns},setNumberOfColumns:function(a){this._options.numberOfColumnsToObjMap=a},getNumberOfColumnsToObjMap:function(){return this._options.noOfColumnsToObjMap},setNumberOfColumnsToObjMap:function(a){this._options.noOfColumnsToObjMap=a},getColumnValueAccessor:function(a){this._validateColumnIndex(a);return this._options.columnToObjMap[a]},getMaxNoOfSuggestionsToDisplay:function(){return this._options.maxNoOfSuggestionsToDisplay},_validateColumnIndex:function(a){if(typeof a!=="number")throw new TypeError("IllegalArgument: expected a positive integer");if(a<0||a>this.getNumberOfColumns()-1)throw new RangeError("Column Index bound[0 "+(this.getNumberOfColumns()-1)+"]");}};dojo.provide("dj.widget.autocomplete.SuggestDataModel");dojo.require("dj.lang");dojo.require("dj.util.Observer");(dj.widget.autocomplete.SuggestDataModel=function(a){this._options=dj.lang.cloneMixin(this.OPTIONS_CONFIG,a);this._categorySuggestionsArray=[];for(a=0;a<this._options.noOfCategories;a++)this._categorySuggestionsArray.push([]);this._suggestDataModelListeners=new dj.util.Observer(this);this._suggestSelectionListeners=new dj.util.Observer(this);this._suggestionContext={};this._selectedSuggestion={ctgIndex:-1,ctgItemIndex:-1};this._hasSelectedSuggestion=false}).prototype={OPTIONS_CONFIG:{noOfCategories:1},addSuggestDataModelListener:function(a){if(typeof a!=="function")throw new TypeError("IllegalArgument: Expected an argument of type function");this._suggestDataModelListeners.subscribe(a,a)},removeSuggestDataModelListener:function(a){if(typeof a!=="function")throw new TypeError("IllegalArgument: Expected an argument of type function");this._suggestDataModelListeners.unsubscribe(a)},addSuggestSelectionListener:function(a){if(typeof a!=="function")throw new TypeError("IllegalArgument: Expected an argument of type function");this._suggestSelectionListeners.subscribe(a,a)},removeSuggestSelectionListener:function(a){if(typeof a!=="function")throw new TypeError("IllegalArgument: Expected an argument of type function");this._suggestSelectionListeners.unsubscribe(a)},updateSuggestionContext:function(a){this._suggestionContext=a},getSuggestionContext:function(){return this._suggestionContext},getCategorySuggestions:function(a){this._validateCategoryIndex(a);return this._categorySuggestionsArray[a]},updateCategorySuggestions:function(a,b){this._validateCategoryIndex(a);if(!dojo.isArray(b))throw new TypeError("IllegalArgument: Expected an 2nd argument of type Array");this._categorySuggestionsArray[a]=b;this._suggestDataModelListeners.fire(this,this._suggestionContext,a)},emptyCategorySuggestions:function(a){this._validateCategoryIndex(a);this._categorySuggestionsArray[a]=[]},getCategoryLineItemData:function(a,b){var c=this.getCategorySuggestions(a);if(c.length>b)return c[b];return{}},getNumberOfCategories:function(){return this._options.noOfCategories},getNumberOfCategoryLineItems:function(a){return this.getCategorySuggestions(a).length},_validateCategoryIndex:function(a){if(typeof a!=="number")throw new TypeError("IllegalArgument: expected a positive integer");if(!this._isCategoryIndexInRange(a))throw new RangeError("Category Index bound[0 "+(this.getNumberOfCategories()-1)+"], received "+a);},_isCategoryIndexInRange:function(a){return!(a<0||a>this.getNumberOfCategories()-1)},isEmpty:function(){for(var a=this._categorySuggestionsArray.length,b=0;b<a;b++)if(this._categorySuggestionsArray[b].length>0)return false;return true},clear:function(){for(var a=this.getNumberOfCategories(),b=0;b<a;b++){this.emptyCategorySuggestions(b);this._suggestDataModelListeners.fire(this,this._suggestionContext,b)}this.clearSelection()},clearSelection:function(){this._hasSelectedSuggestion=false;this._selectedSuggestion.ctgIndex=-1;this._selectedSuggestion.ctgItemIndex=-1},hasSelectedSuggestion:function(){return this._hasSelectedSuggestion},selectSuggestion:function(a,b){var c=this._isSelectionChanging(a,b);if(this._isCategoryIndexInRange(a)){if(this.getCategorySuggestions(a).length>b){this._selectedSuggestion.ctgIndex=a;this._selectedSuggestion.ctgItemIndex=b;this._hasSelectedSuggestion=true}}else{this._selectedSuggestion.ctgIndex=a;this._selectedSuggestion.ctgItemIndex=b;this._hasSelectedSuggestion=false}c&&this._fireSelectionChangeEvent()},_isSelectionChanging:function(a,b){if(this._selectedSuggestion.ctgIndex===a&&this._selectedSuggestion.ctgItemIndex===b)return false;return true},getSelectedSuggestion:function(){if(this._hasSelectedSuggestion===true)return this.getCategoryLineItemData(this._selectedSuggestion.ctgIndex,this._selectedSuggestion.ctgItemIndex);return null},getSelectedSuggestionIndices:function(){return dj.lang.clone(this._selectedSuggestion)},selectPreviousSuggestion:function(a){var b;if(this._hasSelectedSuggestion===true){var c=this._selectedSuggestion.ctgIndex,e=this._selectedSuggestion.ctgItemIndex;if(this._selectedSuggestion.ctgItemIndex>0){e--;this.selectSuggestion(c,e)}else for(c--;this._isCategoryIndexInRange(c);){e=this.getNumberOfCategoryLineItems(c)-1;if((b=a.getMaxNoOfSuggestionsToDisplay(c))&&b-1<e)e=b-1;if(e>=0){this.selectSuggestion(c,e);break}else c--}}},selectNextSuggestion:function(a,b){var c=0;if(typeof b!="undefined")c=b;var e=-1;if(this._hasSelectedSuggestion===true){c=this._selectedSuggestion.ctgIndex;e=this._selectedSuggestion.ctgItemIndex}var d=a.getMaxNoOfSuggestionsToDisplay(c);for(e++;this._isCategoryIndexInRange(c);)if(e<this.getNumberOfCategoryLineItems(c)&&e<d){this.selectSuggestion(c,e);break}else{e=0;c++}},_fireSelectionChangeEvent:function(){var a=new dj.widget.autocomplete.SuggestDataModel$DataModelEvent;if(this._hasSelectedSuggestion===true)a.setCurrentSelectionIndices(this._selectedSuggestion.ctgIndex,this._selectedSuggestion.ctgItemIndex);else throw Error("No reason to fire SelectionChangeEvent");this._suggestSelectionListeners.fire(a)}};(dj.widget.autocomplete.SuggestDataModel$DataModelEvent=function(){this._eventName="";this._currentSelectedCategoryLineItemIndex=this._currentSelectedCategoryIndex=-1}).prototype={isSuggestionSelectionChangeEvent:function(){return true},setCurrentSelectionIndices:function(a,b){this._currentSelectedCategoryIndex=a;this._currentSelectedCategoryLineItemIndex=b},getSelectedCategoryIndex:function(){return this._currentSelectedCategoryIndex},getSelectedCategoryLineItemIndex:function(){return this._currentSelectedCategoryLineItemIndex}};dojo.provide("dj.widget.autocomplete.RemoteSuggestDataProvider");dojo.require("dj.lang");dojo.require("dj.util.Observer");dojo.require("dojo.io.script");(dj.widget.autocomplete.RemoteSuggestDataProvider=function(a){this._options=dj.lang.cloneMixin(this.OPTIONS_CONFIG,a);this._suggestDataSubscribers=new dj.util.Observer(this);this._suggestDataUrlBuilder=null;this._urlCallCount=2;this._urlCallStart=0;this._responseErrUrl={}}).prototype={OPTIONS_CONFIG:{},setSuggestDataUrlBuilder:function(a){if(typeof a!=="function")throw new TypeError("IllegalArgument: Expected an argument of type function");this._suggestDataUrlBuilder=a},addSuggestDataHandlerClientCallback:function(a){if(typeof a!=="function")throw new TypeError("IllegalArgument: Expected an argument of type function");this._suggestDataSubscribers.subscribe(a,a)},getSuggestData:function(a){typeof this._options.product=="undefined"||this._options.product=="PRO"?dj.lang.xhrGet(this._buildDojoRequest(a)):dojo.io.script.get(this._buildDojoRequest(a))},_getSuggestDataUrl:function(a){var b=this._suggestDataUrlBuilder,c="";if(b===null||typeof b!=="function")throw Error("TODO: to be implemented");else c=b.call(b,a);return c},_handleResponse:function(a,b){try{this._suggestDataSubscribers.fire(b,a)}catch(c){typeof console!="undefined"&&typeof console.error!="undefined"&&console.error("Autocomplete Integration client code failed to consume data %o",c)}},_buildDojoRequest:function(a){var b=this,c={url:this._getSuggestDataUrl(a),handleAs:"json",timeout:1E4,headers:{},load:function(e,d){b._handleResponse(e,a,d)},error:function(e,d){b._handleResponse('{"Error":"Message"}',a,d)}};if(typeof this._options.product!="undefined")c.callbackParamName="callback";return c}};dojo.provide("dj.widget.autocomplete.provider.MWatchWSJHatSearchProvider");dojo.require("dj.widget.autocomplete.RemoteSuggestDataProvider");dj.widget.autocomplete.provider.MWatchWSJHatSearchProvider=function(a,b){var c=new dj.widget.autocomplete.RemoteSuggestDataProvider({product:"WSJ"});c.setSuggestDataUrlBuilder(function(j){var k="symbol,private-company";if(j.searchText.length>3)k+=",person,suggested-search-term,topic,omniture-keyword";var n=j.searchText;if(n.match(",")){n=j.searchText.split(",");if(dojo.trim(n[n.length-1])=="")if(n[n.length-2]){n=dojo.trim(n[n.length-2]);if(typeof dj.module.autocomplete!="undefined"&&typeof dj.module.autocomplete.companiesArray!="undefined"){if(!dj.module.autocomplete.oldSearchResultArr)dj.module.autocomplete.oldSearchResultArr=[];dj.module.autocomplete.oldSearchResultArr.push({term:n,resultset:dj.module.autocomplete.companiesArray})}n=n}else n="";else n=dojo.trim(n[n.length-1])}n=encodeURIComponent(n);j="http://services.dowjones.com";if(dj.context.core.urlPrefix)if(dj.context.core.urlPrefix.indexOf("s.dev")!=-1||dj.context.core.urlPrefix.indexOf("f.dev")!=-1)j="http://services-staging.dowjones.com";var t="";if(b.language)t="&ks="+b.language;var f="";if(b.countryCode)f="&cc="+b.countryCode;var h=dojo.getObject("dj.context.autocomplete.exclusionlist")||"XBUE,XBAH,XCNQ,XTNX,XBOG,XCYS,XCAI,XSTU,XBER,XHAN,XTAE,XAMM,XKAZ,XKUW,XCAS,XMUS,XKAR,XLIM,DSMD,XMIC,RTSX,XSAU,XBRA,XCOL,PFTS,XADS,XDFM,XCAR,XNSE,MISX";return j+"/autocomplete/data?q="+n+"&it=fund,exchangetradedfund,stock,Index&count=5&need="+k+t+f+"&excludeexs="+h});c.addSuggestDataHandlerClientCallback(function(j,k){var n=a.getSuggestDataModel();n.getSuggestionContext()===j&&dojo.forEach(b.CategoryDisplayConfigs,function(t,f){var h=t.name,o=t.maxNoOfSuggestionsToDisplay;if(h==="suggestedTerms")k.suggestedTerms==null||typeof k.suggestedTerms=="undefined"||k.suggestedTerms.length==0?n.updateCategorySuggestions(f,[]):n.updateCategorySuggestions(f,k.suggestedTerms);else if(h==="companies")k.symbols==null||typeof k.symbols=="undefined"||k.symbols.length==0?n.updateCategorySuggestions(f,[]):n.updateCategorySuggestions(f,k.symbols);else if(h==="privateCompanies")k.privateCompanies==null||typeof k.privateCompanies=="undefined"||k.privateCompanies.length==0?n.updateCategorySuggestions(f,[]):n.updateCategorySuggestions(f,k.privateCompanies);else if(h==="topics"){var p=[];if(k.topics!=null&&typeof k.topics!="undefined"&&k.topics.length!=0)p=k.topics;if(k.people!=null&&typeof k.people!="undefined"&&k.people.length>0){p=[];var q=Math.ceil(o/2),r=Math.floor(o/2),s=k.topics.length,u=k.people.length,v=u<r?o-u:q;v=v>s?s:v;q=s<q?o-s:r;q=q>u?u:q;for(u=0;u<v;u++)p.push(k.topics[u]);for(v=0;v<q;v++)p.push(k.people[v])}n.updateCategorySuggestions(f,p)}else if(h==="keywords")k.keywords==null||typeof k.keywords=="undefined"||k.keywords.length==0?n.updateCategorySuggestions(f,[]):n.updateCategorySuggestions(f,k.keywords)})});var e=function(j,k){(new dj.widget.autocomplete.LandingPageGenerator(b,j,k)).doFeaturesSearch("DNH_S_features")},d=function(j,k){(new dj.widget.autocomplete.LandingPageGenerator(b,j,k)).goToQuotesPage()},g=function(j,k){(new dj.widget.autocomplete.LandingPageGenerator(b,j,k)).goToTopicsOrPINPage()},l=function(j,k){(new dj.widget.autocomplete.LandingPageGenerator(b,j,k)).doKeyWordSearch(k.keyword,"DNH_S_recent")},m=function(j,k){(new dj.widget.autocomplete.LandingPageGenerator(b,j,k)).doPrivateCompaniesSearch(k.name,"DNH_S_privatecompany")};(function(){c.selectHandlers=[];if(b.categoryTypeArr&&b.categoryTypeArr.length>0)for(var j=0;j<b.categoryTypeArr.length;j++)if(b.categoryTypeArr[j]=="FEATURES")c.selectHandlers.push(e);else if(b.categoryTypeArr[j]=="COMPANIES")c.selectHandlers.push(d);else if(b.categoryTypeArr[j]=="PRIVATE_COMPANIES")c.selectHandlers.push(m);else if(b.categoryTypeArr[j]=="TOPICS")c.selectHandlers.push(g);else b.categoryTypeArr[j]=="KEYWORDS"&&c.selectHandlers.push(l)})();return c};dojo.provide("dj.widget.autocomplete.SuggestDisplayModel");dojo.require("dj.lang");dojo.require("dj.widget.autocomplete.SuggestCategoryDisplayModel");(dj.widget.autocomplete.SuggestDisplayModel=function(a,b){this._options=dj.lang.cloneMixin(this.OPTIONS_CONFIG,a);this._categoryDisplayModels=b?[]:[new dj.widget.autocomplete.SuggestCategoryDisplayModel];this._footerText=this._headerText="";this._isFooterVisible=this._isHeaderVisible=false}).prototype={constructor:dj.widget.autocomplete.SuggestDisplayModel,OPTIONS_CONFIG:{},getHeaderText:function(){return this._headerText},setHeaderText:function(a){this._headerText=a},isHeaderVisible:function(){return this._isHeaderVisible},setHeaderVisible:function(a){this._isHeaderVisible=a?true:false},getFooterText:function(){return this._footerText},setFooterText:function(a){this._footerText=a},isFooterVisible:function(){return this._isFooterVisible},setFooterVisible:function(a){this._isFooterVisible=a?true:false},addCategoryDisplayModel:function(){var a=null;switch(arguments.length){case 0:throw Error("IllegalArgument: expected atleast one categoryDisplayModel arg");case 1:if(typeof arguments[0]==="string"){a=new dj.widget.autocomplete.SuggestCategoryDisplayModel;a.setSubHeading1(arguments[0]);this._categoryDisplayModels.push(a)}else if(arguments[0].constructor===dj.widget.autocomplete.SuggestCategoryDisplayModel)this._categoryDisplayModels.push(arguments[0]);else throw new TypeError("IllegalArgument: expected instance of string or dj.widget.autocomplete.SuggestCategoryDisplayModel");break;case 2:if(typeof arguments[0]==="string"&&typeof arguments[1]==="string"){a=new dj.widget.autocomplete.SuggestCategoryDisplayModel;a.setSubHeading1(arguments[0]);a.setSubHeading2(arguments[1]);this._categoryDisplayModels.push(a)}break;default:throw Error("Illegal Number of Arguments , supported 1 object or 2 string args");}},removeAllCategories:function(){this._categoryDisplayModels=[]},getNumberOfCategories:function(){return this._categoryDisplayModels.length},getCategorySubHeading1:function(a){this._validateCategoryIndex(a);return this._categoryDisplayModels[a].getSubHeading1()},isCategorySubHeading1Visible:function(a){this._validateCategoryIndex(a);return this._categoryDisplayModels[a].isSubHeading1Visible()},getCategorySubHeading2:function(a){this._validateCategoryIndex(a);return this._categoryDisplayModels[a].getSubHeading2()},getCategorySubHeading1Class:function(a){this._validateCategoryIndex(a);return this._categoryDisplayModels[a].getSubHeading1Class()},isCategorySubHeading2Visible:function(a){this._validateCategoryIndex(a);return this._categoryDisplayModels[a].isSubHeading2Visible()},getNumberOfColumnsInCategory:function(a){this._validateCategoryIndex(a);return this._categoryDisplayModels[a].getNumberOfColumns()},getNumberOfColumnsToObjMap:function(a){this._validateCategoryIndex(a);return this._categoryDisplayModels[a].getNumberOfColumnsToObjMap()},getCategoryColumnValueAccessor:function(a,b){this._validateCategoryIndex(a);return this._categoryDisplayModels[a].getColumnValueAccessor(b)},getMaxNoOfSuggestionsToDisplay:function(a){this._validateCategoryIndex(a);return this._categoryDisplayModels[a].getMaxNoOfSuggestionsToDisplay()},_validateCategoryIndex:function(a){if(typeof a!=="number")throw new TypeError("IllegalArgument: expected a positive integer");if(a<0||a>this.getNumberOfCategories()-1)throw new RangeError("Category Index bound[0 "+(this.getNumberOfCategories()-1)+"]");}};dojo.provide("dj.widget.autocomplete.AutoCompleteView");dojo.require("dj.lang");dojo.require("dj.widget.autocomplete.SuggestDisplayModel");dojo.require("dj.widget.autocomplete.autoCompleteViewTemplate");(dj.widget.autocomplete.AutoCompleteView=function(a,b,c){this._cfg=dj.lang.cloneMixin(this.DEFAULT_CONFIG,a);this._options=dj.lang.cloneMixin(this.OPTIONS_CONFIG,b);this._content=this._currentHighlightedItem=this._suggestionsContentNode=this._suggestionsContainer=null;this._suggestionBlocks=[];this._showAllSymbolsAnchorNode=this._suggestFooterNode=null;this._categoryDisplayDataPointsIndex=[];this._suggestDisplayModel=typeof c==="undefined"?new dj.widget.autocomplete.SuggestDisplayModel:c}).prototype={DEFAULT_CONFIG:{},OPTIONS_CONFIG:{},setViewContainer:function(a){this._suggestionsContainer=a},getViewContainer:function(){return this._suggestionsContainer},fetchViewTemplate:function(){var a=this;dj.widget.autocomplete.autoCompleteViewTemplate.getTemplate(function(b){a.handleViewTemplateLoad(b)})},handleViewTemplateLoad:function(a){dojo.query("div.yui-ac-content",this.getViewContainer())[0].innerHTML=a;this._buildCategoryDisplay();this.indexDataPoints()},highlightSuggestion:function(a){this._currentHighlightedItem!==null&&dojo.removeClass(this._currentHighlightedItem,"yui-ac-highlight");this._currentHighlightedItem=a;dojo.addClass(a,"yui-ac-highlight")},highlightSuggestionAt:function(a,b){this.highlightSuggestion(this._categoryDisplayDataPointsIndex[a].listNodes[b])},_buildCategoryDisplay:function(){for(var a=this._suggestDisplayModel.getNumberOfCategories(),b=dojo.query("div.suggestionblockcontainer",this.getViewContainer())[0],c=0;c<a;c++){var e=this._suggestDisplayModel.getNumberOfColumnsInCategory(c),d=null;if(e===4)d=dojo.query("div[class~='suggestionblock'][templateType='C2']",this.getViewContainer())[0];else if(e===1)d=dojo.query("div[class~='suggestionblock'][templateType='C1']",this.getViewContainer())[0];else throw Error("View not supported for more than 2 columns");d=d.cloneNode(true);var g=this._suggestDisplayModel.getMaxNoOfSuggestionsToDisplay(c),l=dojo.query("li",d)[0];l.setAttribute("categoryIndex",c);l.setAttribute("categoryItemIndex",0);for(var m=dojo.query("ul",d)[0],j=1;j<g;j++){var k=l.cloneNode(true);k.setAttribute("categoryItemIndex",j);m.appendChild(k)}d.removeAttribute("templateType");dojo.addClass(d,"concrete");d.setAttribute("categoryIndex",c);g=dojo.query("div.subHeading1",d)[0];if(e===4){e=dojo.query("div.subHeading2",d)[0];e.setAttribute("categoryIndex",c);e.innerHTML=this._suggestDisplayModel.getCategorySubHeading2(c);this._suggestDisplayModel.isCategorySubHeading2Visible(c)&&dojo.removeClass(e,"hidden")}g.innerHTML=this._suggestDisplayModel.getCategorySubHeading1(c);this._suggestDisplayModel.isCategorySubHeading1Visible(c)&&dojo.removeClass(g,"hidden");b.appendChild(d)}a=dojo.query("div.yui-ac-hd",this.getViewContainer())[0];this._suggestDisplayModel.isHeaderVisible()&&dojo.removeClass(a,"hidden");a=dojo.query("div.yui-ac-ft",this.getViewContainer())[0];if(this._suggestDisplayModel.isFooterVisible()){dojo.removeClass(a,"hidden");dojo.query("div.footer",a)[0].innerHTML=this._suggestDisplayModel.getFooterText()}},indexDataPoints:function(){this._content=dojo.query("div[class~='yui-ac-content']",this.getViewContainer())[0];this._suggestionBlocks=dojo.query("div.suggestionblock.concrete",this.getViewContainer());for(var a=this._suggestDisplayModel.getNumberOfCategories(),b=0;b<a;b++){var c=this._suggestDisplayModel.getNumberOfColumnsInCategory(b),e=dojo.query("li",this._suggestionBlocks[b]),d=null;if(c===1){d=dojo.query("span.keywordResult",this._suggestionBlocks[b]);this._categoryDisplayDataPointsIndex.push({listNodes:e,col1Nodes:d})}else if(c===4){d=dojo.query("td.symbolCompleteCol1",this._suggestionBlocks[b]);c=dojo.query("td.symbolCompleteCol2",this._suggestionBlocks[b]);var g=dojo.query("td.symbolCompleteCol3",this._suggestionBlocks[b]),l=dojo.query("td.symbolCompleteCol4",this._suggestionBlocks[b]),m=dojo.query("div.subHeading2",this._suggestionBlocks[b])[0];this._categoryDisplayDataPointsIndex.push({listNodes:e,col1Nodes:d,col2Nodes:c,col3Nodes:g,col4Nodes:l,subHeading2:m})}else throw Error("Data point indexing supported for 1 and 4 columns only");}this._suggestFooterNode=dojo.query("div.footer",this.getViewContainer())[0]},populateCategoryDisplayMetaData:function(a,b,c){if(this._suggestDisplayModel.getNumberOfColumnsInCategory(a)===4)this._categoryDisplayDataPointsIndex[a].subHeading2.innerHTML=this._getCategorySubHeading2(a,b,c)},populateCategoryData:function(a,b,c){var e=this._suggestDisplayModel.getNumberOfColumnsInCategory(c);this.populateCategoryDisplayMetaData(c,a,b);if(e===1)this.populateSingleColumnSuggestions(c,a,b);else if(e===4)this.populateFourColumnSuggestions(c,a,b);else throw Error("View is not supported for more than 4 columns");},populateTwoColumnSuggestions:function(a,b,c){var e=this._suggestDisplayModel.getMaxNoOfSuggestionsToDisplay(a),d=this._suggestDisplayModel.getCategoryColumnValueAccessor(a,0),g=this._suggestDisplayModel.getCategoryColumnValueAccessor(a,1);if(c.length===0)dojo.addClass(this._suggestionBlocks[a],"hidden");else{dojo.removeClass(this._suggestionBlocks[a],"hidden");for(var l=0;l<e;l++){var m=c[l];if(typeof m=="undefined")dojo.addClass(this._categoryDisplayDataPointsIndex[a].listNodes[l],"hidden");else{dojo.removeClass(this._categoryDisplayDataPointsIndex[a].listNodes[l],"hidden");var j=m[d];if(typeof j=="undefined")j="-";this._categoryDisplayDataPointsIndex[a].col1Nodes[l].innerHTML=this._getHighlightedSearchTerm(j,b);this._categoryDisplayDataPointsIndex[a].col2Nodes[l].innerHTML=this._getHighlightedSearchTerm(m[g],b)}}}},populateFourColumnSuggestions:function(a,b,c){var e=this._suggestDisplayModel.getMaxNoOfSuggestionsToDisplay(a),d=this._suggestDisplayModel.getCategoryColumnValueAccessor(a,0),g=this._suggestDisplayModel.getCategoryColumnValueAccessor(a,1),l=this._suggestDisplayModel.getCategoryColumnValueAccessor(a,2),m=this._suggestDisplayModel.getCategoryColumnValueAccessor(a,3);if(c.length===0)dojo.addClass(this._suggestionBlocks[a],"hidden");else{dojo.removeClass(this._suggestionBlocks[a],"hidden");for(var j=0;j<e;j++){var k=c[j];if(typeof k=="undefined")dojo.addClass(this._categoryDisplayDataPointsIndex[a].listNodes[j],"hidden");else{dojo.removeClass(this._categoryDisplayDataPointsIndex[a].listNodes[j],"hidden");var n=k[d];if(typeof n=="undefined")n="-";this._categoryDisplayDataPointsIndex[a].col1Nodes[j].innerHTML=this._getHighlightedSearchTerm(n,b);this._categoryDisplayDataPointsIndex[a].col2Nodes[j].innerHTML=this._getHighlightedSearchTerm(k[g],b);this._categoryDisplayDataPointsIndex[a].col3Nodes[j].innerHTML=this._doExchangeCountryMap(k[l]);this._categoryDisplayDataPointsIndex[a].col4Nodes[j].innerHTML=k[m]}}}},_getHighlightedSearchTerm:function(a,b){return(""+a).replace(RegExp("("+b.searchText+")","i"),'<span class="scResultTerm">$1</span>')},_doExchangeCountryMap:function(a){var b={};b.US="U.S.";b["SAO PAULO"]="Brazil: Bovespa";b.TOR="Canada: Toronto";b.CSEC="Venezuela: Caracas";b.ASX="Australia: Sydney";b.SHSE="China: Shanghai";b.SSE="China: Shenzhen";b.HKSE="Hong Kong";b.TSE="Japan: Tokyo";b.KLSE="Malaysia";b.NZSE="New Zealand: NZX";b.SES="Singapore: SGX";b.TWSE="Taiwan";b.BRUX="Belgium: Brussels";b.COPN="Denmark: OMX";b.TALLINN="Estonia: Tallinn";b.HELS="Finland: Helsinki";b.PARB="France: Paris";b.FRNK="Germany: Frankfurt";b.XETRA="Germany: Xetra";b.REYKJAVIK="Iceland";b.DUBLIN="Ireland: Dublin";b.MILAN="Italy: Milan";b.RIGA="Latvia: Riga";b.LITHUANIA="Lithuania: Vilnius";b.AMS="Netherlands: Amsterdam";b.OSLO="Norway: Oslo";b.SIBE="Spain: Madrid";b.STKM="Sweden: Stockholm";b.ZSE="Switzerland: SWX";b.LONDON="U.K.: London";b.VTX="Switzerland: SWX";b.PINKSH="U.S.: Pink Sheets";b.NNOTC="U.S.: Other OTC";b.NASDBB="U.S.: OTCBB";b.XTSX="Canada: TSX Venture";b.BOMBAY="India: Bombay";b.BSE="Hungary: Budapest";b.LISBON="Portugal: Lisbon";b.SET="Thailand: Bangkok";b.VIENNA="Austria: Vienna";return b[a]},populateSingleColumnSuggestions:function(a,b,c){var e=this._suggestDisplayModel.getMaxNoOfSuggestionsToDisplay(a),d=this._suggestDisplayModel.getCategoryColumnValueAccessor(a,0);if(c.length===0)dojo.addClass(this._suggestionBlocks[a],"hidden");else{dojo.removeClass(this._suggestionBlocks[a],"hidden");for(var g=0;g<e;g++){var l=c[g];if(typeof l=="undefined")dojo.addClass(this._categoryDisplayDataPointsIndex[a].listNodes[g],"hidden");else{dojo.removeClass(this._categoryDisplayDataPointsIndex[a].listNodes[g],"hidden");this._categoryDisplayDataPointsIndex[a].col1Nodes[g].innerHTML=this._getHighlightedSearchTerm(l[d],b)}}}},_getCategorySubHeading2:function(a,b){return this._suggestDisplayModel.getCategorySubHeading2(a)+'"'+b.searchText+'"'},show:function(){dojo.removeClass(this.getViewContainer(),"hidden")},hide:function(){dojo.addClass(this.getViewContainer(),"hidden")},isHidden:function(){return dojo.hasClass(this.getViewContainer(),"hidden")},clearSelection:function(){if(this._currentHighlightedItem!==null){dojo.removeClass(this._currentHighlightedItem,"yui-ac-highlight");this._currentHighlightedItem=null}},detach:function(){var a=dojo.query("div.yui-ac-content",this.getViewContainer())[0];this._suggestionsContentNode=dojo.query("div:first-child",a).orphan()[0]},attach:function(){dojo.query("div.yui-ac-content",this.getViewContainer())[0].appendChild(this._suggestionsContentNode)}};dojo.provide("dj.widget.autocomplete.WSJAutoCompleteView");dojo.require("dj.lang");dojo.require("dj.widget.autocomplete.SuggestDisplayModel");dojo.require("dj.widget.autocomplete.autoCompleteViewTemplate");dojo.require("dj.util.Ads");(dj.widget.autocomplete.WSJAutoCompleteView=function(a,b,c){this._cfg=dj.lang.cloneMixin(this.DEFAULT_CONFIG,a);this._options=dj.lang.cloneMixin(this.OPTIONS_CONFIG,b);this._content=this._currentHighlightedItem=this._suggestionsContentNode=this._suggestionsContainer=null;this._suggestionBlocks=[];this._showAllSymbolsAnchorNode=this._suggestFooterNode=null;this._categoryDisplayDataPointsIndex=[];this._suggestDisplayModel=typeof c==="undefined"?new dj.widget.autocomplete.SuggestDisplayModel:c}).prototype={DEFAULT_CONFIG:{},OPTIONS_CONFIG:{},setViewContainer:function(a){this._suggestionsContainer=a},getViewContainer:function(){return this._suggestionsContainer},fetchViewTemplate:function(){var a=this,b=dj.widget.autocomplete.autoCompleteViewTemplate;this._cfg.templateNodeSelector&&b.setTemplateNodeSelector(this._cfg.templateNodeSelector);b.getTemplate(function(c){a.handleViewTemplateLoad(c)})},handleViewTemplateLoad:function(a){dojo.query("div.autocompleteContent",this.getViewContainer())[0].innerHTML=a;this._buildSectionsDisplay();this.createDataPoints()},highlightSuggestion:function(a){this._currentHighlightedItem!==null&&dojo.removeClass(this._currentHighlightedItem,"searchHover");for(var b=dojo.query(".searchHover",this._suggestionsContainer),c=0;c<b.length;c++)dojo.removeClass(b[c],"searchHover");this._currentHighlightedItem=a;dojo.addClass(a,"searchHover")},highlightSuggestionAt:function(a,b){this.highlightSuggestion(this._categoryDisplayDataPointsIndex[a].listNodes[b])},_buildSectionsDisplay:function(){for(var a=this._suggestDisplayModel.getNumberOfCategories(),b=dojo.query("div.dropdownContainerClass",this.getViewContainer())[0],c=0;c<a;c++){var e=this._suggestDisplayModel.getNumberOfColumnsInCategory(c),d=null;if(e===6)d=dojo.query("div[class~='suggestionblock'][templateType='C3']",this.getViewContainer())[0];else if(e===1)d=dojo.query("div[class~='suggestionblock'][templateType='C1']",this.getViewContainer())[0];else throw Error("View not supported for more than 2 columns");e=d.cloneNode(true);d=this._suggestDisplayModel.getMaxNoOfSuggestionsToDisplay(c);var g=dojo.query("li.lineItem",e)[0];g.setAttribute("categoryIndex",c);g.setAttribute("categoryItemIndex",0);var l=dojo.query("ul",e)[0];dojo.addClass(l,this._suggestDisplayModel.getCategorySubHeading1Class(c));for(var m=1;m<d;m++){var j=g.cloneNode(true);j.setAttribute("categoryItemIndex",m);l.appendChild(j)}e.removeAttribute("templateType");dojo.addClass(e,"concrete");e.setAttribute("categoryIndex",c);d=dojo.query("li.hdrSearchListName",e)[0];d.innerHTML=this._suggestDisplayModel.getCategorySubHeading1(c);this._suggestDisplayModel.isCategorySubHeading1Visible(c)?dojo.removeClass(d,"hidden"):dojo.addClass(d,"hidden");b.appendChild(e)}a=dojo.query("div.acHeadline",this.getViewContainer())[0];this._suggestDisplayModel.isHeaderVisible()&&dojo.removeClass(a,"hidden");a=dojo.query("div.acFooter",this.getViewContainer())[0];if(this._suggestDisplayModel.isFooterVisible()){dojo.removeClass(a,"hidden");dojo.query("a.footer",a)[0].innerHTML=this._suggestDisplayModel.getFooterText()}},createDataPoints:function(){this._content=dojo.query("div[class~='autocompleteContent']",this.getViewContainer())[0];this._suggestionBlocks=dojo.query("div.suggestionblock.concrete",this.getViewContainer());for(var a=this._suggestDisplayModel.getNumberOfCategories(),b=0;b<a;b++){var c=this._suggestDisplayModel.getNumberOfColumnsInCategory(b),e=dojo.query("li.lineItem",this._suggestionBlocks[b]),d=null;if(c===1){d=dojo.query("a.searchResult",this._suggestionBlocks[b]);this._categoryDisplayDataPointsIndex.push({listNodes:e,col1Nodes:d})}else if(c===6){e=dojo.query("li.lineItem",this._suggestionBlocks[b]);d=dojo.query("div.searchListCompTicker",this._suggestionBlocks[b]);c=dojo.query("div.searchListCompName",this._suggestionBlocks[b]);var g=dojo.query("div.searchListCompMarkets",this._suggestionBlocks[b]);this._categoryDisplayDataPointsIndex.push({listNodes:e,col1Nodes:d,col2Nodes:c,col3Nodes:g})}else throw Error("Data point indexing supported for 1 and 3 columns only");}this._suggestFooterNode=dojo.query("div.acFooter",this.getViewContainer())[0]},populateCategoryDisplayMetaData:function(){},populateCategoryData:function(a,b,c){for(var e=this._suggestDisplayModel.getNumberOfColumnsInCategory(c),d=dojo.query(".searchHover",this._suggestionsContainer),g=0;g<d.length;g++)dojo.removeClass(d[g],"searchHover");if(e===1)this.populateSingleColumnSuggestions(c,a,b);else if(e===6)this.populateThreeColumnSuggestions(c,a,b);else throw Error("View is not supported for more than 3 columns");},populateTwoColumnSuggestions:function(a,b,c){var e=this._suggestDisplayModel.getMaxNoOfSuggestionsToDisplay(a),d=this._suggestDisplayModel.getCategoryColumnValueAccessor(a,0),g=this._suggestDisplayModel.getCategoryColumnValueAccessor(a,1);if(c.length===0)dojo.addClass(this._suggestionBlocks[a],"hidden");else{dojo.removeClass(this._suggestionBlocks[a],"hidden");for(var l=0;l<e;l++){var m=c[l];if(typeof m=="undefined")dojo.addClass(this._categoryDisplayDataPointsIndex[a].listNodes[l],"hidden");else{dojo.removeClass(this._categoryDisplayDataPointsIndex[a].listNodes[l],"hidden");var j=m[d];if(typeof j=="undefined")j="-";this._categoryDisplayDataPointsIndex[a].col1Nodes[l].innerHTML=this._getHighlightedSearchTerm(j,b);this._categoryDisplayDataPointsIndex[a].col2Nodes[l].innerHTML=this._getHighlightedSearchTerm(m[g],b)}}}},populateThreeColumnSuggestions:function(a,b,c){if(!dj.module.autocomplete)dj.module.autocomplete={};dj.module.autocomplete.companiesArray=c;var e=this._suggestDisplayModel.getMaxNoOfSuggestionsToDisplay(a),d=this._suggestDisplayModel.getCategoryColumnValueAccessor(a,0),g=this._suggestDisplayModel.getCategoryColumnValueAccessor(a,1),l=this._suggestDisplayModel.getCategoryColumnValueAccessor(a,2),m=this._suggestDisplayModel.getCategoryColumnValueAccessor(a,3),j=this._suggestDisplayModel.getCategoryColumnValueAccessor(a,5);if(c.length===0)dojo.addClass(this._suggestionBlocks[a],"hidden");else{dojo.removeClass(this._suggestionBlocks[a],"hidden");for(var k=0;k<e;k++){var n=c[k];if(typeof n=="undefined")dojo.addClass(this._categoryDisplayDataPointsIndex[a].listNodes[k],"hidden");else{dojo.removeClass(this._categoryDisplayDataPointsIndex[a].listNodes[k],"hidden");this._categoryDisplayDataPointsIndex[a].col1Nodes[k].innerHTML=this._getHighlightedSearchTerm(n[d],b);this._categoryDisplayDataPointsIndex[a].col2Nodes[k].innerHTML=this._getHighlightedSearchTerm(n[g],b);this._categoryDisplayDataPointsIndex[a].col3Nodes[k].innerHTML=n[j]=="Index"?"Index":this._getCountryToDisplay(n[l],n[m])}}}},_getCountryToDisplay:function(a,b){var c=b;if("CA,CN,DE,US,IN,XE,JP,KR".indexOf(dojo.trim(a))!=-1)c=b;else if(b.indexOf(":")>-1)c=b.substring(0,b.indexOf(":"));return c},_getHighlightedSearchTerm:function(a,b){return(""+a).replace(RegExp("("+b.searchText+")","i"),'<span class="searchTerm">$1</span>')},_doExchangeCountryMap:function(a){var b={};b.US="U.S.";b["SAO PAULO"]="Brazil: Bovespa";b.TOR="Canada: Toronto";b.CSEC="Venezuela: Caracas";b.ASX="Australia: Sydney";b.SHSE="China: Shanghai";b.SSE="China: Shenzhen";b.HKSE="Hong Kong";b.TSE="Japan: Tokyo";b.KLSE="Malaysia";b.NZSE="New Zealand: NZX";b.SES="Singapore: SGX";b.TWSE="Taiwan";b.BRUX="Belgium: Brussels";b.COPN="Denmark: OMX";b.TALLINN="Estonia: Tallinn";b.HELS="Finland: Helsinki";b.PARB="France: Paris";b.FRNK="Germany: Frankfurt";b.XETRA="Germany: Xetra";b.REYKJAVIK="Iceland";b.DUBLIN="Ireland: Dublin";b.MILAN="Italy: Milan";b.RIGA="Latvia: Riga";b.LITHUANIA="Lithuania: Vilnius";b.AMS="Netherlands: Amsterdam";b.OSLO="Norway: Oslo";b.SIBE="Spain: Madrid";b.STKM="Sweden: Stockholm";b.ZSE="Switzerland: SWX";b.LONDON="U.K.: London";b.VTX="Switzerland: SWX";b.PINKSH="U.S.: Pink Sheets";b.NNOTC="U.S.: Other OTC";b.NASDBB="U.S.: OTCBB";b.XTSX="Canada: TSX Venture";b.BOMBAY="India: Bombay";b.BSE="Hungary: Budapest";b.LISBON="Portugal: Lisbon";b.SET="Thailand: Bangkok";b.VIENNA="Austria: Vienna";return b[a]},populateSingleColumnSuggestions:function(a,b,c){var e=this._suggestDisplayModel.getMaxNoOfSuggestionsToDisplay(a);this._suggestDisplayModel.getNumberOfColumnsToObjMap(a);var d=this._suggestDisplayModel.getCategoryColumnValueAccessor(a,0);if(c.length===0)dojo.addClass(this._suggestionBlocks[a],"hidden");else{dojo.removeClass(this._suggestionBlocks[a],"hidden");for(var g=0;g<e;g++){var l=c[g];if(typeof l=="undefined")dojo.addClass(this._categoryDisplayDataPointsIndex[a].listNodes[g],"hidden");else{var m=l[d];if(d=="keyword"&&typeof l[d]!="undefined"){m=decodeURIComponent(m);m=m.replace(/\+/g," ")}if(typeof l[d]=="undefined"&&typeof l.fullName!="undefined"){m=l.fullName;if(typeof l.companyName!="undefined"&&l.companyName!=null&&l.companyName!="")m=m+"<small> from "+l.companyName+"</small>"}dojo.removeClass(this._categoryDisplayDataPointsIndex[a].listNodes[g],"hidden");this._categoryDisplayDataPointsIndex[a].col1Nodes[g].innerHTML=this._getHighlightedSearchTerm(m,b)}}}},_getCategorySubHeading2:function(){return""},show:function(){dojo.removeClass(this.getViewContainer(),"hidden");dojo.addClass(dojo.byId("searchInputEle"),"searchActive");dj.util.Ads().loadAds("SearchSponsorBox",{ordrecalculate:1})},hide:function(){dojo.addClass(this.getViewContainer(),"hidden");dojo.removeClass(dojo.byId("searchInputEle"),"searchActive")},isHidden:function(){return dojo.hasClass(this.getViewContainer(),"hidden")},clearSelection:function(){if(this._currentHighlightedItem!==null){dojo.removeClass(this._currentHighlightedItem,"searchTerm");this._currentHighlightedItem=null}},detach:function(){var a=dojo.query("div.autocompleteContent",this.getViewContainer())[0];this._suggestionsContentNode=dojo.query("div:first-child",a).orphan()[0]},attach:function(){dojo.query("div.autocompleteContent",this.getViewContainer())[0].appendChild(this._suggestionsContentNode)},showInlineErrorMessage:function(){var a=this._cfg.errorMessage;if(a.inline){var b=dojo.byId(a.containerId);dojo.addClass(b,a.className);b.value=a.errorText;b.blur()}},hideInlineErrorMessage:function(){var a=this._cfg.errorMessage,b=dojo.byId(a.containerId);if(dojo.hasClass(b,a.className)){dojo.removeClass(b,a.className);b.value=""}},isInlineErrorMessage:function(){var a=this._cfg.errorMessage,b=dojo.byId(a.containerId);return dojo.hasClass(b,a.className)&&b.value===a.errorText}};dojo.provide("dj.widget.autocomplete.AutoComplete");dojo.require("dj.lang");dojo.require("dj.util.Observer");dojo.require("dj.util.Element");dojo.require("dj.widget.autocomplete.SuggestCategoryDisplayModel");dojo.require("dj.widget.autocomplete.SuggestDisplayModel");dojo.require("dj.widget.autocomplete.SuggestDataModel");(dj.widget.autocomplete.AutoComplete=function(a,b,c){this._cfg=dj.lang.cloneMixin(this.DEFAULT_CONFIG,a);this._options=dj.lang.cloneMixin(this.OPTIONS_CONFIG,b);this._suggestDataProvider=this._suggestionContextBuilder=this._currentSuggestionContext=this._suggestionsDisplayContainer=null;this._setDefaultSuggestDataProvider();this._suggestionSelectionHandlers=new dj.util.Observer(this);this._footerClickHandlers=new dj.util.Observer(this);this._enterHandler=new dj.util.Observer(this);this._viewEventHandlers=new dj.util.Observer(this);this._lastDataDetchCallId=null;this._suggestViewEventListeners=new dj.util.Observer(this);this._suggestionContextInputEvent=null;a=new dj.widget.autocomplete.SuggestDisplayModel({},true);if(typeof c!=="undefined"){typeof c.Header!=="undefined"&&a.setHeaderText(c.Header);typeof c.HeaderVisible!=="undefined"&&a.setHeaderVisible(c.HeaderVisible);typeof c.Footer!=="undefined"&&a.setFooterText(c.Footer);typeof c.FooterVisible!=="undefined"&&a.setFooterVisible(c.FooterVisible);if(typeof c.CategoryDisplayConfigs!=="undefined"){b=c.CategoryDisplayConfigs;for(var e=0;e<b.length;e++){var d=new dj.widget.autocomplete.SuggestCategoryDisplayModel(b[e]);a.addCategoryDisplayModel(d)}}}if(typeof this._options.product=="undefined"||this._options.product=="PRO"){dojo.require("dj.widget.autocomplete.AutoCompleteView");this._viewInstance=new dj.widget.autocomplete.AutoCompleteView({},{},a)}else if(this._options.product=="WSJ"){dojo.require("dj.widget.autocomplete.WSJAutoCompleteView");var g={};b=c.templateNodeSelector;c=c.errorMessage;if(typeof b!=="undefined"&&b!=="")g.templateNodeSelector=b;if(typeof c!=="undefined"&&c!=="")g.errorMessage=c;this._viewInstance=new dj.widget.autocomplete.WSJAutoCompleteView(g,{},a)}this._dataModelInstance=new dj.widget.autocomplete.SuggestDataModel({noOfCategories:a.getNumberOfCategories()});var l=this;this._dataModelInstance.addSuggestDataModelListener(function(m,j,k){l.onSuggestModelChange(m,j,k)});this._dataModelInstance.addSuggestSelectionListener(function(m){l.onSuggestSelectionChange(m)});this.djLang=dj.lang}).prototype={DEFAULT_CONFIG:{dataFetchDelayMilliSeconds:100},OPTIONS_CONFIG:{tooltipContainer:"autoCompleteList",tooltipContainerClass:".autoCompleteDiv",suggestOnInit:false},_setDefaultSuggestDataProvider:function(){},setSuggestDataProvider:function(a){this._suggestDataProvider=a},setSuggestionContextBuilder:function(a){if(!dojo.isFunction(a))throw new TypeError("IllegalArgument: Expected an argument of type function");this._suggestionContextBuilder=a},getSuggestDataProvider:function(){return this._suggestDataProvider},getOptionsCfg:function(){return this._options},getSuggestDataModel:function(){return this._dataModelInstance},getCurrentSuggestionContext:function(){return this._currentSuggestionContext},init:function(){var a=this;this._suggestionContextInputEvent=this._addSuggestionContextInputSource();this.keyBoardSuggestionEvent=dj.lang.addLiveEvent(this._options.tooltipTargetClass,"keydown",function(b){a._keyboardSuggestionScroller(b,a._options.tooltipContainer)});this.pageBodyClickEvent=dj.lang.addLiveEvent("body","click",function(b){a._pageBodyClickHandler(b)});this._viewInstance.setViewContainer(this.getSuggestionsDisplayContainer());this._viewInstance.fetchViewTemplate();this.addViewEventListener(function(b,c,e){var d=a._dataModelInstance.getSuggestionContext();if(b==="LINE_ITEM_CLICK"){b=a._dataModelInstance.getCategoryLineItemData(c,e);a._suggestionSelectionHandlers.fire(d,b,c)}else if(b==="FOOTER_CLICK")a._footerClickHandlers.fire(d);else b==="CATEGORY_SUBHEADING2_CLICK"&&a._viewEventHandlers.fire(b,c,e)});this.subscribeToEvents();this._options.suggestOnInit===true&&this._getSuggestions(dojo.query(this._options.tooltipTargetClass))},_addSuggestionContextInputSource:function(){var a=this;return dj.lang.addLiveEvent(this._options.tooltipTargetClass,"keyup",function(b){b.keyCode===40||b.keyCode===38||b.keyCode===13||a._getSuggestions(this)})},_getSuggestions:function(a){this._currentSuggestionContext=a=this.buildSuggestionContext(a);this._dataModelInstance.updateSuggestionContext(a);if(a.searchText.length===0){this._hideView();this._clearSelectedSuggestion();this._clearDataModel()}else this._getData(a)},addSuggestionSelectionHandler:function(a){if(!dojo.isFunction(a))throw new TypeError("IllegalArgument: Expected an argument of type function");this._suggestionSelectionHandlers.subscribe(a,a)},removeSuggestionSelectionHandler:function(a){if(!dojo.isFunction(a))throw new TypeError("IllegalArgument: Expected an argument of type function");this._suggestionSelectionHandlers.unsubscribe(a)},addFooterClickHandler:function(a){if(!dojo.isFunction(a))throw new TypeError("IllegalArgument: Expected an argument of type function");this._footerClickHandlers.subscribe(a,a)},removeFooterClickHandler:function(a){if(!dojo.isFunction(a))throw new TypeError("IllegalArgument: Expected an argument of type function");this._footerClickHandlers.unsubscribe(a)},addEnterHandler:function(a){if(!dojo.isFunction(a))throw new TypeError("IllegalArgument: Expected an argument of type function");this._enterHandler.subscribe(a,a)},removeEnterHandler:function(a){if(!dojo.isFunction(a))throw new TypeError("IllegalArgument: Expected an argument of type function");this._enterHandler.unsubscribe(a)},addViewEventHandler:function(a){if(!dojo.isFunction(a))throw new TypeError("IllegalArgument: Expected an argument of type function");this._viewEventHandlers.subscribe(a,a)},removeViewEventHandler:function(a){if(!dojo.isFunction(a))throw new TypeError("IllegalArgument: Expected an argument of type function");this._viewEventHandlers.unsubscribe(a)},getSuggestionsDisplayContainer:function(){return this._suggestionsDisplayContainer===null?dojo.byId(this._options.tooltipContainer):this._suggestionsDisplayContainer},onSuggestModelChange:function(a,b,c){var e=a.getCategorySuggestions(c);a.isEmpty()?this._viewInstance.hide():this._viewInstance.show();this._clearSelectedSuggestion();this._viewInstance.populateCategoryData(b,e,c)},onSuggestSelectionChange:function(a){a.isSuggestionSelectionChangeEvent()&&this._viewInstance.highlightSuggestionAt(a.getSelectedCategoryIndex(),a.getSelectedCategoryLineItemIndex())},buildSuggestionContext:function(a){return this._suggestionContextBuilder===null?{searchText:a.value}:this._suggestionContextBuilder(a.value)},_clearDataModel:function(){this._dataModelInstance.clear()},_hideView:function(){this._viewInstance.hide()},_getData:function(a){var b=this;this._lastDataDetchCallId!==null&&clearTimeout(this._lastDataDetchCallId);this._lastDataDetchCallId=setTimeout(function(){b._suggestDataProvider.getSuggestData(a)},this._cfg.dataFetchDelayMilliSeconds)},_keyboardSuggestionScroller:function(a,b){if(a.keyCode===13)this._enterHandler.fire();else if(a.keyCode===38)this._dataModelInstance.selectPreviousSuggestion(this._viewInstance._suggestDisplayModel,parseInt(c));else if(a.keyCode===40){for(var c=0,e=0;e<dojo.query(".suggestionblock",b).length;e++)if(!dojo.hasClass(dojo.query(".suggestionblock")[e],"hidden")){lineItem=dojo.query(".suggestionblock")[e];c=lineItem.getAttribute("categoryIndex");break}this._dataModelInstance.selectNextSuggestion(this._viewInstance._suggestDisplayModel,parseInt(c))}},_pageBodyClickHandler:function(a){this._viewInstance.isHidden()||dj.util.Element.contains(dojo.query(this._options.tooltipTargetClass)[0],a.clientX,a.clientY)||this._viewInstance.hide()},addViewEventListener:function(a){if(!dojo.isFunction(a))throw new TypeError("IllegalArgument: Expected an argument of type function");this._suggestViewEventListeners.subscribe(a,a)},removeViewEventListener:function(a){if(!dojo.isFunction(a))throw new TypeError("IllegalArgument: Expected an argument of type function");this._suggestViewEventListeners.unsubscribe(a)},_fireViewEvents:function(a,b){var c=parseInt(b.getAttribute("categoryIndex"),10);c=isNaN(c)?-1:c;var e=parseInt(b.getAttribute("categoryItemIndex"),10);e=isNaN(e)?-1:e;this._suggestViewEventListeners.fire(a,c,e)},subscribeToEvents:function(){var a=this._viewInstance.getViewContainer().id,b="li";if(dojo.query("li.lineItem",a).length>0)b="li.lineItem";b="div[id="+a+"] * "+b;var c=this;this.lineItemClickEvent=this.djLang.addLiveEvent(b,"click",function(){c._selectSuggestion(this);c._fireViewEvents("LINE_ITEM_CLICK",this)});this.lineItemMouseOverEvent=this.djLang.addLiveEvent(b,"mouseover",function(){c._selectSuggestion(this);c._fireViewEvents("LINE_ITEM_MOUSEOVER",this)});b="div.footer";b=dojo.query("div.footer",a).length>0?"div.footer":"div.acFooter";this.footerClickEvent=this.djLang.addLiveEvent("div[id="+a+"] * "+b,"click",function(){c._fireViewEvents("FOOTER_CLICK",this)});this.categorySubheadingClickEvent=this.djLang.addLiveEvent("div[id="+a+"] * div.subHeading2","click",function(){c._fireViewEvents("CATEGORY_SUBHEADING2_CLICK",this)})},_selectSuggestion:function(a){var b=parseInt(a.getAttribute("categoryIndex"),10);b=isNaN(b)?-1:b;a=parseInt(a.getAttribute("categoryItemIndex"),10);a=isNaN(a)?-1:a;this._dataModelInstance.selectSuggestion(b,a)},_clearSelectedSuggestion:function(){this._viewInstance.clearSelection();this._dataModelInstance.clearSelection()},close:function(){this._hideView();this._clearDataModel()},destroy:function(){dj.lang.removeLiveEvent(this._suggestionContextInputEvent);dj.lang.removeLiveEvent(this.keyBoardSuggestionEvent);dj.lang.removeLiveEvent(this.pageBodyClickEvent);dj.lang.removeLiveEvent(this.lineItemClickEvent);dj.lang.removeLiveEvent(this.lineItemMouseOverEvent);dj.lang.removeLiveEvent(this.footerClickEvent);dj.lang.removeLiveEvent(this.categorySubheadingClickEvent);this._suggestionContextInputEvent=null;this.close();this._suggestionsDisplayContainer=null},detach:function(){dj.lang.removeLiveEvent(this._suggestionContextInputEvent);this._suggestionContextInputEvent=null;this.close();this._viewInstance.detach();this._suggestionsDisplayContainer=null},attach:function(a){this._options=dj.lang.cloneMixin(this._options,a);this._viewInstance.setViewContainer(this.getSuggestionsDisplayContainer());this._viewInstance.attach();this._suggestionContextInputEvent=this._addSuggestionContextInputSource()}};dojo.provide("dj.module.ep.globalheader.wsjAutocomplete");dojo.require("dj.lang");dj.module.ep.globalheader.wsjAutocomplete=function(a,b,c,e){this.clearOnFirstClickEvent=this.autoCompleteInitEvent=null;this._inputField=a||"globalHeaderSearchInput";this._activationField=a||"searchBlingBox";var d=this;this._searchContext=dojo.mixin({searchType:"",industryQuery:"",selectedIndustry:"",selectedIndustryName:""},e);this.autoCompleteInitializer=function(){dojo.require("dj.widget.autocomplete.AutoComplete");dojo.require("dj.widget.autocomplete.LandingPageGenerator");dojo.require("dj.widget.autocomplete.provider.MWatchWSJHatSearchProvider");dojo.require("dj.widget.autocomplete.RemoteSuggestDataProvider");var g=dojo.mixin({tooltipTargetClass:'input[id="globalHeaderSearchInput"][class~="hdrSearchInput"]',tooltipContainer:"globalHeaderAutoComplete",tooltipContainerClass:"div[id='globalHeaderAutoComplete'][class~='hdrSearchList']",suggestProvider:undefined,companyResearchBaseUrl:"quotes.f.dev.wsj.com",product:"WSJ"},b),l=g.suggestProvider===undefined||g.suggestProvider===null?false:true,m=dojo.mixin({FooterVisible:true,templateNodeSelector:"#wsj_autocomplete_template",Footer:"View All Search Results &raquo;",categoryTypeArr:["FEATURES","COMPANIES","TOPICS","KEYWORDS"],CategoryDisplayConfigs:[{subHeading1:"COMPANIES",subHeading2:"See all symbol results for ",noOfColumns:6,columnToObjMap:["ticker","company","country","exchange","exchangeIsoCode","type"],subHeading1DisplayFlag:true,subHeading2DisplayFlag:false,name:"companies",maxNoOfSuggestionsToDisplay:5,subHeading1Class:"hdrSearchListComp",noOfColumnsToObjMap:6},{subHeading1:"Recent Searches",subHeading2:"",noOfColumns:1,columnToObjMap:["keyword"],subHeading1DisplayFlag:true,name:"keywords",maxNoOfSuggestionsToDisplay:3,subHeading1Class:"hdrSearchListRecent",noOfColumnsToObjMap:1}]},c),j=new dj.widget.autocomplete.AutoComplete(null,g,m),k=function(f,h,o,p){h=new dj.widget.autocomplete.LandingPageGenerator(m,f,h);p=="FOOTER_CLICK"?h.doKeyWordSearch(f.searchtext):h.goToQuotesPage(true)},n={};if(l){console.debug("Setting suggestProvider to: %o",g.suggestProvider);n=dj.widget.autocomplete.provider[g.suggestProvider](j,m)}else n=dj.widget.autocomplete.provider.MWatchWSJHatSearchProvider(j,m);j.setSuggestDataProvider(n);j.addSuggestionSelectionHandler(function(f,h,o){if(l)n.selectHandlers[o]===null||n.selectHandlers[o]===undefined||n.selectHandlers[o]===-1?k(f,h,o):n.selectHandlers[o](f,h);else k(f,h,o)});j.addFooterClickHandler(function(f){k(f,undefined,undefined,"FOOTER_CLICK")});j.addEnterHandler(function(){t()});j.init();d.clearOnFirstClickEvent=dj.lang.addLiveEvent("#"+d._inputField,"click",function(){var f=dojo.byId(d._inputField);if(dojo.hasClass(f,"unUsed")||dojo.hasClass(f,"searchWsj")){dojo.removeClass(f,"unUsed");dojo.removeClass(f,"searchWsj");if(f.value)f.value=""}for(var h=dojo.query(".searchHover",g.tooltipContainer),o=0;o<h.length;o++)dojo.removeClass(h[o],"searchHover")});d.resetSearchBox=function(){var f=dojo.byId(d._inputField);if(dojo.trim(f.value)===""){dojo.removeClass(f,"searchWsj");dojo.addClass(f,"unUsed");f.value="News, Quotes, Companies, Videos"}};var t=function(){var f=j.getSuggestDataModel(),h=f.getSuggestionContext(),o=f.getSelectedSuggestionIndices().ctgIndex;if(l)if(n.selectHandlers[o]===null||n.selectHandlers[o]===undefined||n.selectHandlers[o]===-1)f.hasSelectedSuggestion()?k(h,f.getSelectedSuggestion(),o):k(h);else n.selectHandlers[o](h,f.getSelectedSuggestion())};dj.lang.addLiveEvent(".hdrSearchBtn","click",t);dojo.disconnect(d.autoCompleteInitEvent)};dojo.removeClass(dojo.byId("searchBlingBox"),"hidden");this.autoCompleteInitEvent=dojo.connect(dojo.byId(this._activationField),"mouseover",this.autoCompleteInitializer);dojo.addOnLoad(function(){})};dojo.provide("dj.util.date.timestamp");
dojo.require("dj.util.Element");
dojo.require("dojo.date");
dojo.require("dojo.date.locale");
dojo.require("dj.util.Region");

dj.util.date.timestamp = {
  scan : function() {
    var dt = dj.util.date.timestamp;
    dt.calculateDate();
    setTimeout(dj.util.date.timestamp.scan, 60000, null);
  },

  scanWithinContainer : function(container) {
    this.calculateDate(container);
  },

  calculateDate : function(container) {
    var dt = dj.util.date.timestamp;
    var browserDate = new Date();

    var query = "[data-widget='dj.timestamp']";
    var queryString = (typeof container === 'undefined' || container == null) ? query : container + " " + query;
    dojo.query(queryString).forEach(function(object, index) {
      var date = dj.util.Element.getData(object, "major-date");
      if( date != null && date != undefined) {
    	  var regionVal = dj.util.Region.getViewByRegion();
    	  var outputDate = '';
    	  if(regionVal != null && regionVal != undefined &&  regionVal.toLowerCase() === 'germany') {
    		  outputDate = dt.prettyDateGermany(date, browserDate);
    	  } else if(regionVal != null && regionVal != undefined &&  regionVal.toLowerCase() === 'asia,jp') {
          outputDate = dt.prettyDateJapan(date, browserDate);
        } else {
    		  outputDate = dt.prettyDate(date, browserDate);
    	  }

          if(outputDate.color) {
            dojo.addClass(object, "time-rel");
          } else {
            dojo.removeClass(object, "time-rel");
          }
          if(typeof outputDate.text != 'undefined' && outputDate.text != '') {
            object.innerHTML = "&nbsp;" + outputDate.text;
          }
      }
    });
  },

  prettyDate : function(utcStringTime, browserDate) {
    var date = new Date(utcStringTime || ""); 
    var diff = dojo.date.difference(date, browserDate, "second");

    var result  = (diff > -1 && diff < 120 && {text:"1 min ago", color: true}
            || diff >= 120 && diff < 3600 && {text: Math.floor(diff / 60) + " min ago", color: true}
            || diff > 3599 && diff < 7200 && {text:dojo.date.locale.format(date, {selector:"time", timePattern:"h:mm a"}), color: false}
            || diff > 7200 && {text: "", color: false});
    
    if(result) {
      return result;
    } else {
      return {text:"", color: false};
    }
  },

  prettyDateGermany : function(utcStringTime, browserDate) {
	    var date = new Date(utcStringTime || "");
	    var diff = dojo.date.difference(date, browserDate, "second");

	    var result  = (diff > -1 && diff < 120 && {text:"vor 1 Min.", color: true}
	            || diff >= 120 && diff < 3600 && {text: "vor " +Math.floor(diff / 60) + " Min.", color: true}
	            || diff > 3599 && diff < 7200 && {text:dojo.date.locale.format(date, {selector:"time", timePattern:"HH:mm 'Uhr'"}), color: false}
	            || diff > 7200 && {text: "", color: false});
	    if(result) {
	      return result;
	    } else {
	      return {text:"", color: false};
	    }
  },

  prettyDateJapan : function(utcStringTime, browserDate) {
    var majorPubDate = new Date(utcStringTime || "");
    var diff = dojo.date.difference(majorPubDate,browserDate,"second");
       
      //use JST to display on the page
      var utc = majorPubDate.getTime() + (majorPubDate.getTimezoneOffset() * 60000);
      var utcOffset = 9;
      var japanDate = new Date(utc + (3600000*utcOffset));       
      
      var majorPubDateMonth = japanDate.getMonth() + 1;
      var majorPubDateDt = japanDate.getDate();
      
      var result  = (diff > -1 && diff < 120 && {text:"1 &#20998;&#21069;", color: true}
              || diff >= 120 && diff < 3600 && {text: Math.floor(diff / 60) + " &#20998;&#21069;", color: true}
              || diff > 3599 && diff < 7200 && {text:dojo.date.locale.format(japanDate, {selector:"time", timePattern:"HH:mm 'JST'"}), color: false}
              || diff > 7200 && diff < 86400 && {text: '('+majorPubDateMonth+'/'+majorPubDateDt+')', color: false}              
              || diff > 86400 && {text: "", color: false});
      
      if(result) {
        return result;
      } else {
        return {text:"", color: false};
      }
  }
};

hat={init:function(){this.currId=this.getSelectedProduct();this.partyHatMoreDropdown=document.getElementById("partyhat_more_dropdown");this.oHatFBButton=document.getElementById("hat_fb_button");this.oHatTwtButton=document.getElementById("hat_twt_button");if(window.addEventListener){this.partyHatMoreDropdown.addEventListener("click",this.moredropdown,false);typeof this.oHatFBButton!=="undefined"&&this.oHatFBButton&&this.oHatFBButton.addEventListener("click",this.showFacebookOverlay,false);window.addEventListener("click",this.hideOverlays,false);typeof this.oHatTwtButton!=="undefined"&&this.oHatTwtButton&&this.oHatTwtButton.addEventListener("click",this.showTwitterOverlay,false)}else{this.partyHatMoreDropdown.attachEvent("onclick",this.moredropdown);typeof this.oHatFBButton!=="undefined"&&this.oHatFBButton&&this.oHatFBButton.attachEvent("onclick",this.showFacebookOverlay);document.attachEvent("onclick",this.hideOverlays);typeof this.oHatTwtButton!=="undefined"&&this.oHatTwtButton&&this.oHatTwtButton.attachEvent("onclick",this.showTwitterOverlay)}},moredropdown:function(a){hat.hideFacebookOverlay();hat.hideTwitterOverlay();var b=hat.partyHatMoreDropdown.parentNode;if(b.className.match(/hat_dd_selected/))b.className=b.className.replace("hat_dd_selected","");else b.className+=" hat_dd_selected";hat.StopEvent(a)},hideMoreDropdown:function(){var a=hat.partyHatMoreDropdown.parentNode;if(a.className.match(/hat_dd_selected/))a.className=a.className.replace("hat_dd_selected","")},facebookURL:function(){return this.currId.match(/wsj_asia/)?"wsjasia, WSJAsia on Facebook":this.currId.match(/wsj_india/)?"wsjindia, WSJ India on Facebook":this.currId.match(/wsj_gm/)?"pages/The-Wall-Street-Journal-Deutschland/111293262305204, WSJDeutschland auf Facebook,de_DE":this.currId.match(/wsj_eu/)?"pages/The-Wall-Street-Journal-Europe/124739154250536, WSJEurope on Facebook":this.currId.match(/wsjpro_eu/)?"pages/The-Wall-Street-Journal-Europe/124739154250536, WSJEurope on Facebook":this.currId.match(/wsjpro_asia/)?"wsjasia, WSJAsia on Facebook":this.currId.match(/wsj_classroom/)?"wsjclassroom, WSJclassroom on Facebook":this.currId.match(/wsj_kp/)?"pages/WSJ-Korea/273852312731478, WSJ\ud55c\uad6d on Facebook,ko_KR":this.currId.match(/wsj_jp/)?"pages/WSJ-Japan/308413537545,WSJ \u65e5\u672c\u7248\u306eFacebook\u30da\u30fc\u30b8,ja_JP":this.currId.match(/wsj_id/)?"WSJIndonesia, WSJIndonesia on Facebook":this.currId.match(/wsj_br/)?"wsj, WSJPortugues on Facebook":this.currId.match(/wsj_lat/)?"wsj, WSJAmericas on Facebook":this.currId.match(/wsj_tr/)?"wsjturkiye, WSJTurkey on Facebook,tr_TR":this.currId.match(/wsj/)?"wsj, WSJ on Facebook":this.currId.match(/bol/)?"barronsonline, Barron's on Facebook":this.currId.match(/mw/)?"marketwatch, Marketwatch on Facebook":this.currId.match(/sm/)?"SmartMoney, SmartMoney on Facebook":this.currId.match(/atd/)?"allthingsd, AllThingsD on Facebook":this.currId.match(/fins/)?"FINSfinancecareers,FINS Finance on Facebook|FINStechcareers,FINS Technology on Facebook|FINSsalesmarketingcareers,FINS Sales & Marketing on Facebook":this.currId.match(/fact/)?"DJFactiva,Factiva on Facebook":this.currId.match(/live/)?"wsjlive,WSJLive on Facebook":"wsj, WSJ on Facebook"},showFacebookOverlay:function(a){hat.hideOverlays();this.oHatFBLikeOverlay=document.getElementById("fb_like_overlay");this.oHatFBLikeOverlay.className="hat_overlay hat_overlay_fb";if(!window.frames.facebook_iframe){var b=hat.facebookURL().split("|");fbULEle=document.createElement("ul");for(var c=0;c<b.length;c++){var d=b[c].split(","),e=hat.createLIElement(d[1],"hat_fb_icon");d=hat.createIFRAMEElement("facebook_iframe",d[2]?"http://www.facebook.com/plugins/like.php?href=http://www.facebook.com/"+d[0]+"&action=recommend&layout=button_count&send=false&show_faces=false&width=90&locale="+d[2]:"http://www.facebook.com/plugins/like.php?href=http://www.facebook.com/"+d[0]+"&action=recommend&layout=button_count&send=false&show_faces=false&width=90",200,21);e.appendChild(d);fbULEle.appendChild(e)}this.oHatFBLikeOverlay.appendChild(fbULEle)}hat.StopEvent(a)},createLIElement:function(a,b){var c=document.createElement("li");h4Ele=document.createElement("h4");c.appendChild(h4Ele);SpanEle=document.createElement("span");SpanEle.className="icon";SpanEle.setAttribute("id",b);h4Ele.appendChild(SpanEle);strNode=document.createTextNode(a);h4Ele.appendChild(strNode);return c},createIFRAMEElement:function(a,b,c,d){var e=document.createElement("IFRAME");e.setAttribute("name",a);e.setAttribute("id",a);e.setAttribute("src",b);e.setAttribute("frameBorder",0);e.style.width=c+"px";e.setAttribute("allowtransparency","true");e.setAttribute("scrolling","no");e.style.height=d+"px";return e},hideFacebookOverlay:function(){this.oHatFBLikeOverlay=document.getElementById("fb_like_overlay");if(typeof this.oHatFBLikeOverlay!=="undefined"&&this.oHatFBLikeOverlay)this.oHatFBLikeOverlay.className="hat_overlay hat_overlay_fb hidden"},twitterURL:function(){return this.currId.match(/wsj_eu/)?"wsjeurope, WSJEurope on Twitter":this.currId.match(/wsj_india/)?"wsjindia, WSJ India on Twitter":this.currId.match(/wsj_gm/)?"WSJDeutschland, WSJDeutschland auf Twitter,de":this.currId.match(/wsjpro_eu/)?"wsjeurope, WSJEurope on Twitter":this.currId.match(/wsjpro_asia/)?"wsjasia, WSJAsia on Twitter":this.currId.match(/wsj_classroom/)?"wsjclassroom, WSJclassroom on Twitter":this.currId.match(/wsj_pro/)?"wsj, WSJ on Twitter":this.currId.match(/wsj_jp/)?"WSJJapan, WSJ \u65e5\u672c\u7248\u3092Twitter\u3067\u30d5\u30a9\u30ed\u30fc\u3059\u308b,ja":this.currId.match(/wsj_ch/)?"wsjchina, WSJChina on Twitter":this.currId.match(/wsj_asia/)?"wsjasia, WSJAsia on Twitter":this.currId.match(/wsj_kp/)?"wsjkorea1,  WSJ\ud55c\uad6d on Twitter,ko":this.currId.match(/wsj_id/)?"wsjindonesia, WSJIndonesia on Twitter":this.currId.match(/wsj_sp/)?"WSJAmericas, WSJAmericas on Twitter":this.currId.match(/wsj_br/)?"WSJPortugues, WSJPortugues on Twitter":this.currId.match(/wsj_lat/)?"WSJAmericas, WSJAmericas on Twitter":this.currId.match(/wsj_tr/)?"TheWSJTurkiye, WSJTurkiye on Twitter,tr":this.currId.match(/wsj/)?"wsj, WSJ on Twitter":this.currId.match(/bol/)?"barronsonline, Barron's on Twitter":this.currId.match(/mw/)?"MarketWatch, MarketWatch on Twitter":this.currId.match(/sm/)?"SmartMoney, SmartMoney on Twitter":this.currId.match(/atd/)?"allthingsd, AllThingsD on Twitter":this.currId.match(/fins/)?"FINSider,FINS Finance Careers on Twitter|techFINSider,FINS Technology Careers on Twitter|salesFINSider,FINS Sales Careers on Twitter":this.currId.match(/fact/)?"factiva,Factiva on Twitter":this.currId.match(/live/)?"WSJVideo,WSJVideo on Twitter":"wsj, WSJ on Twitter"},showTwitterOverlay:function(a){hat.hideOverlays();this.oHatTwtLikeOverlay=document.getElementById("twitter_overlay");this.oHatTwtLikeOverlay.className="hat_overlay hat_overlay_twitter";if(!window.frames.twitter_iframe){var b=hat.twitterURL().split("|");twULEle=document.createElement("ul");for(var c=0;c<b.length;c++){var d=b[c].split(","),e=hat.createLIElement(d[1],"hat_twt_icon");d=d[2]?"http://platform.twitter.com/widgets/follow_button.html?screen_name="+d[0]+"&show_count=true&show_screen_name=true&lang="+d[2]:"http://platform.twitter.com/widgets/follow_button.html?screen_name="+
d[0]+"&show_count=true&show_screen_name=true";var f=hat.createIFRAMEElement("twitter_iframe",d,250,21);f.setAttribute("src",d);e.appendChild(f);twULEle.appendChild(e)}this.oHatTwtLikeOverlay.appendChild(twULEle)}hat.StopEvent(a)},hideTwitterOverlay:function(){this.oHatTwtLikeOverlay=document.getElementById("twitter_overlay");if(typeof this.oHatTwtLikeOverlay!=="undefined"&&this.oHatTwtLikeOverlay)this.oHatTwtLikeOverlay.className="hat_overlay hat_overlay_twitter hidden"},getSelectedProduct:function(){var a=document.getElementById("hattabs").children;for(i=0;i<a.length;i++)if(a[i].className.match(/current/))return a[i].id;return"hat_tab_wsj"},StopEvent:function(a){if(!a)if(window.event)a=window.event;else return;if(a.cancelBubble!=null)a.cancelBubble=true;a.stopPropagation&&a.stopPropagation();a.preventDefault&&a.preventDefault();if(window.event)a.returnValue=false;if(a.cancel!=null)a.cancel=true},hideOverlays:function(){hat.hideFacebookOverlay();hat.hideTwitterOverlay();hat.hideMoreDropdown()}};hat.init();dojo.provide("dj.widget.networkHat.infocomplete");function InfoComplete(){this.autoComplete=this.dataSource=null;this.count=0;this.allowexchanges=this.allowsymboltypes=this.allowcountries=this.domain="";this.currentQueryHasResultMatch=false;this.lastExactResult="";this.exactMatches=[];this.lastExactMatchResultSet=[];this.keyword=this.symbol=null}function autoCompleteTrim(a){return a.replace(/^\s*(\S*(\s+\S+)*)\s*$/,"$1")}
InfoComplete.prototype.Setup=function(a){var b,c;if(!(typeof a=="undefined"||a===null)){b=0;for(c=a.sections.length;b<c;b++){var d=a.sections[b].dataSource.server;if(typeof d=="undefined"||d===null||d==="")return}document.getElementsByTagName("BODY");this.count=a.count;this.dataSource=[];b=0;for(c=a.sections.length;b<c;b++){d=a.sections[b];if(d.type=="keyword")this.keyword=b;else if(d.type=="symbol")this.symbol=b;var e=new YAHOO.widget.DS_XHR(d.dataSource.server,d.dataSource.schema);e.responseType=d.dataSource.responseType;e.scriptQueryAppend=d.dataSource.scriptQueryAppend;e.index=b;e.dataErrorEvent.subscribe(this.handleError,e);this.dataSource[b]=e}this.autoComplete=new YAHOO.widget.MultiAutoComplete(a.inputId,a.containerId,this.dataSource);this.count=a.count;this.autoComplete.autoHighlight=false;this.autoComplete.maxResultsDisplayed=a.count;this.autoComplete.queryDelay=a.delay;this.autoComplete.allowBrowserAutocomplete=false;this.autoComplete.typeAhead=true;this.autoComplete.animVert=false;this.autoComplete.animHoriz=false;this.autoComplete.delimChar=",";this.autoComplete.setHeader('Choose a quote match or "GO" to get quote news');this.autoComplete.setFooter("Separate multiple symbols with commas (,)");this.autoComplete.formatResult=function(f,k,p){return a.sections[p].formatFunc(f,k,p,this)};this.autoComplete.dataReturnEvent.subscribe(this.checkResultsForExactMatch,this.autoComplete,this);this.autoComplete.textboxKeyEvent.subscribe(this.checkPastExactResults,this.autoComplete,this)}};InfoComplete.prototype.getFirstDelimChar=function(){if(this.autoComplete.delimChar&&this.autoComplete.delimChar.length>0)return this.autoComplete.delimChar[0];return""};InfoComplete.prototype.isSymbolMatch=function(){var a=this.getFirstDelimChar();if(this.currentQueryHasResultMatch===true&&this.lastExactResult.toUpperCase()==autoCompleteTrim(this.autoComplete._oTextbox.value).replace(/,$|\.,$/,"").toUpperCase())return true;a=this.autoComplete._oTextbox.value.split(a);for(var b=0;b<this.exactMatches.length;b++)for(var c=0;c<a.length;c++)if(this.exactMatches[b]==a[c])return true;return this.doesListHaveMatch(0)};InfoComplete.prototype.handleError=function(a,b){var c=b[1];c._populateStaging&&c._populateStaging("null",null,c,b[0].index)};InfoComplete.prototype.checkPastExactResults=function(a,b){if("function"==typeof this.getFirstDelimChar){var c=this.getFirstDelimChar();if(b[0]._oTextbox.value.length>0&&b[0]._oTextbox.value.lastIndexOf(c)==b[0]._oTextbox.value.length-1&&this.currentQueryHasResultMatch){if(this.exactMatches.length>0)for(c=0;c<this.exactMatches.length;c++)if(this.exactMatches[c]==this.lastExactResult)return;this.exactMatches.push(this.lastExactResult);this.lastExactMatchResultSet.push(this.getLastMatchResultset(0,this.lastExactResult))}}};InfoComplete.prototype.checkResultsForExactMatch=function(a,b){if(!(!b||b.length<4||b[3]>0)){var c=this.getFirstDelimChar(),d=b[2],e=b[0]._oTextbox.value;if(e.indexOf(c)>0){e=e.split(c);e=autoCompleteTrim(e[e.length-1])}if(d&&d.length>0)for(c=0;c<d.length;c++)if(d[c]&&d[c][0]!==null){var f=d[c][0];if(e.toUpperCase()==f.toUpperCase()){this.currentQueryHasResultMatch=true;this.lastExactResult=e;return}}this.currentQueryHasResultMatch=false}};InfoComplete.prototype.doesListHaveMatch=function(a){var b=this.getFirstDelimChar(),c=this.autoComplete.getListItems(),d=autoCompleteTrim(this.autoComplete._oTextbox.value).replace(/,$|\.,$/,"");if(d.indexOf(b)>0){d=d.split(b);d=autoCompleteTrim(d[d.length-1])}if(a<c.length){a=c[a];for(c=0;c<a.length;c++)if(a[c]&&a[c]._oResultData)if(d.toUpperCase()==a[c]._oResultData[0].toUpperCase())return true}return false};InfoComplete.prototype.getLastMatchResultset=function(a,b){var c=this.getFirstDelimChar(),d=this.autoComplete.getListItems();if(b.indexOf(c)>0){c=b.split(c);b=autoCompleteTrim(c[c.length-1])}if(a<d.length){d=d[a];for(c=0;c<d.length;c++)if(d[c]&&d[c]._oResultData)if(b.toUpperCase()==d[c]._oResultData[0].toUpperCase())return d[c]._oResultData}return null};function param(){this.array=Array(1);this.setValue=function(a){this.array[0]=a};this.getValue=function(){return this.array[0]}}
function InstallLibrary(a){a=a||window;a.symbolComplete=new InfoComplete;a.InfoComplete=new InfoComplete}InstallLibrary();dojo.provide("dj.widget.networkHat.RCLogin");dojo.require("dj.util.queryParam");dojo.require("dj.util.Cookie");dj.widget.networkHat.RCLogin={init:function(a){this._cfg=dojo.mixin(this.DEFAULT_CONFIG,a);this.pageLoaded()},DEFAULT_CONFIG:{loginInfoDiv:"riskComplianceLogInInfoDivId",loginInfoClose:".riskComplianceLogInClose",riskTabInHat:"hat_tab_risk",hatTabWithRiskSelected:"hat_div",cookie:{name:"RnC",on:"1",off:"0",ttl:365}},pageLoaded:function(){dojo.addClass(dojo.byId(this._cfg.hatTabWithRiskSelected),"RiskLogIn");if(!this.isCookieSet()){this.showMarketingDialog();dojo.query(this._cfg.loginInfoClose).connect("click",this,function(){this.closeMarketingDialog()})}},showMarketingDialog:function(){dojo.removeClass(dojo.byId(this._cfg.loginInfoDiv),"hidden")},closeMarketingDialog:function(){dojo.addClass(dojo.byId(this._cfg.loginInfoDiv),"hidden");this.dropCookie()},isCookieSet:function(){var a=this._cfg.cookie;return dj.util.Cookie.getGroupCookie("DJCOOKIE",a.name)===a.on},dropCookie:function(){var a=this._cfg.cookie;dj.util.Cookie.setGroupCookie("DJCOOKIE",a.name,a.on,a.ttl)}};dojo.provide("dj.widget.networkHat.AutoComplete");dojo.require("dj.widget.networkHat.infocomplete");dojo.require("dj.lang");dojo.getObject("dj.context.networkHat",true);(function(){var a=dj.widget.networkHat;(a.AutoComplete=function(){this.d=document;this.cdnDomain=dj.context.core.cdnPrefix;this.uP="";if(typeof uP!="undefined")this.uP=uP;var b=new Date;b=""+b.getFullYear()+(b.getMonth()+1)+b.getDate();this.jScript=this.d.location.host.indexOf("s.dev")!=-1||this.d.location.host.indexOf("idev")!=-1?this.uP+"/djscript/j_networkHat-"+b+".js":this.cdnDomain+"/djscript/j_networkHat-"+b+".js";this.d.getElementsByTagName("div")[0].className.indexOf("subType-subscribed");this.inputDefaultText="News, Quotes, Companies, Videos";if(dj.autocompletesearch!==undefined&&dj.autocompletesearch.inputDefaultText!==undefined)this.inputDefaultText=dj.autocompletesearch.inputDefaultText;b=dojo.byId("hat_div");this.oHatInput=dojo.byId("hat_input_auto");dojo.query(".hat_select",b);if(dojo.isIE&&(this.d.domain.indexOf("ds.sat.wsj.com")!=-1||this.d.domain.indexOf("ds.wsj.com")!=-1))dj.util.Url.addStylesheet("http://s.wsj.net/css/hatIEPortfolio.css");this.onfocusLoad=dojo.connect(this.oHatInput,"onfocus",this,this.onHatLoad);this.onmouseoverLoad=dojo.connect(this.oHatInput,"onmouseover",this,this.onHatLoad);this.onclickClear=dojo.connect(this.oHatInput,"onclick",this,this.clearField);this.onkeydownClear=dojo.connect(this.oHatInput,"onkeydown",this,this.clearField);if(this.oHatInput.value!==""&&this.oHatInput.value!=this.inputDefaultText||dj.context.networkHat.jnetworkHatJsLoaded)this.onHatLoad();this.setFieldDefault()}).prototype={setFieldDefault:function(){if(this.oHatInput.value===""){this.oHatInput.value=this.inputDefaultText;dojo.addClass(this.oHatInput,"unUsed")}},clearField:function(){this.stopObservingClick();if(dojo.hasClass(this.oHatInput,"unUsed"))this.oHatInput.value="";dojo.removeClass(this.oHatInput,"unUsed")},stopObservingClick:function(){dojo.disconnect(this.onclickClear);dojo.disconnect(this.onkeydownClear)},onHatLoad:function(){dojo.disconnect(this.onfocusLoad);dojo.disconnect(this.onmouseoverLoad);if(dj.context.networkHat.jnetworkHatJsLoaded)this.initInfoComplete();else{var b;if(!this.d.getElementsByTagName("head")){b=new Element("head");this.d.getElementsByTagName("body")[0].appendChild(b)}this.jsNode=this.loadAutoCompleteScript(this.jScript)}},loadAutoCompleteScript:function(b){var c=this.d.createElement("script");c.type="text/javascript";c.src=b;if(this.d.getElementsByTagName("head").length===0){b=this.d.createElement("head");this.d.getElementsByTagName("html")[0].appendChild(b)}this.d.getElementsByTagName("head")[0].appendChild(c);return c},initInfoComplete:function(){if(dojo.isIE&&(this.d.domain.indexOf("ds.sat.wsj.com")!=-1||this.d.domain.indexOf("ds.wsj.com")!=-1))dj.util.Url.addStylesheet("http://s.wsj.net/css/hatIEPortfolio.css");initInfoCompleteNew();this.stopObservingClick();dojo.connect(this.oHatInput,"onfocus",null,function(){this.style.backgroundImage="url('http://s.wsj.net/img/b.gif')";searchFieldOnFocus(this);setFocused(this)});dojo.connect(this.oHatInput,"onkeypress",null,function(){showHideCRDrpdwn("hide")});dojo.connect(this.oHatInput,"onblur",null,function(){showHideCRDrpdwn("show")});var b=this.oHatInput.value;if(InfoComplete.autoComplete.dataSources&&InfoComplete.autoComplete.dataSources.length>=2)InfoComplete.autoComplete.dataSources[InfoComplete.keyword].scriptQueryParam="query";b&&b!=this.inputDefaultText&&InfoComplete.autoComplete.sendQuery(b)}}})();dojo.provide("dj.widget.networkHat.FactivaLogin");dojo.require("dj.util.queryParam");dojo.require("dj.util.Cookie");dojo.require("dj.util.User");dj.widget.networkHat.FactivaLogin={init:function(a,b){function c(f,k){dojo.byId(f).href=k}var d=dj.util.queryParam.getQueryStrParams(),e=this.CONFIG=dojo.mixin({useridemail:function(f,k){dojo.byId(f).value=k},regurl:c,forgoturl:c,enableurl:c,loginurl:function(f,k){dojo.byId(f).action=k},getFactivaOpen:"factivaLogInGet",getFactivaClose:"factivaLogInClose",getFactivaPopout:"factivaLogInInfo",twitterAndFacebook:false,cookie:{name:"FLMD",on:"1",off:"0",ttl:365},weekend:{hideContentBucket:"#headerContentBucket",showContentBucket:"#headerContentBucket_factiva",qualifier:"pageType-weekend"}},a);for(id in d)e[id]&&e[id](id,d[id]);dojo.connect(dojo.byId(e.getFactivaClose),"click",this,function(f){dojo.stopEvent(f);this.closeMarketingDialog()});if(e.twitterAndFacebook){dojo.require("dj.widget.networkHat.hat");hat.init()}this.isCookieSet()||this.showMarketingDialog();typeof b!=="undefined"&&b!==null&&this.inDateRange(b)&&dj.util.User.isLoggedIn(dojo.hitch(this,function(f){f&&this.switchWeekendContentBucket()}))},showMarketingDialog:function(){dojo.removeClass(dojo.byId(this.CONFIG.getFactivaPopout),"hidden")},closeMarketingDialog:function(){dojo.addClass(dojo.byId(this.CONFIG.getFactivaPopout),"hidden");this.dropCookie()},isCookieSet:function(){var a=this.CONFIG.cookie;return dj.util.Cookie.getGroupCookie("DJCOOKIE",a.name)===a.on},dropCookie:function(){var a=this.CONFIG.cookie;dj.util.Cookie.setGroupCookie("DJCOOKIE",a.name,a.on,a.ttl)},switchWeekendContentBucket:function(){var a=this.CONFIG.weekend;dojo.query(a.hideContentBucket).forEach(function(b){dojo.addClass(b,"hidden")});dojo.query(a.showContentBucket).forEach(function(b){dojo.removeClass(b,"hidden")})},inDateRange:function(a){if(typeof serverTime==="undefined"||serverTime===null)serverTime=new Date;var b=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"][serverTime.getDay()];a=a.split(",");for(var c=0,d=a.length;c<d;c++){var e=a[c];if(e===b)return true;else{var f=e.split("-");if(f[0]===b){e=f.length<2||f[1]===""?0:parseInt(f[1],10);f=f.length<3||f[2]===""?2359:parseInt(f[2],10);var k=serverTime.getHours(),p=serverTime.getMinutes();k=parseInt("".concat(k).concat((p<10?"0":"")+p),10);if(k<=f&&k>=e)return true}}}return false}};
dojo.provide("dj.module.massrel.massrel");(function(){var a,b,c;(function(d){function j(a,b){if(a&&a.charAt(0)==="."&&b){b=b.split("/"),b=b.slice(0,b.length-1),a=b.concat(a.split("/"));var c,d;for(c=0;d=a[c];c++)if(d===".")a.splice(c,1),c-=1;else if(d==="..")if(c!==1||a[2]!==".."&&a[0]!=="..")c>0&&(a.splice(c-1,2),c-=2);else break;a=a.join("/")}return a}function k(a,b){return function(){return i.apply(d,g.call(arguments,0).concat([a,b]))}}function l(a){return function(b){return j(b,a)}}function m(a){return function(b){e[a]=b}}function n(a){if(f.hasOwnProperty(a)){var b=f[a];delete f[a],h.apply(d,b)}return e[a]}function o(a,b){var c,d,e=a.indexOf("!");return e!==-1?(c=j(a.slice(0,e),b),a=a.slice(e+1),d=n(c),d&&d.normalize?a=d.normalize(a,l(b)):a=j(a,b)):a=j(a,b),{f:c?c+"!"+a:a,n:a,p:d}}var e={},f={},g=[].slice,h,i;if(typeof c=="function")return;h=function(a,b,c,g){var h=[],i,j,l,p,q,r;g||(g=a);if(typeof c=="function"){!b.length&&c.length&&(b=["require","exports","module"]);for(p=0;p<b.length;p++){r=o(b[p],g),l=r.f;if(l==="require")h[p]=k(a);else if(l==="exports")h[p]=e[a]={},i=!0;else if(l==="module")j=h[p]={id:a,uri:"",exports:e[a]};else if(e.hasOwnProperty(l)||f.hasOwnProperty(l))h[p]=n(l);else if(r.p)r.p.load(r.n,k(g,!0),m(l),{}),h[p]=e[l];else throw a+" missing "+l}q=c.apply(e[a],h),a&&(j&&j.exports!==d?e[a]=j.exports:i||(e[a]=q))}else a&&(e[a]=c)},a=i=function(a,b,c,e){return typeof a=="string"?n(o(a,b).f):(a.splice||(b.splice?(a=b,b=arguments[2]):a=[]),e?h(d,a,b,c):setTimeout(function(){h(d,a,b,c)},15),i)},i.config=function(){return i},b||(b=i),c=function(a,b,d){b.splice||(d=b,b=[]),c.unordered?f[a]=[a,b,d]:h(a,b,d)},c.amd={jQuery:!0}})(),c("almond.js",function(){}),c("globals",{host:"tweetriver.com",timeout:1e4,protocol:document.location.protocol==="https:"?"https":"http",min_poll_interval:5e3,jsonp_param:"jsonp"}),c("helpers",["globals"],function(a){var b={},c=encodeURIComponent;b.step_through=function(a,c,d){a=b.is_array(a)?a:[a];var e=a.length-1;if(e>=0)for(;e>=0;e--){var f=a[e];for(var g=0,h=c.length;g<h;g++)c[g].call(d,f)}},b.extend=function(a,b){var c;for(c in b)typeof a[c]=="undefined"&&(a[c]=b[c]);return a},b.api_url=function(b,c){return c=c||a.host,a.protocol+"://"+c+b};var d=0;a._json_callbacks={},b.jsonp_factory=function(c,e,f,g,h,i){var j=f+++d,k=!1,l;a._json_callbacks[j]=function(c){typeof h=="function"?h(c):b.is_array(h)&&h.length>0&&helpers.step_through(c,h,g),delete a._json_callbacks[j],k=!0,clearTimeout(l)},e.push([a.jsonp_param,"massrel._json_callbacks."+j]);var m=b.load(c+"?"+b.to_qs(e));l=setTimeout(function(){k||(a._json_callbacks[j]=function(){delete a._json_callbacks[j]},typeof i=="function"&&i(),m.stop())},a.timeout)},b.is_array=Array.isArray||function(a){return Object.prototype.toString.call(a)==="[object Array]"};var e=document.getElementsByTagName("head")[0]||document.body;b.load=function(a,b){var c=document.createElement("script");c.type="text/javascript",c.src=a;var d=!1;return c.onload=c.onreadystatechange=function(){!d&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")&&(d=!0,c.onload=c.onreadystatechange=null,e&&c.parentNode&&e.removeChild(c),typeof b=="function"&&b())},e.insertBefore(c,e.firstChild),{stop:function(){c.onload=c.onreadystatechange=null,e&&c.parentNode&&e.removeChild(c),c.src="#"}}},b.to_qs=function(a){var d=[],e;if(a&&a.length){for(var f=0,g=a.length;f<g;f++){e=a[f][1];if(b.is_array(e)){var h=[];for(var i=0,j=e.length;i<j;i++)h[i]=c(e[i]||"");e=h.join(",")}else e!==undefined&&e!==null?e=c(e):e="";d.push(c(a[f][0])+"="+e)}return d.join("&")}return""};var f=/\+\d{4} \d{4}$/,g=/^(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2})(\+\d{4})$/;return b.fix_date=b.fix_twitter_date=function(a){if(f.test(a)){a=a.split(" ");var b=a.pop();a.splice(3,0,b),a=a.join(" ")}else g.test(a)&&(a=a.replace(g,"$1/$2/$3 $4:$5:$6 $7"));return a},b.parse_params=function(){raw={},queryString=window.location.search.substring(1),queryString.charAt(0)=="?"&&(queryString=queryString.substring(1));if(queryString.length>0){queryString=queryString.replace(/\+/g," ");var a=queryString.split(/[&;]/g);for(var b=0;b<a.length;b++){var c=a[b].split("="),d=decodeURIComponent(c[0]),e=c.length>1?decodeURIComponent(c[1]):"";if(d in raw){var f=raw[d];typeof f!="string"?raw[d].push(e):(raw[d]=[],raw[d].push(f),raw[d].push(e))}else raw[d]=e}}return raw},b.poll_interval=function(b){var c=a.min_poll_interval;return Math.max(b||c,c)},b}),c("meta_poller",["helpers"],function(a){function b(b,c){var d=this,e=function(){g&&b.meta(d.opts,function(b){g&&(a.step_through(b,d._listeners,d),g&&f())},function(){f()})},f=function(){h=setTimeout(e,a.poll_interval(d.opts.frequency))},g=!1,h;this._listeners=[],this.opts=c||{},this.opts.frequency=(this.opts.frequency||30)*1e3,this.start=function(){return g||(g=!0,e()),this},this.stop=function(){return clearTimeout(h),g=!1,this}}return b.prototype.data=function(a){return this._listeners.push(a),this},b.prototype.each=b.prototype.data,b}),c("account",["helpers","meta_poller"],function(a,b){function d(a){this.user=a}var c=encodeURIComponent;return d.prototype.meta_url=function(){return a.api_url("/"+c(this.user)+".json")},d.prototype.meta=function(){var b,c,d;if(typeof arguments[0]=="function")c=arguments[0],d=arguments[1],b={};else if(typeof arguments[0]=="object")b=arguments[0],c=arguments[1],d=arguments[2];else throw new Error("incorrect arguments");var e=this.buildMetaParams(b);return a.jsonp_factory(this.meta_url(),e,"meta_",this,c,d),this},d.prototype.buildMetaParams=function(b){b=b||{};var c=[];b.quick_stats&&c.push(["quick_stats","1"]);if(b.streams){var d=a.is_array(b.streams)?b.streams:[b.streams];c.push(["streams",d.join(",")])}return c},d.prototype.metaPoller=function(a){return new b(this,a)},d.prototype.toString=function(){return this.user},d}),c("poller_queue",["helpers"],function(a){function b(b,c){function k(){i=j.total,setTimeout(function(){if(j.poller.enabled&&j.total===i&&e.length>0&&d.length===0){var a=Math.min(Math.floor(e.length*Math.random()),e.length-1),b=e[a];d.push(b),j.total+=1,j.enqueued+=1,j.reused+=1,l()}k()},c.history_timeout*1e3)}function l(){if(!g&&d.length>0&&typeof f=="function"){var a=++h;j.enqueued-=1,j.count+=1;var b=d.shift();g=!0,f.call(j,b,function(){a===h&&(g=!1,setTimeout(l,0))}),c.history_size>0&&!b.__recycled&&(c.history_size===e.length&&e.shift(),b.__recycled=!0,e.push(b))}}this.poller=b,c=a.extend(c||{},{history_size:0,history_timeout:b.frequency/1e3});var d=[],e=[],f=null,g=!1,h=0,i=0;this.total=0,this.enqueued=0,this.count=0,this.reused=0;var j=this;b.batch(function(a){var b=a.length,c=b-1;for(;c>=0;c--)d.push(a[c]);j.total+=b,j.enqueued+=b,l()}),c.history_size>0&&k(),this.next=function(a){!g&&typeof a=="function"&&(f=a,l())}}return b}),c("poller",["helpers","poller_queue"],function(a,b){function c(a,b){this.stream=a,this._callbacks=[],this._enumerators=[],this._bound_enum=!1,this._t=null,b=b||{},this.limit=b.limit||null,this.since_id=b.since_id||null,this.start_id=b.start_id||null,this.replies=!!b.replies,this.geo_hint=!!b.geo_hint,this.keywords=b.keywords||null,this.frequency=(b.frequency||30)*1e3,this.stay_realtime="stay_realtime"in b?!!b.stay_realtime:!0,this.enabled=!1,this.alive=!0,this.alive_instance=0,this.consecutive_errors=0}return c.prototype.poke=function(a){return!this.alive&&this.enabled&&(this._t=null,this.start()),this},c.prototype.batch=function(a){return this._callbacks.push(a),this},c.prototype.each=function(a){return this._enumerators.push(a),this},c.prototype.start=function(){function d(){c.alive=!1;if(!c.enabled||b!==c.alive_instance)return;var e={};c.stay_realtime?e.since_id=c.since_id:e.from_id=c.since_id,c.stream.load(c.params(e),function(b){c.alive=!0,c.consecutive_errors=0;if(b&&b.length>0){c.since_id=b[0].entity_id,c.start_id||(c.start_id=b[b.length-1].entity_id);for(var e=0,f=c._callbacks.length;e<f;e++)c._callbacks[e].call(c,b);a.step_through(b,c._enumerators,c)}c._t=setTimeout(d,a.poll_interval(c.frequency))},function(){c.consecutive_errors+=1,c.poke()})}if(this._t)return this;this.enabled=!0;var b=this.alive_instance=this.alive_instance+1,c=this;return d(),this},c.prototype.stop=function(){return clearTimeout(this._t),this._t=null,this.enabled=!1,this},c.prototype.queue=function(a){var c=new b(this);return c.next(a),this},c.prototype.more=function(a,b){var c=this,d=function(){c.stream.load(c.params({start_id:c.start_id}),function(b){b.length>0&&(c.start_id=b[b.length-1].entity_id,c.since_id||(c.since_id=b[0].entity_id)),a.call(c,b)},function(){typeof b=="function"&&b()})};return d(),this},c.prototype.params=function(b){return a.extend({limit:this.limit,replies:this.replies,geo_hint:this.geo_hint,keywords:this.keywords},b||{})},c}),c("stream",["helpers","poller","meta_poller"],function(a,b,c){function e(){var a=arguments.length===1?arguments[0].split("/"):arguments;this.account=a[0],this.stream_name=a[1],this._enumerators=[]}var d=encodeURIComponent;return e.prototype.stream_url=function(){return a.api_url("/"+d(this.account)+"/"+d(this.stream_name)+".json")},e.prototype.meta_url=function(){return a.api_url("/"+d(this.account)+"/"+d(this.stream_name)+"/meta.json")},e.prototype.load=function(b,c,d){b=a.extend(b||{},{});var e=this.buildParams(b);return a.jsonp_factory(this.stream_url(),e,"_",this,c||this._enumerators,d),this},e.prototype.buildParams=function(a){a=a||{};var b=[];return a.limit&&b.push(["limit",a.limit]),a.since_id?b.push(["since_id",a.since_id]):a.from_id?b.push(["from_id",a.from_id]):(a.start_id||a.start)&&b.push(["start",a.start_id||a.start]),a.replies&&b.push(["replies","1"]),a.geo_hint&&b.push(["geo_hint","1"]),a.keywords&&b.push(["keywords",a.keywords]),b},e.prototype.each=function(a){return this._enumerators.push(a),this},e.prototype.poller=function(a){return new b(this,a)},e.prototype.meta=function(){var b,c,d;if(typeof arguments[0]=="function")c=arguments[0],d=arguments[1],b={};else if(typeof arguments[0]=="object")b=arguments[0],c=arguments[1],d=arguments[2];else throw new Error("incorrect arguments");var e=this.buildMetaParams(b);return a.jsonp_factory(this.meta_url(),e,"meta_",this,c,d),this},e.prototype.buildMetaParams=function(a){a=a||{};var b=[];return a.disregard&&b.push(["disregard",a.disregard]),a.num_minutes&&b.push(["num_minutes",a.num_minutes]),a.num_hours&&b.push(["num_hours",a.num_hours]),a.num_days&&b.push(["num_days",a.num_days]),a.top_periods&&b.push(["top_periods",a.top_periods]),a.top_periods_relative&&b.push(["top_periods_relative",a.top_periods_relative]),a.top_count&&b.push(["top_count",a.top_count]),a.finish&&b.push(["finish",a.finish]),b},e.prototype.metaPoller=function(a){return new c(this,a)},e}),c("context",["helpers"],function(a){function b(a){this.status=a,this.source={facebook:!1,twitter:!1,message:!1},this.known=!1,this.intents=!0}return b.create=function(c,d){c=c||{};var e=new b(c);return d=a.extend(d||{},{intents:!0,retweeted_by:!0}),e.intents=d.intents,c.id_str&&c.text&&c.entities&&(e.source.twitter=e.known=!0),c.facebook_id?(e.source.facebook=!0,e.known=typeof c.message=="string"):c.network==="massrelevance"&&(e.source.message=e.known=!0),e.source.twitter&&c.retweeted_status&&d.retweeted_by&&(e.retweet=!0,e.retweeted_by_user=c.user,e.status=c.retweeted_status),e},b}),c("compare_poller",["helpers"],function(a){function b(b,c){var d=this,e=function(){g&&b.load(d.opts,function(b){g&&(a.step_through(b,d._listeners,d),g&&f())},function(){f()})},f=function(){h=setTimeout(e,a.poll_interval(d.opts.frequency))},g=!1,h;d._listeners=[],d.opts=c||{},d.opts.frequency=(d.opts.frequency||30)*1e3,d.start=function(){return g||(g=!0,e()),this},d.stop=function(){return clearTimeout(h),g=!1,this}}return b.prototype.data=function(a){return this._listeners.push(a),this},b.prototype.each=b.prototype.data,b}),c("compare",["helpers","compare_poller"],function(a,b){function c(b){a.is_array(b)?this.streams=b.slice(0):typeof b=="string"?this.streams=[b]:this.streams=[]}return c.prototype.compare_url=function(){return a.api_url("/compare.json")},c.prototype.buildParams=function(a){var b=[];return a=a||{},a.streams&&b.push(["streams",a.streams]),(a.target||a.target>=0)&&b.push("target",a.target.toString()),b},c.prototype.load=function(b,c,d){typeof b=="function"&&(d=c,c=b,b=null);var e=this.buildParams(a.extend({streams:this.streams},b||{}));return a.jsonp_factory(this.compare_url(),e,"meta_",this,c,d),this},c.prototype.poller=function(a){return new b(this,a)},c}),c("intents",["helpers"],function(a){var b={base_url:"https://twitter.com/intent/",params:{text:"(string): default text, for tweet/reply",url:"(string): prefill url, for tweet/reply",hashtags:"(string): hashtag (or list with ,) without #, for tweet/reply",related:"(string): screen name (or list with ,) without @, available for all",in_reply_to:"(number): tweet id, only for reply",via:"(string): screen name without @, tweet/reply",tweet_id:"(number): tweet id, for retweet and favorite",screen_name:"(string): only for user/profile",user_id:"(number): only for user/profile"}};return b.url=function(c,d){d=d||{};var e=[];for(var f in d)e.push([f,d[f]]);return b.base_url+encodeURIComponent(c)+"?"+a.to_qs(e)},b.tweet=function(a){return b.url("tweet",a)},b.reply=function(a,c){return c=c||{},c.in_reply_to=a,b.tweet(c)},b.retweet=function(a,c){return c=c||{},c.tweet_id=a,b.url("retweet",c)},b.favorite=function(a,c){return c=c||{},c.tweet_id=a,b.url("favorite",c)},b.user=function(a,c){return c=c||{},isNaN(parseInt(a,10))?c.screen_name=a:c.user_id=a,b.url("user",c)},b.profile=b.user,b}),c("massrel",["globals","helpers","stream","account","poller","meta_poller","poller_queue","context","compare","compare_poller","intents"],function(d,e,f,g,h,i,j,k,l,m,n){var o=window.massrel;typeof o=="undefined"?o=window.massrel=d:e.extend(o,d),o.Stream=f,o.Account=g,o.Poller=h,o.MetaPoller=i,o.PollerQueue=j,o.Context=k,o.Compare=l,o.CompatePoller=m,o.helpers=e,o.intents=n,o.define=c,o.require=b,o.requirejs=a,typeof window.define=="function"&&typeof window.define.amd!="undefined"&&window.define(o)})})();dojo.provide("dj.widget.massrelevance.tweetRiver");dojo.require("dj.module.massrel.massrel");dojo.require("dojo.io.script");dojo.require("dojo.date");dojo.require("dojo.date.locale");dojo.declare("dj.widget.massrelevance.tweetRiver",[],{constructor:function(cfg){this.conf=dojo.mixin(this.DEFAULT_CONFIG,cfg);},DEFAULT_CONFIG:{streamCount:1,streamRefreshInterval:30,twitterStreamName:"dowjonestwo/wsjtest",mrJSWidgetToLoad:"https://raw.github.com/MassRelevance/massrel-js/master/massrel.js",streamEleClass:".content_section"},getTwitterFeedOldApproach:function(callback,context,divToCreateHTML){var that=this;var jsonArgs={url:that.conf.mrJSWidgetToLoad,checkString:"massrel",load:dojo.hitch(this,function(){var stream=new massrel.Stream(this.conf.twitterStreamName);var streamContent=[];var that=this;stream.poller({limit:this.conf.streamCount,frequency:this.conf.streamRefreshInterval}).batch(function(tweets){streamContent=[];while(tweets.length>0){streamContent.push(tweets.pop());}
that.renderTwitterHTML(callback,context,divToCreateHTML,streamContent);callback.apply(context,[streamContent]);}).start();}),error:function(error){console.error("twitter feed couldn't be laoded");}};dojo.io.script.get(jsonArgs);},getTwitterFeed:function(callback,context,divToCreateHTML){var stream=new massrel.Stream(this.conf.twitterStreamName);var streamContent=[];var that=this;stream.poller({limit:this.conf.streamCount,frequency:this.conf.streamRefreshInterval}).batch(function(tweets){streamContent=[];while(tweets.length>0){streamContent.push(tweets.pop());}
that.renderTwitterHTML(callback,context,divToCreateHTML,streamContent);callback.apply(context,[streamContent]);}).start();},renderTwitterHTML:function(callback,context,divToCreateHTML,streamContentArr){if(typeof divToCreateHTML!="undefined"&&streamContentArr.length>0){divToCreateHTML.innerHTML="";var contentDivEle=dojo.create("div",{"class":"twtContent"},divToCreateHTML,"last");var hrefLink="https://twitter.com/"+streamContentArr[0].user.screen_name;var aEle=dojo.create("a",{"href":hrefLink,"target":"_blank"},contentDivEle,"first");var imgEle=dojo.create("img",{"src":streamContentArr[0].user.profile_image_url,"class":"twtIcon"},aEle,"first");var blockquoteEle=dojo.create("blockquote",{"class":"twt"},contentDivEle,"last");var hrefLink2="https://twitter.com/"+streamContentArr[0].user.screen_name;var aEle2=dojo.create("a",{"href":hrefLink2,"target":"_blank"},blockquoteEle,"first");aEle2.innerHTML='@'+streamContentArr[0].user.screen_name;var text=streamContentArr[0].text;var textArr=text.split(" ");for(var l=0;l<textArr.length;l++){var space=" ";if(l==textArr.length-1){space=".";}
var word=textArr[l];if(word.indexOf("#")==0){var tag=word.substring(1);var hrefHashLink="https://twitter.com/search?q=%23"+tag+"&src=hash";var aEle3=dojo.create("a",{"href":hrefHashLink,"target":"_blank"},blockquoteEle,"last");aEle3.innerHTML=" #"+tag+space;}else if(word.indexOf("@")==0){var name=word.substring(1);var hrefAtLink="https://twitter.com/"+name;var aEle4=dojo.create("a",{"href":hrefAtLink,"target":"_blank"},blockquoteEle,"last");aEle4.innerHTML=" @"+name+space;}
else{blockquoteEle.appendChild(document.createTextNode(word+space));}}
var spanEle=dojo.create("span",{"class":"twtTime"},contentDivEle,"last");var ulEle=dojo.create("ul",{"class":"twtMeta"},contentDivEle,"last");var liEle1=dojo.create("li",{"class":"twtTime"},ulEle,"first");var ts=streamContentArr[0].created_at;if(ts!==""){try{var tsSplitArr=ts.split(" ");var tsTime=tsSplitArr[3];var tsTimeArr=tsTime.split(":");var monthNum=this.getMonthNum(tsSplitArr[1]);var dateVal=new Date(tsSplitArr[5],monthNum,tsSplitArr[2],tsTimeArr[0],tsTimeArr[1],tsTimeArr[2]);var formattedDate=dojo.date.locale.format(dateVal,{datePattern:"MMM d, yyyy",selector:"date"});liEle1.innerHTML=this.getOrdialDate(formattedDate);}catch(e1){console.log("error in formatting date"+e1);}}
var tweetURL="https://twitter.com/intent/";var liEle2=dojo.create("li",{"class":"twtFav"},ulEle,"last");var favVar=tweetURL+"favorite?tweet_id="+streamContentArr[0].id_str;var aEle3=dojo.create("a",{"href":favVar},liEle2,"first");aEle3.innerHTML="Favorite";var liEle3=dojo.create("li",{"class":"twtRetwt"},ulEle,"last");var retweetVar=tweetURL+"retweet?tweet_id="+streamContentArr[0].id_str;var aEle4=dojo.create("a",{"href":retweetVar},liEle3,"first");aEle4.innerHTML="Retweet";var liEle4=dojo.create("li",{"class":"twtReply"},ulEle,"last");var replyVar=tweetURL+"tweet?in_reply_to="+streamContentArr[0].id_str;var aEle5=dojo.create("a",{"href":replyVar},liEle4,"first");aEle5.innerHTML="Reply";}},getOrdialDate:function(formattedDate){try{var num=formattedDate;var commaIndex=formattedDate.indexOf(",");num=formattedDate.substring(4,commaIndex);try{num=parseInt(num,10);}catch(e){console.log("date could not be converted to int "+e);}
var s='th';if(num===1||num==21||num==31){s='st';}
if(num===2||num==22){s='nd';}
if(num===3||num==23){s='rd';}
formattedDate.replace(num,num+s);return formattedDate.replace(num,num+s);}catch(ex){return formattedDate;}},getMonthNum:function(mon){var months={"Jan":0,"Feb":1,"Mar":2,"Apr":3,"May":4,"Jun":5,"Jul":6,"Aug":7,"Sep":8,"Oct":9,"Nov":10,"Dec":11};return months[mon];}});
dojo.provide("dj.module.carouselSection");dojo.require("dj.widget.panels.virtual.Carousel");dojo.addOnLoad(function(){dj.module.carouselSection=dj.widget.panels.PanelsFactory.create("carouselSection",{core:{panelGroup:".newsItem",panel:"li",paginationContainer:".pagination",viewport:2},carousel:{prevButton:".nav-inline .prev",nextButton:".nav-inline .next"},rotator:{rotateTime:10}})});dojo.provide("dj.module.chartbeat");dojo.require("dj.util.io");dj.module.chartbeat={init:function(){var a="",b=dojo.query("link[rel = canonical]");if(b.length>0)a=b[0].href?b[0].href:"";b=dj.context.core.urlPrefix;if(a.indexOf("http://kr.wsj.com/")!=-1)b="http://kr.wsj.com";else if(a.indexOf("http://indo.wsj.com/")!=-1)b="http://indo.wsj.com";var c=a.indexOf(".com")+4;a=a.substring(c);b=b.substring(7);if(typeof s!="undefined"&&typeof s.prop2!="undefined"){var e=s.prop2;if(e!="undefined")if(e.indexOf("WSJ_")<0)e="WSJ_"+e}window._sf_async_config={uid:8900,domain:b,path:a,sections:e};window._sf_endpt=(new Date).getTime();dj.util.io.insertScriptAsync(("https:"==document.location.protocol?"https://s3.amazonaws.com/":"http://")+"static.chartbeat.com/js/chartbeat.js")}};dojo.provide("dj.module.mostPopularTab");dojo.require("dj.widget.panels.virtual.Tabs");dj.module.mostPopularTab={init:function(a){var b=["mostRead","mostEmailed","mostPopularVideo","mostCommented","mostSearched"],c={core:{panelPrefix:"mostPopularTab_panel_",panels:b},tabs:{tabPrefix:"mostPopularTab_tab_",tabOnStyle:"selectedTab",tabOffStyle:"deselected"}};if(a)c.core=dojo.mixin(c.core,a);this.pnl=dj.widget.panels.PanelsFactory.create("mostPopularTab",c);c={core:{panelPrefix:"mostPopularTab_rssPanel_",panels:b,controller:this.pnl}};if(a)c.core=dojo.mixin(c.core,a);this.pnlRss=dj.widget.panels.PanelsFactory.create("mostPopularTab",c)}};dojo.provide("dj.module.newsTicker");dojo.require("dj.widget.panels.virtual.Carousel");dj.module.newsTicker={init:function(a){if(typeof this.ticker=="object")this.ticker.update();else this.ticker=this.createTicker(a)},createTicker:function(a){a=dojo.deepMixin({container:"newsTicker",assassinContainer:"topBanner",containerClass:"headlineSummary newsTicker newsTickerBg"},a);var b=dojo.byId(a.container);b.className=a.containerClass;return dj.widget.panels.PanelsFactory.create(b,{carousel:{type:"circular",prevButtonEnabledStyle:"",nextButtonEnabledStyle:""},rotator:{rotateTime:8}})}};dojo.provide("dj.module.outbrain");dojo.require("dj.util.onVisibleWidget");dj.module.outbrain={jsurl:"http://widgets.outbrain.com/outbrain.js",scriptLoaded:false,init:function(){if(!this.scriptLoaded){this.scriptLoaded=true;var a=document.createElement("script");a.type="text/javascript";a.src=this.jsurl;document.body.appendChild(a)}}};dojo.provide("dj.module.rssBlogTimes");dojo.require("dj.util.Element");dj.module.rssBlogTimes={init:function(a){a=dojo.query(a);if(a.length===0)console.log("{dj.module.xslTimestamp} no timestamps found.");else for(var b=0,c;c=a[b++];){c=dj.util.Element.cleanWhitespace(c);var e=this.calculateDuration(dojo.trim(c.innerHTML));dojo.empty(c);c.innerHTML=e}},calculateDuration:function(a){a=new Date(a);var b=Math.ceil((new Date).getTime()-a.getTime());b=Math.ceil(b/6E4);var c="";if(b<1)c="1 min ago";else if(b<59)c="6 mins ago";else if(b>60&&b<240){b="";b=a.getHours()<=12?" am":" pm";c=a.getHours()+":"+a.getMinutes()+b}return c===""?null:c}};dojo.provide("dj.module.assasinModule");dojo.require("dj.util.Element");dojo.require("dj.widget.video.Video");dojo.require("dj.widget.flash.Flash");dj.module.assasinModule={init:function(a){if(typeof a=="undefined")a="";var b=dojo.query(".viModule [id^=assasinMedia]");if(b!==null)for(var c=0,e=b.length;c<e;++c){var f=b[c].className.split("::");if(f&&f[1]!=="undefined"){var g=f[0],h=f[1];f=f[2];if(g===a+"VIDEO")this.videoPlayer=new dj.widget.video.Video(dj.util.Element.identify(b[c]),h,"","",f);else if(g===a+"FLASH")this.flashPlayer=new dj.widget.flash.Flash(dj.util.Element.identify(b[c]),h,f)}}}};dojo.provide("dj.module.newsReel");dojo.require("dj.widget.ad.AdManager");dojo.require("dj.util.Page");dojo.require("dj.widget.panels.virtual.Carousel");dj.module.newsReel={REEL_STATE:{FULL:0,COLLAPSED:1,SMALL:2},reelState:0,reelHeight:0,isAnimation:false,cfg:{reelOpenClass:"reelState-open",reelClosedClass:"reelState-closed",btnSelectedClass:"selected",stateCookieName:"newsReel_state",currentArticleClass:"currentArticle",currentPointerClass:"current",newsReelPointerClass:".newsreelPointer",reelLoadedClass:"reelState-loaded"},oCnt:null,cntId:null,init:function(a,b){this.oCnt=dojo.byId(a);if(this.oCnt===null)throw Error("{newsReel} container is not located.");dojo.addClass(this.oCnt,this.cfg.reelLoadedClass);this.currentArticle=null;this.reelState=this.REEL_STATE.FULL;this.reel=this.initReel(this.oCnt);if(!(typeof b==="undefined"||b===null||b===""))try{this.initNewsReelAds(b,this.oCnt)}catch(c){console.error("{newsReel} ads error: "+c)}},setId:function(a){this.cntId=a},update:function(){this.init(this.cntId);return this},initReel:function(a){var b=dj.widget.panels.PanelsFactory.create(a,{core:{panelGroup:"#newsReelContent > .reelContentTree .unitList",panel:"li",viewArea:4},carousel:{navContainer:".reelNav",prevButton:".newsreel_prev",nextButton:".newsreel_next",type:"circular"}}),c=this._setCurrentPanelActive(a);if(c===null)return b;this.reelPtrCnt=dojo.query(this.cfg.newsReelPointerClass,a)[0];a=dojo.query(".newsreel_pointer_container li",this.reelPtrCnt);dojo.addClass(a[c],this.cfg.currentPointerClass);if(dojo.query(".unit.sponsor").children().first()[0]){var e=a[0];a=e.parentNode;e=dojo.create(e.tagName,{className:e.className,innerHTML:e.innerHTML});a.appendChild(e)}dj.widget.panels.PanelsFactory.create(this.reelPtrCnt,{core:{panelGroup:".newsreel_pointer_container",panel:"li",viewArea:4,controller:b},carousel:{type:"circular"}});if(b.getNumberOfPanels()>3)try{var f=b.getById(c).getPosition();b.setActiveByPosition(f+1)}catch(g){console.error("{newsReel} cannot scroll to invalid panel id: "+c)}return b},_setCurrentPanelActive:function(a){var b=typeof AT_VARS==="object"&&AT_VARS.baseDocId?AT_VARS.baseDocId:dj.util.Page.getQueryParam("baseDocId"),c=null,e=this;dojo.query("#newsReelContent > .reelContentTree .unitList .unit",a).forEach(function(f,g){var h=dojo.query("a",f)[0];if(typeof h!=="undefined"&&h.href!==null&&h.href.indexOf(b)!==-1){c=g;dojo.addClass(dojo.byId(f),e.cfg.currentPointerClass)}});return c},initNewsReelAds:function(a,b){dojo.query("#newsReelContent .newsReelAd",b).forEach(function(c){dj.widget.ad.AdManager.loadAds(a,{id:c.getAttribute("id")})})}};dojo.provide("dj.module.globalHeader");dojo.deprecated("dj.module.globalHeader","use the one in the 'header' bundle","0.7");dojo.require("dj.lang");dojo.require("dj.util.Config");dojo.require("dj.util.Cookie");dojo.require("dj.util.Date");dojo.require("dj.util.Region");dojo.require("dj.util.Element");dojo.require("dj.util.User");dj.module.globalHeader=function(){var a={HEADER_CONTAINER_CLASS:".header",TIMESTAMP_CLASS:".date",WSJ_LOGO_ID:"wsjLogo",WSJ_LARGE_LOGO_CLASSNAME:"logo_large",WSJ_SMALL_LOGO_CLASSNAME:"logo_small",CURRENT_SUBSECTION_DISPLAY_CLASS:".currentSubSection",GLOBALNAV_SUBSECTION_ELEMENT_ID:"currentGlobalNavSubSection",SUBSCRIBER_LOGIN_CLASS:".login",HEADER_PROMO_CLASS:".promo",SUBSCRIBER_DETAILS_ELEMENT_ID:"subscribedUserDetailsId",COMMUNITY_FORUMS_LINK_CLASS:".communityForumsLink",TODAYS_PAPER_LINK_CLASS:".todaysPaperLink",MOJ_LINK_CLASS:".myOnlineJournalLink",MESSAGE_CENTER_LINK_CLASS:".messageCenterLink",MESSAGE_COUNT_CLASS:".messageCount",LOGIN_USERNAME_ELEMENT_ID:"login_username",LOGIN_PASSWORD_ELEMENT_ID:"login_password",LOGIN_FORM_ID:"login_form",PAGE_URL_ELEMENT_ID:"page_url",LOGOUT_LINK_ELEMENT_ID:"logoutLink",LOGIN_BUTTON_ELEMENT_ID:"login_button",USER_NAME_ELEMENT_ID:"userName",WSJ_LOGO_FADE_APPEAR_DURATION:"1.0",WSJ_LOGO_DELAY_DURATION:"2000",LOGGED_IN_COMMUNITY_URL:"/community",LOGGED_IN_TODAYS_PAPER_URL:"/itp?mod=WSJ_formfactor",MESSAGE_CENTER_POST_URL:"/community/integration/userinfo.html",LOGOUT_URL:"/static_html_files/logout_confirmation.htm",SUBSCRIBER_HOMEPAGE_PID:"0_0_WH_0001",NONSUBSCRIBER_HOMEPAGE_PID:"0_0_WH_0001_public",ASIA_PAGE_PID:"0_0_WP_2103",EUROPE_PAGE_PID:"0_0_WP_2104",NONSUBSCRIBER_NEWSLETTERS_ALERTS_PAGE_PID:"5_6007",NONSUBSCRIBER_SEARCH_PAGE_PID:"3_0466",HOMEPAGE_SUBSCRIBER_URL:"/",SEARCH_PAGE_SUBSCRIBER_URL:"/search",TODAYS_PAPER_LINK_CONTAINER_CLASS:".todaysPaperLinkContainer",VIDEO_LINK_CONTAINER_CLASS:".videoLinkContainer",COLUMNS_LINK_CONTAINER_CLASS:".columnsLinkContainer",BLOGS_LINK_CONTAINER_CLASS:".blogsLinkContainer",INTERACTIVE_GRAPHICS_LINK_CONTAINER_CLASS:".interactiveGraphicsLinkContainer",TOPICS_LINK_CONTAINER_CLASS:".topicsLinkContainer",COMMUNITY_FORUMS_LINK_CONTAINER_CLASS:".communityForumsLinkContainer",TODAYS_PAPER_PID:"0_0_WP_40",TODAYS_PAPER_US_NONSUB_PID:"2_0433",TODAYS_PAPER_EUROPE_NONSUB_PID:"2_0434",TODAYS_PAPER_ASIA_NONSUB_PID:"2_0435",TODAYS_PAPER_US_PID:"2_0133",TODAYS_PAPER_EUROPE_PID:"2_0134",TODAYS_PAPER_ASIA_PID:"2_0135",TODAYS_PAPER_PAST_EDITIONS_PID:"2_0233",TODAYS_PAPER_INDEX_BIZ_PID:"2_0156",TODAYS_PAPER_INDEX_PEOPLE_PID:"2_0155",TODAYS_PAPER_CORRECTIONS_PID:"Corrections",VIDEO_PID:"0_0_WP_3000",BLOGS_PID:"8_0019",COLUMNS_PID:"2_0140",INTERACTIVE_GRAPHICS_PID:"0_0_WP_2003",TOPICS_PID:"0_0_WT_0001",NEWSLETTERS_ALERTS_SUB_PID:"5_6001",NEWSLETTERS_ALERTS_PUB_PID:"5_6003",MOJ_LINK_URL:"/page/my-journal-main.html",MDC_LINK_URL:"/mdc/page/marketsdata.html",MDC_PAGE_PID:"2_3000",COMMUNITY_HIGHLIGHT_COMPARE_URL:"/community",FORUMS_HIGHLIGHT_COMPARE_URL:"forums.wsj.com",FREE_REG_CLASS:".freereg",LOCATION_NAV_CLASS:".location_nav",LOCATION_NAV_COLLAPSED_CLASSNAME:"location_collapsed",LOCATION_NAV_EXPANDED_CLASSNAME:"location_expanded",US_EDITION_LINK_CLASS:".map_us",EU_EDITION_LINK_CLASS:".map_europe",ASIA_EDITION_LINK_CLASS:".map_asia",IN_EDITION_LINK_CLASS:".map_india",LOGGED_IN_TODAYS_PAPER_URL_ASIA:"/page/asia_in_todays_paper.html?mod=WSJ_formfactor",LOGGED_IN_TODAYS_PAPER_URL_EUROPE:"/page/europe_in_todays_paper.html?mod=WSJ_formfactor",US_EDITION_MDC_URL:"/marketsdata",EU_EDITION_MDC_URL:"/mdc/public/page/marketsdata_europe.html",ASIA_EDITION_MDC_URL:"/mdc/public/page/marketsdata_asia.html",IN_EDITION_MDC_URL:"/mdc/public/page/marketsdata_asia.html",MDC_COMPARE_URL:"/mdc/",FOOTER_CONTAINER_CLASS:".pagefooter"};return{initialize:function(b){this.cfg=dj.lang.cloneMixin(a,b);this.oHeader=dojo.query(this.cfg.HEADER_CONTAINER_CLASS)[0];this.editionDropdownSetUp();this.displaySubSection();this.displayTimeStamp();var c=this;this.currRegion=dj.util.Region.getViewByRegion();this.concatURL="";this.concatURL=typeof gcDomain!=="undefined"&&gcDomain!==null&&gcDomain!==""?"http://"+gcDomain:"http://"+document.domain;dj.util.User.isLoggedIn(function(g){if(g){c.displaySubscriberDetails();c.setupLogout()}else{c.setupLogin();c.ofreereg=dojo.query(c.cfg.FREE_REG_CLASS,c.oHeader)[0];g=dojo.query("#register_module",c.ofreereg)[0];dojo.style(g,{display:"none"});dojo.style(c.ofreereg,{display:"block"});c.oSubscriberLogin=dojo.query(c.cfg.SUBSCRIBER_LOGIN_CLASS,c.oHeader)[0];g=dojo.query(".login_module",c.oSubscriberLogin)[0];dojo.style(g,{display:"none"});dojo.style(c.oSubscriberLogin,{display:"block"});c.oHeaderPromo=dojo.query(c.cfg.HEADER_PROMO_CLASS,c.oHeader)[0];dojo.style(c.oHeaderPromo,{display:"block"})}});this.highlightFormFactorLinks();this.oTodaysPaperLink=dojo.query(this.cfg.TODAYS_PAPER_LINK_CLASS,this.oHeader)[0];var e=this.cfg.LOGGED_IN_TODAYS_PAPER_URL;b=this.cfg.LOGGED_IN_TODAYS_PAPER_URL_ASIA;var f=this.cfg.LOGGED_IN_TODAYS_PAPER_URL_EUROPE;if(this.currRegion=="asia"||this.currRegion=="asia,india")e=b;else if(this.currRegion=="europe")e=f;this.oTodaysPaperLink.href=typeof gcDomain!=="undefined"&&gcDomain!==null&&gcDomain!==""?"http://"+gcDomain+e:e;c=this;dj.util.User.isSubLoggedIn(function(g){if(!g)c.oTodaysPaperLink.href=typeof gcDomain!=="undefined"&&gcDomain!==null&&gcDomain!==""?"http://"+gcDomain+"/public"+e:"/public"+e})},toggleDropdownClass:function(){var b=this.cfg.LOCATION_NAV_COLLAPSED_CLASSNAME,c=this.cfg.LOCATION_NAV_EXPANDED_CLASSNAME;if(dojo.hasClass(this.oLocDropDownContainer,b)){dojo.removeClass(this.oLocDropDownContainer,b);dojo.addClass(this.oLocDropDownContainer,c)}else dojo.hasClass(this.oLocDropDownContainer,c)&&dojo.addClass(this.oLocDropDownContainer,b)},editionDropdownSetUp:function(){var b=this;this.oLocationNav=dojo.query(this.cfg.LOCATION_NAV_CLASS,this.oHeader)[0];var c=this.cfg.LOCATION_NAV_COLLAPSED_CLASSNAME,e=this.cfg.LOCATION_NAV_EXPANDED_CLASSNAME,f=this.cfg.US_EDITION_LINK_CLASS;f=this.cfg.US_EDITION_LINK_CLASS;var g=this.cfg.EU_EDITION_LINK_CLASS,h=this.cfg.IN_EDITION_LINK_CLASS,j=this.cfg.ASIA_EDITION_LINK_CLASS;this.usEditionMDCUrl=this.cfg.US_EDITION_MDC_URL;this.euEditionMDCUrl=this.cfg.EU_EDITION_MDC_URL;this.inEditionMDCUrl=this.cfg.IN_EDITION_MDC_URL;this.asiaEditionMDCUrl=this.cfg.ASIA_EDITION_MDC_URL;var k=this.cfg.MDC_COMPARE_URL;this.oCurrentEdition=dojo.byId("currentEdition");this.oUsEdition=dojo.byId("usEdition");this.oEuEdition=dojo.byId("europeEdition");this.oInEdition=dojo.byId("indiaEdition");this.oAsiaEdition=dojo.byId("asiaEdition");this.oChiEdition=dojo.byId("chiEdition");this.oSpaEdition=dojo.byId("spaEdition");this.oPorEdition=dojo.byId("porEdition");this.osectionFooterSub=dojo.byId("hrefNonSubId");this.osectionFooterNonSub=dojo.byId("hrefSubId");this.oUsEditionFooter=dojo.byId("usEditionFooter");this.currRegion=dj.util.Region.getViewByRegion();var l="";this.tempConcatURL=typeof gcDomain!=="undefined"&&gcDomain!==null&&gcDomain!==""?"http://"+gcDomain:"http://"+document.domain;this.isMDCPageFlag=document.location.href!==null&&document.location.href!==""&&document.location.href.indexOf(k)!==-1;this.oUsEdition!==null&&dojo.connect(this.oUsEdition,"onclick",this,function(m){dojo.stopEvent(m);dj.util.Region.setViewByRegion("na,us");dj.util.Cookie.setGroupCookie("DJCOOKIE","HOMEPAGE","/home-page",365);window.location=this.isMDCPageFlag?this.tempConcatURL+this.usEditionMDCUrl:this.oUsEdition.href});this.oUsEditionFooter!==null&&dojo.connect(this.oUsEditionFooter,"onclick",this,function(m){dojo.stopEvent(m);dj.util.Region.setViewByRegion("na,us");dj.util.Cookie.setGroupCookie("DJCOOKIE","HOMEPAGE","/home/us",365);window.location=this.isMDCPageFlag?this.tempConcatURL+this.usEditionMDCUrl:this.oUsEditionFooter.href});this.oEuEdition!==null&&dojo.connect(this.oEuEdition,"onclick",this,function(m){dojo.stopEvent(m);window.location=this.isMDCPageFlag?this.tempConcatURL+this.euEditionMDCUrl:this.oEuEdition.href;if(this.isMDCPageFlag){dj.util.Region.setViewByRegion("europe");dj.util.Cookie.setGroupCookie("DJCOOKIE","HOMEPAGE","/home/europe",365)}});this.oInEdition!==null&&dojo.connect(this.oInEdition,"onclick",this,function(m){dojo.stopEvent(m);window.location=this.isMDCPageFlag?this.tempConcatURL+this.inEditionMDCUrl:this.oInEdition.href;if(this.isMDCPageFlag){dj.util.Region.setViewByRegion("asia,india");dj.util.Cookie.setGroupCookie("DJCOOKIE","HOMEPAGE","/home/india",365)}});this.oAsiaEdition!==null&&dojo.connect(this.oAsiaEdition,"onclick",this,function(m){dojo.stopEvent(m);window.location=this.isMDCPageFlag?this.tempConcatURL+this.asiaEditionMDCUrl:this.oAsiaEdition.href;if(this.isMDCPageFlag){dj.util.Region.setViewByRegion("asia");dj.util.Cookie.setGroupCookie("DJCOOKIE","HOMEPAGE","/home/asia",365)}});this.oChiEdition!==null&&dojo.connect(this.oChiEdition,"onclick",this,function(m){dojo.stopEvent(m);window.open(this.oChiEdition.href)});this.oSpaEdition!==null&&dojo.connect(this.oSpaEdition,"onclick",this,function(m){dojo.stopEvent(m);window.location=this.oSpaEdition.href});this.oPorEdition!==null&&dojo.connect(this.oPorEdition,"onclick",this,function(m){dojo.stopEvent(m);window.location=this.oPorEdition.href});this.osectionFooterSub!==null&&dojo.connect(this.osectionFooterSub,"onclick",this,function(m){dojo.stopEvent(m);window.location=this.osectionFooterSub.href});this.osectionFooterNonSub!==null&&dojo.connect(this.osectionFooterNonSub,"onclick",this,function(m){dojo.stopEvent(m);window.location=this.osectionFooterNonSub.href});if(this.currRegion=="asia"){l="Asia Edition";this.oSelectedEdition=dojo.query(j,this.oHeader)[0]}else if(this.currRegion=="asia,india"){l="Asia Edition";this.oSelectedEdition=dojo.query(h,this.oHeader)[0]}else if(this.currRegion=="europe"){l="Europe Edition";this.oSelectedEdition=dojo.query(g,this.oHeader)[0]}else{l="U.S. Edition";this.oSelectedEdition=dojo.query(f,this.oHeader)[0]}dojo.addClass(this.oSelectedEdition,"selected");this.oCurrentEdition.innerHTML=l;this.oFormFactorContainer=dojo.byId("formFactorContainer");dojo.style(this.oFormFactorContainer,{display:""});this.oLocDropDownContainer=dojo.byId("locNavContainer");dojo.style(this.oLocDropDownContainer,{display:""});if(this.oLocDropDownContainer!==null){dojo.connect(this.oLocationNav,"onclick",this,function(m){dojo.stopEvent(m);if(dojo.hasClass(b.oLocDropDownContainer,c)){dojo.removeClass(b.oLocDropDownContainer,c);dojo.addClass(b.oLocDropDownContainer,e)}else if(dojo.hasClass(b.oLocDropDownContainer,e)){dojo.removeClass(b.oLocDropDownContainer,e);dojo.addClass(b.oLocDropDownContainer,c)}});dojo.connect(document,"onclick",this,function(m){if(dj.util.Element.contains(this.oLocDropDownContainer,m.clientX,m.clientY)==false)if(dojo.hasClass(this.oLocDropDownContainer,e)){dojo.removeClass(this.oLocDropDownContainer,e);dojo.addClass(this.oLocDropDownContainer,c)}});this.oSectionFooterNonSub=dojo.byId("sectionFooterNonSub");this.oSectionFooterSub=dojo.byId("sectionFooterSub");dj.util.User.isLoggedIn(function(m){if(m){dojo.style(b.oSectionFooterNonSub,{display:"none"});dojo.style(b.oSectionFooterSub,{display:""})}else{dojo.style(b.oSectionFooterNonSub,{display:""});dojo.style(b.oSectionFooterSub,{display:"none"})}})}},displayTimeStamp:function(){this.oTimestamp=dojo.query(this.cfg.TIMESTAMP_CLASS,this.oHeader)[0];if(typeof pDate!=="undefined"&&this.oTimestamp!==null)this.oTimestamp.innerHTML=window.pStl=="renovation"?dj.util.Date.displayTime(pDate,pDateinGMT):pDate},displaySubSection:function(){this.oCurrentSubSection=dojo.query(this.cfg.CURRENT_SUBSECTION_DISPLAY_CLASS,this.oHeader)[0];if(typeof globalHeaderPageTitle!=="undefined"&&globalHeaderPageTitle!==null&&globalHeaderPageTitle!==""){this.oCurrentSubSection.innerHTML=globalHeaderPageTitle;this._delayedFadeInSubSection()}},_delayedFadeInSubSection:function(){setTimeout(dojo.hitch(this,function(){dojo.style(this.oCurrentSubSection,{display:"inline",opacity:0});dojo.fadeIn({node:this.oCurrentSubSection,duration:this.cfg.WSJ_LOGO_FADE_APPEAR_DURATION*1E3}).play()}),this.cfg.WSJ_LOGO_DELAY_DURATION)},displaySubscriberDetails:function(){dj.util.User.renderCallsign(this.cfg.USER_NAME_ELEMENT_ID);this.setupSubscriberLinks();this.oMessageCenterLink=dojo.query(this.cfg.MESSAGE_CENTER_LINK_CLASS,this.oHeader)[0];var b=this;dj.util.User.isSubLoggedIn(function(c){if(c)b.setupMessageCenter();else{b.setUpMJLinksForReg();dojo.style(b.oMessageCenterLink,{display:"none"})}});this.oSubscriberDetails=dojo.byId(this.cfg.SUBSCRIBER_DETAILS_ELEMENT_ID);dojo.removeClass(this.oSubscriberDetails,"hidden")},setUpMJLinksForReg:function(){this.oFooter=dojo.query(this.cfg.FOOTER_CONTAINER_CLASS)[0];var b=this.cfg.MOJ_LINK_URL,c=this.cfg.MOJ_LINK_CLASS;this.oMojLinkHeader=dojo.query(c,this.oHeader)[0];this.oMojLinkFooter=dojo.query(c,this.oFooter)[0];if(typeof gcDomain!=="undefined"&&gcDomain!==null&&gcDomain!==""){this.oMojLinkHeader.href="http://"+gcDomain+b;this.oMojLinkFooter.href="http://"+gcDomain+b}else{this.oMojLinkHeader.href=b;this.oMojLinkFooter.href=b}},setupSubscriberLinks:function(){this.oTodaysPaperLink=dojo.query(this.cfg.TODAYS_PAPER_LINK_CLASS,this.oHeader)[0];var b=this.cfg.LOGGED_IN_TODAYS_PAPER_URL,c=this;dj.util.User.isSubLoggedIn(function(e){if(e)c.oTodaysPaperLink.href=typeof gcDomain!=="undefined"&&gcDomain!==null&&gcDomain!==""?"http://"+gcDomain+b:b})},setupMessageCenter:function(){this.oMessageCenterLink=dojo.query(this.cfg.MESSAGE_CENTER_LINK_CLASS,this.oHeader)[0];this.oMessageCount=dojo.query(this.cfg.MESSAGE_COUNT_CLASS,this.oHeader)[0];var b=this,c=function(f){if(f==="-1")dojo.style(b.oMessageCenterLink,{display:"none"});else b.oMessageCount.innerHTML=f},e=dj.util.Cookie.getCookie("msgCount");e===null?dojo.xhrPost({url:this.cfg.MESSAGE_CENTER_POST_URL,load:function(f){e=f.MessagesCount;f=f.Status;dj.util.Cookie.setCookie("msgCount",e,5/24/60);dj.util.Cookie.setCookie("userStatus",f,5/24/60);c(e)},error:function(f,g){console.error("Exception occured while posting posting Ajax Request: %s",g)}}):c(e)},setupLogin:function(){this.oUserName=dojo.byId(this.cfg.LOGIN_USERNAME_ELEMENT_ID);this.oPassword=dojo.byId(this.cfg.LOGIN_PASSWORD_ELEMENT_ID);this.oLoginImg=dojo.byId(this.cfg.LOGIN_BUTTON_ELEMENT_ID);this.oLoginForm=dojo.byId(this.cfg.LOGIN_FORM_ID);this.oLoginForm.reset();this.oPageUrl=dojo.byId(this.cfg.PAGE_URL_ELEMENT_ID);var b=this;if(this.oPageUrl!==null){var c=this.cfg.NONSUBSCRIBER_HOMEPAGE_PID,e=this.cfg.NONSUBSCRIBER_SEARCH_PAGE_PID,f=this.cfg.NONSUBSCRIBER_NEWSLETTERS_ALERTS_PAGE_PID,g=this.cfg.MDC_PAGE_PID,h;h=typeof gcDomain!=="undefined"&&gcDomain!==null&&gcDomain!==""?"http://"+gcDomain:"http://"+document.domain;var j;var k=j=dojo.isIE?window.location.href:document.location.href;if(typeof pID!=="undefined"){k=pID===c?h+this.cfg.HOMEPAGE_SUBSCRIBER_URL:pID===f?h+"/email":pID===e?h+this.cfg.SEARCH_PAGE_SUBSCRIBER_URL:pID===g?h+this.cfg.MDC_LINK_URL:j;if(dojo.isIE)document.login_form.url.value=k;else this.oPageUrl.value=k}if(this.oUserName!==null){dojo.connect(this.oUserName,"onfocus",this,function(){dj.util.Form.clearValue(this.oUserName,"User Name")});dojo.connect(this.oUserName,"onclick",this,function(){dj.util.Form.clearValue(this.oUserName,"User Name")})}if(this.oPassword!==null){dojo.connect(this.oPassword,"onfocus",this,function(){dj.util.Form.clearValue(b.oPassword,"Password");this.oPassword.type="password"});dojo.connect(this.oPassword,"onclick",this,function(){dj.util.Form.clearValue(b.oPassword,"Password")});dojo.connect(this.oPassword,"onchange",this,function(){dj.util.Form.clearValue(b.oPassword,"Password")})}dojo.isIE&&dojo.connect(this.oLoginImg,"onclick",this,function(){document.login_form.url.value=j;console.log("coming in to img onlick in IE"+j);this.oLoginForm.submit()});dojo.connect(this.oPassword,"onkeypress",this,function(l){l=l.keyCode||l.which;if(dojo.isIE)if(l==Event.KEY_RETURN){document.login_form.url.value=j;this.oLoginForm.submit()}})}},setupLogout:function(){this.oLogout=dojo.byId(this.cfg.LOGOUT_LINK_ELEMENT_ID);this.oLogout!==null&&dojo.connect(this.oLogout,"onclick",this,function(b){dojo.stopEvent(b);dj.util.Cookie.deleteCookie("msgCount");dj.util.Cookie.deleteCookie("HOMEPAGE",true);document.cookie="HOMEPAGE=;path=/;domain=.wsj.com;expires=Thu, 01-Jan-1970 00:00:01 GMT";window.location=typeof gcDomain!=="undefined"&&gcDomain!==null&&gcDomain!==""?"/logout?url=http://"+gcDomain:"/logout"})},highlightFormFactorLinks:function(){this.oTodaysPaperLinkContainer=dojo.query(this.cfg.TODAYS_PAPER_LINK_CONTAINER_CLASS,this.oHeader)[0];this.oVideoLinkContainer=dojo.query(this.cfg.VIDEO_LINK_CONTAINER_CLASS,this.oHeader)[0];this.oBlogsLinkContainer=dojo.query(this.cfg.BLOGS_LINK_CONTAINER_CLASS,this.oHeader)[0];this.oColumnsLinkContainer=dojo.query(this.cfg.COLUMNS_LINK_CONTAINER_CLASS,this.oHeader)[0];this.oInteractiveGraphicsLinkContainer=dojo.query(this.cfg.INTERACTIVE_GRAPHICS_LINK_CONTAINER_CLASS,this.oHeader)[0];this.oTopicsLinkContainer=dojo.query(this.cfg.TOPICS_LINK_CONTAINER_CLASS,this.oHeader)[0];this.oCommunityForumsLinkContainer=dojo.query(this.cfg.COMMUNITY_FORUMS_LINK_CONTAINER_CLASS,this.oHeader)[0];var b=this.cfg.TODAYS_PAPER_PID,c=this.cfg.TODAYS_PAPER_US_NONSUB_PID,e=this.cfg.TODAYS_PAPER_EUROPE_NONSUB_PID,f=this.cfg.TODAYS_PAPER_ASIA_NONSUB_PID,g=this.cfg.TODAYS_PAPER_US_PID,h=this.cfg.TODAYS_PAPER_EUROPE_PID,j=this.cfg.TODAYS_PAPER_ASIA_PID,k=this.cfg.TODAYS_PAPER_PAST_EDITIONS_PID,l=this.cfg.TODAYS_PAPER_INDEX_BIZ_PID,m=this.cfg.TODAYS_PAPER_INDEX_PEOPLE_PID,q=this.cfg.TODAYS_PAPER_CORRECTIONS_PID,n=this.cfg.VIDEO_PID,o=this.cfg.INTERACTIVE_GRAPHICS_PID,r=this.cfg.TOPICS_PID,u=this.cfg.COLUMNS_PID,v=this.cfg.BLOGS_PID,w=document.location.host+this.cfg.COMMUNITY_HIGHLIGHT_COMPARE_URL,p=this.cfg.FORUMS_HIGHLIGHT_COMPARE_URL;if(typeof pID!=="undefined")if(pID.indexOf(b)==0||pID===c||pID===e||pID===f||pID===g||pID===h||pID===j||pID===k||pID===l||pID===m||pID===q)dojo.addClass(this.oTodaysPaperLinkContainer,"selected");else if(pID===n)dojo.addClass(this.oVideoLinkContainer,"selected");else if(pID===o)dojo.addClass(this.oInteractiveGraphicsLinkContainer,"selected");else if(pID===u)dojo.addClass(this.oColumnsLinkContainer,"selected");else if(pID===v)dojo.addClass(this.oBlogsLinkContainer,"selected");else pID===r&&dojo.addClass(this.oTopicsLinkContainer,"selected");if(document.location.href!==null&&document.location.href!==""&&document.location.href.indexOf(w)!==-1||document.location.href.indexOf(p)!==-1)dojo.addClass(this.oCommunityForumsLinkContainer,"selected")}}}();dojo.provide("dj.module.showSectionAndTicker");dojo.require("dj.module.newsTicker");dj.module.showSectionAndTicker={init:function(){this.sectPan=dj.module.carouselSection.panels;this.newsPan=dj.module.newsTicker.ticker;!this.sectPan||!this.newsPan?console.warn("{showSectionAndTicker} either (or both) of the carousels is not found"):this.bind()},bind:function(){var a=0,b=this.sectPan,c=this.newsPan,e=b.model.getNumberOfPanels();c.model.setRotationState(0);b.model.addChangeListener("success",function(f){f.getPosition()==e&&a++;if(f.getPosition()==1&&a>0){b.model.setRotationState(0);c.model.setRotationState(1)}});b.model.addChangeListener("rotationStateSuccess",function(f){f==0?c.model.setRotationState(1):c.model.setRotationState(0)})}};
dojo.provide("dj.module.marketdata.excanvas");if(!document.createElement('canvas').getContext){(function(exports){var m=Math;var mr=m.round;var ms=m.sin;var mc=m.cos;var abs=m.abs;var sqrt=m.sqrt;var Z=10;var Z2=Z/2;function getContext(){return this.context_||(this.context_=new CanvasRenderingContext2D_(this));}
var slice=Array.prototype.slice;function bind(f,obj,var_args){var a=slice.call(arguments,2);return function(){return f.apply(obj,a.concat(slice.call(arguments)));};}
var G_vmlCanvasManager_={init:function(opt_doc){if(/MSIE/.test(navigator.userAgent)&&!window.opera){var doc=opt_doc||document;doc.createElement('canvas');doc.attachEvent('onreadystatechange',bind(this.init_,this,doc));}},init_:function(doc){if(!doc.namespaces['g_vml_']){doc.namespaces.add('g_vml_','urn:schemas-microsoft-com:vml','#default#VML');}
if(!doc.namespaces['g_o_']){doc.namespaces.add('g_o_','urn:schemas-microsoft-com:office:office','#default#VML');}
if(!doc.styleSheets['ex_canvas_']){var ss=doc.createStyleSheet();ss.owningElement.id='ex_canvas_';ss.cssText='canvas{display:inline-block;overflow:hidden;'+'text-align:left;width:300px;height:150px}'+'g_vml_\\:*{behavior:url(#default#VML)}'+'g_o_\\:*{behavior:url(#default#VML)}';}
var els=doc.getElementsByTagName('canvas');for(var i=0;i<els.length;i++){this.initElement(els[i]);}},initElement:function(el,width,height){if(!el.getContext){this.width=width;this.height=height;el.getContext=getContext;el.attachEvent('onpropertychange',onPropertyChange);el.attachEvent('onresize',onResize);var attrs=el.attributes;if(attrs.width&&attrs.width.specified){el.style.width=attrs.width.nodeValue+'px';}else{el.width=el.clientWidth;}
if(attrs.height&&attrs.height.specified){el.style.height=attrs.height.nodeValue+'px';}else{el.height=el.clientHeight;}}
return el;}};function onPropertyChange(e){var el=e.srcElement;switch(e.propertyName){case'width':el.style.width=el.attributes.width.nodeValue+'px';el.getContext().clearRect();break;case'height':el.style.height=el.attributes.height.nodeValue+'px';el.getContext().clearRect();break;}}
function onResize(e){var el=e.srcElement;if(el.firstChild){el.firstChild.style.width=el.clientWidth+'px';el.firstChild.style.height=el.clientHeight+'px';}}
var dec2hex=[];for(var i=0;i<16;i++){for(var j=0;j<16;j++){dec2hex[i*16+j]=i.toString(16)+j.toString(16);}}
function createMatrixIdentity(){return[[1,0,0],[0,1,0],[0,0,1]];}
function matrixMultiply(m1,m2){var result=createMatrixIdentity();for(var x=0;x<3;x++){for(var y=0;y<3;y++){var sum=0;for(var z=0;z<3;z++){sum+=m1[x][z]*m2[z][y];}
result[x][y]=sum;}}
return result;}
function copyState(o1,o2){o2.fillStyle=o1.fillStyle;o2.lineCap=o1.lineCap;o2.lineJoin=o1.lineJoin;o2.lineWidth=o1.lineWidth;o2.miterLimit=o1.miterLimit;o2.shadowBlur=o1.shadowBlur;o2.shadowColor=o1.shadowColor;o2.shadowOffsetX=o1.shadowOffsetX;o2.shadowOffsetY=o1.shadowOffsetY;o2.strokeStyle=o1.strokeStyle;o2.globalAlpha=o1.globalAlpha;o2.arcScaleX_=o1.arcScaleX_;o2.arcScaleY_=o1.arcScaleY_;o2.lineScale_=o1.lineScale_;}
function processStyle(styleString){var str,alpha=1;styleString=String(styleString);if(styleString.substring(0,3)=='rgb'){var start=styleString.indexOf('(',3);var end=styleString.indexOf(')',start+1);var guts=styleString.substring(start+1,end).split(',');str='#';for(var i=0;i<3;i++){str+=dec2hex[Number(guts[i])];}
if(guts.length==4&&styleString.substr(3,1)=='a'){alpha=guts[3];}}else{str=styleString;}
return{color:str,alpha:alpha};}
function processLineCap(lineCap){switch(lineCap){case'butt':return'flat';case'round':return'round';case'square':default:return'square';}}
function CanvasRenderingContext2D_(surfaceElement){this.m_=createMatrixIdentity();this.mStack_=[];this.aStack_=[];this.currentPath_=[];this.strokeStyle='#000';this.fillStyle='#000';this.lineWidth=1;this.lineJoin='miter';this.lineCap='butt';this.miterLimit=Z*1;this.globalAlpha=1;this.canvas=surfaceElement;var el=surfaceElement.ownerDocument.createElement('div');el.style.width=G_vmlCanvasManager_.width;el.style.height=G_vmlCanvasManager_.height;el.style.overflow='hidden';el.style.position='absolute';surfaceElement.appendChild(el);this.element_=el;this.arcScaleX_=1;this.arcScaleY_=1;this.lineScale_=1;}
var contextPrototype=CanvasRenderingContext2D_.prototype;contextPrototype.clearRect=function(){this.element_.innerHTML='';this.currentPath_=[];};contextPrototype.beginPath=function(){this.currentPath_=[];};contextPrototype.moveTo=function(aX,aY){var p=this.getCoords_(aX,aY);this.currentPath_.push({type:'moveTo',x:p.x,y:p.y});this.currentX_=p.x;this.currentY_=p.y;};contextPrototype.lineTo=function(aX,aY){var p=this.getCoords_(aX,aY);this.currentPath_.push({type:'lineTo',x:p.x,y:p.y});this.currentX_=p.x;this.currentY_=p.y;};contextPrototype.bezierCurveTo=function(aCP1x,aCP1y,aCP2x,aCP2y,aX,aY){var p=this.getCoords_(aX,aY);var cp1=this.getCoords_(aCP1x,aCP1y);var cp2=this.getCoords_(aCP2x,aCP2y);bezierCurveTo(this,cp1,cp2,p);};function bezierCurveTo(self,cp1,cp2,p){self.currentPath_.push({type:'bezierCurveTo',cp1x:cp1.x,cp1y:cp1.y,cp2x:cp2.x,cp2y:cp2.y,x:p.x,y:p.y});self.currentX_=p.x;self.currentY_=p.y;}
contextPrototype.quadraticCurveTo=function(aCPx,aCPy,aX,aY){var cp=this.getCoords_(aCPx,aCPy);var p=this.getCoords_(aX,aY);var cp1={x:this.currentX_+2.0/3.0*(cp.x-this.currentX_),y:this.currentY_+2.0/3.0*(cp.y-this.currentY_)};var cp2={x:cp1.x+(p.x-this.currentX_)/3.0,y:cp1.y+(p.y-this.currentY_)/3.0};bezierCurveTo(this,cp1,cp2,p);};contextPrototype.arc=function(aX,aY,aRadius,aStartAngle,aEndAngle,aClockwise){aRadius*=Z;var arcType=aClockwise?'at':'wa';var xStart=aX+mc(aStartAngle)*aRadius-Z2;var yStart=aY+ms(aStartAngle)*aRadius-Z2;var xEnd=aX+mc(aEndAngle)*aRadius-Z2;var yEnd=aY+ms(aEndAngle)*aRadius-Z2;if(xStart==xEnd&&!aClockwise){xStart+=0.125;}
var p=this.getCoords_(aX,aY);var pStart=this.getCoords_(xStart,yStart);var pEnd=this.getCoords_(xEnd,yEnd);this.currentPath_.push({type:arcType,x:p.x,y:p.y,radius:aRadius,xStart:pStart.x,yStart:pStart.y,xEnd:pEnd.x,yEnd:pEnd.y});};contextPrototype.rect=function(aX,aY,aWidth,aHeight){this.moveTo(aX,aY);this.lineTo(aX+aWidth,aY);this.lineTo(aX+aWidth,aY+aHeight);this.lineTo(aX,aY+aHeight);this.closePath();};contextPrototype.strokeRect=function(aX,aY,aWidth,aHeight){this.beginPath();this.moveTo(aX,aY);this.lineTo(aX+aWidth,aY);this.lineTo(aX+aWidth,aY+aHeight);this.lineTo(aX,aY+aHeight);this.closePath();this.stroke();this.currentPath_=[];};contextPrototype.fillRect=function(aX,aY,aWidth,aHeight){this.beginPath();this.moveTo(aX,aY);this.lineTo(aX+aWidth,aY);this.lineTo(aX+aWidth,aY+aHeight);this.lineTo(aX,aY+aHeight);this.closePath();this.fill();this.currentPath_=[];};contextPrototype.createLinearGradient=function(aX0,aY0,aX1,aY1){var gradient=new CanvasGradient_('gradient');gradient.x0_=aX0;gradient.y0_=aY0;gradient.x1_=aX1;gradient.y1_=aY1;return gradient;};contextPrototype.createRadialGradient=function(aX0,aY0,aR0,aX1,aY1,aR1){var gradient=new CanvasGradient_('gradientradial');gradient.x0_=aX0;gradient.y0_=aY0;gradient.r0_=aR0;gradient.x1_=aX1;gradient.y1_=aY1;gradient.r1_=aR1;return gradient;};contextPrototype.drawImage=function(image,var_args){var dx,dy,dw,dh,sx,sy,sw,sh;var oldRuntimeWidth=image.runtimeStyle.width;var oldRuntimeHeight=image.runtimeStyle.height;image.runtimeStyle.width='auto';image.runtimeStyle.height='auto';var w=image.width;var h=image.height;image.runtimeStyle.width=oldRuntimeWidth;image.runtimeStyle.height=oldRuntimeHeight;if(arguments.length==3){dx=arguments[1];dy=arguments[2];sx=sy=0;sw=dw=w;sh=dh=h;}else if(arguments.length==5){dx=arguments[1];dy=arguments[2];dw=arguments[3];dh=arguments[4];sx=sy=0;sw=w;sh=h;}else if(arguments.length==9){sx=arguments[1];sy=arguments[2];sw=arguments[3];sh=arguments[4];dx=arguments[5];dy=arguments[6];dw=arguments[7];dh=arguments[8];}else{throw Error('Invalid number of arguments');}
var d=this.getCoords_(dx,dy);var w2=sw/2;var h2=sh/2;var vmlStr=[];var W=10;var H=10;vmlStr.push(' <g_vml_:group',' coordsize="',Z*W,',',Z*H,'"',' coordorigin="0,0"',' style="width:',W,'px;height:',H,'px;position:absolute;');if(this.m_[0][0]!=1||this.m_[0][1]){var filter=[];filter.push('M11=',this.m_[0][0],',','M12=',this.m_[1][0],',','M21=',this.m_[0][1],',','M22=',this.m_[1][1],',','Dx=',mr(d.x/Z),',','Dy=',mr(d.y/Z),'');var max=d;var c2=this.getCoords_(dx+dw,dy);var c3=this.getCoords_(dx,dy+dh);var c4=this.getCoords_(dx+dw,dy+dh);max.x=m.max(max.x,c2.x,c3.x,c4.x);max.y=m.max(max.y,c2.y,c3.y,c4.y);vmlStr.push('padding:0 ',mr(max.x/Z),'px ',mr(max.y/Z),'px 0;filter:progid:DXImageTransform.Microsoft.Matrix(',filter.join(''),", sizingmethod='clip');")}else{vmlStr.push('top:',mr(d.y/Z),'px;left:',mr(d.x/Z),'px;');}
vmlStr.push(' ">','<g_vml_:image src="',image.src,'"',' style="width:',Z*dw,'px;',' height:',Z*dh,'px;"',' cropleft="',sx/w,'"',' croptop="',sy/h,'"',' cropright="',(w-sx-sw)/w,'"',' cropbottom="',(h-sy-sh)/h,'"',' />','</g_vml_:group>');this.element_.insertAdjacentHTML('BeforeEnd',vmlStr.join(''));};contextPrototype.stroke=function(aFill){var lineStr=[];var lineOpen=false;var a=processStyle(aFill?this.fillStyle:this.strokeStyle);var color=a.color;var opacity=a.alpha*this.globalAlpha;var W=10;var H=10;lineStr.push('<g_vml_:shape',' filled="',!!aFill,'"',' style="position:absolute;width:',W,'px;height:',H,'px;"',' coordorigin="0 0" coordsize="',Z*W,' ',Z*H,'"',' stroked="',!aFill,'"',' path="');var newSeq=false;var min={x:null,y:null};var max={x:null,y:null};for(var i=0;i<this.currentPath_.length;i++){var p=this.currentPath_[i];var c;switch(p.type){case'moveTo':c=p;lineStr.push(' m ',mr(p.x),',',mr(p.y));break;case'lineTo':lineStr.push(' l ',mr(p.x),',',mr(p.y));break;case'close':lineStr.push(' x ');p=null;break;case'bezierCurveTo':lineStr.push(' c ',mr(p.cp1x),',',mr(p.cp1y),',',mr(p.cp2x),',',mr(p.cp2y),',',mr(p.x),',',mr(p.y));break;case'at':case'wa':lineStr.push(' ',p.type,' ',mr(p.x-this.arcScaleX_*p.radius),',',mr(p.y-this.arcScaleY_*p.radius),' ',mr(p.x+this.arcScaleX_*p.radius),',',mr(p.y+this.arcScaleY_*p.radius),' ',mr(p.xStart),',',mr(p.yStart),' ',mr(p.xEnd),',',mr(p.yEnd));break;}
if(p){if(min.x==null||p.x<min.x){min.x=p.x;}
if(max.x==null||p.x>max.x){max.x=p.x;}
if(min.y==null||p.y<min.y){min.y=p.y;}
if(max.y==null||p.y>max.y){max.y=p.y;}}}
lineStr.push(' ">');if(!aFill){var lineWidth=this.lineScale_*this.lineWidth;if(lineWidth<1){opacity*=lineWidth;}
lineStr.push('<g_vml_:stroke',' opacity="',opacity,'"',' joinstyle="',this.lineJoin,'"',' miterlimit="',this.miterLimit,'"',' endcap="',processLineCap(this.lineCap),'"',' weight="',lineWidth,'px"',' color="',color,'" />');}else if(typeof this.fillStyle=='object'){var fillStyle=this.fillStyle;var angle=0;var focus={x:0,y:0};var shift=0;var expansion=1;if(fillStyle.type_=='gradient'){var x0=fillStyle.x0_/this.arcScaleX_;var y0=fillStyle.y0_/this.arcScaleY_;var x1=fillStyle.x1_/this.arcScaleX_;var y1=fillStyle.y1_/this.arcScaleY_;var p0=this.getCoords_(x0,y0);var p1=this.getCoords_(x1,y1);var dx=p1.x-p0.x;var dy=p1.y-p0.y;angle=Math.atan2(dx,dy)*180/Math.PI;if(angle<0){angle+=360;}
if(angle<1e-6){angle=0;}}else{var p0=this.getCoords_(fillStyle.x0_,fillStyle.y0_);var width=max.x-min.x;var height=max.y-min.y;focus={x:(p0.x-min.x)/width,y:(p0.y-min.y)/height};width/=this.arcScaleX_*Z;height/=this.arcScaleY_*Z;var dimension=m.max(width,height);shift=2*fillStyle.r0_/dimension;expansion=2*fillStyle.r1_/dimension-shift;}
var stops=fillStyle.colors_;stops.sort(function(cs1,cs2){return cs1.offset-cs2.offset;});var length=stops.length;var color1=stops[0].color;var color2=stops[length-1].color;var opacity1=stops[0].alpha*this.globalAlpha;var opacity2=stops[length-1].alpha*this.globalAlpha;var colors=[];for(var i=0;i<length;i++){var stop=stops[i];colors.push(stop.offset*expansion+shift+' '+stop.color);}
lineStr.push('<g_vml_:fill type="',fillStyle.type_,'"',' method="none" focus="100%"',' color="',color1,'"',' color2="',color2,'"',' colors="',colors.join(','),'"',' opacity="',opacity2,'"',' g_o_:opacity2="',opacity1,'"',' angle="',angle,'"',' focusposition="',focus.x,',',focus.y,'" />');}else{lineStr.push('<g_vml_:fill color="',color,'" opacity="',opacity,'" />');}
lineStr.push('</g_vml_:shape>');this.element_.insertAdjacentHTML('beforeEnd',lineStr.join(''));};contextPrototype.fill=function(){this.stroke(true);}
contextPrototype.closePath=function(){this.currentPath_.push({type:'close'});};contextPrototype.getCoords_=function(aX,aY){var m=this.m_;return{x:Z*(aX*m[0][0]+aY*m[1][0]+m[2][0])-Z2,y:Z*(aX*m[0][1]+aY*m[1][1]+m[2][1])-Z2}};contextPrototype.save=function(){var o={};copyState(this,o);this.aStack_.push(o);this.mStack_.push(this.m_);this.m_=matrixMultiply(createMatrixIdentity(),this.m_);};contextPrototype.restore=function(){copyState(this.aStack_.pop(),this);this.m_=this.mStack_.pop();};contextPrototype.translate=function(aX,aY){var m1=[[1,0,0],[0,1,0],[aX,aY,1]];this.m_=matrixMultiply(m1,this.m_);};contextPrototype.rotate=function(aRot){var c=mc(aRot);var s=ms(aRot);var m1=[[c,s,0],[-s,c,0],[0,0,1]];this.m_=matrixMultiply(m1,this.m_);};contextPrototype.scale=function(aX,aY){this.arcScaleX_*=aX;this.arcScaleY_*=aY;var m1=[[aX,0,0],[0,aY,0],[0,0,1]];var m=this.m_=matrixMultiply(m1,this.m_);var det=m[0][0]*m[1][1]-m[0][1]*m[1][0];this.lineScale_=sqrt(abs(det));};contextPrototype.clip=function(){};contextPrototype.arcTo=function(){};contextPrototype.createPattern=function(){return new CanvasPattern_;};function CanvasGradient_(aType){this.type_=aType;this.x0_=0;this.y0_=0;this.r0_=0;this.x1_=0;this.y1_=0;this.r1_=0;this.colors_=[];}
CanvasGradient_.prototype.addColorStop=function(aOffset,aColor){aColor=processStyle(aColor);this.colors_.push({offset:aOffset,color:aColor.color,alpha:aColor.alpha});};function CanvasPattern_(){}
exports.G_vmlCanvasManager=G_vmlCanvasManager_;exports.CanvasRenderingContext2D=CanvasRenderingContext2D_;exports.CanvasGradient=CanvasGradient_;exports.CanvasPattern=CanvasPattern_;})(window);}
dojo.provide("dj.module.marketdata.marketwatch");(function(exports){var BlueGrass={};if(typeof(MarketWatch)=="undefined"){var MarketWatch=new(function(){this.Sample={area:"sample"};this.Section={area:"section"};this.Investing={area:"investing"};this.Story={area:"story"};this.News={area:"news"};this.Community={area:"community"};this.Community.InstrumentPicker={area:"community"};this.Community.TopPickers={area:"community"};this.Community.PickerAccordian={area:"community"};this.Community.CommenterGrid={area:"community"};this.Community.FilteredCommentTabs={area:"community"};this.Search={area:"search"};this.MarketState={component:"marketstate"};this.Member={component:"member"};this.DockingBar={component:"dockingbar"};this.DockingBar.Community={component:"dockingbar"};this.DockingBar.Community.Groups={component:"dockingbar"};this.DockingBar.Portfolio={component:"dockingbar"};this.DayParting={component:"dayparting"};this.MarketsNews={component:"marketsnews"};this.Panels={component:"panels"};this.Kiosk={component:"kiosk"};this.BreakingNews={component:"breakingnews"};this.MultiQuote={component:"multiquote"};this.Investing.AdvancedCharts={area:"investing"};this.Investing.AdvancedCharts.Cookie={area:"investing"};this.UI={component:"ui"};this.FishHawk={component:"fishhawk"};this.Video={component:"video"};this.Investing.MutualFunds={area:"investing"};var _baseUrl="";this.setBaseUrl=function(url){_baseUrl=url;};this.getBaseUrl=function(){return _baseUrl;};})();}
if(typeof(string)=="undefined"){var string=(new function(){return{IsNullOrEmpty:function(theString){return(typeof(theString)=="undefined"||!theString||theString.length==0);}}}());}
else{string.IsNullOrEmpty=function(theString){return(typeof(theString)=="undefined"||!theString||theString.length==0);}}
String.prototype.IndexOf=function(val){return this.indexOf(val);}
String.prototype.Substring=function(start){return this.substring(start);}
var Html=new(function(){var thunk=this;var _headlineModelLink=function(text,object,options){var area=options.area||options.Area||"story";var controller=options.controller||options.Controller||"story";var action=null;var guid=object.DocGuid;var attr=null;var queryString="guid="+object.DocGuid.Value;text=object.HeadlineText;if(options&&typeof(options.MaxLength)=="number")
text=text.substring(0,options.MaxLength);if(typeof(object.ContentType)=="number")
object.ContentType=_getContentType(object.ContentType);if(object.ContentType=="headline"){if(typeof(options.LinkDocType90)=="undefined"||options.LinkDocType90==null||options.LinkDocType90==true){if(object.Instruments&&object.Instruments.length>0&&object.Instruments[0].Ticker){if(typeof(options.LinkTickerAsHeadline)!="undefined"&&options.LinkTickerAsHeadline){return _instrumentModelLink(text,object.Instruments[0],{});}
return"["+_instrumentModelLink(object.Instruments[0].Ticker,object.Instruments[0],{})+"] "+text;}}
return text;}
else if(object.ContentType=="nofollow"){attr='rel="nofollow"';}
if(object.SeoHeadlineFragment&&object.SeoHeadlineFragment.length>0){controller=null;action=object.SeoHeadlineFragment.substr(1);queryString=null;}
return thunk.ActionLink(text,area,controller,action,queryString,attr);};var _instrumentModelLink=function(text,object,options){var area=options.area||options.Area||"investing";var controller=options.controller||options.Controller||"stock";if(!object.Ticker)
return;if(object.Type)
controller=_getInstrumentType(object.Type);if(!text||text.length==0)
text=object.Ticker
var area="investing";var action=object.Ticker+"/overview";var queryString="";if(object.CountryCode&&object.CountryCode.toLowerCase()!="us")
queryString="countrycode="+object.CountryCode;return thunk.ActionLink(text,area,controller,action,queryString,null);};var _getContentType=function(type){switch(type){case 1:return"story";case 2:return"audio";case 3:return"video";case 4:return"nofollow";case 5:return"headline";}
return"story";};var _getInstrumentType=function(instrumentType){if(typeof(instrumentType)=="number"){switch(instrumentType){case 0:return"bond";case 2:return"currency";case 1:case 3:case 4:case 7:return"fund";case 5:return"future";case 6:return"index";case 8:case 9:case 10:return"option";}}
else if(instrumentType=="bond"||instrumentType=="currency"||instrumentType=="fund"||instrumentType=="future"||instrumentType=="index"||instrumentType=="option")
return instrumentType;return"stock";}
this.ModelLink=function(textOrObject,objectOrOptions,options){var text=textOrObject;var object=objectOrOptions;if(typeof(textOrObject)!="string"){text="";object=textOrObject;options=objectOrOptions;}
if(!options)options={};if(object.HeadlineText){return _headlineModelLink(text,object,options);}
else if(object.Ticker){return _instrumentModelLink(text,object,options);}};this.ActionLink=function(text,area,controller,action,queryString,attr){var link='<a '+(attr?attr:'')+' href="'+MarketWatch.getBaseUrl()+'/'+area+(controller?'/'+controller:'')+(action?'/'+action:'')+(queryString?'?'+queryString:'')+'">'+text+'</a>';return link;};this.GetShortDateStampMarkup=function(utcTimestamp,offset){if(typeof(BlueGrass)!="undefined"&&BlueGrass.Utility){var date=BlueGrass.Utility.convertToExchangeTime(utcTimestamp,offset);var now=new Date();var diff=now.getTime()-date.getTime();if(diff>86400000||now.getUTCDate()!=date.getUTCDate())
return"<span>"+date.dateFormat("m/d")+"</span>";var formatted=date.dateFormat("g:ia");return"<span>"+formatted.substring(0,formatted.length-1)+"</span>";}
return"<span>&nbsp;</span>";};this.GetTimeAgoMarkup=function(utcTimestamp,offset){if(typeof(BlueGrass)!="undefined"&&BlueGrass.Utility){var date=BlueGrass.Utility.convertToExchangeTime(utcTimestamp,offset);var now=new Date();var nowUtc=new Date().getTime();var easternNow=BlueGrass.Utility.convertToExchangeTime(nowUtc+"",offset);var diff=easternNow.getTime()-date.getTime();var formatted=date.dateFormat("g:ia Today");if(diff>86400000||now.getUTCDate()!=date.getUTCDate())
return"<span>"+date.dateFormat("g:ia n/d/y")+"</span>";else if(diff<=3600000){var ceiling=Math.ceil(diff/60000);if(ceiling==0)
formatted="< 1 min ago"
else
formatted=ceiling+" min ago";}
return"<span class='timeAgo'><span>"+formatted+"</span>"+"<span class='invisible'>"+date.dateFormat("g:ia n/d/y")+"</span></span>";}
return"<span>&nbsp;</span>";};this.GetShortTimeAgoMarkup=function(utcTimestamp,offset){if(typeof(BlueGrass)!="undefined"&&BlueGrass.Utility){var date=BlueGrass.Utility.convertToExchangeTime(utcTimestamp,offset);var now=new Date();var nowUtc=new Date().getTime();var easternNow=BlueGrass.Utility.convertToExchangeTime(nowUtc+"",offset);var diff=easternNow.getTime()-date.getTime();var formatted=date.dateFormat("g:ia");if(easternNow.getDay()!=date.getDay())
return"<span>"+date.dateFormat("n/d/y")+"</span>";else if(diff<=3600000){var ceiling=Math.ceil(diff/60000);if(ceiling==0)
formatted="< 1 min ago"
else
formatted=ceiling+" min ago";}
return"<span class='timeAgo short'><span>"+formatted+"</span>"+"<span class='invisible'>"+date.dateFormat("g:ia n/d/y")+"</span></span>";}
return"<span>&nbsp;</span>";};})();exports.Html=Html;exports.MarketWatch=MarketWatch;exports.BlueGrass=BlueGrass;}(window));dojo.provide("dj.module.marketdata.thunderball");(function(exports){exports.Thunderball={ChartScalingV2:{CalculateDelta2:function(preferredDivisionCount,preferMoreDivisions,allowNoGap,dMin,dMax,dStart,dFinish){if(!dMin){dMin=0;}
if(!dMax){dMax=1;}
if(preferredDivisionCount<=1||preferredDivisionCount==null||preferredDivisionCount==undefined){dStart.value=dMin;dFinish.value=dMax;return dMax-dMin;}
if(dMax<dMin){var Tmp=dMin;dMin=dMax;dMax=Tmp;}
var dMax=Math.abs(dMax);if(dMax==0)dMax=1;var Tol=5.0e-6;if((dMax-dMin)/dMax<=Tol){if(dMax<0)
dMax=0;else if(dMax==0)
dMax=1;else
dMin=0;}
var dGears=[10,5,2.5,2,1];var dBestDifference=-1;var dBestLineCount=-1;var dBestMax=0;var dBestMin=0;var dBestDelta=0;var dRange=dMax-dMin;var dRangeDivision=dRange/preferredDivisionCount;Math.log10=function(n){return this.log(n)/this.log(10);}
var dDivisionMagnitude=Math.log10(dRangeDivision);var nDivisionMultiplier=parseInt(Math.floor(dDivisionMagnitude));for(var nMagAdditive=1;nMagAdditive>-2;nMagAdditive--){for(var i=0;i<dGears.length;i++){var dTmpDelta=dGears[i]*Math.pow(10,nDivisionMultiplier+nMagAdditive);var dTmpMax=Thunderball.ChartScalingV2.Math.RoundUpToMultiple(dMax,dTmpDelta,allowNoGap);var dTmpMin=Thunderball.ChartScalingV2.Math.RoundDownToMultiple(dMin,dTmpDelta,allowNoGap);var dLineCount=Math.round((dTmpMax-dTmpMin)/dTmpDelta)+1;var dDiff=Math.abs(preferredDivisionCount-dLineCount);if((dBestDifference==-1)||(dDiff<=dBestDifference)){if(preferMoreDivisions||(dLineCount<=preferredDivisionCount)){dBestDifference=dDiff;dBestLineCount=dLineCount;dBestMax=dTmpMax;dBestMin=dTmpMin;dBestDelta=dTmpDelta;}}}}
dFinish.value=dBestMax;dStart.value=dBestMin;return dBestDelta;},Math:{RoundUpToMultiple:function(val,multiple,inclusive){var dRemainder=Math.abs(val%multiple);if((dRemainder==0)&&inclusive)
return val;if(val>0)
return val+(multiple-dRemainder);else
return val+dRemainder;},RoundDownToMultiple:function(val,multiple,inclusive){var dRemainder=Math.abs(val%multiple);if((dRemainder==0)&&inclusive)
return val;if(val>0)
return val-dRemainder;else
return val-(multiple-dRemainder);}}},Utilities:{canvas_compatible:false,Requesters:[],check_canvas:function(){try{this.canvas_compatible=!!(document.createElement('canvas').getContext('2d'));}catch(e){this.canvas_compatible=!!(document.createElement('canvas').getContext);}
return this.canvas_compatible;},DataUpdater:function(data){for(var i=0;i<Thunderball.Utilities.Requesters.length;i++){if(Thunderball.Utilities.Requesters[i].requestId==data.requestId){Thunderball.Utilities.Requesters[i].data=data;Thunderball.Utilities.Requesters[i]._didLoad();Thunderball.Utilities.Requesters.splice(i,1);}}},GetData:function(chart){var requestObject=chart.buildRequest();$.ajax({type:"POST",url:chart.url,dataType:"json",data:requestObject,success:function(data){if(data!=null&&data.length>0){var chartdata=data[0].Value;chartdata.requestId=chart.requestId;Thunderball.Utilities.DataUpdater(chartdata);data=null;}}});requestObject=null;},FormatDate:function(dateString){if(typeof dateString=="string"){var converted=0;if(dateString.indexOf("-")>=0||dateString.indexOf("+")>=0){var _userOffset=new Date().getTimezoneOffset()/60;var temp=dateString.substring(dateString.length-7,dateString.length-2);var offset=parseInt(temp.substring(2))/100;if(temp.substring(0,1)=="-"){offset=-offset;}
converted=parseInt(dateString.substring(6,dateString.length-7))+((_userOffset+offset)*3600000);}
else{converted=parseInt(dateString.substring(6,dateString.length-2));}
var dateTime=new Date(converted);return dateTime;}
else{return dateString;}},drawXaxisLines:function(chart){if(chart.style.verticalGridLineStyle){var ctx=chart.drawingContext;chart._bump=true;ctx.beginPath();var ticks=chart._timeLines;for(var i=0;i<ticks.length;i++){var x=ticks[i];ctx.moveTo(x+0.5,chart.height);ctx.lineTo(x+0.5,0);}
ctx.strokeStyle=chart.style.verticalGridLineStyle;ctx.stroke();}
if(chart.style.verticalGridLineStyle_Opaque){var ctx=chart.drawingContext;chart._bump=true;ctx.beginPath();var ticks=chart._opaqueTimeLines;for(var i=0;i<ticks.length;i++){var x=ticks[i];ctx.moveTo(x+0.5,chart.height);ctx.lineTo(x+0.5,0);}
ctx.strokeStyle=chart.style.verticalGridLineStyle_Opaque;ctx.stroke();}
chart._timeLines=[];chart._opaqueTimeLines=[];},addXAxisLabels:function(chart){var labelsToCreate=chart._xAxisLabels;var self=chart;var target=self.targetSelector;var TotalHeight=self.height;var XAxisContent="";var elmWidth=30;var elmWidthCenter;if(!self.style.xAxisLabelPadding){self.style.xAxisLabelPadding=20;}
XAxisContent="<div style='position:relative width:"+self.width+"px;'>";for(var i=0;i<labelsToCreate.length;i++){elmWidthCenter=labelsToCreate[i].x-(elmWidth/2);XAxisContent=XAxisContent+"<div style='text-align:center; position: absolute; top:"+TotalHeight+"px;left:"+elmWidthCenter+"px;width:"+elmWidth+"px' class='xValueLbl'>"+labelsToCreate[i].element+"</div>";}
XAxisContent=XAxisContent+"</div>";dojo.place(XAxisContent,target);},addTick:function(Data,Symbol,Timestamp,Price,Offset){var Sessions=Thunderball.Utilities._getSessionByTicker(Data,Symbol);if(Sessions!=null){var timestamp=BlueGrass.Utility.convertToExchangeTime(Timestamp,Offset);var where=Thunderball.Utilities._findXSession(Sessions,timestamp,Data.BarFactor);if(where&&where.x){where.Session.Trades[where.x]=Price;if(where.Session.Trades.length-2==where.x){where.Session.Trades[where.x+1]=null;}
if(where.Session.Low&&where.Session.Low.Price>Price){where.Session.Low.Price=Price;where.Session.Low.Index=where.x;}
if(where.Session.High&&where.Session.High.Price<Price){where.Session.High.Price=Price;where.Session.High.Index=where.x;}
return where;}}
return where;},_findXSession:function(Sessions,Timestamp,BarFactor){Timestamp=new Date(Timestamp);for(var i=0;i<Sessions.length;i++){var Session=Sessions[i];var ten_days=1000*60*60*24*10;if(Session.Stop.getTime()-Session.Start.getTime()<=ten_days){if(Session.Start<=Timestamp&&Timestamp<=Session.Stop){var x=(Timestamp.getTime()-Session.Start.getTime())/BarFactor;return{x:parseInt(x),Session:Session,Historical:false};}}
else{return{x:null,Session:null,Historical:true};}}
return{x:null,Session:null,Historical:false};},_getSessionByTicker:function(ChartData,Symbol){var s=Symbol.toUpperCase();for(var i=0;i<ChartData.Data.length;i++){if(ChartData.Data[i].Key==s){return ChartData.Data[i].Value.Sessions;}}
return null;}}};}(window));dojo.provide("dj.module.marketdata.chart");dojo.require("dj.module.marketdata.thunderball");dojo.require("dj.module.marketdata.marketwatch");var _PrevClose=0;var _isDEEdition=false;var WSJIndexChartStyle={background:"#ffffff",border:"#E6E2D7",closelineStyle:"#e36825",horizontalGridLineStyle:"#f4f3f1",highIndicatorStyle:"#093c71",highlowLineStyle:"#015190",lowIndicatorStyle:"#093c71",mainLineStyle:"#557BA0",mainPriceLineFill:"rgba(85,123,160,0.15)",mainPriceLineWidth:1,maxPriceLines:4,verticalGridLineStyle:"rgba(180,201,202,0.5)",verticalGridLineStyle_Opaque:"rgba(180,201,202,1.0)",vPadding:12,YAxisLabelStyle:1,YAxisLabelHeight:12,showDecimals:1,regionStyles:{0:'#cde2e0',1:'#cde2e0',2:'rgba(51,51,51,0.06)'},comparelineStyles:{0:'#cc3333',1:'#3b8dad',2:'#c9932e',3:'#b78383',4:'#8eb3bc',5:'#dbb782'}};function LegacyChart(container,legacyQueryString,width,height){var _chartBox=dojo.byId(container);var _legacyQueryString=legacyQueryString;var _width=width;var _height=height;var _currentsymbol=null;var start=legacyQueryString.indexOf("symb=")+5;var end=legacyQueryString.indexOf("&",start);if(end==-1){_currentsymbol=legacyQueryString.substr(start).toUpperCase();}else{_currentsymbol=legacyQueryString.substr(start,end-start).toUpperCase();}
var _showChart=function(){_chartBox.innerHTML="";dojo.place('<img src="//www.marketwatch.com/charts/big.chart'+_legacyQueryString+'" />',_chartBox);};return{ShowChart:function(symbol){if(symbol!=null&&symbol!=undefined&&_currentsymbol!=symbol.toUpperCase()){_currentsymbol=symbol.toUpperCase();_legacyQueryString=_legacyQueryString.replace(/sid=[^&^\n]*/i,"sid=");if(_currentsymbol.indexOf("US:CRUDE OIL - ELECTRONIC")>-1){_legacyQueryString=_legacyQueryString.replace(/symb=[^&^\n]*/i,"symb=");if(_legacyQueryString.indexOf("sid=")>-1){_legacyQueryString=_legacyQueryString.replace(/sid=[^&^\n]*/i,"sid=3343724");}else{_legacyQueryString=_legacyQueryString+"&sid=3343724";}}else if(_currentsymbol.indexOf("US:FUTURE-US-GOLD")>-1){_legacyQueryString=_legacyQueryString.replace(/symb=[^&^\n]*/i,"symb=");if(_legacyQueryString.indexOf("sid=")>-1){_legacyQueryString=_legacyQueryString.replace(/sid=[^&^\n]*/i,"sid=1782661");}else{_legacyQueryString=_legacyQueryString+"&sid=1782661";}}else if(_currentsymbol.indexOf("DX:DAX")>-1){_legacyQueryString=_legacyQueryString.replace(/symb=[^&^\n]*/i,"symb=");if(_legacyQueryString.indexOf("sid=")>-1){_legacyQueryString=_legacyQueryString.replace(/sid=[^&^\n]*/i,"sid=125284");}else{_legacyQueryString=_legacyQueryString+"&sid=125284";}}else{_legacyQueryString=_legacyQueryString.replace(/symb=[^&^\n]*/i,"symb="+_currentsymbol);}}
_showChart();},TickSubscribe:function(){},UpdateAllCharts:function(time,freq,startdate,enddate){this.UpdateChart(time,freq,startdate,enddate);},UpdateChart:function(time,freq,startdate,enddate){_legacyQueryString=_legacyQueryString.replace(/freq=[^&^\n]*/i,"freq="+freq);if(time==null||time==undefined){_legacyQueryString=_legacyQueryString.replace(/time=[^&^\n]*/i,"time=");}else{_legacyQueryString=_legacyQueryString.replace(/time=[^&^\n]*/i,"time="+time);}
if(startdate==null||startdate==undefined){_legacyQueryString=_legacyQueryString.replace(/startdate=[^&^\n]*/i,"startdate=");}else{if(_legacyQueryString.indexOf("startdate=")>-1){_legacyQueryString=_legacyQueryString.replace(/startdate=[^&^\n]*/i,"startdate="+startdate);}else{_legacyQueryString=_legacyQueryString+"&startdate="+startdate;}}
if(enddate==null||enddate!=undefined){_legacyQueryString=_legacyQueryString.replace(/enddate=[^&^\n]*/i,"enddate=");}else{if(_legacyQueryString.indexOf("enddate=")>-1){_legacyQueryString=_legacyQueryString.replace(/enddate=[^&^\n]*/i,"enddate="+enddate);}else{_legacyQueryString=_legacyQueryString+"&enddate="+enddate;}}
_showChart();},ChangeSymbol:function(symbol){var symbols=symbol.toUpperCase().split('|');_currentsymbol=symbols[0];_legacyQueryString=_legacyQueryString.replace(/symb=[^&^\n]*/i,"symb="+_currentsymbol);if(symbols.length>1){if(_legacyQueryString.indexOf("compidx=")>-1){_legacyQueryString=_legacyQueryString.replace(/compidx=[^&^\n]*/i,"compidx="+symbols[1]);}else{_legacyQueryString=_legacyQueryString+"&compidx="+symbols[1];}}else{_legacyQueryString=_legacyQueryString.replace(/compidx=[^&^\n]*/i,"compidx=");}
if(symbols.length>2){var comp="";for(var i=2;i<symbols.length;i++){if(comp.length>0){comp=comp+",";}
comp=comp+symbols[i];}
if(_legacyQueryString.indexOf("comp=")>-1){_legacyQueryString=_legacyQueryString.replace(/comp=[^&^\n]*/i,"comp="+comp);}else{_legacyQueryString=_legacyQueryString+"&comp="+comp;}}else{_legacyQueryString=_legacyQueryString.replace(/comp=[^&^\n]*/i,"comp=");}
_showChart();},SetChartRefresh:function(rate){setInterval(_showChart,rate);}}}
function EmbeddedChartMDM(container,style,width,height,time,freq,startdate,enddate,chartdata,symbol,prevClose,isDEEdition){_PrevClose=0;_PrevClose=prevClose;_isDEEdition=false;_isDEEdition=isDEEdition;return new EmbeddedChart(container,style,width,height,time,freq,startdate,enddate,chartdata,symbol);}
function EmbeddedChart(container,style,width,height,time,freq,startdate,enddate,chartdata,symbol){var _chartBox=document.getElementById(container);var _style=style;var _width=width;var _height=height;var _time=time;var _freq=freq;var _startdate=startdate;var _enddate=enddate;var _pagedata=null;var _currentsymbol=null;var _firstsymbol=symbol;var _symbolCount=0;var _chart=null;var _tick=false;var _ticktimeout=null;var _currentchannel=null;var _connection=null;var _url="/Market/ECProxy/ChartData";var _setPageData=function(data){if(data!=null&&data!=undefined&&data.length>0){if(_pagedata==null){_pagedata=[];}
for(var i=0;i<data.length;i++){if(data[i].Value!=null&&data[i].Value!=undefined&&data[i].Key!=''){_pagedata[data[i].Key]=data[i].Value;if(_pagedata[data[i].Key].Data!=null){for(var j=0;j<_pagedata[data[i].Key].Data.length;j++){for(var k=0;k<_pagedata[data[i].Key].Data[j].Value.Sessions.length;k++){var session=_pagedata[data[i].Key].Data[j].Value.Sessions[k];session.Start=new Date(Thunderball.Utilities.FormatDate(session.Start));session.Stop=new Date(Thunderball.Utilities.FormatDate(session.Stop));}}}}}}}
var _showChart=function(symbol){if(_pagedata==null){_chart=new JSChart(_chartBox,symbol.split('|'),_width,_height,_style,_freq,_time,_startdate,_enddate,undefined,MarketWatch.getBaseUrl()+_url);_currentsymbol=symbol;}else{if(symbol!=_currentsymbol){if(_chart!=null){_pagedata[_currentsymbol]=_chart.data;_chart.data=null;_chart=null;}
var symbols=symbol.split('|');_chart=new JSChart(_chartBox,symbols,_width,_height,_style,_freq,_time,_startdate,_enddate,_pagedata[symbol],MarketWatch.getBaseUrl()+_url);_currentsymbol=symbol;_symbolCount=symbols.length;}}}
_setPageData(chartdata);var _refreshPageData=function(){var symbols=[]
for(var symbol in _pagedata){symbols.push(symbol);}
_refreshData(symbols,"mo");}
var _refreshData=function(symbols,cachekey){requestObject={freq:_freq,time:_time,Symbol:symbols,StartDate:_startdate,EndDate:_enddate,Width:_width,Height:_height,CacheKey:cachekey};dojo.rawXhrPost({url:MarketWatch.getBaseUrl()+_url,postData:requestObject,handleAs:"json",load:function(response,ioArgs){if(response!=null){_setPageData(response);response=null;if(_chart!=null){_chart.data=_pagedata[_currentsymbol];_chart._didLoad();}}
return response;}});requestObject=null;}
var _reloadChart=function(){if(_chart!=null){_chart.time=_time;_chart.freq=_freq;_chart.startDate=_startdate;_chart.endDate=_enddate;_chart.reload();}}
return{ShowChart:function(symbol){if(symbol===undefined){symbol=_firstsymbol;}
symbol=symbol.toUpperCase();if(symbol!=_currentsymbol){if(_pagedata[symbol]!==null&&_pagedata[symbol]!==undefined){_showChart(symbol);return true;}else{return false;}}},TickSubscribe:function(){if(_chart!=null){_tick=true;var chartSubscribeCallback=function(message){if(_chart!=null&&_chart.data!=null&&_symbolCount==1){for(var symbol in _pagedata){for(var i=0;i<_pagedata[symbol].Data.length;i++){if(_pagedata[symbol].Data[i].Value.BlueGrassChannel!=null&&_pagedata[symbol].Data[i].Value.BlueGrassChannel.toLowerCase()==message.h.t){if(symbol.toUpperCase()===_currentsymbol.toUpperCase()){_chart.addTick(symbol,message.b.z,message.b.l,message.b.e);}
break;}}}}};var chartConnectionCallback=function(connection,type){if(type=="connect"){_connection=connection;if(_pagedata[_currentsymbol]!=null){_currentchannel=_connection.subscribe(_pagedata[_currentsymbol].Data[0].Value.BlueGrassChannel,chartSubscribeCallback);}}};if(_currentchannel!=null){_currentchannel.removeCallback(chartSubscribeCallback);}
if(_connection!=null){if(_pagedata[_currentsymbol]!=null){_currentchannel=_connection.subscribe(_pagedata[_currentsymbol].Data[0].Value.BlueGrassChannel,chartSubscribeCallback);}}else{if(BlueGrass!==null&&BlueGrass.Runtime!==null){BlueGrass.Runtime.openConnection({},chartConnectionCallback);}}}},UpdateAllCharts:function(time,freq,startdate,enddate){if(_chart!=null){this.UpdateChart(time,freq,startdate,enddate);setTimeout(_refreshPageData,5);}},UpdateChart:function(time,freq,startdate,enddate){if(_chart!=null){_time=time;_freq=freq;_startdate=startdate;_enddate=enddate;_reloadChart();}},ChangeSymbol:function(symbol){if(_chart!=null){_currentsymbol=symbol;_chart.setSymbols(symbol.split('|'));_symbolCount=_chart.symbols.length;_reloadChart();}},SetChartRefresh:function(rate){setInterval(_refreshPageData,rate);}}}
var JSChart=function(targetSelector,symbols,width,height,style,freq,time,startDate,endDate,data,url){this.targetSelector=targetSelector;if(style===undefined){this.style=LargeChartStyle;}else{this.style=style;}
if(url!==undefined){this.url=url;}
this.width=width;this.height=height;this.symbols=symbols;this.selectedSymbol=symbols[0];if(freq===undefined){this.freq="1mi";}else{this.freq=freq;}
if(time===undefined){this.time="1dy";}else{this.time=time;}
if(startDate!==undefined){this.startDate=startDate;}
if(endDate!==undefined){this.endDate=endDate;}
var self=this;if(data===undefined){$(function(){self.reload();});}else{self.preload(data);}};JSChart.prototype={freq:"1mi",time:"1dy",unit:"Minute",url:"./HistoricChartData.aspx",span:1,step:1,startDate:'',endDate:'',data:null,selectedSymbol:null,width:0,height:0,drawingContext:null,style:null,highPrice:null,highPoint:{"x":null,"y":null},lowPoint:{"x":null,"y":null},lowPrice:null,lastPoint:{"x":null,"y":null},lastPrice:null,closePrice:null,buildRequest:function(){var requestObject;var symbol="";for(var i=0;i<this.symbols.length;i++){if(i>0){symbol+="|";}
symbol+=this.symbols[i];}
requestObject={freq:this.freq,time:this.time,Symbol:symbol,StartDate:this.startDate,EndDate:this.endDate,Width:this.width};return requestObject;},lastTickPrice:0,lastTickChange:0,lastTickX:0,addTick:function(tickSymbol,Timestamp,Price,offSet){var where=Thunderball.Utilities.addTick(this.data,tickSymbol,Timestamp,Price,offSet);if(where.Historical==false){if(where.x==null){return;}else{if(Price!=this.lastTickPrice){this.lastTickChange=Price-this.lastTickPrice;this.lastTickPrice=Price;}else if(where.x==this.lastTickX){return;}
this.lastTickX=where.x;this._didLoad();}}},setSymbols:function(symbols){this.symbols=symbols;this.selectedSymbol=symbols[0];},reload:function(){this._resetState();var d=new Date();var requestId=this.symbols[0]+d.getTime();this.requestId=requestId;Thunderball.Utilities.Requesters.push(this);Thunderball.Utilities.GetData(this);},preload:function(data){this._resetState();this.data=data;this._didLoad();},_resetState:function(){this.lastTickPrice=this.lastTickChange=this.lastTickX=0;},redraw:function(){this._prepareCanvas();this._clearLabels();var ctx=this.drawingContext;ctx.clearRect(0,0,this.width,this.height);ctx.save();this._drawChartBackground();var Data=Thunderball.Utilities._getSessionByTicker(this.data,this.selectedSymbol);if(Data!=null){for(var i=0;i<Data.length;i++){this._drawRegions(Data[i]);}
if(this.style.type=='Spark'){this._drawSpark(Data[Data.length-1]);}else{this._determineTypeOfChart(Data);this._setHLC(Data);this._fillTrades(Data);this._drawPriceLines();this._createYAxisLabels(this.symbols.length);Thunderball.Utilities.addXAxisLabels(this);Thunderball.Utilities.drawXaxisLines(this);this._drawCloseLines(Data);var st=this.style;if(this.highPoint.y!=this.lowPoint.y){this._priceIndicator(this.highPoint,"",st.highIndicatorStyle,"chartPointer chartPoint-high",false);this._priceIndicator(this.lowPoint,"",st.lowIndicatorStyle,"chartPointer chartPoint-low",false);}
this._priceIndicator(this.lastPoint,"","","lastLbl",true);if(this.symbols.length>1){for(var j=1;j<this.symbols.length;j++){var Session=Thunderball.Utilities._getSessionByTicker(this.data,this.symbols[j]);if(Session!=null){var compareColor='black';if(j<=6){compareColor=this.style.comparelineStyles[j-1];}
this._strokeTrades(Session,compareColor);}}}
this._strokeTrades(Data,this.style.mainLineStyle);this._drawChartBorder();if(this.highPoint.y!=this.lowPoint.y){this._drawHorizontalLine(this.highPoint.y);this._drawHorizontalLine(this.lowPoint.y);}
this.startTime=this.overallStartTime;}}
ctx.restore();},_x:0,_xscale:0,_y:0,_yscale:0,_bump:false,_fillStyle:'black',_padding:0,_events:[],_barFactor:0,_barSize:1,_priceLines:[],_timeLines:[],_opaqueTimeLines:[],_historical:false,_customDateRange:false,_chartUnit:1,_displayUnit:1,_xAxisLabels:[],_findOpaqueGridLines:function(time){var xAxisInfo=this._xAxisLabels;var timeLines=this._timeLines;var data=this.data;var opaqueTimeLines=[];this._opaqueTimeLines=[];if(this._displayUnit===1||this._displayUnit===2){if(_isDEEdition){this._convertGridLinesForGermany(xAxisInfo,time,opaqueTimeLines);}else{for(var i=0;i<xAxisInfo.length;i++){var patt=/^M$|^T$|^W$|^F$|^S$/;if(xAxisInfo[i].element.match(patt)){opaqueTimeLines.push(xAxisInfo[i].x);}}}}else{for(var i=0;i<xAxisInfo.length;i++){var patt=/^\d{2}$/;if(xAxisInfo[i].element.match(patt)&&xAxisInfo[i].x!==(.5*timeLines[0])){opaqueTimeLines.push(xAxisInfo[i].x);}}}
if(opaqueTimeLines.length>0){for(var i=0;i<opaqueTimeLines.length;i++){this._opaqueTimeLines.push(opaqueTimeLines[i]);}}},_convertGridLinesForGermany:function(xAxisInfo,time,opaqueTimeLines){var patt=/^M$|^T$|^W$|^F$|^S$/;var pattDE=/^M$|^D$|^F$|^S$/;if(time.toString()=="1dy"){var xElement="";var length=xAxisInfo.length;for(var i=0;i<length;i++){xElement=xAxisInfo[i];if(xElement!=undefined){if(length==1&&(xElement.element.match(patt)||xElement.element.match(pattDE))){this._convertGridLinesForGermany5dy(xAxisInfo,time,opaqueTimeLines);return;}
var len=xElement.element.length;var hour=xElement.element;var ap=xElement.element.substring(len-1);if((len==2||len==3)&&(ap=="a"||ap==="p")){hour=xElement.element.substring(0,len-1);}
if(ap=="p"&&hour!="12"){hour=parseFloat(hour)+parseFloat(12);}else if(hour.length==1){hour="0"+hour;}
xElement.element=hour.toString();}}}else if(time.toString()=="5dy"){this._convertGridLinesForGermany5dy(xAxisInfo,time,opaqueTimeLines);return;}},_convertGridLinesForGermany5dy:function(xAxisInfo,time,opaqueTimeLines){var pattDE=/^M$|^D$|^F$|^S$/;var xElement="";var length=xAxisInfo.length;for(var i=0;i<length;i++){xElement=xAxisInfo[i];if(xElement!=undefined){if(xElement.element=="M"){xElement.element="M";}else if(xElement.element=="W"){xElement.element="M";}else if(xElement.element=="F"){xElement.element="F";}else if(xElement.element=="S"){xElement.element="S";}else if(xElement.element=="T"){xElement.element="D";}
if(xElement.element.match(pattDE)){opaqueTimeLines.push(xElement.x);}}}},_didLoad:function(){if(!this.data)
return;if(this.data.Error){var target=this.targetSelector;var errorMessage="<div style='position: absolute; top:0px;left:0px; class='xValueLbl'>Error, the chart cannot be displayed.</div>";if(this.data.Error=="Error: Time"){errorMessage="<div style='position: absolute; top:0px;left:0px; class='xValueLbl'>One or more of the symbols you have chosen does not contain trade data for this time frame. Please choose a longer timeframe.</div>";}
var ctx=this.drawingContext;if(ctx!=null){ctx.clearRect(0,0,this.width,this.height);this._clearLabels();dojo.place(errorMessage,target);}
return;}
var data=this.data.Data;if(data.length>1){var tradesExist=false;for(var i=0;i<data.length;i++){var value=data[i].Value;var sessions=value.Sessions;for(var j=0;j<sessions.length;j++){if(sessions[j].Trades.length>0){tradesExist=true;continue;}}}
if(!tradesExist){var target=this.targetSelector;var errorMessage="<div style='position: absolute; top:0px;left:0px; class='xValueLbl'>One or more of the symbols you have chosen does not contain trade data for this time frame. Please choose a longer timeframe.</div>";var ctx=this.drawingContext;if(ctx!=null){ctx.clearRect(0,0,this.width,this.height);this._clearLabels();dojo.place(errorMessage,target);}
return;}}
this._barFactor=this.data.BarFactor;this._barSize=this.data.BarSize;this._chartUnit=this.data.xAxisLabelInfo.chartUnit;this._displayUnit=this.data.xAxisLabelInfo.displayUnit;this._timeLines=this.data.xAxisLabelsObj.timeLines;this._xAxisLabels=this.data.xAxisLabelsObj.ElementList;if(this._displayUnit===1||this._displayUnit===2||this._displayUnit===3){this._findOpaqueGridLines(this.time);}
this._customDateRange=this.data.CustomDateRange;try{for(var j=0;j<this.symbols.length;j++){var Sessions=Thunderball.Utilities._getSessionByTicker(this.data,this.symbols[j]);if(Sessions!=null){if(this.symbols.length>1){this._changeDataToPercentage(Sessions);}
dojo.forEach(Sessions,function(Session,i){if(Session.Trades===undefined){Session.Trades=[];}
if(Session.Events===undefined){Session.Events=[];}
if(Session.News===undefined){Session.News=[];}
if(Session.Weight===undefined){}
if(Session.Start===undefined){}
if(Session.Stop===undefined){}
var sessionStartFormat=Thunderball.Utilities.FormatDate(Session.Start);var sessionStopFormat=Thunderball.Utilities.FormatDate(Session.Stop);Session.Start=new Date(sessionStartFormat);Session.Stop=new Date(sessionStopFormat);});this._layoutSessions(Sessions);}}}catch(e){}
this._autoScale(this.data.Data,this.time);this.redraw();},_changeDataToPercentage:function(Sessions){var basePrice=null;for(var k=0;k<Sessions.length;k++){var trades=Sessions[k].Trades;for(var l=0;l<trades.length;l++){if(trades[l]!==null&&basePrice===null){basePrice=trades[l];break;}}
if(basePrice!==null){break;}}
if(basePrice!==null&&basePrice>0){for(var k=0;k<Sessions.length;k++){var trades=Sessions[k].Trades;for(var l=0;l<trades.length;l++){if(trades[l]!==null){trades[l]=100*((trades[l]-basePrice)/basePrice);}}
if(Sessions[k].Low!==null){Sessions[k].Low.Price=100*((Sessions[k].Low.Price-basePrice)/basePrice);}
if(Sessions[k].High!==null){Sessions[k].High.Price=100*((Sessions[k].High.Price-basePrice)/basePrice);}}}},_drawHorizontalLine:function(y){if(this.style.highlowLineStyle){var ctx=this.drawingContext;this._bump=true;ctx.beginPath();ctx.lineWidth=1;ctx.moveTo(0,y+0.5);ctx.lineTo(this.width,y+0.5);ctx.strokeStyle=this.style.highlowLineStyle;ctx.stroke();}},_priceIndicator:function(point,string,style,cssClass,lastPoint){if(point.x===null||point.y===null){return;}
if(lastPoint){if(point.x>this.width-3){point.x=this.width-3;}
var y=point.y-10;var x=point.x-2;if(this.lastTickChange<0){lastPointIcon="<div class='chartDownIndicator'></div>";}else if(this.lastTickChange>0){lastPointIcon="<div class='chartUpIndicator'></div>";}else{lastPointIcon="<div class='chartIndicator'></div>";y=point.y-3;}
return;}else{}},_createYAxisLabels:function(type){if(!this.style.maxPriceLines)
return;var decimalsToShow=2;var YAxisContent="";var displayValue="";var x,y,p;var elmHeight=this.style.YAxisLabelHeight;var excludeLabel=[];if(!this.style.yAxisLabelPadding){this.style.yAxisLabelPadding=2;}
function addCommas(nStr){nStr+='';x=nStr.split('.');x1=x[0];x2=x.length>1?'.'+x[1]:'';var rgx=/(\d+)(\d{3})/;while(rgx.test(x1)){x1=x1.replace(rgx,'$1'+','+'$2');}
return x1+x2;}
function decimalsNeeded(lineNum,range){var Tol=5.0e-6;if(range===0||lineNum===0)
return 0;var maxDecimals=6;var division=range/lineNum;var decimals=0;while(decimals<=maxDecimals){var divtest=division*Math.pow(10,decimals);if(Math.abs(divtest-Math.round(divtest))<Tol)
break;decimals+=(decimals==0)?2:1;}
return decimals;}
if(this._priceLines.length>1){this._priceLines.sort(function(a,b){return a-b});var firstValue=this._priceLines[0];var lastValue=this._priceLines[this._priceLines.length-1];var diffValue=lastValue-firstValue;var totalNumber=this._priceLines.length-1;if(this.style.showDecimals===0){decimalsToShow=0;}else if(this.style.YAxisLabelStyle===1){if(lastValue<10)
decimalsToShow=3;else if(lastValue<100)
decimalsToShow=2;else
decimalsToShow=0;}else{decimalsToShow=decimalsNeeded(totalNumber,diffValue);}}
try{var current=false;for(var i=this._priceLines.length-1;i>=0;i--){var drawLabel=true;p=this._priceLines[i];if(this._priceLines[i]===this.lastPrice){y=(this.ty(p)-(elmHeight/2)-1);}else if(this._priceLines[i]===this.highPrice){y=(this.ty(p)-elmHeight);}else if(this._priceLines[i]===this.lowPrice){y=this.ty(p)-1;}else if(this._priceLines[i]===this.closePrice){y=(this.ty(p)-(elmHeight/2)-1);}else{y=this.ty(p)-(elmHeight/2);}
x=this.style.yAxisLabelPadding+this.width;if(this.style.YAxisLabelStyle===1){for(var j=0;j<this._priceLines.length;j++){if(this._priceLines[i]!=this.lastPrice&&j!=i&&excludeLabel[j]!=1){var cp=this._priceLines[j];if(this._priceLines[j]===this.lastPrice){cy=(this.ty(cp)-(elmHeight/2))-1;}else if(this._priceLines[j]===this.closePrice){cy=(this.ty(cp)-(elmHeight/2))-1;}else if(this._priceLines[j]===this.highPrice){cy=(this.ty(cp)-elmHeight)-1;}else if(this._priceLines[j]===this.lowPrice){cy=this.ty(cp)-1;}else{drawLabel=false;}
if(Math.abs(Math.abs(cy)-Math.abs(y))<elmHeight+1){if(this._priceLines[j]!=this.closePrice){drawLabel=false;excludeLabel[i]=1;}}}}}
if(type>1){displayValue=p.toFixed(decimalsToShow)+"%";}else{displayValue=p.toFixed(decimalsToShow);}
var labelClass="priceLbl";if(this.style.YAxisLabelStyle===1){var width=5;if(this._priceLines[i]===this.lastPrice&&(this._priceLines[i]>=this.closePrice||this.closePrice===null)&&!current){labelClass="chartPointer chartLastPoint chartPoint-pos";current=true;}else if(this._priceLines[i]===this.lastPrice&&this._priceLines[i]<this.closePrice&&!current){labelClass="chartPointer chartLastPoint chartPoint-neg";current=true;}else if(this._priceLines[i]===this.lowPrice){if(this.lowPrice===this.lastPrice&&current){drawLabel=false;}
labelClass="chartPointer chartPoint-low";}else if(this._priceLines[i]===this.highPrice){if(this.highPrice===this.lastPrice&&current){drawLabel=false;}
labelClass="chartPointer chartPoint-high";}else if(this.closePrice&&this._priceLines[i]===this.closePrice){if(this.closePrice===this.lastPrice&&current){drawLabel=false;}
labelClass="chartPointer chartPoint-close";}}
if(drawLabel===true&&this.style.YAxisLabelStyle===1){YAxisContent=YAxisContent+"<div style='position: absolute; top:"+y+"px;left:"+x+"px; ' class='"
+labelClass+"'>"+displayValue+"</div>";}else if(drawLabel===true){YAxisContent=YAxisContent+"<div style='position: absolute; top:"+y+"px;left:"+x+"px; ' class='"
+labelClass+"'>"+displayValue+"</div>"}}}catch(e){}
dojo.place(YAxisContent,this.targetSelector);},_determineTypeOfChart:function(Sessions){if(Sessions.length>=1&&Sessions[0].Regions.length>=1){var numberOfRegions=Sessions[0].Regions.length;if(numberOfRegions==1&&Sessions[0].Regions[0].Type!=4){this._historical=true;}else{this._historical=false;}}},_setHLC:function(Sessions){this.lastPoint.x=null;this.lastPoint.y=null;this.lowPoint.x=null;this.lowPoint.y=null;this.highPoint.x=null;this.highPoint.y=null;var MinMax=this._getMinMax(Sessions,false);var needsBump=false;if(this.data.Data[0].Value.IsIndex===1&&this._barSize===60){needsBump=true;}
if(MinMax.MinPoint!=null||MinMax.Min!=null){this.lowPoint=MinMax.MinPoint;}
if(MinMax.MaxPoint!=null||MinMax.Max!=null){this.highPoint=MinMax.MaxPoint;}
for(var i=0;i<Sessions.length;i++){var Session=Sessions[i];this._setSession(Session);if(Session.Trades&&Session.Trades.length!==0){var lastIndex=Session.Trades.length-1;var price=Session.Trades[lastIndex];if(price){this.lastPoint.y=this.ty(price);if(this._historical){this.lastPoint.x=this.tx(lastIndex/this._barSize);}else{if(needsBump){this.lastPoint.x=this.tx(lastIndex+0.5);}else{this.lastPoint.x=this.tx(lastIndex);}}}else{for(var j=lastIndex;j>=0;j--){price=Session.Trades[j];if(price){this.lastPoint.y=this.ty(price);if(this._historical){this.lastPoint.x=this.tx(j/this._barSize);}else{if(needsBump){this.lastPoint.x=this.tx(j+0.5);}else{this.lastPoint.x=this.tx(lastIndex);}}
break;}}}}}},_drawRoundIndicator:function(color,x,y,circleSize){if(x!==null&&y!==null){var ctx=this.drawingContext;ctx.fillStyle=color;ctx.beginPath();ctx.arc(x,y,3,0,Math.PI*2,true);ctx.fill();ctx.strokeStyle=color;ctx.beginPath();ctx.save();ctx.lineWidth=1.5;ctx.arc(x,y,circleSize,0,Math.PI*2,true);ctx.stroke();ctx.restore();}},_drawRoundDot:function(color,x,y,size){if(x!==null&&y!==null){var ctx=this.drawingContext;ctx.fillStyle=color;ctx.beginPath();ctx.arc(x,y,size,0,Math.PI*2,true);ctx.fill();}},_drawNewsOverlay:function(Sessions){this._bump=false;for(var i=0;i<Sessions.length;i++){this._setSession(Sessions[i]);var news=Sessions[i].News;for(var j=0;j<news.length;j++){var story=news[j];var x=this.tx(story.At);var p;var Trades=Sessions[i].Trades;for(var k=0;k<Trades.length&&k<story.At;k++){if(Trades[k]){p=Trades[k];}}
if(p){var newsLink=$('<a></a>').attr('href',story.Url);var icon=$('<img />').attr('border',0).attr('src',this.style.newsBackground).attr('title',story.Text).appendTo(newsLink);}}}},_drawPriceLines:function(){if(this.style.horizontalGridLineStyle){var ctx=this.drawingContext;this._bump=true;ctx.beginPath();var ticks=this._priceLines;for(var i=0;i<ticks.length;i++){var y=this.ty(ticks[i]);ctx.moveTo(0,y);ctx.lineTo(this.width,y);}
ctx.strokeStyle=this.style.horizontalGridLineStyle;ctx.stroke();}},_drawChartBorder:function(){if(this.style.border){var ctx=this.drawingContext;ctx.beginPath();ctx.strokeStyle=this.style.border;ctx.strokeRect(0,0,this.width,this.height);}},_drawChartBackground:function(){if(this.style.background){var ctx=this.drawingContext;ctx.beginPath();ctx.fillStyle=this.style.background;ctx.fillRect(0,0,this.width,this.height);}},_drawCloseLines:function(Sessions){var ctx=this.drawingContext;this._bump=true;var x=0;ctx.beginPath();for(var i=0;i<Sessions.length;i++){var session=Sessions[i];this._setSession(session);var w=session.SessionWidth;var x2=x+w;if(session.PreviousClose!==undefined&&session.PreviousClose!==null&&(this.symbols.length==1)){var y=this.ty(session.PreviousClose);ctx.moveTo(x,y);ctx.lineTo(x2,y);}
x=x2;}
ctx.strokeStyle=this.style.closelineStyle;ctx.stroke();},_drawRegions:function(session){var ctx=this.drawingContext;this._setSession(session);this._bump=false;for(var i=0;i<session.Regions.length;i++){var Region=session.Regions[i];var Color=this._regionStyles[Region.Type];if(!Color||Color==this.style.background){continue;}
var x1=this.tx(Region.Start);var x2;if(i===0&&this._barSize===60&&(Region.Stop+Region.Start>0)){x2=this.tx(Region.Stop+0.5);}else{x2=this.tx(Region.Stop);}
ctx.fillStyle=Color;ctx.fillRect(x1,0,x2-x1,this.height);}},_buildTradePath:function(Sessions){var ctx=this.drawingContext;var data=this.data;var isIndex=data.Data[0].Value.IsIndex;var first=true;var x=0;var firstx;var prev=null;var last;for(var i=0;i<Sessions.length;i++){var Session=Sessions[i];this._setSession(Session);if(Session.Trades){for(var j=0;j<Session.Trades.length;j++){var price=Session.Trades[j];if(price==null){if(prev==null)
continue;price=prev;}
prev=price;var y=this.ty(price);if(this._historical){x=this.tx(j/this._barSize);}else{if(isIndex===1&&this._barSize===60){x=this.tx(j+0.5);}else{x=this.tx(j);}}
if(first){firstx=x;ctx.moveTo(0,y);ctx.lineTo(firstx,y);first=false;}else{ctx.lineTo(x,y);}}}}
return{firstx:firstx,lastx:x};},_strokeFillTrades:function(Sessions,strokeStyle){var ctx=this.drawingContext;ctx.save();ctx.lineWidth=this.style.mainPriceLineWidth;ctx.strokeStyle=strokeStyle;ctx.beginPath();this._bump=true;var x=this._buildTradePath(Sessions);if(x.lastx!=undefined&&x.firstx!=undefined){ctx.stroke();ctx.lineTo(x.lastx,this.height);ctx.lineTo(0,this.height);ctx.fillStyle=this.style.mainPriceLineFill;ctx.fill();}
ctx.restore();},_strokeTrades:function(Sessions,strokeStyle){var ctx=this.drawingContext;ctx.save();ctx.miterLimit=0;ctx.lineJoin="round";ctx.lineWidth=this.style.mainPriceLineWidth;ctx.strokeStyle=strokeStyle;ctx.beginPath();this._bump=true;var x=this._buildTradePath(Sessions);ctx.stroke();ctx.restore();},_fillTrades:function(Sessions){var ctx=this.drawingContext;ctx.fillStyle=this._fillStyle;ctx.beginPath();this._bump=false;var points=this._buildTradePath(Sessions);if(points.lastx!=undefined&&points.firstx!=undefined){ctx.lineTo(points.lastx,this.height);ctx.lineTo(0,this.height);}
ctx.fill();},_precomputeStyles:function(){if(this.style.gradientFillStyle){this._fillStyle=this._makeStyle(this.style.gradientFillStyle);}
if(this.style.mainPriceLineFill){this._fillStyle=this.style.mainPriceLineFill;}
this._regionStyles={};var styles=this.style.regionStyles;for(var style in styles){this._regionStyles[style]=this._makeStyle(styles[style]);}},_prepareCanvas:function(){if(!this.drawingContext||this.drawingContext===null){var canvasWidth=this.width;var canvasHeight=this.height;this.targetSelector.innerHTML="";if(canvasWidth<=0||canvasHeight<=0){throw"Invalid dimensions - width = "+canvasWidth+", height = "+canvasHeight;}
var canvas=document.createElement('canvas');canvas.setAttribute('width',canvasWidth);canvas.setAttribute('height',canvasHeight);dojo.place(canvas,this.targetSelector);if(!Thunderball.Utilities.check_canvas()){canvas=window.G_vmlCanvasManager.initElement(canvas,canvasWidth,canvasHeight);}
this.drawingContext=canvas.getContext("2d");}
this._precomputeStyles();},orphan:function(node){node.parentNode.removeChild(node);},_clearLabels:function(){var label=dojo.query("#"+this.targetSelector.id+" > div");},_layoutSessions:function(Sessions){var TotalSessionWeight=0;dojo.forEach(Sessions,function(value,index){TotalSessionWeight+=value.Weight;});var x=0;for(var i=0;i<Sessions.length;i++){var Session=Sessions[i];var SessionWidth;SessionWidth=Math.floor(this.width*Session.Weight/TotalSessionWeight);Session.SessionWidth=SessionWidth;Session._x=x;x+=SessionWidth;var SessionStart=Session.Start.getTime();var SessionStop=Session.Stop.getTime();var SessionTime=SessionStop-SessionStart;Session._xscale=SessionWidth*this._barFactor/(SessionTime);}},_autoScale:function(Data,time){var Min=null;var Max=null;var High=null;var Low=null;var Close=null;var self=this;var chartValueIndicators=this.style.YAxisLabelStyle;dojo.forEach(Data,function(Sessions,i){var includePreviousClose=true;if(self.symbols.length>1||Sessions.Value===undefined||Sessions.Value.Sessions===undefined||Sessions.Value.Sessions.length<1||Sessions.Value.Sessions[0].PreviousClose===undefined||Sessions.Value.Sessions[0].PreviousClose===null){includePreviousClose=false;}
var MinMax=self._getMinMax(Sessions.Value.Sessions,includePreviousClose);if(chartValueIndicators===1){self._determineLastTrade(Sessions.Value.Sessions[Sessions.Value.Sessions.length-1].Trades);Low=MinMax.Low;High=MinMax.High;if(includePreviousClose&&time=="1dy"){Close=Sessions.Value.Sessions[0].PreviousClose;self.closePrice=Close;}
else if(!includePreviousClose&&time!="1dy"){if(_PrevClose!=null&&_PrevClose>=0){Close=_PrevClose;self.closePrice=Close;}}}
if(!Min||MinMax.Min<Min){Min=MinMax.Min;}
if(!Max||MinMax.Max>Max){Max=MinMax.Max;}});function dStart(){this.value=0;}
function dFinish(){this.value=0;}
if(this.style.maxPriceLines>=1){var dFinishObj=new dFinish();var dStartObj=new dStart();var scale=Thunderball.ChartScalingV2.CalculateDelta2(this.style.maxPriceLines,false,true,Min,Max,dStartObj,dFinishObj);if(dStartObj.value<0&&self.symbols.length===1){scale=Thunderball.ChartScalingV2.CalculateDelta2(Math.round(this.style.maxPriceLines/2),false,true,Min,Max,dStartObj,dFinishObj);}
if(chartValueIndicators===1){if(High===null&&Low===null){if(close!=null){Max=Close+(Close*.01);Min=Close-(Close*.01);}else{Max=1;Min=0;}}
this._priceLines=[];var ticks=this._priceLines;if(Low!=null){ticks.push(Low);this.lowPrice=Low;}
if(this.lastPrice!=null){ticks.push(this.lastPrice);}
if((!(Close===undefined||Close===null))){ticks.push(Close);if(High!=null){ticks.push(High);this.highPrice=High;}}else{if(High!=null){ticks.push(High);this.highPrice=High;}}}else{Min=Math.min(Min,dStartObj.value);Max=Math.max(Max,dFinishObj.value);this._priceLines=[];var ticks=this._priceLines;if(scale>0){for(var p=dStartObj.value;p<=dFinishObj.value+((dFinishObj.value-dStartObj.value)*.05);p+=scale){ticks[ticks.length]=p;}}}}
var pad=this.style.vPadding;var height=this.height-2.0*pad;if(Max-Min===0){if(Max<Min){var Tmp=Min;Min=Max;Max=Tmp;}
var Max=Math.abs(Max);if(Max==0)
Max=1;if(Max<0)
Max=0;else if(Max==0)
Max=1;else
Min=0;}
this._yscale=-height/(Max-Min);this._y=height-Min*this._yscale+pad;},_setSession:function(session){this._xscale=session._xscale;this._x=session._x;},tx:function(x){if(!this._x){this._x=1;}
if(!this._xscale){this._xscale=1;}
return Math.floor(this._xscale*x+this._x)+(this._bump?0.5:0);},ty:function(y){return Math.floor(this._yscale*y+this._y)+(this._bump?0.5:0);},_makeStyle:function(spec){var steps=spec.split('-');if(steps.length==2){var gradient=this.drawingContext.createLinearGradient(0,0,0,this.height);gradient.addColorStop(0,steps[0]);gradient.addColorStop(1,steps[1]);return gradient;}else{return spec;}},_determineLastTrade:function(Trades){var latestPrice=null;for(var k=Trades.length-1;k>=0&&latestPrice===null;k--){if(Trades[k]){latestPrice=Trades[k];}}
this.lastPrice=latestPrice;},_getMinMax:function(Sessions,IncludePreviousClose){var MinPoint;var MaxPoint;var Min;var Max;var LowPrice;var HighPrice;var SessionHighPoint={Index:null,Price:null,SessionIndex:null};var SessionLowPoint={Index:null,Price:null,SessionIndex:null};if(IncludePreviousClose&&Sessions[0].PreviousClose!==null){Max=Min=Sessions[0].PreviousClose;}
var needsBump=false;if(this.data.Data[0].Value.IsIndex===1&&this._barSize===60){needsBump=true;}
for(var i=0;i<Sessions.length;i++){var Session=Sessions[i];this._setSession(Session);if(!Session.Trades){Session.Trades=[];}
var Low=Session.Low;var High=Session.High;if(Low||High){if(Low&&(!Min||Low.Price<Min)){Min=Low.Price;if(this._historical){MinPoint={x:this.tx(Low.Index/this._barSize),y:this.ty(Min)};}else{if(needsBump){MinPoint={x:this.tx(Low.Index+0.5),y:this.ty(Min)};}else{MinPoint={x:this.tx(Low.Index),y:this.ty(Min)};}}
SessionLowPoint.Index=Low.Index;SessionLowPoint.Price=Low.Price;SessionLowPoint.SessionIndex=i;}
if(High&&(!Max||High.Price>Max)){Max=High.Price;if(this._historical){MaxPoint={x:this.tx(High.Index/this._barSize),y:this.ty(Max)};}else{if(needsBump){MaxPoint={x:this.tx(High.Index+0.5),y:this.ty(Max)};}else{MaxPoint={x:this.tx(High.Index),y:this.ty(Max)};}}
SessionHighPoint.Index=High.Index;SessionHighPoint.Price=High.Price;SessionHighPoint.SessionIndex=i;}
if(Low&&(!LowPrice||Low.Price<LowPrice)){LowPrice=Low.Price;}
if(High&&(!HighPrice||High.Price>HighPrice)){HighPrice=High.Price;}}}
var UniqueHighPoint=null;var UniqueLowPoint=null;if(SessionHighPoint.Index!=null&&SessionHighPoint.Price!=null&&SessionHighPoint.SessionIndex!=null){if(SessionHighPoint.SessionIndex<Sessions.length&&SessionHighPoint.Index<Sessions[SessionHighPoint.SessionIndex].Trades.length){UniqueHighPoint=SessionHighPoint.Price;HighPrice=SessionHighPoint.Price;}}
if(SessionLowPoint.Index!=null&&SessionLowPoint.Price!=null&&SessionLowPoint.SessionIndex!=null){if(SessionLowPoint.SessionIndex<Sessions.length&&SessionLowPoint.Index<Sessions[SessionLowPoint.SessionIndex].Trades.length){UniqueLowPoint=SessionLowPoint.Price;LowPrice=SessionLowPoint.Price;}}
if(UniqueHighPoint!==null&&UniqueLowPoint!==null){if(SessionLowPoint.SessionIndex==SessionHighPoint.SessionIndex){if(SessionLowPoint.Index!==SessionHighPoint.Index){Sessions[SessionLowPoint.SessionIndex].Trades[SessionLowPoint.Index]=UniqueLowPoint;Sessions[SessionHighPoint.SessionIndex].Trades[SessionHighPoint.Index]=UniqueHighPoint;}}else
{Sessions[SessionLowPoint.SessionIndex].Trades[SessionLowPoint.Index]=UniqueLowPoint;Sessions[SessionHighPoint.SessionIndex].Trades[SessionHighPoint.Index]=UniqueHighPoint;}}else if(UniqueHighPoint!==null){Sessions[SessionHighPoint.SessionIndex].Trades[SessionHighPoint.Index]=UniqueHighPoint;}else if(UniqueLowPoint!==null){Sessions[SessionLowPoint.SessionIndex].Trades[SessionLowPoint.Index]=UniqueLowPoint;}
return({Min:Min,Max:Max,Low:LowPrice,High:HighPrice,MinPoint:MinPoint,MaxPoint:MaxPoint});}};dojo.provide("dj.module.marketdata.marketdata");dojo.require("dj.lang");dojo.require("dj.util.Page");dojo.require("dj.widget.panels.PanelsFactory");dojo.require("dj.module.marketdata.chart");var _djl=dj.lang;var _djp=dj.util.Page;dj.module.marketdata.marketdata={init:function(conf,passMod){if(_djl.isIE){if(!document.namespaces.g_vml_){document.namespaces.add('g_vml_','urn:schemas-microsoft-com:vml','#default#VML');}
if(!document.namespaces.g_o_){document.namespaces.add('g_o_','urn:schemas-microsoft-com:office:office','#default#VML');}}
var setModValue="";if(passMod==undefined||passMod==""){setModValue="mdc_h_dtabnk";}else
{setModValue=passMod;}
this.configuration={moduleName:"marketDataModule",tabs:["mymarkets","us","europe","asia","currencyrates"],defaultSymbols:[{tab:"mymarkets",symbols:["DJI","NCM","SPX","GDOW","FST","NIKKE"]},{tab:"us",symbols:["DJI","NCM","SPX","DWC","RUT","GDOW"]},{tab:"europe",symbols:["FST","DAX30","PAS","SXXP","GDOW","DJI"]},{tab:"asia",symbols:["HKS","NIKKE","SHCOMP","BSESN","GDOW","DJI"]},{tab:"currencyrates",symbols:["EUR","JPY","GBP","USTYN"]}],defaultTab:3,convertToGerman:false,refreshModule:true,refreshRate:60,moduleContainer:"marketDataContainer",tableDataURL:"/public/resources/live/2_3001_HP_JSON.js",chartDataURL:"/internal/marketData.json",personalizedSymbolsURL:"/pznusersvc/view/getUser/indexes/userName",indexLinkURL:"/mdc/public/npage/2_3051.html?mod="+setModValue+"&symb=",chartContainer:"marketDataChart_",dataContainer:"marketDataTable_",chartWidth:80,chartHeight:95,frequency:"1mi",time:"1dy",overrideNoChartText:false,overrideSymbolMapping:false,showMyMarkets:true,myMarketSymbols:[],finanzenMapping:{"DAX30":"http://www.finanzen.net/index/DAX","TECDAX":"http://www.finanzen.net/index/TECDAX","DJI":"http://www.finanzen.net/index/Dow_Jones","NCM":"http://www.finanzen.net/index/Nasdaq_Composite","EUR":"http://www.finanzen.net/devisen/dollarkurs","CLL":"http://www.finanzen.net/rohstoffe/oelpreis","SPX":"http://www.finanzen.net/index/S&P_500","RUT":"http://www.finanzen.net/index/Russell_2000","GDOW":"http://www.finanzen.net/index/Dow_Jones_Global_Dow","SXXP":"http://www.finanzen.net/index/STOXX_Europe_600","FST":"http://www.finanzen.net/index/FTSE_100","MID250":"http://www.finanzen.net/index/FTSE_250","PAS":"http://www.finanzen.net/index/CAC_40","IBEX35":"http://www.finanzen.net/index/IBEX_35","HKS":"http://www.finanzen.net/index/Hang_Seng","NIKKE":"http://www.finanzen.net/index/Nikkei_225","SHCOMP":"http://www.finanzen.net/index/Shanghai_Composite","BSESN":"http://www.finanzen.net/index/SENSEX","EURGBP":"http://www.finanzen.net/devisen/euro-pfund_sterling-kurs","EURJPY":"http://www.finanzen.net/devisen/euro-yen-kurs","EURCHF":"http://www.finanzen.net/devisen/euro-schweizer_franken-kurs"},symbolMapping:[{"Key":"DJI","mws":"INDU","country":"US"},{"Key":"NCM","mws":"COMP","country":"US"},{"Key":"SPX","mws":"SPX","country":"US"},{"Key":"GDOW","mws":"GDOW","country":"US"},{"Key":"RUT","mws":"RUT","country":"US"},{"Key":"DWC","mws":"DWC","country":"US"},{"Key":"FST","mws":"UKX","country":"UK"},{"Key":"NIKKE","mws":"NI225","country":"JP"},{"Key":"DAX30","mws":"DAX","country":"DX"},{"Key":"PAS","mws":"PX1","country":"FR"},{"Key":"SX5P","mws":"SX5P","country":"ST"},{"Key":"SXXP","mws":"SXXP","country":"ST"},{"Key":"HKS","mws":"HSI","country":"HK"},{"Key":"DJSH","mws":"DJSH","country":"CN"},{"Key":"BSESN","mws":"BSESN","country":"XX"},{"Key":"US1YN","mws":"UST1YR","country":"US"},{"Key":"US2YN","mws":"UST2YR","country":"US"},{"Key":"US5YN","mws":"UST5YR","country":"US"},{"Key":"USTYN","mws":"UST10Y","country":"US"},{"Key":"US30B","mws":"UST30Y","country":"US"},{"Key":"KLCOMP","mws":"1807307","country":"MY"},{"Key":"HSCHINA","mws":"HSCE","country":"HK"},{"Key":"CNY.CN","mws":"USDCNY","country":"US"},{"Key":"EUR","mws":"CUR_EURUSD","country":"US"},{"Key":"JPY","mws":"CUR_USDYEN","country":"US"},{"Key":"GBP","mws":"CUR_GBPUSD","country":"US"},{"Key":"AORD","mws":"XAO","country":"AU"},{"Key":"MSH","mws":"MSH","country":"US"},{"Key":"AEX","mws":"AAEX","country":"NL"},{"Key":"B400","mws":"B400","country":"US"},{"Key":"BEL20","mws":"BEL20","country":"XX"},{"Key":"BVSP","mws":"BVSP","country":"XX"},{"Key":"GSPTSE","mws":"ISPTX","country":"CA"},{"Key":"VIX","mws":"VIX","country":"US"},{"Key":"DJUSBT","mws":"1522956","country":"XX"},{"Key":"DW25","mws":"DW25","country":"US"},{"Key":"DJUSBC","mws":"1522967","country":"XX"},{"Key":"SX5E","mws":"SX5E","country":"ST"},{"Key":"DJUSHP","mws":"1522752","country":"XX"},{"Key":"MYDOW","mws":"1524725","country":"XX"},{"Key":"DJUSAV","mws":"1522901","country":"XX"},{"Key":"DJUSPR","mws":"1523216","country":"XX"},{"Key":"DJUSBPB","mws":"1523335","country":"XX"},{"Key":"SGDOW","mws":"1524781","country":"XX"},{"Key":"DJUBS","mws":"DJUBS","country":"US"},{"Key":"DWCOGS","mws":"DWCOGS","country":"US"},{"Key":"FOX50","mws":"FOX50","country":"US"},{"Key":"ALLSHR","mws":"J203","country":"XX"},{"Key":"JKCOMP","mws":"JKSE","country":"XX"},{"Key":"SPMIB","mws":"FTSEMIB","country":"XX"},{"Key":"RIXF","mws":"NDX","country":"US"},{"Key":"PSE","mws":"PSE.X","country":"US"},{"Key":"NNYA","mws":"NYA","country":"US"},{"Key":"OSEAX","mws":"OSEAX","country":"XX"},{"Key":"GSPASX","mws":"1867453","country":"AU"},{"Key":"SEU","mws":"KS11","country":"XX"},{"Key":"SHCOMP","mws":"SHCOMP","country":"CN"},{"Key":"IBEX35","mws":"IBEX","country":"XX"},{"Key":"SWEDI","mws":"SAX","country":"XX"},{"Key":"TAI","mws":"TWII","country":"XX"},{"Key":"SMI","mws":"SMI","country":"XX"},{"Key":"THAISI","mws":"SETIDX","country":"TH"},{"Key":"FTSTI","mws":"STI","country":"SG"},{"Key":"SGD","mws":"USDSGD","country":"SG"},{"Key":"IDR","mws":"USDIDR","country":"ID"},{"Key":"MYR","mws":"USDMYR","country":"MY"},{"Key":"THB","mws":"USDTHB","country":"TH"},{"Key":"PHP","mws":"USDPHP","country":"PH"},{"Key":"CLL","mws":"CRUDE OIL","country":"US"},{"Key":"MID250","mws":"MCX","country":"UK"},{"Key":"EURGBP","mws":"EURGBP","country":"US"},{"Key":"EURJPY","mws":"EURJPY","country":"US"},{"Key":"EURCHF","mws":"EURCHF","country":"US"}]};_djl.mixin(this.configuration,conf);this.timer="";this.chartData="";this.tableData="";this.panelData=[];this.panels=this.createPanels(this.configuration.moduleContainer);this.helpInfo=_djl.byId("helpInfo");this.footerBox=_djl.byId("footerBox");this.timeStamp=_djl.byId("mdm_timestamp");if(this.configuration.showMyMarkets){this.getPersonalizedSymbols();}
this.chartDataReady=false;this.tableDataReady=false;this.getChartData();this.addEvents();this.initializeNewsTicker();if(this.configuration.refreshModule){_djp.enableModuleRefresh(this.configuration.moduleName);this.setRefresh(this.configuration.refreshRate);}},initializeNewsTicker:function(){if(dojo.byId("newsTickerDiv")){dj.widget.panels.PanelsFactory.create("newsTickerDiv",{core:{panelIncrement:1},carousel:{type:"circular"},rotator:{rotateTime:0,rotateIterations:10}});}},setRefresh:function(refreshRate){var that=this;that.timer=setInterval(function(){if(_djp.isModuleRefreshEnabled(that.configuration.moduleName)){that.getChartData();console.log("Refreshed Market Data");}},refreshRate*1000);},addEvents:function(){var that=this;_djl.addLiveEvent(".mdRow","mouseover",function(ev){var target=(ev.srcElement||ev.target);while(target.tagName!="li"&&target.tagName!="LI"){target=target.parentNode;}
_djl.stopEvent(ev);var params=target.id.split("~");that.setRowSelected(target,params[0]);that.renderChartWithContainerAndSymbol(that.configuration.chartContainer+params[0],params[1],params[2]);that.timeStamp.innerHTML=params[3];},that);_djl.addLiveEvent(".btn_help","click",function(ev){_djl.stopEvent(ev);_djl.addClassName(that.footerBox,"mdmLegend-expanded");});_djl.addLiveEvent(".btn_close","click",function(ev){_djl.stopEvent(ev);_djl.removeClassName(that.footerBox,"mdmLegend-expanded");});},setRowSelected:function(target,container){var that=this;var tabs=_djl.query("#"+that.configuration.dataContainer+container+" .mdRow");for(var i=tabs.length-1;i>=0;i--){_djl.removeClassName(tabs[i],"mdRow-selected");}
_djl.addClassName(target,"mdRow-selected");},buildMyMarketSymbols:function(data){var that=this;if(!data.indexes){return;}
for(var i=0;i<data.indexes.length;i++){that.configuration.myMarketSymbols[i]=data.indexes[i].id;}
if(that.configuration.myMarketSymbols.length>0){that.configuration.defaultSymbols[0].symbols=that.configuration.myMarketSymbols;}},wsjToMWSymbol:function(symbol){var that=this;try{var symbolSize=that.configuration.symbolMapping.length;for(var i=0;i<symbolSize;i++){var map=that.configuration.symbolMapping[i];if(symbol==map.Key){return map.country+":"+map.mws;}}}catch(e){console.log(e);}
return symbol;},getPersonalizedSymbols:function(){var that=this;_djl.xhrGet({url:that.configuration.personalizedSymbolsURL,handleAs:"json",preventCache:true,headers:{"Accept":"application/json"},load:function(response,ioArgs){that.buildMyMarketSymbols(response);return response;},error:function(response,ioArgs){return response;}});},getChartData:function(){var that=this;_djl.xhrGet({url:that.configuration.chartDataURL,handleAs:"json",preventCache:true,load:function(response,ioArgs){that.chartData=response;that.chartDataReady=true;that.getTableData();return response;},error:function(response,ioArgs){that.chartDataReady=false;return response;}});},getTableData:function(){var that=this;_djl.xhrGet({url:that.configuration.tableDataURL,handleAs:"text",preventCache:true,load:function(response,ioArgs){response=response.substring(0,response.indexOf("<")-1);that.tableData=_djl.fromJson(response);that.tableDataReady=true;that.renderDataTable();that.renderChart();return response;},error:function(response,ioArgs){that.tableDataReady=false;console.log(response);console.log(ioArgs);return response;}});},renderChart:function(){var that=this;var withMyMarkets=0;for(var i=that.configuration.defaultSymbols.length-1;i>=withMyMarkets;i--){var symbol=that.configuration.defaultSymbols[i].symbols[0];that.renderChartWithContainerAndSymbol(that.configuration.chartContainer+
that.configuration.defaultSymbols[i].tab,that.wsjToMWSymbol(symbol),symbol);}},renderChartWithContainerAndSymbol:function(container,symbol,simId){var that=this;try{var stockchartChart=new EmbeddedChart(container,WSJIndexChartStyle,that.configuration.chartWidth,that.configuration.chartHeight,that.configuration.time,that.configuration.frequency,null,null,that.chartData,symbol,'');var chartExists=stockchartChart.ShowChart();if(!chartExists){that.showNoChartMessage(container,simId,that.configuration.overrideNoChartText);}}catch(exception){console.log(exception);}},showNoChartMessage:function(container,symbol,overrideChartTxt){var that=this;var containerObject=_djl.byId(container);if(!overrideChartTxt){containerObject.innerHTML="<p class=\"msg-chart\">Chart available at <a href=\""+that.configuration.indexLinkURL+symbol+"\">Market Data Center</a></p>";}else{containerObject.innerHTML="<p class=\"msg-chart\">Chart available on Finanzen.net</p>";}},setLastPointInChart:function(symbol,dataPoint,closeValue){var that=this;dataPoint=parseFloat(dataPoint);closeValue=parseFloat(closeValue);if(that.chartData!==""){for(var i=that.chartData.length-1;i>=0;i--){if(that.chartData[i].Key==symbol){var tradesSize=that.chartData[i].Value.Data[0].Value.Sessions[0].Trades.length;tradesSize=(tradesSize===0)?1:tradesSize;that.chartData[i].Value.Data[0].Value.Sessions[0].Trades[tradesSize]=dataPoint;if(closeValue!==0){that.chartData[i].Value.Data[0].Value.Sessions[0].PreviousClose=closeValue;}
if(dataPoint>that.chartData[i].Value.Data[0].Value.Sessions[0].High.Price){that.chartData[i].Value.Data[0].Value.Sessions[0].High={Index:that.chartData[i].Value.Data[0].Value.Sessions[0].High.Index,Price:dataPoint};}else if(dataPoint<that.chartData[i].Value.Data[0].Value.Sessions[0].Low.Price){that.chartData[i].Value.Data[0].Value.Sessions[0].Low={Index:that.chartData[i].Value.Data[0].Value.Sessions[0].Low.Index,Price:dataPoint};}}}}else{console.log("No Chart Data");}},renderDataTable:function(){var that=this;if(that.tableData.commodities_futures!==undefined){for(var i=that.tableData.commodities_futures.length-1;i>=0;i--){that.panelData[that.tableData.commodities_futures[i].sym]=that.tableData.commodities_futures[i];}}
for(var i=that.tableData.treasuries.length-1;i>=0;i--){that.panelData[that.tableData.treasuries[i].sym]=that.tableData.treasuries[i];}
for(i=that.tableData.indices.length-1;i>=0;i--){that.panelData[that.tableData.indices[i].sym]=that.tableData.indices[i];}
for(var currIndex=that.tableData.currencies.length-1;currIndex>=0;currIndex--){that.panelData[that.tableData.currencies[currIndex].sym]=that.tableData.currencies[currIndex];}
var withMyMarkets=0;var timeStamp="";for(var j=that.configuration.defaultSymbols.length-1;j>=withMyMarkets;j--){var symbolsArray=that.configuration.defaultSymbols[j].symbols;var tableContent="";var firstIndexOnList=true;var priceDP=2;var changeDP=2;var percentDP=2;for(var k=0;k<symbolsArray.length;k++){var dataForIndex=that.panelData[symbolsArray[k]];if(dataForIndex){if(dataForIndex.last!==null&&dataForIndex.last!==undefined){var name=dataForIndex.name.replace(/[\s+\w]+:\s*/g,"");var lastTrade=parseFloat(dataForIndex.last);var difference=0.00;var percentage=0.00;var stateCSS="positive";var hideCSS="";var mwSymbol=that.wsjToMWSymbol(symbolsArray[k]);if(that.configuration.defaultSymbols[j].tab==="currencyrates"&&symbolsArray[k]!=="USTYN"){var pastDay=parseFloat(dataForIndex.pd);difference=lastTrade-pastDay;percentage=(difference/pastDay)*100;that.setLastPointInChart(mwSymbol,lastTrade,dataForIndex.pd);priceDP=4;changeDP=4;percentDP=3;}else{if(symbolsArray[k]==="USTYN"){lastTrade=parseFloat(dataForIndex.yield);difference=parseFloat(dataForIndex.chg);percentage=(difference/dataForIndex.last);priceDP=4;changeDP=4;percentDP=3;}else{difference=parseFloat(dataForIndex.chg);percentage=parseFloat(dataForIndex.pchg);priceDP=2;changeDP=2;percentDP=2;}
that.setLastPointInChart(mwSymbol,lastTrade,0);}
stateCSS=(percentage>=0)?"positive":"negative";percentage=Math.abs(percentage);difference=Math.abs(difference);difference=difference.toFixed(changeDP);percentage=percentage.toFixed(percentDP);lastTrade=lastTrade.toFixed(priceDP);if(that.configuration.convertToGerman&&lastTrade){lastTrade=lastTrade.replace('.',',');difference=difference.replace('.',',');percentage=percentage.replace('.',',');}
var selectedCSS=(firstIndexOnList)?" mdRow-selected":"";var symurl="";if(that.configuration.overrideSymbolMapping){symurl=that.configuration.finanzenMapping[dataForIndex.sym];}else{symurl=that.configuration.indexLinkURL+dataForIndex.symsid;}
tableContent+="<li class=\"mdRow rowType-"+stateCSS+" "+selectedCSS+"\" id=\""+that.configuration.defaultSymbols[j].tab+"~"+mwSymbol+"~"+dataForIndex.symsid+"~"+dataForIndex.timestamp+"\">";tableContent+="<span class=\"mdData marketName\"><a href=\""+symurl+"\" class=\"md_index\" >"+name+"</a></span>";tableContent+="<span class=\"mdData marketValue\">"+lastTrade+"</span>";if(symbolsArray[k]!="USTYN"){tableContent+="<span class=\"mdData marketDelta\">"+difference+"</span>";tableContent+="<span class=\"mdData marketValue\">"+percentage+"%</span>";}else{tableContent+="<span class=\"mdData\"></span>";tableContent+="<span class=\"mdData\"></span>";}
tableContent+="</li>";if(firstIndexOnList){that.renderChartWithContainerAndSymbol(that.configuration.chartContainer+
that.configuration.defaultSymbols[j].tab,mwSymbol,symbolsArray[k]);timeStamp=dataForIndex.timestamp;firstIndexOnList=false;}}}}
document.getElementById(that.configuration.dataContainer+that.configuration.defaultSymbols[j].tab).innerHTML=tableContent;}
that.timeStamp.innerHTML=timeStamp;},addCommas:function(nStr){nStr+='';var x=nStr.split('.');var x1=x[0];var x2=x.length>1?'.'+x[1]:'';var rgx=/(\d+)(\d{3})/;while(rgx.test(x1)){x1=x1.replace(rgx,'$1'+','+'$2');}
return x1+x2;},createPanels:function(container){var that=this;return dj.widget.panels.PanelsFactory.create(container,{core:{panelPrefix:"marketDataPanel_",panels:that.configuration.tabs,enableHistory:false,activePanel:that.configuration.defaultTab},tabs:{tabPrefix:"marketDataTab_",tabOnStyle:"selectedTab",tabOffStyle:"deselected"}});}};dj.module.marketdata.marketDataModule=dj.module.marketdata.marketdata;
dojo.provide("dj.module.videos.liveVideoSchedule");dj.module.videos.liveVideoSchedule={init:function(a){this.config=dojo.mixin({showListClass:dojo.byId("vcrHomepageModuleShowList"),scheduleContentReloadInterval:3E5,scheduleStatusRefreshInterval:5E3,scheduleEndTimePadding:9E4,showLinkQuery:"",videoTabFeedURL:"/api-video/find_all_videos.asp?type=wsjdn-keywords&query=whatsnews&groupid=471&count=1&fields=id,name,description,wsj-section,wsj-subsection",videoTabSchedule:[],videoTabWaitSeconds:180,homeTimezone:"EDT"},a);this.scheduleTimeOffset=0;this.refreshStatusTimer=this.reloadContentTimer=null;this.isScheduledPlay=false;if(dojo.byId("vcrTab_tab_Video"))this.tabSet=dj.widget.panels.PanelsFactory.create("vcrTabs",{core:{panelPrefix:"vcrTab_panel_",panels:["Schedule","Video"]},tabs:{tabPrefix:"vcrTab_tab_",tabOnStyle:"selected",tabOffStyle:""}});this.tabSchedule=this.setUTCTabTimes(this.config.videoTabSchedule.split(","));this.lastPlayedTime=null;this.reloadContentAndRepeat();this.refreshStatusAndRepeat()},getCurrentTime:function(){return new Date((new Date).getTime()+
this.scheduleTimeOffset)},refreshScheduleStatus:function(){var a=this,b=a.getCurrentTime(),c=0,d=dojo.byId("vcrHomepageModuleShowList"),e=dojo.byId("vcrHomepageModule");dojo.query("li",d).forEach(function(f){var k=new Date(f.getAttribute("data-start-time")),g=new Date(k.getTime()+f.getAttribute("data-duration")*1E3+a.config.scheduleEndTimePadding);c++;if(!dojo.hasClass(f,"active"))if(k<=b&&b<=g)a.styleShowAsLive(f);else{b>g&&a.styleShowAsEncoding(f);f=dojo.query("a",f)[0];dojo.removeAttr(f,"href")}});a.tabSet&&a.tabSchedule.length>0&&a.playVideoTabOnSchedule(b);c===0?dojo.addClass(e,"hidden"):dojo.removeClass(e,"hidden")},styleShowAsLive:function(a){var b=dojo.query(".vcrStatus",a)[0],c,d;if(!dojo.hasClass(a,"selected live")){dojo.removeClass(a,"not-active");dojo.addClass(a,"selected live");c=a.getAttribute("data-href");d=dojo.query("a",a)[0];d.setAttribute("href",c);dojo.removeClass(b,"upcomingText");dojo.removeClass(b,"encodeText");dojo.addClass(b,"vcrStatus actionLiveText");b.innerHTML="Watch Live Now";b=dojo.query(".vcrIcon",a)[0];dojo.removeClass(b,"hourglass");dojo.addClass(b,"vcrIcon livebutton");b.innerHTML=this.iconSVG("live");a=dojo.query(".vcrShowStatus",a)[0];a.setAttribute("title","Click to watch this live show.")}},styleShowAsEncoding:function(a){var b=dojo.query(".vcrStatus",a)[0];if(!dojo.hasClass(b,"encodeText")){dojo.removeClass(a,"selected live");dojo.addClass(a,"not-active");dojo.removeClass(b,"upcomingText");dojo.removeClass(b,"actionText");dojo.addClass(b,"vcrStatus encodeText");b.innerHTML="Available Soon";b=dojo.query(".vcrIcon",a)[0];dojo.removeClass(b,"livebutton");dojo.addClass(b,"vcrIcon hourglass");b.innerHTML=this.iconSVG("encoding");a=dojo.query(".vcrShowStatus",a)[0];a.setAttribute("title","This show will be available for replay viewing later today.")}},reloadScheduleContent:function(){var a=this,b="/wsjtvschedule?format=json&startDate=today&endDate=today&timezoneOffset="+(new Date).getTimezoneOffset();dojo.xhrGet({url:b,handleAs:"json",load:function(c){dojo.byId("vcrHomepageModuleShowListContainer").innerHTML=a.scheduleItemsFromJSON(c.reverse());c=dojo.byId("vcrHomepageModuleShowList");c=new Date(c.getAttribute("data-schedule-time"));a.scheduleTimeOffset=c.getTime()-(new Date).getTime();a.refreshScheduleStatus();console.log("liveVideoSchedule data reloaded")},error:function(c,d){console.warn("liveVideoSchedule data reload failed. HTTP status code: ",d.xhr.status)}})},scheduleItemsFromJSON:function(a){var b=this,c="",d,e,f,k,g,h;dojo.forEach(a,function(l){d=new Date(l.PubDate);e=new Date(l.ServerTimeUtc);f=b.formattedAMPMTime(d);k=l.Description.replace('"',"&quot;").replace("'","&rsquo;");g={durationInMinutes:l.Media.Content[0].Duration,itemHREF:l.Link,itemTimestamp:l.PubDate,itemShowtime:d,scheduleTime:e,itemShortShowtimeText:f,itemShowName:l.ShowName,itemDescriptionHTML:k};h=l.ServerTimeUtc;g=e.getTime()<d.getTime()?dojo.mixin(g,{linkTooltip:"This show is scheduled for "+f+".",itemClass:"not-active",itemStatusTextClass:"upcomingText",itemStatusText:"Coming Up",itemIconClass:"hourglass",itemIconType:"comingup"}):l.Media.Content[0].IsLiveStream?dojo.mixin(g,{linkTooltip:"This show will be ready for replay viewing later today.",itemStatusTextClass:"encodeText",itemStatusText:"Available Soon",itemIconClass:"hourglass",itemIconType:"encoding"}):dojo.mixin(g,{linkTooltip:"Click to watch this show.",itemClass:"active",itemStatusTextClass:"actionText",itemStatusText:"Watch",itemIconClass:"playback",itemIconType:"vod"});c+=b.itemHTML(g)});return'<ul id="vcrHomepageModuleShowList" class="vcrHomepageMod-Videolinks" data-schedule-time="'+
h+'">'+c+"</ul>"},itemHTML:function(a){a=dojo.mixin({linkTooltip:"This show is scheduled for later today.",itemClass:"not-active",itemTimestamp:"",durationInMinutes:"0",itemHREF:"",itemDescriptionHTML:"Details are currently unavailable for this show.",itemShortShowtimeText:"12:00 AM",itemShowName:"Scheduled Show",itemStatusTextClass:"upcomingText",itemStatusText:"Coming Up",itemIconClass:"hourglass",itemIconType:"comingup"},a);var b="";if(this.config.showLinkQuery.length>0)a.itemHREF+=a.itemHREF.indexOf("?")>-1?"&"+this.config.showLinkQuery:"?"+this.config.showLinkQuery;b+='<li class="'+a.itemClass+'" data-href="'+a.itemHREF+'" data-start-time="'+a.itemTimestamp+'" data-duration="'+a.durationInMinutes+'">';b+='<a href="'+encodeURI(a.itemHREF)+'">';b+='<span class="vcrShowDesc" title="'+a.itemDescriptionHTML+'">';b+='<span class="vcrHomepageMod-Time">'+a.itemShortShowtimeText+"</span>";b+='<span class="vcrTitle">'+a.itemShowName+"</span>";b+="</span>";b+='<span class="vcrShowStatus" title="'+a.linkTooltip+'">';b+='<span class="vcrStatus '+a.itemStatusTextClass+'">'+a.itemStatusText+"</span>";b+='<span class="vcrIcon '+a.itemIconClass+'">'+this.iconSVG(a.itemIconType,a.itemShowtime)+"</span>";b+="</span>";b+="</a>";b+="</li>";return b},reloadContentAndRepeat:function(){var a=dj.module.videos.liveVideoSchedule;a.reloadScheduleContent();a.reloadContentTimer=setTimeout(a.reloadContentAndRepeat,a.config.scheduleContentReloadInterval)},refreshStatusAndRepeat:function(){var a=dj.module.videos.liveVideoSchedule;a.refreshScheduleStatus();a.refreshStatusTimer=setTimeout(a.refreshStatusAndRepeat,a.config.scheduleStatusRefreshInterval)},iconSVG:function(a,b){switch(a){case"vod":return this.videoIconSVG("#247","margin: 0px 0px 0px -6px");case"encoding":return this.waitIconSVG("margin: -1px 0px 0px -6px");case"live":return this.videoIconSVG("#192","margin: -1px 0px 0px -6px");case"comingup":return this.clockIconSVG(b);default:return""}},videoIconSVG:function(a,b){var c="";c+='<svg viewBox="0 0 100 100" width="17" height="17" style="background-color: #fff; stroke: '+
a+"; fill: "+a+"; "+b+'"><circle cx="50" cy="50" r="44.5" style="stroke-width: 0px" />';c+='<polygon points="37,30 74,51 37,73" fill="#fff" />';c+="</svg>";return c},waitIconSVG:function(a){var b="";b+='<svg viewBox="0 0 100 100" width="17" height="17" style="background-color: #fff; stroke: #a4a4a4; fill: #a4a4a4; '+a+'"><circle cx="50" cy="50" r="45" style="stroke-width: 0px" />';b+='<polygon points="30,17 70,17 70,30 67,35 55,47 55,50 67,62 70,67 70,83 30,83 30,67 33,62 45,50 45,47 33,35 30,30" fill="#fff" />';b+='<polygon points="40,30 60,30 50,42" fill="#a4a4a4" />';b+='<polygon points="50,57 65,75 65,77 35,77 35,75" fill="#a4a4a4" />';b+="</svg>";return b},clockIconSVG:function(a){var b="";try{var c=a.getMinutes(),d=a.getHours()%12+c/60;b+='<svg viewBox="0 0 100 100" width="17" height="17" style="background-color: #fff; stroke: #aaa; stroke-linecap: butt; fill: #aaa; margin: -1px 0px 0px -6px"><circle cx="50" cy="50" r="45" style="stroke-width: 0px" />';b+='<g style="stroke-width: 11px; stroke: #fff">';b+='<line x1="50" y1="54" x2="50" y2="29" transform="rotate('+d*30+',50,50)" />';b+='<line x1="50" y1="54" x2="50" y2="18" transform="rotate('+c*6+',50,50)" />';b+="</g>";b+="</svg>"}catch(e){console.warn("clockIconSVG render failed")}return b},formattedAMPMTime:function(a){var b,c;b=a.getHours();if(b===0)b=12;else if(b>12)b-=12;c=a.getMinutes();c=c<10?"0"+c:c;a=a.getHours()<12?"AM":"PM";return b+":"+c+" "+a},setUTCTabTimes:function(a){for(var b,c,d,e=this.config.homeTimezone==="EDT"?4:5,f=[],k=0;k<a.length;k++){b=a[k];c=b.split(":");b=this.getCurrentTime();d=parseInt(c[0]);if(!isNaN(d)&&d>=0&&d<=23){b.setUTCHours(d+e);if(c.length===1)c=0;else{c=parseInt(c[1]);if(isNaN(c)||c<0||c>59)continue}b.setUTCMinutes(c);b.setUTCSeconds(0);f[f.length]=b}}return f},playVideoTabOnSchedule:function(a){this.tabSet.getActivePanel()!=="Video"&&this.isInViewport()&&this.isVideoTabPlayTime(a)&&this.openVideoTab()},isVideoTabPlayTime:function(a){for(var b=this.config.videoTabWaitSeconds*1E3,c,d,e=0;e<this.tabSchedule.length;e++){c=this.tabSchedule[e];d=new Date(c.getTime()+b);if(c<=a&&a<d)if(c!==this.lastPlayedTime){this.lastPlayedTime=c;return true}}return false},isInViewport:function(){var a=dojo.byId("vcrHomepageModule");return dj.util.onVisible._isNodeVisible(a)},openVideoTab:function(){this.isScheduledPlay=true;dojo.byId("vcrTab_tab_Video").click()}};
dojo.provide("dj.util.Article");dj.util.Article={getParentByNodeName:function(b,a){if(b.nodeName.toLowerCase()==a||b.parentNode===null)return b;return dj.util.Article.getParentByNodeName(b.parentNode,a)},isFloat:function(b){return/\d+\.\d+/.test(b)},shortenMe:function(){var b="http://api.bit.ly/shorten?callback=bitlyCallback&longUrl="+encodeURIComponent(longUrl)+"&version=2.0.1&login=wsjblogs&apiKey=R_4dd2ea29f00a2b806151d12d7807286b";if(document.getElementById("bitlynode")===null){var a=document.createElement("script");a.setAttribute("id","bitlynode");a.setAttribute("src",b);document.body.appendChild(a)}else window.open(bitlyTargetUrl);return false}};dojo.provide("dj.widget.article.slideshow.nonflashSlideshow");dojo.require("dj.widget.panels.PanelsFactory");dojo.require("dj.util.Ads");dojo.require("dj.util.Tracking");dojo.require("dojo.back");dojo.require("dojo.hash");dojo.require("dj.widget.email.EmailThis");dojo.require("dj.util.Element");ApplicationState=function(b,a,c){this.stateData=a;this.changeUrl=c||false;this.pModel=b};ApplicationState.prototype={back:function(){dj.widget.article.slideshow.slideshowHOD.historyCall(this.stateData)},forward:function(){dj.widget.article.slideshow.slideshowHOD.historyCall(this.stateData)}};dj.widget.article.slideshow.nonflashSlideshow={ACTION_SOURCE:{BOOKMARK:1,CONTROL:2,HISTORY:3,NONE:-1},init:function(b,a){var c=this.config=dojo.safeMixin({containerId:"slideContainer",imageCreditCriteria:".imageCredit div",slideDescriptionCriteria:".slideDescription div",adRefreshCounter:3,hasBrowserHistory:true,panels:{core:{enableLazyImages:true,panelGroup:".imageSlide .newsItem",cacheVector:false,tabletSwipe:true},carousel:{hasLastSlideScrim:true}},additionalControl:["slideBox"],hashPrefix:"slide/",history:true,tabbedModule:false,lastSlideScrim:{id:"lastSlideScrim",clazz:".lastSlideScrim",backToBeginning:".dSlideviewer-backToBeginning"},slideContainer:"slideBox",swipeThresholdRatio:0.5,removeElement:null,removeClass:"startNext",renderThumbs:false,fireInitOmniture:true,omnitureContainerId:"omnitureInitCall",disableOmnitureCall:false,thumbsContainerId:"thumbBox",thumbsPanels:{core:{panelIncrement:3},carousel:{navContainer:".nav-inline",showNavButtons:true}}},b);try{if(b!=null&&b!==undefined){if(b.photopannel!==undefined&&b.photopannel!=null&&b.photopannel!="")c.panels=dojo.fromJson(b.photopannel);if(b.lastslidescrimobj!==undefined&&b.lastslidescrimobj!=null&&b.lastslidescrimobj!="")c.lastSlideScrim=dojo.fromJson(b.lastslidescrimobj);if(b.thumbspanel!==undefined&&b.thumbspanel!=null&&b.thumbspanel!="")c.thumbsPanels=dojo.fromJson(b.thumbspanel);if(b.slideContainer!==undefined&&b.slideContainer!=null)c.additionalControl[0]=b.slideContainer}}catch(d){console.log("Error while reteriving the config obj: "+d)}this._initialize(a);this._initLastSlideScrim();this.config.hasBrowserHistory&&this._initHistory();this._initializeTools();this._initializeCaptionShowHide()},_initialize:function(b){var a=null,c=this.config,d=this,e=c.additionalControl,f=dj.widget.panels.PanelsFactory;this.clickCounter=0;this.omniture={};this.panelsCount=0;this.actionSource=this.ACTION_SOURCE.NONE;if(b!==undefined&&b!==null)a=this.nextPanel=f.create(c.containerId,c.panels);else a=this.pnls=f.create(c.containerId,c.panels);a.firstNavArrows={view:a.views.navArrows,control:a.controllers.navArrows,lastSlideScrim:c.lastSlideScrim,slideContainer:c.slideContainer};a.lastSlideScrim=c.lastSlideScrim;b=0;for(var g=e.length;b<g;b++)f.addModuleNavArrows(a,{container:dojo.byId(e[b]),tabletSwipe:c.panels.core.tabletSwipe,thresholdRatio:c.swipeThresholdRatio});this.panelsCount=a.getNumberOfPanels();try{if(c.panels.carousel.hasLastSlideScrim){d=this;d.currPanel=a;dojo.addLiveEvent(c.lastSlideScrim.backToBeginning,"click",dojo.hitch(d,function(j){dojo.stopEvent(j);d._backToBeginning(d.currPanel)}),this)}}catch(h){console.log("Error while initializing last slide: "+c.lastSlideScrim.backToBeginning+" Error Msg: "+h)}a.addChangeListener("failure",function(j){if(c.tabbedModule&&c.slideshowParent!==undefined){dj.util.Element.setData(dojo.byId(c.slideshowParent),"activity","live");dj.module.electionTabbedRenderer.handlePageRefresh(c.slideshowParent,"off");dj.module.electionTabbedRenderer.handleModuleRefresh(c.slideshowParent,null,"refresh","off")}var n=a.firstNavArrows.lastSlideScrim.id,l=dojo.byId(n);if(l!==undefined&&l!==null){if(j>a.getNumberOfPanels()){a.firstNavArrows.view.displayLastSlideScrim();this._enableLastSlideScrim(n,a.firstNavArrows.slideContainer)}}else if(j>a.getNumberOfPanels()){a.firstNavArrows.view.displayLastSlideScrim();this._enableLastSlideScrim()}dojo.query("#email_LastSlide").connect("onclick",function(){(new dj.widget.email.EmailThis(null,{type:"slideshow",mod:"wsj_share_email"})).init()})},this);a.addChangeListener("success",function(j){if(c.tabbedModule&&c.slideshowParent!==undefined){dj.util.Element.setData(dojo.byId(c.slideshowParent),"activity","live");dj.module.electionTabbedRenderer.handlePageRefresh(c.slideshowParent,"off");dj.module.electionTabbedRenderer.handleModuleRefresh(c.slideshowParent,null,"refresh","off")}prevId=this.model._prevInHistory._position?this.model._prevInHistory._position:1;j=j.getPosition();if(prevId===j)prevId=1;if(j!==1)dojo.removeClass(c.slideContainer,"theFirstSlide");else j===1&&dojo.addClass(c.slideContainer,"theFirstSlide");try{if(!c.panels.carousel.hasLastSlideScrim&&a.getNumberOfPanels()===j)c.panels.carousel.nextButton!==undefined&&dojo.forEach(dojo.query(c.panels.carousel.nextButton),function(p){dojo.addClass(p,"hidden")});else!c.panels.carousel.hasLastSlideScrim&&a.getNumberOfPanels()-1===j&&c.panels.carousel.nextButton!==undefined&&dojo.forEach(dojo.query(c.panels.carousel.nextButton),function(p){dojo.hasClass(p,"hidden")&&dojo.removeClass(p,"hidden")})}catch(n){console.log("{nonflashSlideshow => addChangeListener} Error while hidding/showing next arrow")}try{c.removeElement=dojo.query("."+c.removeClass)||c.removeElement;c.removeElement.length>0&&dojo.removeClass(c.removeElement[0],c.removeClass)}catch(l){console.log("{nonflashSlideshow => addChangeListener} Error while removing startnext class")}d.updateThumbsAndPanel(prevId,j,c.renderThumbs,c.containerId,c.slideDescriptionCriteria,c.imageCreditCriteria);if(c.renderThumbs){d.thumbs.setActiveByPosition(j);if(j>d.thumbs.getActivePanel()+7)d.thumbs.setActiveByPosition(j-6);else j<=d.thumbs.getActivePanel()&&d.thumbs.setActiveByPosition(j)}});if(dojo.byId(c.thumbsContainerId))c.renderThumbs=true;if(dojo.byId(c.omnitureContainerId))c.fireInitOmniture=false;if(c.renderThumbs){this.thumbs=dj.widget.panels.PanelsFactory.create(c.thumbsContainerId,c.thumbsPanels);d=this;dojo.addLiveEvent(".thumbs","click",function(){try{d._disableLastSlideScrim();d.pnls.firstNavArrows.control.disableLastSlideScrim()}catch(j){console.info("Error in disabling the last slide.")}d.pnls.getActivePanel();var n=this.id.split("_")[1];d.pnls.setActiveByPosition(n)})}},_initializeCaptionShowHide:function(){dojo.addLiveEvent(".ssTxtToggle","click",function(b){dojo.stopEvent(b);var a=this.parentNode;if(a){var c=dojo.query(".caption_short",a);if(c){var d=dojo.query(".caption_full",a);if(d){c.addClass("hidden");d.removeClass("hidden");dojo.addClass(this,"hidden")}}}})},updateThumbsAndPanel:function(b,a,c,d,e,f){this.clickCounter+=1;var g=null;if(d!==undefined&&d!==null&&d!=="")g=dojo.byId(d);var h=null,j=null;if(d!==undefined&&d!==null&&d!==""){h=dojo.query(e,g.parentNode);j=dojo.query(f,g.parentNode)}else{h=dojo.query(this.config.imageCreditCriteria);j=dojo.query(this.config.slideDescriptionCriteria)}if(h!=undefined&&h[b-1])h[b-1].style.display="none";if(h!=undefined&&h[a-1])h[a-1].style.display="block";if(j!=undefined&&j[b-1])j[b-1].style.display="none";if(j!=undefined&&j[a-1])j[a-1].style.display="block";if(this.clickCounter%this.config.adRefreshCounter==0)try{(new dj.util.Ads).loadAds("slideshow",{ordrecalculate:1})}catch(n){}if(c){c=dojo.query(".imageInfo .summary p");if(c[b-1])c[b-1].style.display="none";dojo.removeClassName(dojo.query("#thumbs_"+b)[0],"selected");if(c[a-1])c[a-1].style.display="block";dojo.addClassName(dojo.query("#thumbs_"+a)[0],"selected")}if(a!==1)try{this.config.disableOmnitureCall||this.omniturefirepixel(a)}catch(l){console.log("Error nonflashSlideshow{omniturefirepixel}: "+l)}},_initHistory:function(){var b=this.config;if(b.history){dojo.subscribe("/dojo/hashchange",this,function(d){if(this.actionSource!==this.ACTION_SOURCE.CONTROL&&this.actionSource!==this.ACTION_SOURCE.BOOKMARK){d=d.replace(b.hashPrefix,"");var e=this.pnls.getNumberOfPanels();if(d==="eos"){this._enableLastSlideScrim();this.actionSource=this.ACTION_SOURCE.HISTORY;this.isEos=true}else{e=parseInt(d);this.isEos&&this._disableLastSlideScrim();this.isEos=false}this.pnls.setActiveByPosition(e)}if(this.actionSource!==this.ACTION_SOURCE.HISTORY)this.actionSource=this.ACTION_SOURCE.NONE});this.pnls.addChangeListener("success",function(d){if(this.actionSource===this.ACTION_SOURCE.BOOKMARK||this.actionSource===this.ACTION_SOURCE.HISTORY)this.actionSource=this.ACTION_SOURCE.NONE;else{d=b.hashPrefix+d._position;this.actionSource=this.ACTION_SOURCE.CONTROL;dojo.hash(d)}},this);this.pnls.addChangeListener("failure",function(d){if(this.actionSource!==this.ACTION_SOURCE.BOOKMARK&&d>this.pnls.getNumberOfPanels()){d=b.hashPrefix+"eos";this.actionSource=this.ACTION_SOURCE.CONTROL;dojo.hash(d)}},this);var a=dojo.hash();this.actionSource=this.ACTION_SOURCE.BOOKMARK;if(a===""||a==="articleTabs%3Dslideshow"){if(a==="articleTabs%3Dslideshow")this.isTabbedSlideshow=true;dojo.hash(b.hashPrefix.concat(1),true);b.fireInitOmniture&&this.omniturefirepixel()}else{a=a.split("/")[1];if(a==="eos"){a=this.pnls;var c=a._activePanelObserver;this.isEos=true;c.fireByName("failure",a.getNumberOfPanels()+1);this.pnls.setActiveByPosition(this.pnls.getNumberOfPanels())}else{a=parseInt(a);if(a!==this.pnls.getActive()._position)this.pnls.setActiveByPosition(a);else{this.actionSource=this.ACTION_SOURCE.NONE;b.fireInitOmniture&&this.omniturefirepixel()}}}}},_initLastSlideScrim:function(){},_initializeTools:function(){dojo.query("#email").connect("onclick",function(){(new dj.widget.email.EmailThis(null,{type:"slideshow",mod:"wsj_share_email"})).init()})},_enableLastSlideScrim:function(b,a){var c=this.config;if(b!==undefined&&b!==null){dojo.removeClass(b,"hidden");dojo.removeClass(a,"theFirstSlide");dojo.addClass(a,"theLastSlide")}else{dojo.removeClass(c.lastSlideScrim.id,"hidden");dojo.removeClass(c.slideContainer,"theFirstSlide");dojo.addClass(c.slideContainer,"theLastSlide")}},_disableLastSlideScrim:function(b,a){var c=this.config;if(b!==undefined&&b!==null){dojo.addClass(b,"hidden");dojo.removeClass(a,"theLastSlide");dojo.addClass(a,"theFirstSlide")}else{dojo.addClass(c.lastSlideScrim.id,"hidden");dojo.removeClass(c.slideContainer,"theLastSlide");dojo.addClass(c.slideContainer,"theFirstSlide")}},_backToBeginning:function(b){if(b!==undefined&&b!==null){this._disableLastSlideScrim(b.firstNavArrows.lastSlideScrim.id,b.firstNavArrows.slideContainer);b.setActiveByPosition(1);b.firstNavArrows.control.disableLastSlideScrim()}else{this._disableLastSlideScrim();this.pnls.setActiveByPosition(1);this.pnls.firstNavArrows.control.disableLastSlideScrim()}},historyCall:function(b){this.pnls.setHistory=false;var a=b;if(b.length>1&&b.indexOf("last")>0){a=b.split("/")[1];this.pnls.setActiveByPosition(a);dojo.byId("lastSlideScrim").style.display="block"}else this.pnls.setActiveByPosition(a);this.pnls.setHistory=true},initExplore:function(){this.initExploreSlideshows();this.initializeExplore()},initExploreSlideshows:function(){this.exploreMore=dj.widget.panels.PanelsFactory.create("exploreMoreSlideshows",{core:{panelIncrement:5,panelGroup:".carouselContainer",panel:"ul.one li",enableLazyImages:true},carousel:{},rotator:{rotateTime:0}})},initializeExplore:function(){var b=this;dojo.addLiveEvent(".baseDocId","click",function(){b.baseDocId=this.id;b.openSlideshow()})},openSlideshow:function(){document.location.href=dj.context.core.urlPrefix+"/article/"+this.baseDocId+".html"},omnituresavepixel:function(){for(var b=this.omniture.saveVars.length,a=0;a<b;a++)this.omniture.saveValues[a]=this.omniture.pixel.getMetaData(this.omniture.saveVars[a])},omniturerestorepixel:function(){for(var b=this.omniture.saveVars.length,a=0;a<b;a++)this.omniture.pixel.setMetaData(this.omniture.saveVars[a],this.omniture.saveValues[a])},omniturefirepixel:function(){isBlogs=document.domain.indexOf("blogs")==-1?false:true;this.omniture={};this.omniture.saveVars=["pageName","section","subsection","aheadline","abasedocid","author","atype","csource","ctype","apage","basesection"];this.omniture.saveValues=[];if(!this.omniture.pixel)this.omniture.pixel=dj.util.Tracking.omniture;this.omniture.pixel.resetPixel();this.omnituresavepixel();var b="http://online.wsj.com";if(dj.context.core)b=dj.context.core.urlPrefix;var a=/jp(.f.dev|.s.dev|).wsj.com/,c=/jpbeta.wsj.com/,d=/wallstreetjournal.de/,e=/tr(.f.dev|.s.dev|).wsj.com/,f=/(f.dev.|s.dev.|)wsj.com.tr/;this.omniturePrefix=b.match(a)||b.match(c)?"WSJJP_":b.match(d)?"WSJDE_":b.match(e)?"WSJTur_":b.match(f)?"WSJTur_":"WSJ_";a=this.omniture.pixel.getMetaData("subsection");if(typeof a=="undefined"||a==""){a="US News";setMetaData("subsection",a)}setMetaData("qsymbol","slideshow");b=this.omniture.pixel.getMetaData("aheadline");setMetaData("aheadline",this.omniturePrefix+"slideshow_"+a+"_"+b);if(!isBlogs){setMetaData("section","Multimedia");setMetaData("apage",this.omniturePrefix+"Multimedia_Slideshow");setMetaData("atype",this.omniturePrefix+"Multimedia_Slideshow");setMetaData("basesection",this.omniturePrefix+"Slideshow");this.isTabbedSlideshow?setMetaData("ctype","photos_tab"):setMetaData("ctype","photos")}setMetaData("csource","DJ Infographics");this.omniture.pixel.getMetaData("atype");a=this.pnls.getActivePanel()+1;setMetaData("pageName","Infogrfx Slide Show Redesigned_"+b+"_"+a+"_of_"+this.panelsCount);b="http://online.wsj.com";if(dj.context.core)b=dj.context.core.urlPrefix;a=/jp(.f.dev|.s.dev|).wsj.com/;c=/jpbeta.wsj.com/;d=/wallstreetjournal.de/;e=/tr(.f.dev|.s.dev|).wsj.com/;f=/(f.dev.|s.dev.|)wsj.com.tr/;if(b.match(a)||b.match(c))this.omniture.pixel.firePixel(true,"WSJJP_");else if(b.match(d))this.omniture.pixel.firePixel(true,"WSJDE_");else if(b.match(e))this.omniture.pixel.firePixel(true,"WSJTur_");else b.match(f)?this.omniture.pixel.firePixel(true,"WSJTur_"):this.omniture.pixel.firePixel(true);this.omniturerestorepixel()}};
dojo.provide("dj.module.electionTabbedRenderer");dojo.require("dj.widget.fragmentloader.FragmentLoader");dojo.require("dj.util.user.Environment");dojo.require("dj.util.JSExec");dojo.require("dj.util.Region");dojo.require("dj.util.User");dojo.require("dj.util.Page");dojo.require("dj.util.Element");dojo.require("dj.widget.massrelevance.tweetRiver");dojo.require("dj.widget.email.EmailThis");dojo.require("dj.widget.article.slideshow.nonflashSlideshow");dj.module.electionTabbedRenderer={init:function(a){this.conf={version:"v21",iframeSrc:"http://graphicsdev.dowjones.net/users/keegan/ELECTION2012HP/?m=n",fragmentJSON:{TABBEDLIVEVIDEO:{fragmentURL:"/public/page/NA_WSJ_PUB:0_0_WP_TABBED_MODULE_LIVEVIDEO",container:"tabbedDataPanel_LIVEVIDEO",refreshRate:"0",refreshCount:0,tabstatus:"inactive"},TABBEDVIDEO:{fragmentURL:"/public/page/NA_WSJ_PUB:0_0_WP_TABBED_MODULE_VIDEO",container:"tabbedDataPanel_VIDEO",refreshRate:"240000",refreshCount:0,tabstatus:"inactive"},TABBEDSLIDESHOW:{fragmentURL:"/public/page/NA_WSJ_PUB:0_0_WP_TABBED_MODULE_SLIDESHOW",container:"tabbedDataPanel_SLIDESHOW",refreshRate:"120000",refreshCount:0,tabstatus:"inactive"},TABBEDPHOTOS:{fragmentURL:"/public/page/NA_WSJ_PUB:0_0_WP_TABBED_MODULE_PHOTO",container:"tabbedDataPanel_PHOTO",refreshRate:"120000",refreshCount:0,tabstatus:"inactive"},TABBEDIFRAME:{fragmentURL:"/public/page/NA_WSJ_PUB:0_0_WP_TABBED_MODULE_IFRAME",container:"tabbedDataPanel_IFRAME",refreshRate:"1200000",refreshCount:0,tabstatus:"inactive"}},TTL:"1m",userEnv:null,videoTab:"TABBEDVIDEO",liTabPrefix:"tabbedModule_",nav_election_class:".nav_election_class",election_tabContent:".subnavTabs",livevideoTab:"TABBEDLIVEVIDEO",slideshowTab:"TABBEDSLIDESHOW",photoTab:"TABBEDPHOTO",refreshContainerClass:"refresh",iframeTab:"TABBEDIFRAME",slideShowContainer:"TABBEDSLIDESHOW_CONTAINER",photoContainer:"TABBEDPHOTO_CONTAINER",containerPrefix:"container_",tabPrefix:"tabbedDataPanel_",omPagePrefix:"",blockquoteHide:'<div class="video_content_text content_text hidden">',blockquoteStart:'<div class="video_content_text content_text">',blockquoteEnd:'</div><div class="blank_content_text content_text"></div>',photoDescStart:'<p class="msg_txt" id="photoTabDesc">',photoTagCount:37,refreshLimit:49,initialLoad:false,tabbedShareTools:".tabbedShareTools",slideshowParams:{photopannel:"photopannel","image-credit-criteria":"imageCreditCriteria","slide-description-criteria":"slideDescriptionCriteria",hashprefix:"hashPrefix","slide-container":"slideContainer","container-id":"containerId",lastslidescrimobj:"lastslidescrimobj","has-browser-history":"hasBrowserHistory"},selectedTabClass:".electionSelectedTab",tabstatus:"",domNodeId:"tabbedDataPanel_LIVEVIDEO",livevideoTextStart:"<p class='msg_txt'>",livevideoTextEnd:"</p>",mediaCaptionStart:"<div class='mediaCaption'><p>",mediaCaptionEnd:"</p></div>",photoText:"",isLoadInlineJs:false,electionVideoURL:"http://live.wsj.com?category=election2012",twitterStreamConfig:{streamCount:1,streamRefreshInterval:30,twitterStreamName:"dowjonestwo/wsjtest",mrJSWidgetToLoad:"https://raw.github.com/MassRelevance/massrel-js/master/massrel.js",streamEleClass:".content_section"}};if(a)this.conf=dojo.mixin(this.conf,a);a=dojo.query(this.conf.selectedTabClass)[0];this.addEvents();this.conf.initialLoad=true;this.loadTabData(a,"init")},selectDeselect:function(a,b){dojo.forEach(dojo.query(b.conf.nav_election_class),function(f){if(dojo.hasClass(f,"selected")){dojo.removeClass(f,"selected");dojo.addClass(f,"deselected")}});dojo.removeClass(a.parentNode,"deselected");dojo.addClass(a.parentNode,"selected");b=this;dojo.forEach(dojo.query(b.conf.election_tabContent),function(f){dojo.hasClass(f,"hidden")||(dojo.hasClass(f,"videoTabClass_Content")&&!b._isIE()?dojo.attr(f,"style","position: absolute; top: -5000px; left: -500px; "):dojo.addClass(f,"hidden"))});var d=dj.util.Element.getData(a.parentNode,"container-id"),c=null;if(d!==undefined&&d!==null&&"TABBEDVIDEO"===d){d=a.parentNode.id;d=d.replace(b.conf.liTabPrefix,b.conf.tabPrefix);c=dojo.byId(d)}else c=dojo.byId(b.conf.tabPrefix+
d);if(dojo.hasClass(c,"videoTabClass_Content")){dojo.removeClass(c,"hidden");dojo.attr(c,"style","")}else dojo.removeClass(c,"hidden")},addEvents:function(){var a=this;dojo.query(a.conf.nav_election_class).connect("onclick",function(b){dojo.stopEvent(b);b=b.srcElement||b.target;try{var d=b.parentNode.id;if(d!==undefined&&d!==null&&d!==""){d=d.replace(a.conf.liTabPrefix,"");if(pID!==undefined&&pID!==null&&pID!=="")d=d+"_"+pID;a.omnitureTabClicks(a.conf.omPagePrefix+d)}}catch(c){console.log("Error while making omniture call"+
c)}if(dj.util.Element.getData(b.parentNode,"tabstatus")==="active")a.selectDeselect(b,a);else{dj.util.Element.setData(b.parentNode,"tabstatus","active");dojo.addClass(b.parentNode,"electionSelectedTab");a.selectDeselect(b,a);a.loadTabData(b.parentNode,"tabclick")}})},executeInitialJS:function(a,b){a!==undefined&&a!==null&&a.init(b)},loadTabData:function(a,b){var d="",c="",f="",e="size=EtabbedVideo",g="";if(a!=null&&a!==undefined){d=dj.util.Element.getData(a,"container-id");c=dj.util.Element.getData(a,"secondparam")}if(b==="timer"&&dojo.hasClass(a,"deselected")){dj.util.Element.setData(a,"tabstatus","inactive");if(d.indexOf(this.conf.slideshowTab)!=-1||d.indexOf(this.conf.photoTab)!=-1)this.handleSlideshowRefresh(this,this.conf.liTabPrefix+d,a,"on")}else if(d!=null&&d!==undefined&&d!==""){var k=this.conf.fragmentJSON[d],m=k.fragmentURL;if(d.indexOf(this.conf.videoTab)!=-1){var s=e=f=null;if("TABBEDVIDEO"===d){g=a.id;g=g.replace(this.conf.liTabPrefix,this.conf.tabPrefix);e=dojo.byId(g)}try{if(e!==null&&e!==undefined)for(;e.parentNode!=null;){e=e.parentNode;if(dojo.hasClass(e,this.conf.refreshContainerClass)){f=e;break}}if(f!==undefined||f!==null)s=dj.util.Element.getData(f,"widget-playerid");if(s!==null&&(s.indexOf("||"+c+"||")!==-1||s.indexOf("||{"+c+"}||")!==-1)){this.setDataRefreshTimer(k.refreshRate,this,a);return}}catch(l){console.log("Error while handling refresh on video tab"+l)}e=dj.util.Element.getData(a,"alternatetext");f="-"+c.replace(/-/g,"vvodd")+".html?videoURL="+c+"&alternateText=size=EtabbedVideo";dj.util.Element.getData(a,"param-cid")}else if(d.indexOf(this.conf.livevideoTab)!=-1){if(this._isIpad())c=dj.util.Element.getData(a,"ipadsecondparam");e=dj.util.Element.getData(a,"alternatetext");f="-"+c+".html?livevideoURL="+c+"&alternatText="+e}else if(d.indexOf(this.conf.slideshowTab)!=-1||d.indexOf(this.conf.photoTab)!=-1){b==="tabclick"&&dj.util.Element.setData(a,"activity","live");f=dj.util.Element.getData(a,"activity");if(b==="timer"&&this.isActiveLive(f)){this.setDataRefreshTimer(k.refreshRate,this,a);this.handleSlideshowRefresh(this,this.conf.liTabPrefix+d,a,"off");dj.util.Element.setData(a,"activity","");return}else if(b==="timer"&&!this.isActiveLive(f))this.handleSlideshowRefresh(this,this.conf.liTabPrefix+d,a,"on");else if(b!=="timer"){this.handleSlideshowRefresh(this,this.conf.liTabPrefix+d,a,"off");dj.util.Element.setData(a,"activity","")}e=dj.util.Element.getData(a,"alternatetext");f="-"+e+"-"+c+"-"+this.conf.initialLoad+".html?slideshowurl="+e+"&flashProject="+c+"&initialLoad="+
this.conf.initialLoad;if(k.refreshCount>=this.conf.refreshLimit)k.refreshCount=0;else k.refreshCount+=1}else if(d.indexOf(this.conf.iframeTab)!=-1){e=dj.util.Element.getData(a,"project-src-id");f="-"+c+"-"+e+".html?iframeSrc="+c+"&projectSrc="+e}this.conf.initialLoad=false;if(d.indexOf(this.conf.videoTab)!=-1)d=g;this.tabrefreshCount=k.refreshCount;this.domNodeId=this.conf.containerPrefix+d;var j=this;b!=="init"?dojo.xhrGet({url:m+f,handleAs:"text",load:function(r){j.populateTab(r,j.domNodeId,j.tabrefreshCount)},error:function(r){console.log(r)}}):j.populateTab("init",this.domNodeId,this.tabrefreshCount);console.log("********************** Refreshing tab content **********************"+a.id);k.refreshRate!=0&&this.setDataRefreshTimer(k.refreshRate,this,a)}},handleSlideshowRefresh:function(a,b,d,c){try{var f=dojo.byId(d.id);d=null;if(f!==null&&f!==undefined)for(;f.parentNode!=null;){f=f.parentNode;if(dojo.hasClass(f,a.conf.refreshContainerClass)){d=f;break}}if(d===undefined||d===null)a.handlePageRefresh("tabbed_media_bucket",c);else{a.handlePageRefresh(b,c);a.handleModuleRefresh(b,d,"refresh",c)}}catch(e){console.log("Error while handling refresh on slideshow tab"+e)}},setDataRefreshTimer:function(a,b,d){var c=[];c[0]=b;c[1]=d;console.log("********************Refreshed****************************: "+d.id);setTimeout(dojo.hitch(c,function(){c[0].loadTabData(c[1],"timer")}),a)},populateDescription:function(a){a=dojo.query("."+a+"_desc")[0];return a!==undefined&&a!==null?a.innerHTML:null},populateTab:function(a,b,d){a=a;if(a!=="init"){if(b.indexOf(this.conf.livevideoTab)!=-1){var c=this.populateDescription(this.domNodeId),f=this.populateDescription(this.domNodeId+"_caption");if(f!==undefined&&f!==null&&f!=="")a=a+this.conf.mediaCaptionStart+f+this.conf.mediaCaptionEnd;if(c!==undefined&&c!==null&&c!=="")a=a+this.conf.livevideoTextStart+c+this.conf.livevideoTextEnd}else if(b.indexOf(this.conf.videoTab)!=-1)try{var e=this.populateDescription(this.domNodeId);if(e!==undefined&&e!==null&&e!==""){var g=a.indexOf(this.conf.blockquoteHide);if(g===-1)g=a.indexOf(this.conf.blockquoteStart);var k=a.indexOf(this.conf.blockquoteEnd);a=a.substring(0,g)+this.conf.blockquoteStart+e+a.substring(k)}else a=a.replace(this.conf.blockquoteHide,this.conf.blockquoteStart)}catch(m){console.log("Error while trying to reteriving edited video description by editors")}else if(b.indexOf(this.conf.photoTab)!=-1)try{a=a.replace(/sscountt/g,d);e=this.populateDescription(this.domNodeId);if(e!==undefined&&e!==null&&e!==""){g=a.indexOf(this.conf.photoDescStart);a=a.substring(0,g+this.conf.photoTagCount)+e+a.substring(g+this.conf.photoTagCount)}}catch(s){console.log("Error while trying to reteriving edited Photo tab description by editors")}else a=a.replace(/sscountt/g,d);dojo.query("."+this.domNodeId)[0].innerHTML="";dojo.query("."+this.domNodeId)[0].innerHTML=a}else if(b.indexOf(this.conf.livevideoTab)!=-1)try{c=this.populateDescription(this.domNodeId);f=this.populateDescription(this.domNodeId+"_caption");var l=dojo.byId("live_Video_Player");if(l===undefined||l===null)l=dojo.query(".media_c")[0];if(l){if(f!==undefined&&f!==null&&f!==""){var j=document.createElement("div");dojo.addClass(j,"mediaCaption");var r=document.createElement("p");r.appendChild(document.createTextNode(f));j.appendChild(r);l.appendChild(j)}if(c!==undefined&&c!==null&&c!=="")l.innerHTML=l.innerHTML+this.conf.livevideoTextStart+c+this.conf.livevideoTextEnd}}catch(t){console.log("Error while trying to reteriving edited live video description by editors")}else if(b.indexOf(this.conf.videoTab)!=-1)try{e=this.populateDescription(this.domNodeId);if(e!==undefined&&e!==null&&e!=="")if(l=dojo.query(".video_content_text.content_text")[0]){l.innerHTML=e;dojo.hasClass(l,"hidden")&&dojo.removeClass(l,"hidden")}}catch(q){console.log("Error while trying to reteriving edited video description by editors")}else if(b.indexOf(this.conf.photoTab)!=-1)try{a=a.replace(/sscountt/g,d);e=this.populateDescription(this.domNodeId);if(e!==undefined&&e!==null&&e!==""){g=a.indexOf(this.conf.photoDescStart);a.substring(0,g+this.conf.photoTagCount);a.substring(g+this.conf.photoTagCount)}}catch(n){console.log("Error while trying to reteriving edited Photo tab description by editors")}else a.replace(/sscountt/g,d);this._executeJS(b,this)},_executeJS:function(a,b){var d=null,c=false,f="slide",e={};if(a.indexOf(b.conf.slideshowTab)!=-1){c=true;d=dojo.byId(b.conf.slideShowContainer);e.slideshowParent=a.replace("container","tabbedModule")}else if(a.indexOf(b.conf.photoTab)!=-1){c=true;d=dojo.byId(b.conf.photoContainer);e.slideshowParent=a.replace("container","tabbedModule");f="photo"}if(c){c=b.conf.slideshowParams;try{for(var g in c){var k=c[g],m=dj.util.Element.getData(d,g);if(m!=null&&m!==undefined){if(m==="false")m=false;else if(m==="true")m=true;e[k]=m}}}catch(s){}d=null;if(f==="photo")d={};e.disableOmnitureCall=true;e.tabbedModule=true;dj.widget.article.slideshow.nonflashSlideshow.init(e,d);this.addLastSlideEvents(b)}else if(a.indexOf(b.conf.livevideoTab)!=-1){dj.util.flash.template.scan();dojo.hitch(b,b.initiateLiveTwitterFeed())}},addLastSlideEvents:function(a){dojo.query(a.conf.tabbedShareTools).connect("onclick",function(b){dojo.stopEvent(b);b=b.srcElement||b.target;try{var d=dj.util.Element.getData(b,"url"),c=dj.util.Element.getData(b,"headline"),f=dj.util.Element.getData(b,"type");if(f!==undefined&&f!==null&&f!==""){if(f==="twitter")a.popUp("http://twitter.com/intent/tweet?text="+encodeURIComponent(c)+" "+encodeURIComponent(d),"share","toolbar=0,status=0,width=770,height=450,resizable=1,scrollbars=1");else if(f==="google")a.popUp("https://accounts.google.com/ServiceLogin?service=oz&continue=https://plus.google.com/share?url="+
encodeURIComponent(d)+"&src=frameless&btmpl=popup&hl=en-US","share","toolbar=0,status=0,width=770,height=450,resizable=1,scrollbars=1");else f==="email"&&(new dj.widget.email.EmailThis(null,{type:"slideshow",title:c,url:d,mod:"wsj_share_email"})).init();f==="facebook"&&d&&a.popUp("http://www.facebook.com/login.php?display=popup&next=http://www.facebook.com/sharer/sharer.php?u="+d,"share","toolbar=0,status=0,width=770,height=450,resizable=1,scrollbars=1")}}catch(e){console.log("Error while making omniture call"+
e)}})},popUp:function(a,b,d){(a=window.open(a,b,d))&&a.focus()},initiateLiveTwitterFeed:function(){var a=dojo.query("#tabbedModule_"+this.conf.livevideoTab)[0];if(a!=null&&typeof a!=="undefined"){twitterProject=dj.util.Element.getData(a,"twitterproject");if(twitterProject!=null&&typeof twitterProject!=="undefined"&&twitterProject!=""){a=new dj.widget.massrelevance.tweetRiver(this.conf.twitterStreamConfig);var b=dojo.query("#tabbedDataPanel_"+this.conf.livevideoTab+" "+this.conf.twitterStreamConfig.streamEleClass);if(b.length>0){b=b[0];b.innerHTML="";this.includeTwitterJS(b);a.getTwitterFeed(this.renderStreamContent,this,b)}}}},includeTwitterJS:function(a){var b=document.createElement("script");b.type="text/javascript";b.src="http://platform.twitter.com/widgets.js";a.appendChild(b)},renderStreamContent:function(){var a=dojo.query("#tabbedDataPanel_"+this.conf.livevideoTab+" "+this.conf.twitterStreamConfig.streamEleClass);if(a.length>0)dojo.create("a",{href:this.conf.electionVideoURL,"class":"moreLn"},a[0],"last").innerHTML="View All Video Clips &raquo;"},_getUserEnv:function(){var a=this.conf.userEnv;if(null===a)a=(new dj.util.user.EnvironmentDao(dj.util.Region,dj.util.User)).getEnvironment();return a},_getVersion:function(){var a=new Date,b=this.conf.version;if(dojo.doc.location.toString().indexOf("debugMode")>-1)b=a.getTime();return b},_isIpad:function(){var a=navigator.userAgent.toLowerCase();if(a.match(/iPhone/i)||a.match(/Android/i)||a.match(/iPad/i))return true;return false},_isIE:function(){if(navigator.userAgent.toLowerCase().match(/MSIE/i))return true;return false},omnitureTabClicks:function(a){try{this.omn=dj.util.Tracking.omniture;if(!this.omn.isInitialized()){dj.util.Omniture.init();dj.util.Tracking.omniture.init()}this.omn._s.eVar12=a;this.omn._s.prop10=a;this.omn._s.tl(this,"o",a)}catch(b){console.log("Error electionTabbedRenderer {omnitureTabClicks}: "+b)}},isActiveLive:function(a){return a!==undefined&&a!==null&&a==="live"?true:false},handlePageRefresh:function(a,b){var d=dj.util.Page;if(b==="on")try{dojo.query("div [ data-widget-playerid]");var c=true;dojo.forEach(dojo.query("div [ data-widget-playerid]"),function(e){e=dj.util.Element.getData(e,"widget-playerid");if(e!==undefined&&e!==null&&e!==""&&e.indexOf(a)===-1)c=false});if(c){console.log("************* Enable ********************** ");d.enableRefresh()}}catch(f){console.log("Error while enabling the page refresh"+f);d.enableRefresh()}else{console.log("************* Diable ********************** ");d.disableRefresh()}},handleModuleRefresh:function(a,b,d,c){var f=dj.util.Page;d=d==null?"refresh":d;if(c==="on"){c=null;var e=dojo.byId(a);if(e==null)try{var g=navigator.appVersion,k=g.indexOf("MSIE 7.");if(k!==-1){var m=dojo.query("."+d);dojo.some(m,function(q){var n=dj.util.Element.getData(q,"widget-playerid");if(n!=null&&n.indexOf(a)!==-1){e=q;return false}})}else e=dojo.query('object param[ value*= "'+a+'"]')[0]}catch(s){}if(e!=null)for(;e.parentNode!=null;){e=e.parentNode;if(dojo.hasClass(e,d)){c=e;break}}if(c!=null){b=null;try{b=dj.util.Element.getData(c,"widget-playerid")}catch(l){}if(b==null||b===""){f.enableModuleRefresh(c.id);dj.module[c.id+"_updater"]&&dj.module[c.id+"_updater"].start()}else if(b.indexOf("||||")===-1&&b==="||"+a+"||"){dojo.attr(c,"data-widget-playerid","");f.enableModuleRefresh(c.id);dj.module[c.id+"_updater"]&&dj.module[c.id+"_updater"].start()}else if(b.indexOf("||||")!==-1){b=b.replace("||"+a+"||","");dojo.attr(c,"data-widget-playerid",b)}}else{f.enableModuleRefresh(b);dj.module[b+"_updater"]&&dj.module[b+"_updater"].start()}}else{c=null;e=dojo.byId(a);if(e==null)try{g=navigator.appVersion;k=g.indexOf("MSIE 7.");if(k!==-1){var j=dojo.query("object param");dojo.some(j,function(q){if(q.value!=null&&q.value!=undefined)if(q.value.indexOf(a)!==-1){e=q;return false}})}else e=dojo.query('object param[ value*= "'+a+'"]')[0]}catch(r){}if(e!=null)for(;e.parentNode!=null;){e=e.parentNode;if(dojo.hasClass(e,d)){c=e;break}}if(c!=null){f.disableModuleRefresh(c.id);b=null;try{b=dj.util.Element.getData(c,"widget-playerid")}catch(t){}if(b==null||b==="")dojo.attr(c,"data-widget-playerid","||"+a+"||");else b.indexOf(a)===-1&&dojo.attr(c,"data-widget-playerid",b+"||"+a+"||")}else f.disableModuleRefresh(b)}}};
dojo.provide("dj.widget.newsreel.NewsReelLoader");dojo.require("dj.widget.fragmentloader.FragmentLoader");dojo.require("dj.util.user.EnvironmentDao");dojo.require("dj.util.Region");dojo.require("dj.util.User");dojo.declare("dj.widget.newsreel.NewsReelLoader",dj.widget.fragmentloader.FragmentLoader,{NEWSREEL_CONFIG:{newsreelContainer:"newsReel",adRegisterKey:"newsReelAd",TTL:"24h"},constructor:function(a,b,e,c,d){this.cfg=dojo.delegate(this.DEFAULT_CONFIG,this.NEWSREEL_CONFIG);dojo.mixin(this.cfg,d);if(a=dj.util.Element.getDataset(dojo.byId(c)||{}))this.mstPageId=a.newsreelpage||this.mstPageId;this.cfg.isLoadCss=false;this.cfg.isLoadJs=false;this._initNewsReelRenderers();console.info("this.cfg.isLoadHtml="+
this.cfg.isLoadHtml)},onHtmlLoad:function(){dj.module.newsReel.init(this.cfg.newsreelContainer,this.cfg.adRegisterKey)},_initRenderers:function(){},_initNewsReelRenderers:function(){var a=dojo.clone(dj.context.core);this.userEnv=this._getUserEnv();a.customCacheCdnPrefix=dj.context.core.cdnPrefix;a=new dj.widget.fragmentloader.dao.FileServiceDao(dj.util.io.script,a,{TTL:this.cfg.TTL});var b=new dj.util.PollingConditionChecker;this.fragmentBo=new dj.widget.fragmentloader.bo.FragmentBo(a,this.userEnv,this.cfg);this.fileRenderer=new dj.widget.fragmentloader.renderer.FileRenderer(dj.util.animation,b)},_getUserEnv:function(){var a=this.userEnv;a||(a=(new dj.util.user.EnvironmentDao(dj.util.Region,dj.util.User)).getEnvironment());return a}});
dojo.provide("dj.widget.survey.WSJDNPopUnder");dojo.require("dj.lang");dojo.require("dj.util.Cookie");dojo.require("dj.util.Url");dojo.require("dj.util.User");(function(){var _du=dj.util;var _dws=dj.widget.survey;(_dws.WSJDNPopUnder=function(cfg){this._cfg=dj.lang.cloneMixin(this.DEFAULT_CONFIG,cfg);this._duc=dj.util.Cookie;try{var that=this;that.popunder();}catch(e){throw e;}}).prototype={DEFAULT_CONFIG:{"url":"http://wsjdn.wsj.com/","cookieName":"wsjdnpopunder","windowName":"WSJDN","noRepeatInterval":"1d+","frequencyPercent":100,"cookieGroupExpirationDays":"90","blurPopunder":true,"width":0,"height":0,"popupParams":"menubar=yes,toolbar=yes,location=yes,status=yes,resizable=yes,personalbar=yes,scrollbars=yes"},popunder:function(){var Cookie=this._duc;if(this._canShowPopunder()){this._setNoRepeatCookie(this._cfg.noRepeatInterval);this.showPopUnder();}},showPopUnder:function(){var dimensions=""
if(this._cfg.width){dimensions="width="+this._cfg.width+",height="+this._cfg.height+",";}
var popunder=window.open(this._cfg.url,this._cfg.windowName,dimensions+this._cfg.popupParams);console.log(popunder);if(this._cfg.blurPopunder&&popunder!=null){popunder.blur();window.focus();}},_canShowPopunder:function(){var now=new Date();if((now.getTime()%100)>this._cfg.frequencyPercent){return false;}
var showPopunder=true;var noRepeatCookie=this._duc.getGroupCookie("DJCOOKIE",this._cfg.cookieName);if(noRepeatCookie){var noRepeatDate=new Date(noRepeatCookie);if((noRepeatDate-now)>0){showPopunder=false;}else{this._duc.deleteGroupCookie("DJCOOKIE",this._cfg.cookieName);}}
return showPopunder;},_setNoRepeatCookie:function(interval){var noRepeatDate=this._calcDate(interval);this._duc.setGroupCookie("DJCOOKIE",this._cfg.cookieName,noRepeatDate,this._cfg.cookieGroupExpirationDays);},_calcDate:function(D){var MS=this._calcMilliseconds(D),dO=new Date();dO.setTime((D.substring(D.length-1,D.length)=="+")?dO.getTime()+MS:dO.getTime()-MS);return dO.toGMTString();},_calcMilliseconds:function(D){var TD=D.substring(0,D.length-2),TC=D.substring(D.length-2,D.length-1).toLowerCase(),MS=0;MS=(TC=="m")?TD*((24*60*60*1000)*30):MS;MS=(TC=="d")?TD*(24*60*60*1000):MS;MS=(TC=="s")?TD*1000:MS;return MS;}};}());dojo.provide("dj.module.globalNav");dj.module.globalNav={setupQuicklinks:function(a,b){this.oHideQuickLinks=dojo.query(".hideQuickLinks");this.oGlobalSubNav=dojo.byId(a);this.oQuicklinksContainer=dojo.byId(b);if(typeof this.oHideQuickLinks==="undefined")if(this.oGlobalSubNav===null)if(this.oQuicklinksContainer!=null){dojo.removeClass(this.oQuicklinksContainer,"subnav_hide");dojo.addClass(this.oQuicklinksContainer,"subnav_show")}}};
dojo.provide("dj.module.header.localWeather");dojo.require("dj.util.Cookie");dojo.require("dj.util.User");dojo.require("dj.widget.fragmentloader.FragmentLoader");
(function(){dj.module.header.localWeather={init:function(a){var b={defaultLocation:"10005",ttl:10,populateEl:"weatherContent",fragmentPage:"0_0_WC_HeaderWeather",iframeId:"iframeweatherDetails",iframeParam:"location",locationNameId:"locationName",pznUrl:"/pznusersvc/update/user/profile",setPznWeatherUrl:"/pznusersvc/view/user/profile?profileType=weatherCode",redirectUrl:"http://commerce.wsj.com/auth/login",locationSavedTxt:"Default location saved"};dojo.mixin(b,a);this.config=b;this.cookieWeatherCode=
this.getCookie("weatherCode");dj.util.Region.getViewByRegion()==="na,us"&&this._load()},_load:function(){var a=this;dj.util.User.isLoggedIn(function(b){if(b)dj.util.User.getUserId(function(c){var d=a.getCookie("weatherCode")?a.getCookie("weatherCode"):a.config.defaultLocation;if(a.getCookie("weatherUser")===c)a.getHTML(d);else{a.clearWeatherCookies();a.getPznLocalWeather(c)}});else{a.getHTML(a.config.defaultLocation);a.clearWeatherCookies()}})},getHTML:function(a){var b=(new dj.util.user.EnvironmentDao(dj.util.Region,
dj.util.User)).getEnvironment();(new dj.widget.fragmentloader.FragmentLoader(b,this.config.fragmentPage,a+"-v"+Math.floor(Math.random()*9E4)+1E4,this.config.populateEl,{isLoadCss:false,isLoadHtml:true,isLoadJs:false,isLoadInlineJs:false,isAnimated:false,TTL:this.config.ttl})).load()},getCookie:function(a){return dj.util.Cookie.getGroupCookie("DJCOOKIE",a)},setCookie:function(a,b){dj.util.Cookie.setGroupCookie("DJCOOKIE",a,b,365)},setDefaultLocation:function(a){var b=this,c=dojo.byId(a);a=b.getIframeParam(this.config.iframeId,
this.config.iframeParam);var d=a!==""?a:this.config.defaultLocation;dojo.byId(this.config.locationNameId).innerHTML=unescape(this.getIframeParam(b.config.iframeId,"name"));dj.util.User.isLoggedIn(function(e){if(e)d!==b.getCookie("weatherCode")?dojo.connect(c,"click",function(g){dojo.stopEvent(g);b.clearWeatherCookies();b.setPznLocalWeather(d);b.getHTML(d);b.setCookie("weatherCode",d);dojo.addClass(c,"hidden");dojo.place("<span style='font-size:1.1em'>"+b.config.locationSavedTxt+"</span>",c,"before")}):
dojo.addClass(c,"hidden");else dojo.connect(c,"click",function(g){dojo.stopEvent(g);window.location=b.getCommerceRedirectUrl()})})},getPznLocalWeather:function(a){var b=this;dojo.xhrGet({url:b.config.setPznWeatherUrl,headers:{Accept:"application/json"},handleAs:"json",load:function(c,d){d.xhr.getResponseHeader("Status");if(200!==d.xhr.status)console.error("Error message: Service is not working with Error Code: "+d.xhr.status);else{var e=c.User.profileData[0];if(e!==undefined){b.setCookie("weatherUser",
a);b.setCookie("weatherCode",e.weatherCode);b.getHTML(e.weatherCode)}else b.getHTML(b.config.defaultLocation)}},error:function(c,d){console.error("HTTP status code: ",d.xhr.status);return c}})},setPznLocalWeather:function(a){a={url:this.config.pznUrl,postData:dojo.toJson({profileType:"weatherCode",profileName:"weatherCode",params:[{weatherCode:a}]}),handleAs:"json",contentType:"application/json",accept:"application/json",load:function(){},error:function(){}};dojo.xhrPost(a)},clearWeatherCookies:function(){dj.util.Cookie.deleteGroupCookie("DJCOOKIE",
"weatherUser");dj.util.Cookie.deleteGroupCookie("DJCOOKIE","weatherCode")},getCommerceRedirectUrl:function(a){return(a||this.config.redirectUrl)+"&url="+escape(window.location)},getIframeParam:function(a,b){var c=dojo.byId(a).src,d="[\\?&]"+b.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]")+"=([^&#]*)";c=RegExp(d).exec(c);return c===null?"":c[1]}}})();
dojo.provide("dj.module.header.sectionMenu");dojo.require("dj.widget.panel.LiveModalPanel");dojo.require("dj.util.Element");dojo.require("dj.lang");dojo.require("dj.widget.panel.SelectDropdownPanel");
(function(){dj.module.header.sectionMenu={init:function(){var a=false;this.delayedMouseOver("._exp",function(b){if(!a){this.initializeHeaderPanels();this.setEvents();a=true}this.initShowData(b)},250);this.fadeInArrows()},initializeHeaderPanels:function(){if(this.headerMenu)console.log("Section menu already initialzed");else this.headerMenu=new dj.widget.panel.LiveModalPanel({container:".linklist_dropdown .wsjmn_dropdown_container",containerInd:".linklist_dropdown .wsjmn_dropdown_container .mnExpand",
dropdownContent:".wsjmn_dropdownContent",actionEvent:"click",stateContainer:".wsjmn_dropdownTree",stateCollapsed:"wsjmn_ddState-collapsed",stateExpanded:"wsjmn_ddState-expanded",navContainer:".pmMainNav",stateHover:"mndd_ddState-hover",queryUpClass:"wsjmn_dropdownTree",addMouseEvents:false})},initShowData:function(a){var b=this.getDropdownIndex(a),c=dj.util.Element.getDataset(a).dropdownindex;c=dojo.byId(c+"_content");this.showData(b,c,a)},showData:function(a,b,c){var d=this;setTimeout(function(){if(dojo.hasClassName(c,
"_data")===false){dojo.addClass(c,"_data");d.getHTML(a,b,c)}})},getDropdownIndex:function(a){a=dj.util.Element.getDataset(a);return dj.util.Element.getDataset(dojo.byId(a.dropdownindex)).panelServiceUri},setIframeShimHeights:function(a){a=dj.util.Element.getDataset(a).dropdownindex.match(/(\d.*)/)[0];var b="wsjmn_dropdown_iframe"+a,c=dojo.byId("wsjmn_dropdown"+a+"_content");b=dojo.byId(b);for(var d=0;d<=c.length-1;d++)try{b.offsetHeight=dojo.byId("wsjmn_dropdown_content"+a).offsetHeight}catch(e){}try{b.offsetHeight=
dojo.byId("wsjmn_dropdown_content"+a).offsetHeight}catch(g){}},setEvents:function(){var a=this;dj.lang.addLiveEvent("._exp","mousedown",function(b){a.initShowData(b.target||b.srcElement)});dj.lang.addLiveEvent(".subExpand","mousedown",function(){a.subFlyoutToggle("1-3")})},delayedMouseOver:function(a,b,c){var d=false,e,g=this;dj.lang.addLiveEvent(a,"mouseout",function(){d=false});dj.lang.addLiveEvent(a,"mouseover",function(){e&&clearTimeout(e);d=true;var h=this;e=setTimeout(function(){d&&b.call(g,
h)},c)})},getHTML:function(a,b){dojo.xhrGet({url:a,headers:{Accept:"application/html"},handleAs:"text",load:function(c,d){d.xhr.getResponseHeader("Status");b.innerHTML=c;c.match(/<!--BusinessDropdown--\>/)&&new dj.widget.panel.SelectDropdownPanel("subIndDropdown")},error:function(c,d){console.error("HTTP status code: ",d.xhr.status);return c}})},subFlyoutToggle:function(a){a=dojo.byId("wsjsub_flyout"+a);if(a===null)return false;var b=a.className;a.className=b.indexOf("wsjsub_ddState-collapsed")!==
-1?b.replace(/wsjsub_ddState-collapsed/,"wsjsub_ddState-expanded"):b.replace(/wsjsub_ddState-expanded/,"wsjsub_ddState-collapsed");return false},fadeInArrows:function(){for(var a=dojo.query(".mnExpand._exp"),b=0;b<=a.length-1;b++)dojo.fadeIn({node:a[b],duration:1E3}).play()}}})();
dojo.provide("dj.module.globalHeader");dojo.deprecated("dj.module.globalHeader","use dj.module.header.globalHeader instead","1.4.1");dojo.require("dj.lang");dojo.require("dj.util.Config");dojo.require("dj.util.Cookie");dojo.require("dj.util.Date");dojo.require("dj.util.Region");dojo.require("dj.util.Element");dojo.require("dj.util.User");
dj.module.globalHeader=function(){var a={HEADER_CONTAINER_CLASS:".header",TIMESTAMP_CLASS:".date",WSJ_LOGO_ID:"wsjLogo",WSJ_LARGE_LOGO_CLASSNAME:"logo_large",WSJ_SMALL_LOGO_CLASSNAME:"logo_small",CURRENT_SUBSECTION_DISPLAY_CLASS:".currentSubSection",GLOBALNAV_SUBSECTION_ELEMENT_ID:"currentGlobalNavSubSection",SUBSCRIBER_LOGIN_CLASS:".login",HEADER_PROMO_CLASS:".promo",SUBSCRIBER_DETAILS_ELEMENT_ID:"subscribedUserDetailsId",COMMUNITY_FORUMS_LINK_CLASS:".communityForumsLink",TODAYS_PAPER_LINK_CLASS:".todaysPaperLink",
MOJ_LINK_CLASS:".myOnlineJournalLink",MESSAGE_CENTER_LINK_CLASS:".messageCenterLink",MESSAGE_COUNT_CLASS:".messageCount",LOGIN_USERNAME_ELEMENT_ID:"login_username",LOGIN_PASSWORD_ELEMENT_ID:"login_password",LOGIN_FORM_ID:"login_form",PAGE_URL_ELEMENT_ID:"page_url",LOGOUT_LINK_ELEMENT_ID:"logoutLink",LOGIN_BUTTON_ELEMENT_ID:"login_button",USER_NAME_ELEMENT_ID:"userName",WSJ_LOGO_FADE_APPEAR_DURATION:"1.0",WSJ_LOGO_DELAY_DURATION:"2000",LOGGED_IN_COMMUNITY_URL:"/community",LOGGED_IN_TODAYS_PAPER_URL:"/itp?mod=WSJ_formfactor",
LOGGED_IN_TODAYS_PAPER_URL_ASIA:"/itp/asia?mod=WSJ_formfactor",LOGGED_IN_TODAYS_PAPER_URL_EUROPE:"/itp/europe?mod=WSJ_formfactor",MESSAGE_CENTER_POST_URL:"/community/integration/userinfo.html",LOGOUT_URL:"/static_html_files/logout_confirmation.htm",SUBSCRIBER_HOMEPAGE_PID:"0_0_WH_0001",NONSUBSCRIBER_HOMEPAGE_PID:"0_0_WH_0001_public",ASIA_PAGE_PID:"0_0_WP_2103",EUROPE_PAGE_PID:"0_0_WP_2104",NONSUBSCRIBER_NEWSLETTERS_ALERTS_PAGE_PID:"5_6007",NONSUBSCRIBER_SEARCH_PAGE_PID:"3_0466",HOMEPAGE_SUBSCRIBER_URL:"/",
SEARCH_PAGE_SUBSCRIBER_URL:"/search",TODAYS_PAPER_LINK_CONTAINER_CLASS:".todaysPaperLinkContainer",VIDEO_LINK_CONTAINER_CLASS:".videoLinkContainer",COLUMNS_LINK_CONTAINER_CLASS:".columnsLinkContainer",BLOGS_LINK_CONTAINER_CLASS:".blogsLinkContainer",INTERACTIVE_GRAPHICS_LINK_CONTAINER_CLASS:".interactiveGraphicsLinkContainer",TOPICS_LINK_CONTAINER_CLASS:".topicsLinkContainer",COMMUNITY_FORUMS_LINK_CONTAINER_CLASS:".communityForumsLinkContainer",TODAYS_PAPER_PID:"0_0_WP_40",TODAYS_PAPER_US_NONSUB_PID:"2_0433",
TODAYS_PAPER_EUROPE_NONSUB_PID:"2_0434",TODAYS_PAPER_ASIA_NONSUB_PID:"2_0435",TODAYS_PAPER_US_PID:"2_0133",TODAYS_PAPER_EUROPE_PID:"2_0134",TODAYS_PAPER_ASIA_PID:"2_0135",TODAYS_PAPER_PAST_EDITIONS_PID:"2_0233",TODAYS_PAPER_INDEX_BIZ_PID:"2_0156",TODAYS_PAPER_INDEX_PEOPLE_PID:"2_0155",TODAYS_PAPER_CORRECTIONS_PID:"Corrections",VIDEO_PID:"0_0_WP_3000",BLOGS_PID:"8_0019",COLUMNS_PID:"2_0140",INTERACTIVE_GRAPHICS_PID:"0_0_WP_2003",TOPICS_PID:"0_0_WT_0001",NEWSLETTERS_ALERTS_SUB_PID:"5_6001",NEWSLETTERS_ALERTS_PUB_PID:"5_6003",
MOJ_LINK_URL:"/page/my-journal-main.html",MDC_LINK_URL:"/mdc/page/marketsdata.html",MDC_PAGE_PID:"2_3000",COMMUNITY_HIGHLIGHT_COMPARE_URL:"/community",FORUMS_HIGHLIGHT_COMPARE_URL:"forums.wsj.com",FREE_REG_CLASS:".freereg",LOCATION_NAV_CLASS:".location_nav",LOCATION_NAV_COLLAPSED_CLASSNAME:"location_collapsed",LOCATION_NAV_EXPANDED_CLASSNAME:"location_expanded",US_EDITION_LINK_CLASS:".map_us",EU_EDITION_LINK_CLASS:".map_europe",ASIA_EDITION_LINK_CLASS:".map_asia",IN_EDITION_LINK_CLASS:".map_india",
US_EDITION_MDC_URL:"/marketsdata",EU_EDITION_MDC_URL:"/mdc/public/page/marketsdata_europe.html",ASIA_EDITION_MDC_URL:"/mdc/public/page/marketsdata_asia.html",IN_EDITION_MDC_URL:"/mdc/public/page/marketsdata_asia.html",MDC_COMPARE_URL:"/mdc/",FOOTER_CONTAINER_CLASS:".pagefooter",GO_PRO_HOOK:"goprohook",GO_PRO_HOOK_REGION:["na,us"]};return{initialize:function(b){this.cfg=dj.lang.cloneMixin(a,b);this.oHeader=dojo.query(this.cfg.HEADER_CONTAINER_CLASS)[0];this.editionDropdownSetUp();this.displaySubSection();
this.displayTimeStamp();var c=this;this.currRegion=dj.util.Region.getViewByRegion();this.concatURL="";this.concatURL=typeof gcDomain!=="undefined"&&gcDomain&&gcDomain!==""?"http://"+gcDomain:"http://"+document.domain;dj.util.User.isLoggedIn(function(g){if(g){c.displaySubscriberDetails();c.setupLogout()}else{c.setupLogin();c.ofreereg=dojo.query(c.cfg.FREE_REG_CLASS,c.oHeader)[0];g=dojo.query("#register_module",c.ofreereg)[0];dojo.style(g,{display:"none"});dojo.style(c.ofreereg,{display:"block"});c.oSubscriberLogin=
dojo.query(c.cfg.SUBSCRIBER_LOGIN_CLASS,c.oHeader)[0];g=dojo.query(".login_module",c.oSubscriberLogin)[0];dojo.style(g,{display:"none"});dojo.style(c.oSubscriberLogin,{display:"block"});c.oHeaderPromo=dojo.query(c.cfg.HEADER_PROMO_CLASS,c.oHeader)[0];dojo.style(c.oHeaderPromo,{display:"block"})}});this.highlightFormFactorLinks();this.oTodaysPaperLink=dojo.query(this.cfg.TODAYS_PAPER_LINK_CLASS,this.oHeader)[0];b=this.cfg.LOGGED_IN_TODAYS_PAPER_URL;var d=this.cfg.LOGGED_IN_TODAYS_PAPER_URL_ASIA,e=
this.cfg.LOGGED_IN_TODAYS_PAPER_URL_EUROPE;if(this.currRegion=="asia"||this.currRegion=="asia,india")b=d;else if(this.currRegion=="europe")b=e;this.oTodaysPaperLink.href=typeof gcDomain!=="undefined"&&gcDomain&&gcDomain!==""?"http://"+gcDomain+b:b;dj.util.User.isSubLoggedIn(function(g){if(g){var h=-1;dojo.forEach(c.cfg.GO_PRO_HOOK_REGION,function(k,i){if(k===c.currRegion)h=i});if(c.cfg.GO_PRO_HOOK_REGION==="all"||h!==-1)dojo.removeClass(c.cfg.GO_PRO_HOOK,"hidden")}})},toggleDropdownClass:function(){var b=
this.cfg.LOCATION_NAV_COLLAPSED_CLASSNAME,c=this.cfg.LOCATION_NAV_EXPANDED_CLASSNAME;if(dojo.hasClass(this.oLocDropDownContainer,b)){dojo.removeClass(this.oLocDropDownContainer,b);dojo.addClass(this.oLocDropDownContainer,c)}else dojo.hasClass(this.oLocDropDownContainer,c)&&dojo.addClass(this.oLocDropDownContainer,b)},editionDropdownSetUp:function(){var b=this;this.oLocationNav=dojo.query(this.cfg.LOCATION_NAV_CLASS,this.oHeader)[0];var c=this.cfg.LOCATION_NAV_COLLAPSED_CLASSNAME,d=this.cfg.LOCATION_NAV_EXPANDED_CLASSNAME,
e=this.cfg.US_EDITION_LINK_CLASS;e=this.cfg.US_EDITION_LINK_CLASS;var g=this.cfg.EU_EDITION_LINK_CLASS,h=this.cfg.IN_EDITION_LINK_CLASS,k=this.cfg.ASIA_EDITION_LINK_CLASS;this.usEditionMDCUrl=this.cfg.US_EDITION_MDC_URL;this.euEditionMDCUrl=this.cfg.EU_EDITION_MDC_URL;this.inEditionMDCUrl=this.cfg.IN_EDITION_MDC_URL;this.asiaEditionMDCUrl=this.cfg.ASIA_EDITION_MDC_URL;var i=this.cfg.MDC_COMPARE_URL;this.oCurrentEdition=dojo.byId("currentEdition");this.oUsEdition=dojo.byId("usEdition");this.oEuEdition=
dojo.byId("europeEdition");this.oInEdition=dojo.byId("indiaEdition");this.oAsiaEdition=dojo.byId("asiaEdition");this.oChiEdition=dojo.byId("chiEdition");this.oJpnEdition=dojo.byId("jpnEdition");this.oSpaEdition=dojo.byId("spaEdition");this.oPorEdition=dojo.byId("porEdition");this.osectionFooterSub=dojo.byId("hrefNonSubId");this.osectionFooterNonSub=dojo.byId("hrefSubId");this.oUsEditionFooter=dojo.byId("usEditionFooter");this.currRegion=dj.util.Region.getViewByRegion();var f="";this.tempConcatURL=
typeof gcDomain!=="undefined"&&gcDomain&&gcDomain!==""?"http://"+gcDomain:"http://"+document.domain;this.isMDCPageFlag=document.location.href&&document.location.href!==""&&document.location.href.indexOf(i)!==-1;this.oUsEdition&&dojo.connect(this.oUsEdition,"onclick",this,function(l){dojo.stopEvent(l);dj.util.Region.setViewByRegion("na,us");dj.util.Cookie.setGroupCookie("DJCOOKIE","HOMEPAGE","/home-page",365);window.location=this.isMDCPageFlag?this.tempConcatURL+this.usEditionMDCUrl:this.oUsEdition.href});
this.oUsEditionFooter&&dojo.connect(this.oUsEditionFooter,"onclick",this,function(l){dojo.stopEvent(l);dj.util.Region.setViewByRegion("na,us");dj.util.Cookie.setGroupCookie("DJCOOKIE","HOMEPAGE","/home/us",365);window.location=this.isMDCPageFlag?this.tempConcatURL+this.usEditionMDCUrl:this.oUsEditionFooter.href});this.oEuEdition&&dojo.connect(this.oEuEdition,"onclick",this,function(l){dojo.stopEvent(l);window.location=this.isMDCPageFlag?this.tempConcatURL+this.euEditionMDCUrl:this.oEuEdition.href;
if(this.isMDCPageFlag){dj.util.Region.setViewByRegion("europe");dj.util.Cookie.setGroupCookie("DJCOOKIE","HOMEPAGE","/home/europe",365)}});this.oInEdition&&dojo.connect(this.oInEdition,"onclick",this,function(l){dojo.stopEvent(l);window.location=this.isMDCPageFlag?this.tempConcatURL+this.inEditionMDCUrl:this.oInEdition.href;if(this.isMDCPageFlag){dj.util.Region.setViewByRegion("asia,india");dj.util.Cookie.setGroupCookie("DJCOOKIE","HOMEPAGE","/home/india",365)}});this.oAsiaEdition&&dojo.connect(this.oAsiaEdition,
"onclick",this,function(l){dojo.stopEvent(l);window.location=this.isMDCPageFlag?this.tempConcatURL+this.asiaEditionMDCUrl:this.oAsiaEdition.href;if(this.isMDCPageFlag){dj.util.Region.setViewByRegion("asia");dj.util.Cookie.setGroupCookie("DJCOOKIE","HOMEPAGE","/home/asia",365)}});this.oChiEdition&&dojo.connect(this.oChiEdition,"onclick",this,function(l){dojo.stopEvent(l);window.open(this.oChiEdition.href)});this.oJpnEdition&&dojo.connect(this.oJpnEdition,"onclick",this,function(l){dojo.stopEvent(l);
window.open(this.oJpnEdition.href)});this.oSpaEdition&&dojo.connect(this.oSpaEdition,"onclick",this,function(l){dojo.stopEvent(l);window.location=this.oSpaEdition.href});this.oPorEdition&&dojo.connect(this.oPorEdition,"onclick",this,function(l){dojo.stopEvent(l);window.location=this.oPorEdition.href});this.osectionFooterSub&&dojo.connect(this.osectionFooterSub,"onclick",this,function(l){dojo.stopEvent(l);window.location=this.osectionFooterSub.href});this.osectionFooterNonSub&&dojo.connect(this.osectionFooterNonSub,
"onclick",this,function(l){dojo.stopEvent(l);window.location=this.osectionFooterNonSub.href});if(this.currRegion=="asia"){f="Asia Edition";this.oSelectedEdition=dojo.query(k,this.oHeader)[0]}else if(this.currRegion=="asia,india"){f="Asia Edition";this.oSelectedEdition=dojo.query(h,this.oHeader)[0]}else if(this.currRegion=="europe"){f="Europe Edition";this.oSelectedEdition=dojo.query(g,this.oHeader)[0]}else{f="U.S. Edition";this.oSelectedEdition=dojo.query(e,this.oHeader)[0]}dojo.addClass(this.oSelectedEdition,
"selected");this.oCurrentEdition.innerHTML=f;this.oFormFactorContainer=dojo.byId("formFactorContainer");dojo.style(this.oFormFactorContainer,{display:""});this.oLocDropDownContainer=dojo.byId("locNavContainer");dojo.style(this.oLocDropDownContainer,{display:""});if(this.oLocDropDownContainer){dojo.connect(this.oLocationNav,"onclick",this,function(l){dojo.stopEvent(l);if(dojo.hasClass(b.oLocDropDownContainer,c)){dojo.removeClass(b.oLocDropDownContainer,c);dojo.addClass(b.oLocDropDownContainer,d)}else if(dojo.hasClass(b.oLocDropDownContainer,
d)){dojo.removeClass(b.oLocDropDownContainer,d);dojo.addClass(b.oLocDropDownContainer,c)}});dojo.connect(document,"onclick",this,function(l){if(dj.util.Element.contains(this.oLocDropDownContainer,l.clientX,l.clientY)==false)if(dojo.hasClass(this.oLocDropDownContainer,d)){dojo.removeClass(this.oLocDropDownContainer,d);dojo.addClass(this.oLocDropDownContainer,c)}});this.oSectionFooterNonSub=dojo.byId("sectionFooterNonSub");this.oSectionFooterSub=dojo.byId("sectionFooterSub");dj.util.User.isLoggedIn(function(l){if(l){dojo.style(b.oSectionFooterNonSub,
{display:"none"});dojo.style(b.oSectionFooterSub,{display:""})}else{dojo.style(b.oSectionFooterNonSub,{display:""});dojo.style(b.oSectionFooterSub,{display:"none"})}})}},displayTimeStamp:function(){this.oTimestamp=dojo.query(this.cfg.TIMESTAMP_CLASS,this.oHeader)[0];if(typeof pDate!=="undefined"&&this.oTimestamp)this.oTimestamp.innerHTML=window.pStl=="renovation"?dj.util.Date.displayTime(pDate,pDateinGMT):pDate},displaySubSection:function(){this.oCurrentSubSection=dojo.query(this.cfg.CURRENT_SUBSECTION_DISPLAY_CLASS,
this.oHeader)[0];if(typeof globalHeaderPageTitle!=="undefined"&&globalHeaderPageTitle&&globalHeaderPageTitle!==""){this.oCurrentSubSection.innerHTML=globalHeaderPageTitle;this._delayedFadeInSubSection()}},_delayedFadeInSubSection:function(){setTimeout(dojo.hitch(this,function(){dojo.style(this.oCurrentSubSection,{display:"inline",opacity:0});dojo.fadeIn({node:this.oCurrentSubSection,duration:this.cfg.WSJ_LOGO_FADE_APPEAR_DURATION*1E3}).play()}),this.cfg.WSJ_LOGO_DELAY_DURATION)},displaySubscriberDetails:function(){dj.util.User.renderCallsign(this.cfg.USER_NAME_ELEMENT_ID);
this.setupSubscriberLinks();this.oMessageCenterLink=dojo.query(this.cfg.MESSAGE_CENTER_LINK_CLASS,this.oHeader)[0];var b=this;dj.util.User.isSubLoggedIn(function(c){if(c)b.setupMessageCenter();else{b.setUpMJLinksForReg();dojo.style(b.oMessageCenterLink,{display:"none"})}});this.oSubscriberDetails=dojo.byId(this.cfg.SUBSCRIBER_DETAILS_ELEMENT_ID);dojo.removeClass(this.oSubscriberDetails,"hidden")},setUpMJLinksForReg:function(){this.oFooter=dojo.query(this.cfg.FOOTER_CONTAINER_CLASS)[0];var b=this.cfg.MOJ_LINK_URL,
c=this.cfg.MOJ_LINK_CLASS;this.oMojLinkHeader=dojo.query(c,this.oHeader)[0];this.oMojLinkFooter=dojo.query(c,this.oFooter)[0];if(typeof gcDomain!=="undefined"&&gcDomain&&gcDomain!==""){this.oMojLinkHeader.href="http://"+gcDomain+b;this.oMojLinkFooter.href="http://"+gcDomain+b}else{this.oMojLinkHeader.href=b;this.oMojLinkFooter.href=b}},setupSubscriberLinks:function(){this.oTodaysPaperLink=dojo.query(this.cfg.TODAYS_PAPER_LINK_CLASS,this.oHeader)[0];var b=this.cfg.LOGGED_IN_TODAYS_PAPER_URL,c=this;
dj.util.User.isSubLoggedIn(function(d){if(d)c.oTodaysPaperLink.href=typeof gcDomain!=="undefined"&&gcDomain&&gcDomain!==""?"http://"+gcDomain+b:b})},setupMessageCenter:function(){this.oMessageCenterLink=dojo.query(this.cfg.MESSAGE_CENTER_LINK_CLASS,this.oHeader)[0];this.oMessageCount=dojo.query(this.cfg.MESSAGE_COUNT_CLASS,this.oHeader)[0];var b=this,c=function(e){if(e=="-1")dojo.style(b.oMessageCenterLink,{display:"none"});else b.oMessageCount.innerHTML=e},d=dj.util.Cookie.getCookie("msgCount");
d===null?dojo.xhrPost({url:this.cfg.MESSAGE_CENTER_POST_URL,handleAs:"json",handle:function(e){d=e.MessagesCount;e=e.Status;dj.util.Cookie.setCookie("msgCount",d,5/24/60);dj.util.Cookie.setCookie("userStatus",e,5/24/60);c(d)},error:function(e,g){console.error("Exception occured while posting posting Ajax Request: %s",g)}}):c(d)},setupLogin:function(){this.oUserName=dojo.byId(this.cfg.LOGIN_USERNAME_ELEMENT_ID);this.oPassword=dojo.byId(this.cfg.LOGIN_PASSWORD_ELEMENT_ID);this.oLoginImg=dojo.byId(this.cfg.LOGIN_BUTTON_ELEMENT_ID);
this.oLoginForm=dojo.byId(this.cfg.LOGIN_FORM_ID);this.oLoginForm!=null&&this.oLoginForm.reset();this.oPageUrl=dojo.byId(this.cfg.PAGE_URL_ELEMENT_ID);var b=this;if(this.oPageUrl){var c=this.cfg.NONSUBSCRIBER_HOMEPAGE_PID,d=this.cfg.NONSUBSCRIBER_SEARCH_PAGE_PID,e=this.cfg.NONSUBSCRIBER_NEWSLETTERS_ALERTS_PAGE_PID,g=this.cfg.MDC_PAGE_PID,h;h=typeof gcDomain!=="undefined"&&gcDomain&&gcDomain!==""?"http://"+gcDomain:"http://"+document.domain;var k;var i=k=dojo.isIE?window.location.href:document.location.href;
if(typeof pID!=="undefined"){i=pID===c?h+this.cfg.HOMEPAGE_SUBSCRIBER_URL:pID===e?h+"/email":pID===d?h+this.cfg.SEARCH_PAGE_SUBSCRIBER_URL:pID===g?h+this.cfg.MDC_LINK_URL:k;if(dojo.isIE)document.login_form.url.value=i;else this.oPageUrl.value=i}if(this.oUserName){dojo.connect(this.oUserName,"onfocus",this,function(){dj.util.Form.clearValue(this.oUserName,"User Name")});dojo.connect(this.oUserName,"onclick",this,function(){dj.util.Form.clearValue(this.oUserName,"User Name")})}if(this.oPassword){dojo.connect(this.oPassword,
"onfocus",this,function(){dj.util.Form.clearValue(b.oPassword,"Password");this.oPassword.type="password"});dojo.connect(this.oPassword,"onclick",this,function(){dj.util.Form.clearValue(b.oPassword,"Password")});dojo.connect(this.oPassword,"onchange",this,function(){dj.util.Form.clearValue(b.oPassword,"Password")})}dojo.isIE&&dojo.connect(this.oLoginImg,"onclick",this,function(){document.login_form.url.value=k;console.log("coming in to img onlick in IE"+k);this.oLoginForm.submit()});dojo.connect(this.oPassword,
"onkeypress",this,function(f){f=f.keyCode||f.which;if(dojo.isIE)if(f==dojo.keys.ENTER){document.login_form.url.value=k;this.oLoginForm.submit()}})}},setupLogout:function(){(this.oLogout=dojo.byId(this.cfg.LOGOUT_LINK_ELEMENT_ID))&&dojo.connect(this.oLogout,"onclick",this,function(b){dojo.stopEvent(b);dj.util.Cookie.deleteCookie("msgCount");dj.util.Cookie.deleteCookie("HOMEPAGE",true);document.cookie="HOMEPAGE=;path=/;domain=.wsj.com;expires=Thu, 01-Jan-1970 00:00:01 GMT";if(typeof dj.module.facebook.connect.logout==
"function"&&FB.getAuthResponse())dj.module.facebook.connect.logout(function(){window.location=typeof gcDomain!=="undefined"&&gcDomain&&gcDomain!==""?"/logout?url=http://"+gcDomain:"/logout"});else{console.info("Facebook API is not available when executing Logout");window.location=typeof gcDomain!=="undefined"&&gcDomain&&gcDomain!==""?"/logout?url=http://"+gcDomain:"/logout"}})},highlightFormFactorLinks:function(){this.oTodaysPaperLinkContainer=dojo.query(this.cfg.TODAYS_PAPER_LINK_CONTAINER_CLASS,
this.oHeader)[0];this.oVideoLinkContainer=dojo.query(this.cfg.VIDEO_LINK_CONTAINER_CLASS,this.oHeader)[0];this.oBlogsLinkContainer=dojo.query(this.cfg.BLOGS_LINK_CONTAINER_CLASS,this.oHeader)[0];this.oColumnsLinkContainer=dojo.query(this.cfg.COLUMNS_LINK_CONTAINER_CLASS,this.oHeader)[0];this.oInteractiveGraphicsLinkContainer=dojo.query(this.cfg.INTERACTIVE_GRAPHICS_LINK_CONTAINER_CLASS,this.oHeader)[0];this.oTopicsLinkContainer=dojo.query(this.cfg.TOPICS_LINK_CONTAINER_CLASS,this.oHeader)[0];this.oCommunityForumsLinkContainer=
dojo.query(this.cfg.COMMUNITY_FORUMS_LINK_CONTAINER_CLASS,this.oHeader)[0];var b=this.cfg.TODAYS_PAPER_PID,c=this.cfg.TODAYS_PAPER_US_NONSUB_PID,d=this.cfg.TODAYS_PAPER_EUROPE_NONSUB_PID,e=this.cfg.TODAYS_PAPER_ASIA_NONSUB_PID,g=this.cfg.TODAYS_PAPER_US_PID,h=this.cfg.TODAYS_PAPER_EUROPE_PID,k=this.cfg.TODAYS_PAPER_ASIA_PID,i=this.cfg.TODAYS_PAPER_PAST_EDITIONS_PID,f=this.cfg.TODAYS_PAPER_INDEX_BIZ_PID,l=this.cfg.TODAYS_PAPER_INDEX_PEOPLE_PID,o=this.cfg.TODAYS_PAPER_CORRECTIONS_PID,n=this.cfg.VIDEO_PID,
m=this.cfg.INTERACTIVE_GRAPHICS_PID,p=this.cfg.TOPICS_PID,q=this.cfg.COLUMNS_PID,r=this.cfg.BLOGS_PID,s=document.location.host+this.cfg.COMMUNITY_HIGHLIGHT_COMPARE_URL,t=this.cfg.FORUMS_HIGHLIGHT_COMPARE_URL;if(typeof pID!=="undefined")if(pID.indexOf(b)==0||pID===c||pID===d||pID===e||pID===g||pID===h||pID===k||pID===i||pID===f||pID===l||pID===o)dojo.addClass(this.oTodaysPaperLinkContainer,"selected");else if(pID===n)dojo.addClass(this.oVideoLinkContainer,"selected");else if(pID===m)dojo.addClass(this.oInteractiveGraphicsLinkContainer,
"selected");else if(pID===q)dojo.addClass(this.oColumnsLinkContainer,"selected");else if(pID===r)dojo.addClass(this.oBlogsLinkContainer,"selected");else pID===p&&dojo.addClass(this.oTopicsLinkContainer,"selected");if(document.location.href&&document.location.href!==""&&document.location.href.indexOf(s)!==-1||document.location.href.indexOf(t)!==-1)dojo.addClass(this.oCommunityForumsLinkContainer,"selected")}}}();
dojo.provide("dj.module.header.globalHeader");dojo.require("dj.lang");dojo.require("dj.util.Config");dojo.require("dj.util.Cookie");dojo.require("dj.util.Date");dojo.require("dj.util.Region");dojo.require("dj.util.Element");dojo.require("dj.util.User");
dj.module.header.globalHeader=function(){var a={HEADER_CONTAINER_CLASS:".header",CURRENT_SUBSECTION_DISPLAY_CLASS:".currentSubSection",GLOBALNAV_SUBSECTION_ELEMENT_ID:"currentGlobalNavSubSection",MOJ_LINK_URL:"/page/my-journal-main.html",MDC_LINK_URL:"/mdc/page/marketsdata.html",MDC_PAGE_PID:"2_3000",COMMUNITY_HIGHLIGHT_COMPARE_URL:"/community",FORUMS_HIGHLIGHT_COMPARE_URL:"forums.wsj.com",LOCATION_NAV_CLASS:".location_nav",LOCATION_NAV_COLLAPSED_CLASSNAME:"location_collapsed",LOCATION_NAV_EXPANDED_CLASSNAME:"location_expanded",
US_EDITION_LINK_CLASS:".map_us",EU_EDITION_LINK_CLASS:".map_europe",ASIA_EDITION_LINK_CLASS:".map_asia",IN_EDITION_LINK_CLASS:".map_india",US_EDITION_MDC_URL:"/marketsdata",EU_EDITION_MDC_URL:"/mdc/public/page/marketsdata_europe.html",ASIA_EDITION_MDC_URL:"/mdc/public/page/marketsdata_asia.html",IN_EDITION_MDC_URL:"/mdc/public/page/marketsdata_asia.html",MDC_COMPARE_URL:"/mdc/",FOOTER_CONTAINER_CLASS:".pagefooter"};return{initialize:function(b){this.cfg=dj.lang.cloneMixin(a,b);this.oHeader=dojo.query(".header")[0];
this.editionDropdownSetUp();this.currRegion=dj.util.Region.getViewByRegion();this.oLocToggle=dojo.byId("loc_toggle")},toggleDropdownClass:function(){var b=this.cfg.LOCATION_NAV_COLLAPSED_CLASSNAME,c=this.cfg.LOCATION_NAV_EXPANDED_CLASSNAME;this.oLocToggle=dojo.byId("loc_toggle");if(dojo.hasClass(this.oLocToggle,b)){dojo.removeClass(this.oLocToggle,b);dojo.addClass(this.oLocToggle,c)}else if(dojo.hasClass(this.oLocToggle,c)){dojo.removeClass(this.oLocToggle,c);dojo.addClass(this.oLocToggle,b)}},editionDropdownSetUp:function(){this.oLocationNav=
dojo.byId("locNavContainer");var b=this.cfg.LOCATION_NAV_COLLAPSED_CLASSNAME,c=this.cfg.LOCATION_NAV_EXPANDED_CLASSNAME,d=this.cfg.US_EDITION_LINK_CLASS,e=this.cfg.EU_EDITION_LINK_CLASS,g=this.cfg.IN_EDITION_LINK_CLASS,h=this.cfg.ASIA_EDITION_LINK_CLASS;this.usEditionMDCUrl=this.cfg.US_EDITION_MDC_URL;this.euEditionMDCUrl=this.cfg.EU_EDITION_MDC_URL;this.inEditionMDCUrl=this.cfg.IN_EDITION_MDC_URL;this.asiaEditionMDCUrl=this.cfg.ASIA_EDITION_MDC_URL;var k=this.cfg.MDC_COMPARE_URL;this.oCurrentEdition=
dojo.byId("currentEdition");this.oUsEdition=dojo.byId("usEdition");this.oEuEdition=dojo.byId("europeEdition");this.oInEdition=dojo.byId("indiaEdition");this.oAsiaEdition=dojo.byId("asiaEdition");this.oChiEdition=dojo.byId("chiEdition");this.oGerEdition=dojo.byId("gerEdition");this.oJpnEdition=dojo.byId("jpnEdition");this.oSpaEdition=dojo.byId("spaEdition");this.oPorEdition=dojo.byId("porEdition");this.oIndonesiaEdition=dojo.byId("indonesiaEdition");this.oKoreaEdition=dojo.byId("koreaEdition");this.osectionFooterSub=
dojo.byId("hrefNonSubId");this.osectionFooterNonSub=dojo.byId("hrefSubId");this.oUsEditionFooter=dojo.byId("usEditionFooter");this.currRegion=dj.util.Region.getViewByRegion();this.tempConcatURL=typeof gcDomain!=="undefined"&&gcDomain&&gcDomain!==""?"http://"+gcDomain:"http://"+document.domain;this.isMDCPageFlag=document.location.href&&document.location.href!==""&&document.location.href.indexOf(k)!==-1;this.oUsEdition&&dojo.connect(this.oUsEdition,"onclick",this,function(f){dojo.stopEvent(f);dj.util.Region.setViewByRegion("na,us");
dj.util.Cookie.setGroupCookie("DJCOOKIE","HOMEPAGE","/home-page",365);window.location=this.isMDCPageFlag?this.tempConcatURL+this.usEditionMDCUrl:this.oUsEdition.href});this.oUsEditionFooter&&dojo.connect(this.oUsEditionFooter,"onclick",this,function(f){dojo.stopEvent(f);dj.util.Region.setViewByRegion("na,us");dj.util.Cookie.setGroupCookie("DJCOOKIE","HOMEPAGE","/home/us",365);window.location=this.isMDCPageFlag?this.tempConcatURL+this.usEditionMDCUrl:this.oUsEditionFooter.href});this.oEuEdition&&dojo.connect(this.oEuEdition,
"onclick",this,function(f){dojo.stopEvent(f);window.location=this.isMDCPageFlag?this.tempConcatURL+this.euEditionMDCUrl:this.oEuEdition.href;if(this.isMDCPageFlag){dj.util.Region.setViewByRegion("europe");dj.util.Cookie.setGroupCookie("DJCOOKIE","HOMEPAGE","/home/europe",365)}});this.oInEdition&&dojo.connect(this.oInEdition,"onclick",this,function(f){dojo.stopEvent(f);window.location=this.isMDCPageFlag?this.tempConcatURL+this.inEditionMDCUrl:this.oInEdition.href;if(this.isMDCPageFlag){dj.util.Region.setViewByRegion("asia,india");
dj.util.Cookie.setGroupCookie("DJCOOKIE","HOMEPAGE","/home/india",365)}});this.oAsiaEdition&&dojo.connect(this.oAsiaEdition,"onclick",this,function(f){dojo.stopEvent(f);window.location=this.isMDCPageFlag?this.tempConcatURL+this.asiaEditionMDCUrl:this.oAsiaEdition.href;if(this.isMDCPageFlag){dj.util.Region.setViewByRegion("asia");dj.util.Cookie.setGroupCookie("DJCOOKIE","HOMEPAGE","/home/asia",365)}});this.oChiEdition&&dojo.connect(this.oChiEdition,"onclick",this,function(f){dojo.stopEvent(f);window.open(this.oChiEdition.href)});
this.oGerEdition&&dojo.connect(this.oGerEdition,"onclick",this,function(f){dojo.stopEvent(f);window.open(this.oGerEdition.href)});this.oJpnEdition&&dojo.connect(this.oJpnEdition,"onclick",this,function(f){dojo.stopEvent(f);window.open(this.oJpnEdition.href)});this.oSpaEdition&&dojo.connect(this.oSpaEdition,"onclick",this,function(f){dojo.stopEvent(f);window.location=this.oSpaEdition.href});this.oPorEdition&&dojo.connect(this.oPorEdition,"onclick",this,function(f){dojo.stopEvent(f);window.location=
this.oPorEdition.href});this.oIndonesiaEdition&&dojo.connect(this.oIndonesiaEdition,"onclick",this,function(f){dojo.stopEvent(f);window.location=this.oIndonesiaEdition.href});this.oKoreaEdition&&dojo.connect(this.oKoreaEdition,"onclick",this,function(f){dojo.stopEvent(f);window.location=this.oKoreaEdition.href});this.osectionFooterSub&&dojo.connect(this.osectionFooterSub,"onclick",this,function(f){dojo.stopEvent(f);window.location=this.osectionFooterSub.href});this.osectionFooterNonSub&&dojo.connect(this.osectionFooterNonSub,
"onclick",this,function(f){dojo.stopEvent(f);window.location=this.osectionFooterNonSub.href});this.oSelectedEdition=this.currRegion=="asia"?dojo.query(h,this.oHeader)[0]:this.currRegion=="asia,india"?dojo.query(g,this.oHeader)[0]:this.currRegion=="europe"?dojo.query(e,this.oHeader)[0]:dojo.query(d,this.oHeader)[0];dojo.addClass(this.oSelectedEdition,"selected");this.oFormFactorContainer=dojo.byId("formFactorContainer");this.oLocDropDownContainer=dojo.byId("locNavContainer");this.oLocPopupContainer=
dojo.byId("popupContainer");if(this.oLocDropDownContainer){var i=function(){this.oLocToggle=dojo.byId("loc_toggle");if(dojo.hasClass(this.oLocToggle,b)){dojo.removeClass(this.oLocToggle,b);dojo.addClass(this.oLocToggle,c)}else if(dojo.hasClass(this.oLocToggle,c)){dojo.removeClass(this.oLocToggle,c);dojo.addClass(this.oLocToggle,b)}};dojo.connect(this.oLocationNav,"onclick",this,function(f){dojo.stopEvent(f);i()});dojo.connect(document,"onclick",this,function(f){if(dj.util.Element.contains(this.oLocPopupContainer,
f.clientX,f.clientY)==false)if(dojo.hasClass(this.oLocToggle,c)){dojo.removeClass(this.oLocToggle,c);dojo.addClass(this.oLocToggle,b)}});this.oSectionFooterNonSub=dojo.byId("sectionFooterNonSub");this.oSectionFooterSub=dojo.byId("sectionFooterSub");dj.util.User.isLoggedIn(function(){})}}}}();
dojo.provide("dj.module.header.login");dojo.require("dj.lang");dojo.require("dj.util.Config");dojo.require("dj.util.Cookie");dojo.require("dj.util.Date");dojo.require("dj.util.Region");dojo.require("dj.util.Element");dojo.require("dj.util.User");dojo.require("dj.module.facebook.connect");
dj.module.header.login=function(){var a={HEADER_CONTAINER_CLASS:".header",TIMESTAMP_CLASS:".date",WSJ_LOGO_ID:"wsjLogo",WSJ_LARGE_LOGO_CLASSNAME:"logo_large",WSJ_SMALL_LOGO_CLASSNAME:"logo_small",CURRENT_SUBSECTION_DISPLAY_CLASS:".currentSubSection",GLOBALNAV_SUBSECTION_ELEMENT_ID:"currentGlobalNavSubSection",SUBSCRIBER_LOGIN_CLASS:".login",HEADER_PROMO_CLASS:".promo",SUBSCRIBER_DETAILS_ELEMENT_ID:"subscribedUserDetailsId",COMMUNITY_FORUMS_LINK_CLASS:".communityForumsLink",TODAYS_PAPER_LINK_CLASS:".todaysPaperLink",
MOJ_LINK_CLASS:".myOnlineJournalLink",MESSAGE_CENTER_LINK_CLASS:".messageCenterLink",MESSAGE_COUNT_CLASS:".messageCount",LOGIN_USERNAME_ELEMENT_ID:"login_username",LOGIN_PASSWORD_ELEMENT_ID:"login_password",LOGIN_FORM_ID:"login_form",PAGE_URL_ELEMENT_ID:"page_url",LOGOUT_LINK_ELEMENT_ID:"logoutLink",LOGIN_BUTTON_ELEMENT_ID:"login_button",USER_NAME_ELEMENT_ID:"userName",WSJ_LOGO_FADE_APPEAR_DURATION:"1.0",WSJ_LOGO_DELAY_DURATION:"2000",LOGGED_IN_COMMUNITY_URL:"/community",LOGGED_IN_TODAYS_PAPER_URL:"/itp?mod=WSJ_formfactor",
LOGGED_IN_TODAYS_PAPER_URL_ASIA:"/itp/asia?mod=WSJ_formfactor",LOGGED_IN_TODAYS_PAPER_URL_EUROPE:"/itp/europe?mod=WSJ_formfactor",MESSAGE_CENTER_POST_URL:"/community/integration/userinfo.html",LOGOUT_URL:"/static_html_files/logout_confirmation.htm",SUBSCRIBER_HOMEPAGE_PID:"0_0_WH_0001",NONSUBSCRIBER_HOMEPAGE_PID:"0_0_WH_0001_public",ASIA_PAGE_PID:"0_0_WP_2103",EUROPE_PAGE_PID:"0_0_WP_2104",NONSUBSCRIBER_NEWSLETTERS_ALERTS_PAGE_PID:"5_6007",NONSUBSCRIBER_SEARCH_PAGE_PID:"3_0466",HOMEPAGE_SUBSCRIBER_URL:"/",
SEARCH_PAGE_SUBSCRIBER_URL:"/search",TODAYS_PAPER_LINK_CONTAINER_CLASS:".todaysPaperLinkContainer",VIDEO_LINK_CONTAINER_CLASS:".videoLinkContainer",COLUMNS_LINK_CONTAINER_CLASS:".columnsLinkContainer",BLOGS_LINK_CONTAINER_CLASS:".blogsLinkContainer",INTERACTIVE_GRAPHICS_LINK_CONTAINER_CLASS:".interactiveGraphicsLinkContainer",TOPICS_LINK_CONTAINER_CLASS:".topicsLinkContainer",COMMUNITY_FORUMS_LINK_CONTAINER_CLASS:".communityForumsLinkContainer",TODAYS_PAPER_PID:"0_0_WP_40",TODAYS_PAPER_US_NONSUB_PID:"2_0433",
TODAYS_PAPER_EUROPE_NONSUB_PID:"2_0434",TODAYS_PAPER_ASIA_NONSUB_PID:"2_0435",TODAYS_PAPER_US_PID:"2_0133",TODAYS_PAPER_EUROPE_PID:"2_0134",TODAYS_PAPER_ASIA_PID:"2_0135",TODAYS_PAPER_PAST_EDITIONS_PID:"2_0233",TODAYS_PAPER_INDEX_BIZ_PID:"2_0156",TODAYS_PAPER_INDEX_PEOPLE_PID:"2_0155",TODAYS_PAPER_CORRECTIONS_PID:"Corrections",VIDEO_PID:"0_0_WP_3000",BLOGS_PID:"8_0019",COLUMNS_PID:"2_0140",INTERACTIVE_GRAPHICS_PID:"0_0_WP_2003",TOPICS_PID:"0_0_WT_0001",NEWSLETTERS_ALERTS_SUB_PID:"5_6001",NEWSLETTERS_ALERTS_PUB_PID:"5_6003",
MOJ_LINK_URL:"/page/my-journal-main.html",MDC_LINK_URL:"/mdc/page/marketsdata.html",MDC_PAGE_PID:"2_3000",COMMUNITY_HIGHLIGHT_COMPARE_URL:"/community",FORUMS_HIGHLIGHT_COMPARE_URL:"forums.wsj.com",FREE_REG_CLASS:".freereg",LOCATION_NAV_CLASS:".location_nav",LOCATION_NAV_COLLAPSED_CLASSNAME:"location_collapsed",LOCATION_NAV_EXPANDED_CLASSNAME:"location_expanded",US_EDITION_LINK_CLASS:".map_us",EU_EDITION_LINK_CLASS:".map_europe",ASIA_EDITION_LINK_CLASS:".map_asia",IN_EDITION_LINK_CLASS:".map_india",
US_EDITION_MDC_URL:"/mdc/public/page/marketsdata.html",EU_EDITION_MDC_URL:"/mdc/public/page/marketsdata_europe.html",ASIA_EDITION_MDC_URL:"/mdc/public/page/marketsdata_asia.html",IN_EDITION_MDC_URL:"/mdc/public/page/marketsdata_asia.html",MDC_COMPARE_URL:"/mdc/",FOOTER_CONTAINER_CLASS:".pagefooter",GO_PRO_HOOK:"goprohook",GO_PRO_HOOK_REGION:["all"]};return{initialize:function(b){this.cfg=dj.lang.cloneMixin(a,b);this.oHeader=dojo.query(this.cfg.HEADER_CONTAINER_CLASS)[0];this.currRegion=dj.util.Region.getViewByRegion();
this.concatURL="";this.subscriberLoginInit();this.displayGoPro();this.concatURL=typeof gcDomain!=="undefined"&&gcDomain!==null&&gcDomain!==""?"http://"+gcDomain:"http://"+document.domain},subscriberLoginInit:function(){var b=this;dj.util.User.isLoggedIn(function(c){if(c){b.displaySubscriberDetails();b.setupLogout()}else{b.setupLogin();b.oSubscriberLogin=dojo.query(b.cfg.SUBSCRIBER_LOGIN_CLASS,b.oHeader)[0];c=dojo.query(".login_module",b.oSubscriberLogin)[0];dojo.style(c,{display:"block"});dojo.style(b.oSubscriberLogin,
{display:"block"});b.oHeaderPromo=dojo.query(b.cfg.HEADER_PROMO_CLASS,b.oHeader)[0];dojo.style(b.oHeaderPromo,{display:"block"})}})},displayGoPro:function(){var b=this;dj.util.User.isSubLoggedIn(function(c){if(c){var d=-1;dojo.forEach(b.cfg.GO_PRO_HOOK_REGION,function(e,g){if(e===b.currRegion)d=g});if(b.cfg.GO_PRO_HOOK_REGION[0]==="all"||d!==-1)dojo.byId(b.cfg.GO_PRO_HOOK)&&dojo.removeClass(b.cfg.GO_PRO_HOOK,"hidden")}})},displaySubscriberDetails:function(){dj.util.User.renderCallsign(this.cfg.USER_NAME_ELEMENT_ID);
this.oMessageCenterLink=dojo.query(this.cfg.MESSAGE_CENTER_LINK_CLASS,this.oHeader)[0];var b=this;dj.util.User.isSubLoggedIn(function(c){if(c)b.setupMessageCenter();else{b.setUpMJLinksForReg();b.oMessageCenterLink&&dojo.style(b.oMessageCenterLink,{display:"none"})}});this.oSubscriberDetails=dojo.byId(this.cfg.SUBSCRIBER_DETAILS_ELEMENT_ID);dojo.removeClass(this.oSubscriberDetails,"hidden")},setUpMJLinksForReg:function(){this.oFooter=dojo.query(this.cfg.FOOTER_CONTAINER_CLASS)[0];var b=this.cfg.MOJ_LINK_URL,
c=this.cfg.MOJ_LINK_CLASS;this.oMojLinkHeader=dojo.query(c,this.oHeader)[0];this.oMojLinkFooter=dojo.query(c,this.oFooter)[0];if(typeof gcDomain!=="undefined"&&gcDomain!==null&&gcDomain!==""){if(this.oMojLinkHeader)this.oMojLinkHeader.href="http://"+gcDomain+b;if(this.oMojLinkFooter)this.oMojLinkFooter.href="http://"+gcDomain+b}else{if(this.oMojLinkHeader)this.oMojLinkHeader.href=b;if(this.oMojLinkFooter)this.oMojLinkFooter.href=b}},setupSubscriberLinks:function(){this.oTodaysPaperLink=dojo.query(this.cfg.TODAYS_PAPER_LINK_CLASS,
this.oHeader)[0];var b=this.cfg.LOGGED_IN_TODAYS_PAPER_URL,c=this;dj.util.User.isSubLoggedIn(function(d){if(d)c.oTodaysPaperLink.href=typeof gcDomain!=="undefined"&&gcDomain!==null&&gcDomain!==""?"http://"+gcDomain+b:b})},setupMessageCenter:function(){this.oMessageCenterLink=dojo.query(this.cfg.MESSAGE_CENTER_LINK_CLASS,this.oHeader)[0];this.oMessageCount=dojo.query(this.cfg.MESSAGE_COUNT_CLASS,this.oHeader)[0];var b=this,c=function(e){if(e=="-1")dojo.style(b.oMessageCenterLink,{display:"none"});
else b.oMessageCount.innerHTML=e},d=dj.util.Cookie.getCookie("msgCount");d===null?dojo.xhrPost({url:this.cfg.MESSAGE_CENTER_POST_URL,handleAs:"json",handle:function(e){d=e.MessagesCount;e=e.Status;dj.util.Cookie.setCookie("msgCount",d,5/24/60);dj.util.Cookie.setCookie("userStatus",e,5/24/60);c(d)},error:function(e,g){console.error("Exception occured while posting posting Ajax Request: %s",g)}}):c(d)},setupLogin:function(){this.oUserName=dojo.byId(this.cfg.LOGIN_USERNAME_ELEMENT_ID);this.oPassword=
dojo.byId(this.cfg.LOGIN_PASSWORD_ELEMENT_ID);this.oLoginImg=dojo.byId(this.cfg.LOGIN_BUTTON_ELEMENT_ID);this.oLoginForm=dojo.byId(this.cfg.LOGIN_FORM_ID);this.oLoginForm!=null&&this.oLoginForm.reset();this.oPageUrl=dojo.byId(this.cfg.PAGE_URL_ELEMENT_ID);var b=this;if(this.oPageUrl!==null){var c=this.cfg.NONSUBSCRIBER_HOMEPAGE_PID,d=this.cfg.NONSUBSCRIBER_SEARCH_PAGE_PID,e=this.cfg.NONSUBSCRIBER_NEWSLETTERS_ALERTS_PAGE_PID,g=this.cfg.MDC_PAGE_PID,h;h=typeof gcDomain!=="undefined"&&gcDomain!==null&&
gcDomain!==""?"http://"+gcDomain:"http://"+document.domain;var k;var i=k=dojo.isIE?window.location.href:document.location.href;if(typeof pID!=="undefined"){i=pID===c?h+this.cfg.HOMEPAGE_SUBSCRIBER_URL:pID===e?h+"/email":pID===d?h+this.cfg.SEARCH_PAGE_SUBSCRIBER_URL:pID===g?h+this.cfg.MDC_LINK_URL:k;c=i.indexOf("?")!=-1?"&":"?";if(typeof c!==undefined){c=c+"_nocache="+(new Date).getTime();if(i.indexOf("#")!=-1)i=i.replace("#",c+"#");else i+=c}if(dojo.isIE)document.login_form.url.value=i;else this.oPageUrl.value=
i}if(this.oUserName!==null){dojo.connect(this.oUserName,"onfocus",this,function(){dj.util.Form.clearValue(this.oUserName,"User Name")});dojo.connect(this.oUserName,"onclick",this,function(){dj.util.Form.clearValue(this.oUserName,"User Name")})}if(this.oPassword!==null){dojo.connect(this.oPassword,"onfocus",this,function(){dj.util.Form.clearValue(b.oPassword,"Password");this.oPassword.type="password"});dojo.connect(this.oPassword,"onclick",this,function(){dj.util.Form.clearValue(b.oPassword,"Password")});
dojo.connect(this.oPassword,"onchange",this,function(){dj.util.Form.clearValue(b.oPassword,"Password")})}dojo.isIE&&dojo.connect(this.oLoginImg,"onclick",this,function(){document.login_form.url.value=k;console.log("coming in to img onlick in IE"+k);this.oLoginForm.submit()});dojo.connect(this.oPassword,"onkeypress",this,function(f){f=f.keyCode||f.which;if(dojo.isIE)if(f==dojo.keys.ENTER){document.login_form.url.value=k;this.oLoginForm.submit()}})}},setupLogout:function(){this.oLogout=dojo.byId(this.cfg.LOGOUT_LINK_ELEMENT_ID);
this.oLogout!==null&&dojo.connect(this.oLogout,"onclick",this,function(b){dojo.stopEvent(b);dj.util.Cookie.deleteCookie("msgCount");dj.util.Cookie.deleteCookie("HOMEPAGE",true);document.cookie="HOMEPAGE=;path=/;domain=.wsj.com;expires=Thu, 01-Jan-1970 00:00:01 GMT";if(typeof dj.module.facebook.connect.logout=="function"&&FB.getAuthResponse())dj.module.facebook.connect.logout(function(){window.location=typeof gcDomain!=="undefined"&&gcDomain!==null&&gcDomain!==""?"/logout?url=http://"+gcDomain:"/logout"});
else{console.info("Facebook API is not available when executing Logout");window.location=typeof gcDomain!=="undefined"&&gcDomain!==null&&gcDomain!==""?"/logout?url=http://"+gcDomain:"/logout"}})}}}();

dojo.provide("dj.module.iPadAppPromoLoader");dj.module.iPadAppPromoLoader={init:function(iPadScrimType,uri){if(this._isIpad()){var d=dojo;d.require("djscript.require.dj_module_iPadAppPromo.version.4");if(uri!==null&&uri.length===0){if(iPadScrimType=='holiday2011'){uri="http://wsj.com/holiday";}else if(iPadScrimType=='scrimNewYears12'){uri="https://buy.wsj.com/shopandbuy/order/subscribe.jsp?trackCode=aapui6jq";}else if(iPadScrimType=='iPadAppPromo2012'){uri="https://buy.wsj.com/shopandbuy/order/subscribe.jsp?trackCode=aapui6jq";}else{uri="https://buy.wsj.com/shopandbuy/order/subscribe.jsp?trackCode=aapui6jq";}}
d.addOnLoad(function(){if(iPadScrimType=='holiday2011'){dj.module.iPadAppPromoHoliday.init(uri);}else if(iPadScrimType=='scrimNewYears12'){dj.module.iPadAppPromoNewYears12.init(uri);}else if(iPadScrimType=='iPadAppPromo2012'){dj.module.iPadAppPromo2012.init(uri);}else{dj.module.iPadAppPromo.init(uri);}});}else if(this._isKindleFire()){d=dojo;d.require("djscript.require.dj_module_kindleFireAppPromo.version.70");d.addOnLoad(function(){dj.module.kindleFireAppPromo.init();});}else{return;}},_isIpad:function(){return(navigator.userAgent.match(/iPad/i)!==null);},_isKindleFire:function(){return(navigator.userAgent.match(/Kindle Fire/i)!==null);}};dojo.provide("dj.module.iPadAppPromo");dojo.require("dj.util.User");dojo.require("dj.util.Cookie");dojo.require("dijit.Dialog");dj.module.iPadAppPromo={_cookieName:"dj_module_iPadAppPromo",_appStoreUri:"https://buy.wsj.com/shopandbuy/order/subscribe.jsp?trackCode=aapui6jq",init:function(uri){var that=this;that._appStoreUri=uri;dj.util.User.isSubLoggedIn(function(loggedIn){if(!loggedIn){if(!that.hasSeenPromo()){that.showPromoDialog();that.setPromoAsSeen();}else{that.renderIpadPromoMini();}}});},hasSeenPromo:function(){return(dj.util.Cookie.getCookie(this._cookieName)!==null);},setPromoAsSeen:function(){dj.util.Cookie.setCookie(this._cookieName,"true",0);},showPromoDialog:function(){this._initPromoDialog();this._connectToButtons();this.dialog.show();},hideDialog:function(){this.dialog.hide();},renderIpadPromoMini:function(){var cnt=dojo.create("div",{"class":"nonHTMLBox"}),inner=dojo.create("div",{"class":"nonHTMLInnerBox"},cnt),anchor=dojo.create("a",{href:this._appStoreUri},inner);dojo.create("img",{src:dj.context.core.cdnPrefix+"/adimg/iPad_promo.jpg"},anchor);dojo.place(cnt,"carouselSection","before");},_initPromoDialog:function(){dojo.addClass(dojo.body(),"djDijit");try{dojo.byId("hat_div").style["z-index"]=900;}catch(e){}
var cnt=dojo.create("div",{"class":"iPadAppPromo"});dojo.create("a",{"class":"scrimCloseBtn",href:"#",innerHTML:"Close"},cnt);dojo.create("a",{"class":"goPromoBtn",href:this._appStoreUri},cnt);this.dialog=new dijit.Dialog({"class":"dijit_ipad",content:cnt,draggable:true,showTitle:false});},_connectToButtons:function(){dojo.connect(this.dialog,"onShow",this,function(){dojo.query(".scrimCloseBtn").connect("onclick",this,function(event){dojo.stopEvent(event);this._handleButtonNo();});});},_redirectToAppStore:function(){document.location=this._appStoreUri;},_handleButtonNo:function(){this.hideDialog();this.renderIpadPromoMini();}};dojo.provide("dj.module.iPadAppPromo2012");dojo.require("dj.util.User");dojo.require("dj.util.Cookie");dojo.require("dijit.Dialog");dj.module.iPadAppPromo2012={_cookieName:"dj_module_iPadAppPromo2012",_appStoreUri:"https://buy.wsj.com/shopandbuy/order/subscribe.jsp?trackCode=aapui6jq",init:function(uri){var that=this;that._appStoreUri=uri;dj.util.User.isSubLoggedIn(function(loggedIn){if(!loggedIn){if(!that.hasSeenPromo()){that.showPromoDialog();that.setPromoAsSeen();}else{that.renderIpadPromoMini();}}});},hasSeenPromo:function(){return(dj.util.Cookie.getCookie(this._cookieName)!==null);},setPromoAsSeen:function(){dj.util.Cookie.setCookie(this._cookieName,"true",0);},showPromoDialog:function(){this._initPromoDialog();this._connectToButtons();this.dialog.show();},hideDialog:function(){this.dialog.hide();},renderIpadPromoMini:function(){var cnt=dojo.create("div",{"class":"nonHTMLBox"}),inner=dojo.create("div",{"class":"nonHTMLInnerBox"},cnt),anchor=dojo.create("a",{href:this._appStoreUri},inner);dojo.create("img",{src:dj.context.core.cdnPrefix+"/adimg/iPad_promo.jpg"},anchor);dojo.place(cnt,"carouselSection","before");},_initPromoDialog:function(){dojo.addClass(dojo.body(),"djDijit");try{dojo.byId("hat_div").style["z-index"]=900;}catch(e){}
var cnt=dojo.create("div",{"class":"scrimWSJ_module scrimWSJNewCirc"});var innerDiv=dojo.create("div",{"class":"headerStrap"},cnt);dojo.create("a",{"class":"closeBtn",href:"#",innerHTML:"Close Button"},innerDiv);dojo.create("a",{"class":"scrimWSJNewCircBtn",href:this._appStoreUri,innerHTML:"Download Free App"},cnt);this.dialog=new dijit.Dialog({"class":"dijit_ipad",content:cnt,draggable:true,showTitle:false});},_connectToButtons:function(){dojo.connect(this.dialog,"onShow",this,function(){dojo.query(".closeBtn").connect("onclick",this,function(event){dojo.stopEvent(event);this._handleButtonNo();});});},_redirectToAppStore:function(){document.location=this._appStoreUri;},_handleButtonNo:function(){this.hideDialog();this.renderIpadPromoMini();}};dojo.provide("dj.module.iPadAppPromoHoliday");dojo.require("dj.util.User");dojo.require("dj.util.Cookie");dojo.require("dijit.Dialog");dj.module.iPadAppPromoHoliday={_cookieName:"dj_module_iPadAppPromoHoliday",_appStoreUri:"http://wsj.com/holiday",init:function(uri){var that=this;that._appStoreUri=uri;dj.util.User.isSubLoggedIn(function(loggedIn){if(!loggedIn){if(!that.hasSeenPromo()){that.showPromoDialog();that.setPromoAsSeen();}else{that.renderIpadPromoMini();}}});},hasSeenPromo:function(){return(dj.util.Cookie.getCookie(this._cookieName)!==null);},setPromoAsSeen:function(){dj.util.Cookie.setCookie(this._cookieName,"true",0);},showPromoDialog:function(){this._initPromoDialog();this._connectToButtons();this.dialog.show();},hideDialog:function(){this.dialog.hide();},renderIpadPromoMini:function(){var cnt=dojo.create("div",{"class":"nonHTMLBox"}),inner=dojo.create("div",{"class":"nonHTMLInnerBox"},cnt),anchor=dojo.create("a",{href:this._appStoreUri},inner);dojo.create("img",{src:dj.context.core.cdnPrefix+"/adimg/iPad_promo.jpg"},anchor);dojo.place(cnt,"carouselSection","before");},_initPromoDialog:function(){dojo.addClass(dojo.body(),"djDijit");try{dojo.byId("hat_div").style["z-index"]=900;}catch(e){}
var cnt=dojo.create("div",{"class":"scrimWSJ_module scrimHolidays11"});var innerDiv=dojo.create("div",{"class":"headerStrap"},cnt);dojo.create("a",{"class":"closeBtn",href:"#",innerHTML:"Close Button"},innerDiv);dojo.create("a",{"class":"scrimHolidays11Btn",href:this._appStoreUri},cnt);this.dialog=new dijit.Dialog({"class":"dijit_ipad",content:cnt,draggable:true,showTitle:false});},_connectToButtons:function(){dojo.connect(this.dialog,"onShow",this,function(){dojo.query(".closeBtn").connect("onclick",this,function(event){dojo.stopEvent(event);this._handleButtonNo();});});},_redirectToAppStore:function(){document.location=this._appStoreUri;},_handleButtonNo:function(){this.hideDialog();this.renderIpadPromoMini();}};dojo.provide("dj.module.iPadAppPromoNewYears12");dojo.require("dj.util.User");dojo.require("dj.util.Cookie");dojo.require("dijit.Dialog");dj.module.iPadAppPromoNewYears12={_cookieName:"dj_module_iPadAppPromoNewYears12",_appStoreUri:"https://buy.wsj.com/shopandbuy/order/subscribe.jsp?trackCode=aapui6jq",init:function(uri){var that=this;that._appStoreUri=uri;dj.util.User.isSubLoggedIn(function(loggedIn){if(!loggedIn){if(!that.hasSeenPromo()){that.showPromoDialog();that.setPromoAsSeen();}else{that.renderIpadPromoMini();}}});},hasSeenPromo:function(){return(dj.util.Cookie.getCookie(this._cookieName)!==null);},setPromoAsSeen:function(){dj.util.Cookie.setCookie(this._cookieName,"true",0);},showPromoDialog:function(){this._initPromoDialog();this._connectToButtons();this.dialog.show();},hideDialog:function(){this.dialog.hide();},renderIpadPromoMini:function(){var cnt=dojo.create("div",{"class":"nonHTMLBox"}),inner=dojo.create("div",{"class":"nonHTMLInnerBox"},cnt),anchor=dojo.create("a",{href:this._appStoreUri},inner);dojo.create("img",{src:dj.context.core.cdnPrefix+"/adimg/iPad_promo.jpg"},anchor);dojo.place(cnt,"carouselSection","before");},_initPromoDialog:function(){dojo.addClass(dojo.body(),"djDijit");try{dojo.byId("hat_div").style["z-index"]=900;}catch(e){}
var cnt=dojo.create("div",{"class":"scrimWSJ_module scrimNewYears12"});var innerDiv=dojo.create("div",{"class":"headerStrap"},cnt);dojo.create("a",{"class":"closeBtn",href:"#",innerHTML:"Close"},innerDiv);dojo.create("a",{"class":"scrimNewYears12Btn",href:this._appStoreUri},cnt);this.dialog=new dijit.Dialog({"class":"dijit_ipad",content:cnt,draggable:true,showTitle:false});},_connectToButtons:function(){dojo.connect(this.dialog,"onShow",this,function(){dojo.query(".closeBtn").connect("onclick",this,function(event){dojo.stopEvent(event);this._handleButtonNo();});});},_redirectToAppStore:function(){document.location=this._appStoreUri;},_handleButtonNo:function(){this.hideDialog();this.renderIpadPromoMini();}};dojo.provide("djscript.require.dj_module_iPadAppPromo.version.4");dojo.require("dj.module.iPadAppPromo");dojo.require("dj.module.iPadAppPromoHoliday");dojo.require("dj.module.iPadAppPromoNewYears12");dojo.require("dj.module.iPadAppPromo2012");
dojo.provide("dj.util.doubleclick");dj.util.doubleclick={createTrackingPixel:function(userConf){var conf={container:"",source:"",type:"",category:"",url:"",trackingType:"iframe"};dojo.mixin(conf,userConf);var axel=Math.random()+"";var a=axel*10000000000000;if(conf.container===""){console.error("{dj.util.doubleclick} - container cannot be null or empty");}
try{if(conf.trackingType=="iframe"){dojo.create("iframe",{src:conf.url+";src="+conf.source+";type="+conf.type+";cat="+conf.category+";ord="+a+"?",width:"1",height:"1",frameborder:"0"},conf.container);}
else{dojo.create("img",{src:conf.url+";src="+conf.source+";type="+conf.type+";cat="+conf.category+";ord="+a+"?",width:"1",height:"1",border:"0",alt:""},conf.container);}}catch(e){console.error("{dj.util.doubleclick} - Could not create pixel");console.log(e);}}};dojo.provide("dj.widget.livenews.view.baseLiveUpdateView");

dojo.declare("dj.widget.livenews.view.baseLiveUpdateView", null, {
	actions : {NONE:0,INSERT:1,UPDATE:2,DELETE:3},
	containerObject : null,
	DEFAULT_CONFIG : {
		updateCount : 10,
		imagePrefix : 'http://si.wsj.net/public/resources/images/',
		multiArray : null,
		chartPrefix : 'http://si.wsj.net/public/resources/images/',
		chartMultiArray : null,
		wrapperImgClass : 'newsImage newsImage-A'
	},

	constructor: function(args){
	    dojo.safeMixin(this, args);
	},

  	render : function(response) {
		console.error("{baseLiveUpdateView:render} - This is an abstract class, please define implementation");
	},

	CleanBad : function(string) {
	   for (var i=0, output='', valid="eE-0123456789."; i<string.length; i++)
	   if (valid.indexOf(string.charAt(i)) != -1)
		   output += string.charAt(i)
	   return output;
	},

	getTime : function(time) {
	   var that = this;
	   var sAve = 0;
	   var ez1 = "";
	   var ml3 = "00";
	   var pw3 = parseFloat(that.CleanBad(time));
	   var pm4 = that.CleanBad(time);
	   var pm5 = that.CleanBad(time);
	   var len = pm4.length;
	   if (len != 4) {
		   return time;
	   }
	   else if (pw3>2401) {
		   return time;
	   }
	   else if (pw3>1259) {
		   pw3 = pw3 - 1200;

		   var pm4 = String(pw3);

		   var len = pm4.length;
		   if (len < 4) {
			   pm4 = "0"+ pm4;
		   }

		   if (pm4.substring(0, 1) == "0") {
			   var hours = pm4.substring(1, 2);
		   }
		   else {
			   	var hours = pm4.substring(0, 2);
		   }
		   var mins = pm4.substring(2, 4);
		   ez1 = " P.M.";
		   if (hours == "12") ez1 = " A.M.";
		   if (mins > "59") mins = "???";
		   return hours + ":" + mins + ez1;
	   }
	   else {
		   if (pm4.substring(0, 1) == "0") {
			   var hours = pm4.substring(1, 2);
		   }
		   else {
			   var hours = pm4.substring(0, 2);
		   }
		   var mins = pm4.substring(2, 4);
		   ez1 = " A.M.";
		   if (hours == "12") {
			   ez1 = " P.M.";
		   }
		   if (pm5.substring(0, 2) == "00") {
			   hours = "12";
		   }
		   if (mins > "59")
			   mins = "???";

		   return hours + ":" + mins + ez1;
	   }
	  }

});
dojo.provide("dj.util.dateUtility");
dojo.require("dj.util.Element");
dojo.require("dojo.date");
dojo.require("dojo.date.locale");

dj.util.dateUtility = {
		 scan : function() {
		    var du = dj.util.dateUtility;
		    du.calculateDate();
		    setTimeout(dj.util.dateUtility.scan, 60000, null);
		  },

		  scanWithinContainer : function(container) {
		    this.calculateDate(container);
		  },

		  calculateDate : function(container) {
			var du = dj.util.dateUtility;
		    var browserDate = new Date();

		    var query = "[data-widget='dj.nwtimestamp']";
		    var queryString = (typeof container === 'undefined' || container == null) ? query : container + " " + query;
		    dojo.query(queryString).forEach(function(object, index) {
		      var ts = dj.util.Element.getData(object, "major-ts");
		      if( ts != null && typeof ts != "undefined") {
		    	  var outputDate = du.getTimeDifference(ts);
		          object.innerHTML = outputDate;
		      }
		    });
		},		
		
   /**
   * 
   * @var timestamp_second_utc in seconds
   */
  getTimeDifference: function (timestamp_millisecond_utc){
	    var du = dj.util.dateUtility;
	    var then = new Date(parseInt(timestamp_millisecond_utc) );
	    var now = new Date(); 
	    
	    var then_stamp = timestamp_millisecond_utc; //then.getTime() - then.getTimezoneOffset() * 60 * 1000;
	    
	    var now_stamp = now.getTime();
	    
	    var sec_diff = Math.ceil( (now_stamp - then_stamp) /1000 ) - 1;
	    return du.getSecondDifference( sec_diff, then );
    
  },  
    
  
  getSecondDifference: function ( sec_diff, date ) {  
    
    if ( typeof date == 'undefined' ){
    
    date = new Date();
        
    }
  
    if (date.getDate() == new Date().getDate() && date.getMonth() == new Date().getMonth() && date.getFullYear() == new Date().getFullYear()){ // LESS THAN 1 DAY
      
      var formattedTime = dojo.date.locale.format(date, {timePattern: "h:mm a", selector: "time"});
      //dojo.date.locale.format(new Date(1342800000000), {timePattern: "K:mma", selector: "time"})
      
      /*if(formattedTime.indexOf("AM") > -1){
        formattedTime = formattedTime.replace("AM","a");
      }else if(formattedTime.indexOf("PM") > -1){
        formattedTime = formattedTime.replace("PM","p");
      }*/
      return formattedTime;
      
    } else if (date.getDate() < new Date().getDate() || date.getMonth() < new Date().getMonth() || date.getFullYear() < new Date().getFullYear()){ 
      
      var formattedDate =  dojo.date.locale.format( date, {selector:"date", datePattern: 'M/d' } );

      return formattedDate;
    }
    
  },
  
//dojo.date.locale.format(new Date(1342622580000), {timePattern: "K:ma", selector: "time"});
  //dojo.date.locale.format( new Date(1141322520000), {selector:"date", datePattern: 'M/yy' } );
    
  getSecondDifferenceOld: function( sec_diff, date ) { 
	  var du = dj.util.dateUtility;
    if ( typeof date == 'undefined' ){
    
      date = new Date();
		    
    }
  
    if (sec_diff < 60){ // LESS THAN 60 SECONDS
      
      return du.getTimeDifferenceStr( 0, 'min');
      
    } else if (sec_diff < 3600){ // LESS THAN 1 HOUR
      
      return du.getTimeDifferenceStr( Math.floor( sec_diff / 60 ), 'm');
      
    } else if (sec_diff < 86400){ // LESS THAN 1 DAY
      
      return du.getTimeDifferenceStr( Math.floor( sec_diff / 60 / 60 ) + 1, 'h');
      
    } else if (sec_diff < 259200){ // LESS THAN 3 DAYS
      
      return du.getTimeDifferenceStr( Math.floor( sec_diff / 60 / 60 / 24 ) + 1, 'd');
      
    } else{ // MORE THAN 3 DAYS
     
       var formattedDate = dojo.date.locale.format(date, {
    	   selector : "date",
    	   datePattern : "MMM d"
       });
       //formattedDate = this.getOrdialDate(formattedDate);
       return formattedDate;
    }   
    
  },
  
  getOrdialDate:function(formattedDate){
	  var num = formattedDate;
	  num = num.substring(3);
	  try{
		  num = parseInt(num);
	  }catch(e){
		  console.log("date could not be converted to int " + e);
	  }
  	var s='th';
  	if(num===1 || num==21 || num==31) s='st';
  	if(num===2 || num==22) s='nd';
  	if(num===3 || num==23) s='rd';
  	return formattedDate+s;
  },
  
  getTimeDifferenceStr: function (number, unit){
    var str;
    
    switch(number){
    case 0: 
    	return 'now';
    case 1:
      str = number + unit;
      break;
    default:  
      str = number + unit;
    }
    return str; 
  },

  getInMiliseconds: function(timestamp){
    return timestamp * 1000;
  },
  
  parseInteger: function (num){
    num = parseInt(num, 10);
    return (isNaN(num) ? 0 : num);
  }
  
};
dojo.provide("dj.widget.newsviewer.view.slimNewsViewerView");
dojo.require("dj.widget.livenews.view.baseLiveUpdateView");
dojo.require("dj.util.Element");
dojo.require("dj.util.dateUtility");
dojo.require("dj.util.User");

var fit = 0; //headline fade-in time
var fot = 0; //blue background fade-out time

dojo.declare("dj.widget.newsviewer.view.slimNewsViewerView", dj.widget.livenews.view.baseLiveUpdateView,
        {

          constructor : function(cfg) {
            this.cfg = cfg;
        	   this.numOfRecordsToLoad = cfg.NUM_OF_HEADLINES_TO_LOAD;
        	   this.sectionName = cfg.sectionName;
        	   fit = cfg.fadeInTime;
        	   fot = cfg.fadeOutTime;
        	   this.containerDiv = dojo.byId(this.cfg.CONTAINER_DIV_ID);
          },

          render : function(response, loadType) {
            

            if(typeof response != "undefined" && response != null){
                this.region = dj.util.Region.getViewByRegion();
                if(typeof loadType != "undefined" && loadType != null){
                   if(loadType == "initialLoad"){
                       this.respLength = response.length;
                       
                       for(var index=0;index<this.respLength;index++){
                          this.dataObj = response[index];
                          if(this.containerDiv.children.length < this.numOfRecordsToLoad){
                            var nextHeadline = "";
                            if(this.respLength > (index + 1) ){
                              nextHeadline = response[index + 1];
                            }
                            if(this.isHeadlineGoodToLoad(loadType, nextHeadline)){
                              this.populateData(loadType);
                            }
                              
                          }
                       }
                   }
                }else{
                  this.dataObj = response;
                  if(this.isHeadlineGoodToLoad(loadType)){
                    this.populateData();  
                  }
                  if(this.containerDiv.children.length > this.numOfRecordsToLoad){
                    this.deleteExtraRecord();
                    //FADE transition code - START
					var existingRows = dojo.query('.newest');
					existingRows.forEach(function(obj){
					  var divId = obj.getAttribute('id');
					  if(divId!=null && divId.length>0){
						//Headline FADE-IN
						dojo.style(divId, "opacity", "0");
						var fadeArgs = {node: divId, duration: fit};
						dojo.fadeIn(fadeArgs).play();
						//Blue background FADE-OUT
						window.setTimeout(function () {
						  dojo.addClass(obj,'newfade');
						}, fot);
					  }					  
					});
					//FADE transition code - ENDS
                  }
                }
            }
          },
          
          
          populateData : function(loadType){
            var that = this;
            dojo.forEach(this.cfg.channelJSON, function(channelInfo) {
              if(channelInfo.channelName == that.dataObj.h.t ){
                that.createHeadlineHTML(loadType);
              }
            })
            
            
          },
          
          isHeadlineGoodToLoad:function(loadType, nextResp){
            var bTS = this.getTimestampFromFeed(this.dataObj);
            var cTS = "";
            if(typeof nextResp != "undefined" && nextResp != ""){
              var cTS = this.getTimestampFromFeed(nextResp);  
            }
            
            var position = "first";
            if(typeof loadType != "undefined" && loadType == "initialLoad"){
               position = "last";
               if(this.containerDiv.children.length > 0){
                 var lastDiv = this.containerDiv.children[this.containerDiv.children.length - 1];
                 var aTS = this.getHeadlineTS(lastDiv);
                 if(cTS){
                    if(bTS > aTS && aTS > cTS){
                      console.log("******************* skipped from initial load ");
                      this.putInfoInLogsForSkippedArticle();
                      return false;
                    }else if(bTS > aTS && aTS < cTS){
                      console.log("******************* deleting from initial load ");
                     // this.putInfoInLogsForSkippedArticle();
                      dojo.destroy(lastDiv.id);
                      return true;
                    }else if(bTS < cTS && aTS > cTS){
                      console.log("******************* deleting from initial load ");
                      this.putInfoInLogsForSkippedArticle();
                      return true;
                    }
                 }else if(aTS < bTS){
                   console.log("******************* skipped from initial load ");
                   this.putInfoInLogsForSkippedArticle();
                   return false;
                 }
                 return true;
                 
               }
               
            }else{
              if(this.containerDiv.children.length > 0){
                var firstDiv = this.containerDiv.children[0];
                var firstDivTS = this.getHeadlineTS(firstDiv);
                if(firstDivTS > bTS){
                  console.log("******************* skipped from live update ");
                  this.putInfoInLogsForSkippedArticle();
                  return false;
                }
                this.destroyDuplicateHeadline();
              }
              return true;
              
            }
            return true;
          },
          
          createHeadlineHTML:function(loadType){            
              var position = "first";
              if(typeof loadType != "undefined" && loadType == "initialLoad"){
                 position = "last";
              }
              var currentTS = this.getTimestampFromFeed(this.dataObj);
              var headlineNum = this.getHeadlineNum();
              
              var className = "pmn_newsalert pmn_newsalertType-latest newest"; 
              var isArticlePaid = this.isArticlePaid();
              
              if(isArticlePaid){
                  className = "pmn_newsalert pmn_newsalertType-latest subscriber newest"; 
              }
              
              var existingRows = dojo.query('.newest');
              existingRows.forEach(function(obj){
            	  var exClass = obj.getAttribute('class');
            	  if(exClass != null && typeof exClass != "undefined" 
            		  && exClass.indexOf('pmn_newsalertType-latest') > 0){ 
            		  dojo.removeClass(obj, "newest"); //remove just from Latest Headlines
					  dojo.removeClass(obj, "newfade");					  
            	  }
              });
              
              var div1 = dojo.create("div", {"id":"slimNV_" + headlineNum, "data-messagenum":this.dataObj.h.n,"class":className}, this.containerDiv, position);
              var div2 = dojo.create("div", {"class":"newsalert_single"}, div1, "last");
              var hEle = dojo.create("h3", {"id":"slimNVTimeEle","data-slim-nv-major-ts":currentTS}, div2, "last");
              hEle.innerHTML = dj.util.dateUtility.getTimeDifference(currentTS);
              var div3 = dojo.create("div", {"class":"newsalert_content"}, div2, "last");
              var ulEle = dojo.create("ul", {}, div3, "first");
              var liEle = dojo.create("li", {"class":"listFirst"}, ulEle, "last");
              var url = this.dataObj.b.tpu + "?mod=WSJ_latestheadlines";
              if(this.sectionName!= null && (this.sectionName).length>0){
                  url = this.dataObj.b.tpu + "?mod=WSJ_" + this.sectionName + "_LatestHeadlines";
              }
              var aEle = dojo.create("a", {"href":url}, liEle, "last");
              //adding the logic to trim the Latest Headline text to 73/75 chars only 
              var headlineTxt = this.dataObj.b.h;
              if(headlineTxt != null){
            	  var headlineLen = headlineTxt.length;
            	  var maxLength = 72;
            	  if(isArticlePaid){
            		  maxLength = 70;
            	  }
            	  if(headlineLen > maxLength){
            		  var headlineTxtSub = headlineTxt.substring(0,maxLength);
	          	  	  var headlineTxtSub2 = headlineTxt.substring(maxLength);
	          	  	  if (headlineTxtSub2.indexOf(" ") == 0){
	          	  		  headlineTxt = headlineTxtSub + "...";
	          	  	  } else{
	          	  		  var spaceIdx = headlineTxtSub.lastIndexOf(" ");
	          	  		  headlineTxt = headlineTxtSub.substring(0,spaceIdx) + "...";
	          		  }
            	  }
              }
              aEle.innerHTML = headlineTxt;
              if(isArticlePaid){
                this.createSubKeyToolTip(div1);
              }
              
          },
          
          isArticlePaid:function(){
              var isArticlePaid = true;
              
              this.userLoggedIn = false;
              var that = this;
              dj.util.User.isSubLoggedIn( function(loggedIn) {
                if (loggedIn) {
                  that.userLoggedIn = true;
                }
               })
              
              
              if(!this.userLoggedIn){
            	  var availability = this.dataObj.b.av;
                  var regionEdition = this.region.toUpperCase();
            	  //Examples of free article values in "av" are - FREE, FREEASIA, FREEEUROPE, FREEINDIA
                  if(availability != null && typeof availability != "undefined"){
                	  availability = availability.toUpperCase();
                	  if(availability.indexOf("FREE") > -1){
                		  if(availability.indexOf("FREEINDIA") == -1
	                			  && availability.indexOf("FREEASIA") == -1
	                			  && availability.indexOf("FREEEUROPE") == -1){
	                		  isArticlePaid = false; //free for all editions
	                	  } else if(regionEdition.indexOf("INDIA") > -1 
	                			  && availability.indexOf("FREEINDIA") > -1){
	                		  isArticlePaid = false;
	                	  } else if(regionEdition == "ASIA" && availability.indexOf("FREEASIA") > -1){
	                		  isArticlePaid = false;
	                	  } else if(regionEdition.indexOf("EUROPE") > -1 
	                			  && availability.indexOf("FREEEUROPE") > -1){
	                		  isArticlePaid = false;
	                	  }  
                	  }
                  }
              } else{
                isArticlePaid = false;
              }
              return isArticlePaid;
          },
          
          getTimestampFromFeed:function(response){
            var articleTimestamp = response.b.z;
            if (typeof articleTimestamp !== "undefined" && articleTimestamp !== null) {
                articleTimestamp = articleTimestamp.substring(articleTimestamp.indexOf("(") + 1,articleTimestamp.length - 2);
                articleTimestamp = parseInt(articleTimestamp);
            }
            return articleTimestamp;
            
          },
          
          getHeadlineNum:function(){
            var headlineNum = this.dataObj.b.ei;
            headlineNum = headlineNum.substring(0, headlineNum.indexOf("."));
            return headlineNum;
            
          },
          
          deleteExtraRecord:function(){
            if(this.containerDiv.children.length > 0 ){
              var lastDiv = this.containerDiv.children[this.containerDiv.children.length - 1];
              dojo.destroy(lastDiv);
           }
          },
          
          
          getHeadlineTS:function(divEle){
            var timeDiv = dojo.query("#slimNVTimeEle",divEle)[0];
            var ts = parseInt(dj.util.Element.getData(timeDiv, "slim-nv-major-ts"));
            return ts;
          },
          
          putInfoInLogsForSkippedArticle:function(){
            console.log("Headline:- " + this.dataObj.b.h);
            console.log("SBNum:- " + this.dataObj.b.ei);
            var articleTimestamp = this.dataObj.b.z;
            if (typeof articleTimestamp !== "undefined" && articleTimestamp !== null) {
              articleTimestamp = articleTimestamp.substring(articleTimestamp.indexOf("(") + 1,articleTimestamp.length - 2);
                console.log("Date:- " + new Date(parseInt(articleTimestamp)));
            }
            console.log("MessageNum:- " + this.dataObj.h.n);
          },
          
          destroyDuplicateHeadline:function(){
            var headlineNum = this.getHeadlineNum();
            this.duplicateRecord = dojo.byId("slimNV_" +  headlineNum);
            if (null !== this.duplicateRecord && typeof this.duplicateRecord !== 'undefined') {
                dojo.destroy("slimNV_" + headlineNum);
            }
          },
          
          createSubKeyToolTip:function(divEle){              
              
              divToolBoxEle = dojo.create("div", {"class":"tooltipBox"}, divEle,"last");
              divToolTipEle = dojo.create("div", {"class":"tooltip"}, divToolBoxEle,"last");
              tipPEle = dojo.create("p", {}, divToolTipEle,"last");
              tipSmallEle = dojo.create("small", {}, tipPEle,"last");
              tipSmallEle.innerHTML = "Subscriber Content ";
              tipEMEle = dojo.create("em", {}, tipPEle,"last");
              tipEMEle.innerHTML = "Read Preview";
              
          }
					
        });

dojo.provide("dj.module.newsviewer.slimNewsViewer");

dojo.require("dj.widget.newsviewer.view.slimNewsViewerView");
dojo.require("dj.service.livenews.BluegrassProvider");
dojo.require("dj.util.Element");
dojo.require("dj.util.dateUtility");

dj.module.newsviewer.slimNewsViewer = {
		
    
    
  DEFAULT_CONFIG:{
    NUM_OF_HEADLINES_TO_LOAD:3,
    CONTAINER_DIV_ID:"slimNewsViewerHeadlines",
    lazyLoadHeadlines:false,
    fadeInTime: 2000, 
	fadeOutTime: 5000, 
	initialLoadTimeClass:".initialLoadTimeClass"
     
    
    
  },  

	init: function (config){
	  this._cfg = dojo.mixin(this.DEFAULT_CONFIG,config);
	  
	  if(this._cfg.NUM_OF_HEADLINES_TO_LOAD == 0){
	    var latestHeadlinesBanner = dojo.byId("latestHeadlinesBanner");
	    if(latestHeadlinesBanner != null){
	      dojo.addClass(latestHeadlinesBanner,"hidden");
	    }
	    return;
	  }
	  
	  
	  this.subscribedList = [];
	  
		this.calledFlag = false;
		
		this.channelJSON = this._cfg.channelJSON;
					
	
		if(!this.bluegrassProvider){
		  this.bluegrassProvider = new dj.service.livenews.BluegrassProvider();
		}		
		
		
		this.slimNewsViewerView = new dj.widget.newsviewer.view.slimNewsViewerView(this._cfg);

   
    if(this._cfg.lazyLoadHeadlines){
      this.populateData("initialLoad");  
    }else{  
      try{
        this.updateTimeOnLoadedHeadlines();
      }catch(e){console.log("initial time update failed " + e);}
      this.linkChannels();
      
    }  
    
	},

	
	updateTimeOnLoadedHeadlines:function(){
	  var containerDiv = dojo.byId(this._cfg.CONTAINER_DIV_ID);
	  var timeDivArr = dojo.query(this._cfg.initialLoadTimeClass,containerDiv);
	  dojo.forEach(timeDivArr, function(timeDiv) {
	     var ts = parseInt(dj.util.Element.getData(timeDiv, "nv-initial-ts"));
       if(ts && ts > 0){
  	     var formattedTime = dj.util.dateUtility.getTimeDifference(ts);
  	     if(formattedTime != ""){
  	       timeDiv.innerHTML  = formattedTime;
  	     }
       }
	       
	     
	  })
	  
	},
	
	bluegrassSubscribeChannel: function(channels, viewComp){
		try{
			var that = this;
			var dynamicChannels = [];
			var channelView = null;

			channelView = viewComp;

			dojo.forEach(channels, function(fChannel) {
				if(dojo.indexOf(that.subscribedList, fChannel)  === -1) {
					dynamicChannels.push({
				          channelName : fChannel,
				          view : channelView
			        });
					that.subscribedList.push(fChannel);
				}
			});

			try{
			if(dynamicChannels.length > 0) {
				dj.context.marketdata.bluegrassProvider.dynamicSubscribeChannel(dynamicChannels, channelView, channels);
			}
			}catch(e){
				console.log("Error while making blueegrass connection " + e);
			}

		}catch(e){
			console.log("Error: " + e);

		}
	},

	linkChannels:function(){
	  
	    //this.calledFlag = true;
	    var that = this;
	    dojo.forEach(this.channelJSON, function(channelInfo) {
	     // that.channels = [channelInfo.channelName];
	      //that.bluegrassSubscribeChannel(that.channels, that.slimNewsViewerView);
	      that.bluegrassProvider.subscribeToChannel(channelInfo.channelName, that.slimNewsViewerView);
	    })
	    try{
        this.bluegrassProvider.connect();
      }catch(e){
          try{
            this.bluegrassProvider.connect();
          }catch(e1){
            this.blueGrassConnectionFailed = true;
            console.err("connection to blueGrass provider failed" + e1);
          }
        
      }
    
	},
	
	populateData: function(loadType){
		
		var that = this;
		this.loadType = loadType;
		
		dojo.forEach(this.channelJSON, function(channelInfo) {
		var feedUrl = channelInfo.configFeedURL;
		that.channels = [channelInfo.channelName];
		
		
			dojo.xhrGet({
				 url: feedUrl,
				 handleAs: "json",
				 preventCache: true,
			   load: function(data, xhr){
			     console.log("load ");
  					that.slimNewsViewerView.render(data,that.loadType );
  					
  					if(that.calledFlag == false){
  						that.calledFlag = true;
  						that.bluegrassSubscribeChannel(that.channels, that.slimNewsViewerView);
  					}					
		     },
	     	 error: function(error, ioArgs) {
	     	  console.log("error " + error);
		     		if(that.calledFlag == false){
		     			that.calledFlag = true;
		     			that.bluegrassSubscribeChannel(that.channels, that.slimNewsViewerView);
		     		}
         }

			});
		})
	

	}
	
		        
};

dojo.provide("dj.module.subscribeBar");dojo.require("dj.util.User");dojo.require("dj.lang");dj.module.subscribeBar={init:function(userConfiguration){dojo.mixin(this.getConfiguration(),userConfiguration);this.subbarContainerObject=this.subbarContainerObject||dojo.byId(this.configuration.barId);this.subBarCloseObject=this.subBarCloseObject||dojo.byId(this.configuration.subBarCloseId);this.subBarToggleObject=this.subBarToggleObject||dojo.byId(this.configuration.subBarToggleId);if(this.shouldDisplay()){if(this.configuration.isMboxSession){this.addMboxSession();}
this.showBar();this.saveNewDisplayCount();this.addUiEvent();var me=this;if(this.configuration.autoClose){setTimeout(function(){me.closeBarWithAnimation();},me.configuration.autoCloseTime+me.configuration.animationDuration);}}},getConfiguration:function(){if(!this.configuration){this.configuration={userTypes:[],barId:"subscribeNowSmallBar",subBarCloseId:"subscribeNowMediumClose",subBarToggleId:"subscribeNowMediumToggle",subBarLinkClass:".js_subscribeNowMediumShopAndBuyLink",animationDuration:1200,useAnimation:true,animateClose:true,barOpenBottom:0,barCloseBottom:-32,barCloseSize:34,isMboxSession:false,closedStateClass:"state-closed",openStateClass:"state-open",sessionDisplayCount:1,cookieName:"subscribeNowSmallBarCookie",autoClose:false,autoCloseTime:8000};}
return this.configuration;},addUiEvent:function(){var me=this;if(this.subBarCloseObject){dojo.connect(this.subBarCloseObject,"click",null,function(ev){dojo.stopEvent(ev);me.closeBar();});}
if(this.subBarToggleObject){dojo.connect(this.subBarToggleObject,"click",null,function(ev){dojo.stopEvent(ev);me.toggleState();});}},addMbox:function(){console.log(this);if('undefined'!==typeof USER_TYPE){if(this.configuration.isArticlePage){mboxCreate(this.configuration.mboxLocation,"subscriberType="+USER_TYPE,"siteSection="+ARTICLE_SECTION,"articlePubDate="+PUB_DATE,"freeArticle="+FREE_ARTICLE,"articleType="+AT_VARS.articleType);}
else{mboxCreate(this.configuration.mboxLocation,"subscriberType="+USER_TYPE);}}
else{console.log("USER_TYPE is not defined, mbox for this location cannot be created:"+this.configuration.mboxLocation);}},addMboxSession:function(){var anchorNodes=dojo.query('a#'+this.configuration.subBarLinkClass);var sessionId=mboxFactoryDefault.getSessionId().getId();console.log("anchor nodes");console.log(anchorNodes);dojo.forEach(anchorNodes,function(anchorNode){var currentLink=dojo.attr(anchorNode,"href");if(currentLink){var parameterSeparator="?";if(currentLink.indexOf("?")>=0){parameterSeparator="&";}
var newLink=dojo.attr(anchorNode,"href")+parameterSeparator+"mboxSession="+sessionId;console.log(newLink);dojo.attr(anchorNode,"href",newLink);}});},showBar:function(){if(this.configuration.useAnimation){this.showBarWithAnimation();}
else{this.subbarContainerObject.style.bottom=this.configuration.barOpenBottom+'px';}},showBarWithAnimation:function(){this.setPreOpenState();var me=this;dojo.animateProperty({node:me.subbarContainerObject,duration:me.configuration.animationDuration,properties:{bottom:{end:0}}}).play();},closeBar:function(){if(this.configuration.useAnimation){this.closeBarWithAnimation();}
else{this.setClosedState();}},closeBarWithAnimation:function(){var me=this;dojo.animateProperty({node:me.subbarContainerObject,duration:me.configuration.animationDuration,properties:{bottom:{end:me.configuration.barCloseBottom+me.configuration.barCloseSize}}}).play();setTimeout(function(){me.setClosedState();},me.configuration.animationDuration);},setClosedState:function(){if(this.subbarContainerObject.style.bottom==((this.configuration.barCloseBottom+this.configuration.barCloseSize)+'px')){this.subbarContainerObject.style.bottom=this.configuration.barOpenBottom+'px';dojo.removeClass(this.subbarContainerObject,this.configuration.openStateClass);dojo.addClass(this.subbarContainerObject,this.configuration.closedStateClass);}
else{var me=this;setTimeout(function(){me.setClosedState();},10);}},setPreOpenState:function(){console.log(this.subbarContainerObject.style.bottom);if(this.subbarContainerObject.style.bottom!=(this.configuration.barCloseBottom+'px')){this.subbarContainerObject.style.bottom=(this.configuration.barCloseBottom+this.configuration.barCloseSize)+'px';}
dojo.removeClass(this.subbarContainerObject,this.configuration.closedStateClass);dojo.addClass(this.subbarContainerObject,this.configuration.openStateClass);},toggleState:function(){if(dojo.hasClass(this.subbarContainerObject,this.configuration.openStateClass)){this.closeBar();}
else{this.showBar();}},mboxInit:function(userConfiguration){dojo.mixin(this.getConfiguration(),userConfiguration);if(this.shouldDisplay()){if('function'!==typeof mboxCreate){console.log("loading mbox js");var d=dojo;d.require("dj.util.mbox");}
this.addMbox();}},shouldDisplay:function(){var displayBar=false;var displayForUser=false;var subscriptionTypeArray=dj.util.User.getSubscriptionType().results;console.log("Display for user types:"+this.configuration.userTypes.toString());console.log("User Subscription type:"+subscriptionTypeArray.toString());if(this.configuration.userTypes.length>0){for(var i=0;i<subscriptionTypeArray.length&&!displayForUser;i++){var subscriptionType=subscriptionTypeArray[i];if(subscriptionType){displayForUser=(dojo.indexOf(this.configuration.userTypes,subscriptionType.toUpperCase())>=0);}}}
else{displayForUser=true;}
displayBar=(displayForUser&&this.getNewDisplayCount()<=this.configuration.sessionDisplayCount);console.log("Display Bar:");console.log(displayBar);return displayBar;},saveNewDisplayCount:function(){document.cookie=this.configuration.cookieName+"="+this.getNewDisplayCount();},getNewDisplayCount:function(){if(!this.newDisplayCount){this.newDisplayCount=this.getCookie(this.configuration.cookieName);if(!this.newDisplayCount){this.newDisplayCount=1;}
else{this.newDisplayCount=parseInt(this.newDisplayCount,10)+1;}}
return this.newDisplayCount;},getCookie:function(Name){var search=Name+"=";var returnvalue="";if(document.cookie.length>0){offset=document.cookie.indexOf(search);if(offset!=-1){offset+=search.length;end=document.cookie.indexOf(";",offset);if(end==-1){end=document.cookie.length;}
returnvalue=unescape(document.cookie.substring(offset,end));}}
return returnvalue;}};
dojo.provide("dj.module.mst.preview.decorator");dojo.require("dijit.Menu");dojo.require("dijit.MenuItem");dojo.require("dijit.form.DropDownButton");dojo.require("dijit.form.ToggleButton");dj.module.mst.preview.decorator={override:false,showMasks:true,init:function(){var hn=document.location.hostname;var domain=hn.substring(hn.substring(0,hn.lastIndexOf(".")).lastIndexOf(".")+1,hn.length);if(domain==="dowjones.net"){this.injectCSS("http://ajax.googleapis.com/ajax/libs/dojo/1.6/dijit/themes/tundra/tundra.css");dojo.addClass(dojo.body()," tundra ");if(window.parent!==window.self||this.override){var self=this;dojo.query("div[data-module-id]").forEach(function(node,index,arr){if(dojo.query("div[data-module-id]",node).length===0){dojo.connect(node,"onmouseenter",function(ev){self.placeMask(node);});}});dojo.query(".filteredNode").forEach(function(node,index,arr){dojo.style(node,"border","2px dashed black");dojo.style(node,"height","30px");dojo.style(node,"margin","5px 0px 5px 0px");dojo.style(node,"backgroundColor","#DCDCDC");dojo.style(node,"display","none");node.innerHTML="Name: "+node.getAttribute("data-module-name")+", Rank: "+node.getAttribute("data-module-rank")||"???";});var microPageToggleButton=new dijit.form.ToggleButton({showLabel:true,checked:false,iconClass:"dijitCheckBoxIcon",style:"position:absolute;z-index:2000000;top:5px;left:5px;",onChange:dojo.hitch(this,function(val){this.toggleMicroPageIncludes();}),label:"Show MicroPageIncludes"});var moduleToggleButton=new dijit.form.ToggleButton({showLabel:true,checked:false,iconClass:"dijitCheckBoxIcon",style:"position:absolute;z-index:2000000;top:5px;left:200px;",onChange:dojo.hitch(this,function(val){this.toggleFilteredNodes();}),label:"Show Hidden Modules"});var maskToggleButton=new dijit.form.ToggleButton({showLabel:true,checked:true,iconClass:"dijitCheckBoxIcon",style:"position:absolute;z-index:2000000;top:5px;left:380px;",onChange:dojo.hitch(this,function(val){this.toggleMask();}),label:"Show Module Highlight"});document.body.appendChild(microPageToggleButton.domNode);document.body.appendChild(moduleToggleButton.domNode);document.body.appendChild(maskToggleButton.domNode);}else{var button=new dijit.form.Button({label:"Edit in MST",id:"mstButton",style:"position:absolute;z-index:2000000;top:5px;left:5px;",onClick:function(){document.location.href="/CDSTools/MST/#!"+pID;}});document.body.appendChild(button.domNode);}}},toggleMicroPageIncludes:function(){dojo.query("div[data-module-name=MicroPageInclude]").forEach(function(node,index,arr){dojo.style(node,"border",dojo.style(node,"border")==="2px solid blue"?"0px":"2px solid blue");dojo.style(node,"padding",dojo.style(node,"padding")===2?"0px":"2px");});},toggleFilteredNodes:function(){dojo.query(".filteredNode").forEach(function(node,index,arr){dojo.style(node,"display",dojo.style(node,"display")==="none"?"":"none");});},injectCSS:function(url){var e=document.createElement("link");e.href=url;e.type="text/css";e.rel="stylesheet";e.media="screen";document.getElementsByTagName("head")[0].appendChild(e);},createDrop:function(){this.ele=dojo.create("div",{id:"mask",style:"background-image:url('/static_html_files/mstTool/mask.png');z-index:1000050;position:absolute;"},dojo.body(),"first");var menu=new dijit.Menu({id:"previewMenu",style:"display: none;z-index:1000100"});dojo.connect(menu,"onOpen",menu,function(){this._popupWrapper.style.zIndex="1000100";dojo.style("previewMenu","z-index","1000100");});var menuItem1=new dijit.MenuItem({label:"Edit",id:"previewMaskEdit",maskedElementId:"M565903",onClick:function(){window.parent.dj.util.mst.toolApi.jumpToNode(this.maskedElementId);}});menu.addChild(menuItem1);var menuItem2=new dijit.MenuItem({label:"Copy",onClick:function(){}});var menuItem3=new dijit.MenuItem({label:"Hide/Disable",onClick:function(){}});var button=new dijit.form.DropDownButton({label:"Options",dropDown:menu,id:"optionsButton"});this.ele.appendChild(button.domNode);dojo.create("p",{id:"maskText",style:"color:white;float:right;font-size:1.5em"},this.ele,"last");},placeMask:function(node){if(!this.showMasks){return true;}
var button=dijit.byId("optionsButton");if(!node&&this.ele){if(button){button.closeDropDown();}
dojo.style(this.ele,"display","none");return;}
var targetPos=dojo.position(node,true);if(!this.ele){this.createDrop();dojo.connect(this.ele,"onmouseleave",dojo.hitch(this,function(ev){if(ev.relatedTarget&&(ev.relatedTarget.id.indexOf("Menu")>-1||ev.relatedTarget.id.indexOf("previewMaskEdit")>-1)){return;}else{this.placeMask();}}));}
if(!dojo.hasClass(node,"filteredNode")){dojo.byId("maskText").innerHTML="Name: "+node.getAttribute("data-module-name")+", Rank: "+node.getAttribute("data-module-rank")||"???";}else{dojo.byId("maskText").innerHTML="";}
if(button){button.closeDropDown();}
dijit.byId("previewMaskEdit").maskedElementId="M"+dojo.attr(node,"data-module-id");dojo.style(this.ele,"display","");dojo.style(this.ele,"top",targetPos.y+"px");dojo.style(this.ele,"left",targetPos.x+"px");dojo.style(this.ele,"width",targetPos.w+"px");dojo.style(this.ele,"height",targetPos.h+"px");},toggleMask:function(){this.showMasks=this.showMasks?false:true;}};
dojo.provide("dj.store.Local");dojo.require("dojo.store.Memory");dojo.declare("dj.store.Local",null,{constructor:function(options){dojo.safeMixin(this,(options||{}));if(!localStorage){this.mem=new dojo.store.Memory();}},setItem:function(name,value){if(localStorage){localStorage.setItem(name,value);}else{this.mem.put({id:name,value:value});}},getItem:function(name){if(localStorage){return localStorage.getItem(name);}else{var obj=this.mem.get(name);if(!obj){return null;}
return obj.value;}},removeItem:function(name){if(localStorage){localStorage.removeItem(name);}else{this.mem.remove(name);}}});dojo.provide("dj.store.XDomainLocal");dojo.require("dj.store.Local");dojo.declare("dj.store.XDomainLocal",[dj.store.Local],{constructor:function(options){this.iframePath=(this.iframePath||'/static_html_files/localStorageLoader.html');this.iframes=[];},setItem:function(name,value){this.inherited(arguments);this._updateAll(name,value);},removeItem:function(name){this.inherited(arguments);this._updateAll(name);},_updateAll:function(name,value){if(!window.localStorage){return;}
if(this.iframes.length>0){this._deleteIframes(name);}
this._createIframes(name,value);},_createIframes:function(name,value){var self=this,body=dojo.body(),currHost=dojo.doc.location.host,iframes=this.iframes,path=(this.iframePath+'#name='+encodeURIComponent(name)+'&value='+encodeURIComponent(value));dojo.forEach(this.domains,function(domain){if(domain===currHost){return;}
var iframe=dojo.create('iframe',{src:('//'+domain+path),width:0,height:0,style:{display:'none'}},body);iframes.push({name:name,domNode:iframe});setTimeout(function(){self._deleteIframes(name);},10000);});},_deleteIframes:function(name){var iframes=this.iframes;dojo.forEach(iframes,function(iframe,idx){if(name===iframe.name){dojo.destroy(iframe.domNode);iframes.splice(idx,1);}});}});dojo.provide("dj.store.Preferences");dojo.require("dojo.store.JsonRest");dojo.require("dj.store.Local");dojo.require("dj.store.XDomainLocal");dojo.declare("dj.store.Preferences",null,{cfg:{isOnePerScreen:true,cacheExpire:1},constructor:function(cfg){dojo.mixin(this.cfg,cfg);this.svcPath="/cdssvco/preferences/v1/";this.prefCacheDate="sitewidgets_cache_date";this.screenId='_'+(window.screen.width*window.screen.height);this.localStore=this._getLocalStore();},get:function(prefName,cb){var self=this;if(this.isLocalCacheExpired()){this._getAllPreferences(function(){dojo.hitch(self,self._getItem(prefName,cb));});}else{this._getItem(prefName,cb);}},put:function(prefName,data){if(this.cfg.isOnePerScreen){prefName=prefName+this.screenId;}
var pStore=new dojo.store.JsonRest({target:this.svcPath+"Preferences/"+prefName}),pdata={name:prefName,value:escape(data)};this.localStore.setItem(prefName,data);pStore.put(pdata);},remove:function(prefName){if(this.cfg.isOnePerScreen){prefName=prefName+this.screenId;}
var pStore=new dojo.store.JsonRest({target:this.svcPath+"Preferences/"});this.localStore.removeItem(prefName);pStore.remove(prefName);},_getLocalStore:function(){var store=new dj.store.Local();var prefs=dojo.getObject('dj.context.preferences');if(('object'===typeof prefs)&&dojo.isArray(prefs.storeDomains)){store=new dj.store.XDomainLocal({iframePath:prefs.storeIframePath,domains:prefs.storeDomains});}
return store;},_getAllPreferences:function(cb){var store=new dojo.store.JsonRest({target:this.svcPath}),self=this;store.get("Preferences").then(function(object){if(object&&object.preferences){var i=0;for(i=0;i<object.preferences.length;i=i+1){var item=object.preferences[i];console.debug(item.name);try{var serialized=dojo.toJson(dojo.fromJson(unescape(item.value)));self.localStore.setItem(item.name,serialized);}catch(e){self.localStore.setItem(item.name,unescape(item.value));}}
self.localStore.setItem(self.prefCacheDate,new Date());}
cb();});},_getItem:function(prefName,cb){var def=new dojo.Deferred();if(this.cfg.isOnePerScreen){prefName=prefName+this.screenId;}
var obj=this.localStore.getItem(prefName);cb(obj);},isLocalCacheExpired:function(){var cdate=this.localStore.getItem(this.prefCacheDate);if(cdate===null){return true;}
cdate=new Date(cdate);if((new Date().getTime()-cdate.getTime())/(1000*60*60*24)>this.cfg.cacheExpire){return true;}
return false;}});dojo.provide("dj.module.mdm.mdmTabTicker");

//var bgStarted = true; //to be used in case we want to update the date-time only once, when BG starts
dojo.declare("dj.module.mdm.mdmTabTicker", null, {
  tickerNode: null,
  tickersObject: null,
  bondsArray: [],

  constructor: function(args, tickers, bondsArray) {
	  //console.log("{mdmTabTicker} constructor: "+this.tickerNode);
	  this.tickersObject = args;
	  this.bondsArray = bondsArray;
	  dojo.safeMixin(this, args);
	  this.noPercentChangeMinus =
	    dojo.getObject("tickersObject.configuration.blueGrass.suppressPercentChangeMinus", false, args) || false;
  },
  
  render : function(data, isRangeChg) {
	  this.update(this.tickerNode,data, isRangeChg);
  },
  
  percentageChange : function(changeValue, last) {
    if((last - changeValue)==0){
    	return 0;
    }
	var percentageChange = 0;
    if (changeValue !== null && last !== null ) {
      percentageChange = (changeValue * 100) / (last - changeValue);
      if(percentageChange === null){
        percentageChange = 0;
      }
    }
    return percentageChange;
  },
  
  update : function(tickerRow,data, isRangeChg) { 
	//console.log("{mdmTabTicker} Received updated value; updating: "+tickerRow.id);
	var dateRange = "1dy";
	var pastprice, tab, onedecArr;
	var tickerName = dojo.attr(tickerRow, "ticker");
	var isRefreshBg = false;
	var refreshClass = "refreshBg";

	if(dojo.hasClass(tickerRow, refreshClass)) {
		var rowId = dojo.attr(tickerRow, "id");
		if(rowId) {
			tickerRow = dojo.byId(rowId);
			isRefreshBg = true;
		}
	}
	
	if(dj.module.mdm.marketDataModule && dj.module.mdm.marketDataModule.dateRange) {
		dateRange = dj.module.mdm.marketDataModule.dateRange;
		pastprice = dojo.attr(tickerRow,"data-" + dateRange);
	}
	if(isRangeChg) {
		dojo.attr(tickerRow, "deciDigitsPchg", "2");
		try {
			if(dateRange != "1dy") {
				if(dj.module.mdm.marketDataModule && dj.module.mdm.marketDataModule.oneDecimalTab && dj.module.mdm.marketDataModule.oneDecimalTab.length > 0) {
					onedecArr = dj.module.mdm.marketDataModule.oneDecimalTab;
					tab = dojo.attr(tickerRow, "id").split("_");
					if(tab.length == 3 && dojo.indexOf(onedecArr, tab[1]) > -1) {
		    			dojo.attr(tickerRow, "deciDigitsPchg", "1");
					}
				}
			}
		}
		catch(e) {}
	}	
	var percentageChange = 0;
    var tickerSpanDetailLast = dojo.query(".mdData", tickerRow)[1];
    var tickerSpanDetailChange = dojo.query(".mdData", tickerRow)[2];
    var tickerSpanDetailPctg = dojo.query(".mdData", tickerRow)[3];
    
    var deciDigitsLast = dojo.attr(tickerRow, "deciDigitsLast");
    var deciDigitsChg = dojo.attr(tickerRow, "deciDigitsChg");
    var deciDigitsPchg = dojo.attr(tickerRow, "deciDigitsPchg");
    
    var open = dojo.attr(tickerRow, "open");
    var last = data.b.l;
    var changeValue = 0;
    var timestamp = "";
	if(dateRange !== "1dy" && pastprice) {
	
		open = pastprice;
	}
    if (data.b.c === undefined || data.b.c === null) {
      changeValue = last - open;
    } 
    else {
		if(dateRange !== "1dy" && pastprice) {
			changeValue = last - open;
		}
		else {
      		changeValue = data.b.c; 
		}
      open = last - changeValue;
      dojo.attr(tickerRow, "open", open.toFixed(deciDigitsLast));
    }
	percentageChange = this.percentageChange(changeValue, last);
	if (data.b.z === undefined || data.b.z === null) {
		var dTemp = new Date();
		timestamp = "/Date(" + dTemp.getTime() + ")/"; //convert current time into the BG date format
    } 
    else {
    	timestamp = data.b.z;
    }
	
	var selectedClass = "";
	if(tickerRow.getAttributeNode('class').nodeValue.indexOf("mdRow-selected")!=-1){
		selectedClass = "mdRow-selected";
	}
	var indxPos = "mdRow rowType-positive ";
    var indxNeg = "mdRow rowType-negative ";
    var indxNeutral = "mdRow rowType-neutral ";
    //interchange the pos and neg CSS values for bonds
    /*for(var i = this.bondsArray.length - 1; i >= 0; i--) {
    	if(tickerRow.id.toLowerCase().indexOf(this.bondsArray[i].toLowerCase())!=-1){
    		indxPos = "mdRow rowType-negative";
    		indxNeg = "mdRow rowType-positive";   
    		break;
    	}
    }*/
    

	if (dateRange !== "1dy" && pastprice === "") {
		dojo.attr(tickerRow, "class", indxNeutral+selectedClass);
	}
	else if (changeValue > 0) {
		dojo.attr(tickerRow, "class", indxPos+selectedClass);
    }
    else if (changeValue < 0) {
    	dojo.attr(tickerRow, "class", indxNeg+selectedClass);
    }       
    else {
    	dojo.attr(tickerRow, "class", indxNeutral+selectedClass);
    }
	if(isRefreshBg) {
		dojo.addClass(tickerRow, refreshClass);
	}
    //isNaN check
	if(isNaN(percentageChange)){
    	percentageChange = 0;
    }
    if(isNaN(data.b.l)){
    	data.b.l = 0;
    }
    if(isNaN(changeValue)){
    	changeValue = 0;
    }
    
    dojo.attr(tickerRow, "last", data.b.l.toFixed(deciDigitsLast));
    dojo.attr(tickerRow, "change", changeValue.toFixed(deciDigitsChg));
    dojo.attr(tickerRow, "percent", percentageChange.toFixed(deciDigitsPchg));
    dojo.attr(tickerRow, "timeStamp", timestamp);
    
    dojo.empty(tickerSpanDetailLast);
    dojo.place(dojo.doc.createTextNode(data.b.l.toFixed(deciDigitsLast)),tickerSpanDetailLast);
    dojo.empty(tickerSpanDetailChange);
	dojo.empty(tickerSpanDetailPctg);
	if (dateRange !== "1dy" && pastprice === "") {
		dojo.place(dojo.doc.createTextNode("--"),tickerSpanDetailChange);
		dojo.place(dojo.doc.createTextNode("--"),tickerSpanDetailPctg);
	}
	else {
	    dojo.place(dojo.doc.createTextNode((changeValue>0?"+":"")+changeValue.toFixed(deciDigitsChg)),tickerSpanDetailChange);
	    
	    if(this.noPercentChangeMinus) {
	      dojo.place(dojo.doc.createTextNode(percentageChange.toFixed(deciDigitsPchg).replace("-","") + "%"),tickerSpanDetailPctg);
	    }
	    else {
	      dojo.place(dojo.doc.createTextNode(percentageChange.toFixed(deciDigitsPchg) + "%"),tickerSpanDetailPctg);
	    }
	}
    
    //update the chart for the selected index
    //this.tickersObject.updateChartNow(tickerRow);
    
    //update time stamp only for the selected index
    //Thunderball symbol of the index for which BG data received
    var tballSymbol = tickerRow.getAttributeNode('tballSymbol').nodeValue;
    var cTabllSymbol = currentTballSymbol; //selected i.e. current index Thunderball symbol
    
    //if(bgStarted && (tballSymbol.toString().toLowerCase() == cTabllSymbol.toString().toLowerCase())){
    if(tballSymbol!=null && cTabllSymbol!=null &&
    		(tballSymbol.toString().toLowerCase() == cTabllSymbol.toString().toLowerCase())){
    	this.tickersObject.updateTimeOnBGupdate(tickerRow);
    	//bgStarted = false;
    }
  }
});
dojo.provide("dj.module.mdm.mrktProvider");
dojo.require("dj.lang");
dojo.require("dj.util.bluegrass");

dojo.declare("dj.module.mdm.mrktProvider", null, {
    channels : [],
    _cfg : {},
    connectFlag : null,

    DEFAULT_CONFIG : {
      toURL : dj.context.marketdata.bluegrass.toURL,
      viaURL : dj.context.marketdata.bluegrass.viaURL
    },


    constructor : function(cfg) {
        this._cfg = dj.lang.cloneMixin(this.DEFAULT_CONFIG, cfg);
     },

    subscribeToChannel : function(channel, theView) {
      this.channels.push( {
        channelName : channel,
        view : theView
      });
    },

    subscribeToChannels : function(channels, theView) {
      var that = this;
      dojo.forEach(channels, function(channel){
    	that.subscribeToChannel(channel, theView);
      });
    },

    dynamicSubscribeChannel : function(dynamicChannels, theView, channels) {
    that = this;

	 try{
	      var connection = dj.util.bluegrass.Runtime.getConnection();
	      if (connection != null) {
	          dojo.forEach(dynamicChannels,function(channel) {
	              if (typeof channel.view.render == "function") {
	                var callback = dojo.hitch(channel.view,channel.view.render);
	                channel = connection.subscribe(channel.channelName, callback);
	              } else {
	                console.log("View object for channel %s does not have a render method",
	                        channelName);
	              }
	            });
	        } else {
	        	console.log("{dynamicSubscribeChannel} subscribeToChannels");
	        	that.subscribeToChannels(channels, theView);
	        }

	      } catch (e){
	    	  console.log(e);
	      }
    },


    connectCallback : function(backendConnection, type) {
      if (type == "connect") {
        connection = backendConnection;
        this.connectFlag = true;
        var channelsArray = this.channelList;

        dojo.forEach(channelsArray,function(channel) {
            if (typeof channel.view.render == "function") {
              var callback = dojo.hitch(channel.view,channel.view.render);
              channel = connection.subscribe(channel.channelName, callback);
            } else {
              console.log("View object for channel %s does not have a render method",
                      channelName);
            }
          });

      }
    },

    connect : function(callerCallback) {
    	if(callerCallback !== null && callerCallback !== undefined){
	      dj.util.bluegrass.Runtime.openConnection( {to : this._cfg.toURL, via : this._cfg.viaURL }, callerCallback);
    	} else {
    		var channelObject = {channelList: this.channels};
    	    var callback = dojo.hitch(channelObject, this.connectCallback);
    	    dj.util.bluegrass.Runtime.openConnection( {to : this._cfg.toURL, via : this._cfg.viaURL }, callback);
    	}
    }

  });
dojo.provide("dj.module.mdm.marketDataModule");
dojo.require("dj.lang");
dojo.require("dj.util.Page");
dojo.require("dj.widget.panels.PanelsFactory");
dojo.require("dj.module.mdm.mrktProvider");
//dojo.provide("dj.widget.view.mdmTabTicker");
dojo.require("dj.module.mdm.mdmTabTicker");
dojo.require("dj.module.marketdata.chart");
dojo.require("dj.store.Preferences");

var _djl = dj.lang;
var _djp = dj.util.Page;

dj.module.mdm.marketDataModule = {
  prefStore: null,
  init : function(conf,passMod,checkFreq) {
    // Check for IE to change canvas for VML
    if(_djl.isIE) {
      if (!document.namespaces.g_vml_) {
        document.namespaces.add('g_vml_', 'urn:schemas-microsoft-com:vml',
                   '#default#VML');
      }
      if (!document.namespaces.g_o_) {
        document.namespaces.add('g_o_', 'urn:schemas-microsoft-com:office:office',
                   '#default#VML');
      }
    }

    var setModValue ="";
	
    if(passMod == undefined || passMod==""){
      setModValue = "mdc_h_dtabnk"; //hps_mdm_indexes
    }else
    {
      setModValue = passMod;
    }

    //current container and the ticker value on mouse hovering
    var currentTab = "";
    var currentChartContainer = "";
    var currentIndex = "";
    var currentTballSymbol = "";
    var currentIndxPrevClose = 0;
    var currentIndexValue = 0;
    var currentIndxChartData = null;
    var quotesDomain = dojo.getObject("dj.context.core.quotesUrlPrefix", false);
    if(!quotesDomain) {
      quotesDomain = "http://quotes.wsj.com";
    }
	
	this.dateRange = "1dy";
	
	/* set pref store */
    prefStore = new dj.store.Preferences({
       isOnePerScreen: false
     });

    // Default Configuration
    this.configuration = {
      containerObject : null,
      container: "marketDataContainer",
      tickersObject: null,
      tabPrefix: "marketDataTab_",
      tabs : ["mymarkets", "us", "europe", "asia", "currency", "rates", "futures"], //default tabs
      panelPrefix: "marketDataPanel_",
      tablePrefix: "marketDataTable_",
      myMarketsJsonPage : "/public/page/0_0_WP_MYMARKETS_JSON.js",
      myMarketsURL: "/pznusersvc/view/getUser/indexes/userName",
      myMarketsNoCustomize: true,
      indexLinkURL: quotesDomain + "/index/$symbol$?mod="+setModValue,
      bondURL: "/mdc/public/npage/2_3051.html?mod="+setModValue+"&symb=",
      futuresIndexLinkURL : "/mdc/public/page/2_3028.html?",
      defaultTab : 2,
      tabOnStyle: "selectedTab",
      tabOffStyle: "deselected",
      showMyMarkets: false,  //true only for SUB users
      isASIAEdition: false, //asia
      isEUEdition: false, //europe
      isHKEdition: false, //hongkong
      isSEAEdition: false, //south-east asia
      isDEEdition: false, //germany
      isJPEdition: false, //japan
      isTREdition: false, //turkey
      isForexTab: false,
      isDaylightSavingOn: false,
	  isInIframe: false,
      myMarketSymbols : [],
      chartContainer : "marketDataChart_",
      chartContainerClass : "mdmChart",
      chartWidth : 104,
      chartHeight : 95,
      frequency : "1mi",
      time: "1dy",
      bondsArray : ["10_year"], //ticker value of various bonds - same in the FTL
      bonds: ["10-Year Note"],
      futuresArray : ["gold", "crude oil", "corn", "djia futures", "s&p 500 futures"],

      //Time Zone Offset from DYLAN call and the associated Time Zone
      tzoMapping : {
        "-6":"CST", //Central Standard Time
        "-5":"EST", //Eastern Standard Time
        "-2":"BRST", //Brasilia Summer Time
        "0":"GMT",
        "1":"CET", //Central European Time --- WEST/BST
        "2":"CAT", //Central Africa Time --- SAST
        "5":"IST", //India Standard Time
        "7":"local", //Western Indonesian Time
        "8":"local", //Central Indonesian Time --- CST/HKT/MYT/PHT
        "9":"JST", //Japan Standard Time
        "11":"local" //Eastern Daylight Time (Australia)
      },

      //Time Zone Offset from DYLAN call and the associated Time Zone
      tzoMappingDayLightOn : {
        "-5":"CDT", //Central Daylight Saving (CDT)
        "-4":"EDT", //Eastern Daylight Saving (EDT)
        "-3":"BRST", //Brasilia Summer Time
		"-2":"BRST",
        "0":"GMT",
        "1":"BST",
        "2":"CEST", //Central European Summer Time
        //"2":"(CAT)", //Central Africa Time --- SAST
        "5":"IST", //India Standard Time
        "7":"local", //Western Indonesian Time
        "8":"local", //Central Indonesian Time --- CST/HKT/MYT/PHT
        "9":"JST", //Japan Standard Time
        "10":"local", //Eastern Daylight Time (Australia)
		"11":"local"
      },

      //{tbSymbol:"",time,"",flag:"",cData:""}
      chartsDataArray : [{tbSymbol:"",time:"",flag:false,cData:null}],

      //Request Id in the DYLAN call (is the Thunder Ball chart symbol) : MDC URL
      symHrefMapping : {
        "US:10_YEAR":"UST10Y&page=bond",
        "NL:FTI":"NL:AAEX&page=intl",    "AU:XAO":"AU:XAO&page=intl",
        "US:B400":"B400",          "BE:BEL20":"XX:BEL20&page=intl",
        "BR:BVSP":"BVSP&page=intl",    "IN:1":"1803532&page=intl",
        "FR:PX1":"FR:PX1&page=intl",    "US:VIX":"VIX",
        "DX:DAX":"DX:1876534&page=intl",  "US:DJUSBT":"DJ_4573",
        "US:DW25":"26199Y82",        "US:DJUSBC":"DJ_5553",
        "US:DJUSHP":"DJ_4533",      "MY:DWMY":"DWMY&page=intl",
        "US:DJUSAV":"DJ_5555",        "US:DJUSPR":"DJ_4577",
        "US:DJUSPB":"DJ_5557",      "CN:DJSH":"CN:DJSH&page=intl",
        "US:DWC":"DWC",          "US:DWCOGS":"DWCOGS",
        "US:DJIA":"DJIA",          "XX:DJUBS":"DJUBS",
        "XX:SX5E":"ST:SX5E&page=intl",  "US:FOX50":"FOX50",
        "ZA:ALSH":"XX:1686368&page=intl",  "UK:UKX":"UK:UKX&page=intl",
        "MY:FBMKLCI":"MY:KLSE&page=intl",  "XX:FTSEMIB":"XX:FTSEMIB&page=intl",
        "SG:STI":"FTSTI&page=intl",    "US:GDOW":"GDOW&page=intl",
        "HK:HSI":"HK:1804580&page=intl",  "CN:HSCEI":"HK:HSCHINA&page=intl",
        "XX:IBEX":"XX:IBEX&page=intl",  "US:USDIDR":"C_IDR&sQuote=1",
        "ID:JAKIDX":"1803554&page=intl",  "US:USDJPY":"US:CUR_USDYEN&sQuote=1",
        "KR:0100":"1807211&page=intl",  "US:USDMYR":"C_MYR&sQuote=1",
        "US:MSH":"MSH",          "US:NDX":"NDX",
        "US:COMP":"$COMPQ",        "JP:NIK":"JP:1804610&page=intl",
        "US:$PSE":"PSEX",          "US:NYA":"NYA",
        "SE:OMXSPI":"XX:1762570&page=intl",  "NO:OSEAX":"XX:1871818&page=intl",
        "US:USDPHP":"C_PHP&sQuote=1",
        "US:RUT":"RUT",
        "US:SPX":"SPX",            "AU:XJO":"AU:1867453&page=intl",
        "CA:$ISPTX":"CA:TS300&page=intl",    "CN:000001":"CN:SHCOMP&page=intl",
        "US:USDSGD":"CUR_USDSGD&sQuote=1",
        "XX:SX5P":"ST:SX5P&page=intl",
        "XX:SXXP":"ST:SXXP&page=intl",    "CH:SMI":"XX:SMI&page=intl",
        "XX:Y9999":"XX:1805301&page=intl",  "US:USDTHB":"C_THB&sQuote=1",
        "US:GBPUSD":"CUR_GBPUSD&sQuote=1",  "US:EURUSD":"CUR_EURUSD&sQuote=1",
        "future-us-crude oil - electronic":"category=Energy&subcategory=Petroleum&contract=Crude%252520Light%252520Oil%252520Comp.%252520-%252520nymex&catandsubcat=Energy%257CPetroleum&contractset=Crude%252520Light%252520Oil%252520Comp.%252520-%252520nymex",
        "future-us-gold":"category=Other&subcategory=Metals&contract=Gold%252520Comp.%252520-%252520comex&catandsubcat=Other%257CMetals&contractset=Gold%252520Comp.%252520-%252520comex",
        "future-us-corn":"category=Agriculture&subcategory=Corn%25252C%252520Oats%25252C%252520Rice&contract=Corn%252520Comp.%252520-%252520cbot&catandsubcat=Agriculture%257CCorn%25252C%252520Oats%25252C%252520Rice&contractset=Corn%252520Comp.%252520-%252520cbot",
        "DOW JONES INDUSTRIAL FUTURES":"category=Index&subcategory=U.S.&contract=DJIA%2520-%2520Mini%2520-%2520cbot",
        "SP 500 Futures":"category=Index&subcategory=U.S.&contract=SP%2520500%2520-%2520Mini%2520-%2520cme&catandsubcat=Index%257CU.S.&contractset=SP%2520500%2520Mini%2520-%2520cme",
        "XX:EDOW":"EDOW&page=intl",    "ADOW":"ADOW&page=intl",
        "XX:ADOW":"C_CHF&sQuote=1",    "US:USDCAD":"CUR_USDCAD&sQuote=1",
        "US:USDCNY":"C_CNY&sQuote=1",    "XX:SXXE":"ST:SXXE&page=intl",
        "SG:DWSP":"DWSP&page=intl",    "DK:OMXC20":"KFX&page=intl",
        //add for Germany module append "DE-" in the beginning of the tballSymbol, but only for mapping
        "DE-DX:DAX":"index/DAX",        "DE-XX:TDXP":"index/TECDAX",
        "DE-US:DJIA":"index/Dow_Jones",    "DE-US:COMP":"index/Nasdaq_Composite",
        "DE-US:EURUSD":"devisen/dollarkurs",  "DE-UK:brent crude":"rohstoffe/oelpreis",
        "DE-XX:SXXP":"index/STOXX_Europe_600","DE-UK:UKX":"index/FTSE_100",
        "DE-UK:MCX":"index/FTSE_250",      "DE-FR:PX1":"index/CAC_40",
        "DE-XX:IBEX":"index/IBEX_35",      "DE-XX:EDOWE":"index/The_Europe_Dow",
        "DE-US:SPX":"index/S&P_500",      "DE-US:RUT":"Russell_2000",
        "DE-US:GDOW":"index/Dow_Jones_Global_Dow",  "DE-HK:HSI":"index/Hang_Seng",
        "DE-JP:NIK":"index/Nikkei_225",    "DE-JP:100000016":"index/Nikkei_300",
        "DE-CN:000001":"index/Shanghai_Composite",  "DE-IN:1":"index/SENSEX",
        "DE-XX:ADOWE":"index/The_Asia_Dow",    "DE-US:EURGBP":"devisen/euro-pfund_sterling-kurs",
        "DE-US:EURJPY":"devisen/euro-yen-kurs",    "DE-US:EURCHF":"devisen/euro-schweizer_franken-kurs",
        "DE-DE:DAX FUTURES":"futures/Dax-Future",    "DE-DE:TECDAX FUTURES":"futures/TecDAX-Future",
        "DE-DOW JONES INDUSTRIAL FUTURES":"futures/Dow-Jones-Futures"
      },
      chartClass: "mdmChart",
      delimiter: ": ",
      blueGrass: {
        suppressPercentChangeMinus: true
      }
    };
    _djl.mixin(this.configuration, conf);
	
	this.getStoredTab();
	
	
    this.chartData = "";
    this.myMarketsData = "";
    this.panelData = [];
    this.panels = this.createPanels(this.configuration.container);
	this.tabTickers = [];
	this.oneDecimalTab = [];

    //for logged-in user (SUB)
    if(this.configuration.showMyMarkets) {
	  if(checkFreq) {
	  	this.listenToUpdates(checkFreq);
	  }
      this.getPersonalizedSymbols();
    } else {
      this.connectToBluegrass(); //for PUB user
    }
	
	this.listenToTabChange();
  },
  listenToUpdates: function(freq) {
    var that = this;
  	setInterval(function () {
	  if(prefStore) {
		  prefStore.get("dj_wsj_mj_mymarkets_save", function(val) {
		      if(val && val === 'true') {
		        prefStore.put('dj_wsj_mj_mymarkets_save', 'true_first');
				that.getPersonalizedSymbols(true);
		      } 
			  else if(val && val === 'true_first') {
		        prefStore.put('dj_wsj_mj_mymarkets_save', 'false');
				that.getPersonalizedSymbols(true);
		      } 
		    });
		}
    }, freq);
  },
  connectToBluegrass: function(){
    this.footerBox = _djl.byId("legend_cont");
    this.helpInfo = _djl.byId("helpInfo");
    this.setSelectedTabData();
    this.renderChartForFirstIndxOfTabs();
    this.renderTimeStamps();
    this.addEvents();
    this.initializeNewsTicker();
    //called to connect to chart range drop-down
    this.chartRangeChng();
    this.chartRangeClick();
    currentContext = this;

    if(!dj.context.marketdata.bluegrassProvider){
        console.log("{marketDataModule} dj.context.mdm.bluegrassProvider");
        dj.context.marketdata.bluegrassProvider = new dj.module.mdm.mrktProvider({});
    }

    var connection = dj.util.bluegrass.Runtime.getConnection();
    if (connection === null || connection === undefined) {
      dj.context.marketdata.bluegrassProvider.connect(this.bluegrassSubscribe);
      console.log("{marketDataModule} Connected to bluegrass");
    } else {
      console.log("{marketDataModule} Connection to bluegrass already exists");
      dj.context.marketdata.bluegrassProvider.connect(this.bluegrassSubscribe);
    }
  },

  addEvents : function() {
  var that = this;
  _djl.addLiveEvent(".mdRow", "mouseover", function(ev) {
      var target = (ev.srcElement || ev.target);
      while(target.tagName != "li" && target.tagName != "LI") {
        target = target.parentNode;
      }
      if(dojo.hasClass(target,"rowType-hdr")) {
        return;
      }
      _djl.stopEvent(ev);
      var params = target.id.split("_");
      that.setRowSelected(target, params[1]);
      //setting the current tab and index that is being highlighted
      currentTab = params[1];
      currentChartContainer = that.configuration.chartContainer+params[1]; //marketDataChart_<tabId>
      currentIndex = params[2]; //ticker value
      currentTballSymbol = "";
      currentIndxPrevClose = "";
      currentIndexValue = 0;
      var co = co || dojo.byId('marketDataTable_'+params[1]);
      var selectedNode = dojo.query('.mdRow-selected', co);
      var tballSymbol = ""; var dt = new Date(); var offset = 0;
      if(selectedNode!=null && selectedNode.length==1){
        tballSymbol = selectedNode[0].getAttributeNode('tballSymbol').nodeValue;
        currentTballSymbol = tballSymbol;
        currentIndex = selectedNode[0].getAttributeNode('ticker').nodeValue;
        currentIndxPrevClose = selectedNode[0].getAttributeNode('pc').nodeValue;
        currentIndexValue = selectedNode[0].getAttributeNode('last').nodeValue;
        dt = selectedNode[0].getAttributeNode('timeStamp').nodeValue;
        offset = selectedNode[0].getAttributeNode('timeZoneOffset').nodeValue;
      }

      that.configuration.isForexTab = false; //default value
      if(params[1].toString().toLowerCase()=="currency"
        || currentIndex.toString().toLowerCase()=="10_year"){
        //as 10_YEAR can be selected from the My Markets user list
        that.configuration.isForexTab = true; //suggesting that timezone will be EST
      }
      //change time stamp for the selected index only
      var d = "";
      if(that.configuration.isDEEdition){
      d = that.convertDateTimeGermany(dt, offset);
      } else {
        d = that.convertDateTime(dt, offset);
      }
      var cObj = cObj || dojo.byId(that.configuration.panelPrefix+currentTab);
    var sNode = dojo.query('.metadataType-timestamp', cObj);
    if(sNode!=null && sNode.length==1){
      sNode[0].innerHTML = d;
      sNode[0].reload;
    }

    that.renderChartNow(currentChartContainer, currentIndex, tballSymbol, currentIndxPrevClose, currentIndexValue);
    }, that);

  _djl.addLiveEvent(".btn_help", "click", function(ev) {
      _djl.stopEvent(ev);
      _djl.addClassName(that.footerBox, "mdmLegend-expanded");
    }, that);

    _djl.addLiveEvent(".btn_close", "click", function(ev) {
      _djl.stopEvent(ev);
      _djl.removeClassName(that.footerBox, "mdmLegend-expanded");
    });
  },

  convertDateTime : function(dateTime, offset) {
    var that = this;
    var d = "";
    var forexOffset = offset; //this will take care of the -5 hours for EST and -4 for Daylight saving time
    var browser = navigator.userAgent.toLowerCase(); //find the browser agent
    var appName = navigator.appName.toLowerCase(); //find the browser being used
    var useOffset = false; //TRUE for date from Bluegrass
    var isMonthDec = false; //TRUE if month is December (IE and Mac/Safari check)
    if(dateTime!=null && dateTime.toString().toLowerCase().indexOf("date")!=-1){
      dateTime = dateTime.substring(dateTime.indexOf("(")+1,dateTime.lastIndexOf(")/"));
      d = new Date(parseFloat(dateTime,2)); //for numeric date from BG
      useOffset = true;
      /* BG data has the offset and shows the time as per the country from where the module is being
       * accessed i.e. country from where one is checking the data such as India, France, Australia etc.
       */
    } else {
      //for date string from Dylan call -> format received is   yyyy-MM-ddTHH:mm:ss

      //IE and Mac/Safari fails to parse this format so using split to form the date
      if((appName.indexOf("internet explorer")!=-1 ||
          (browser.indexOf("safari")!=-1 && browser.indexOf("apple")!=-1 &&
          browser.indexOf("chrome")==-1))
          && dateTime!=null && dateTime.length>0){
        var dtParams = dateTime.toString().split("T");
        var e1 = dtParams[0];  var e2 = dtParams[1];
        var dateP = e1.split("-");
        var timeP = e2.split(":");
        /* This check is because IE and Mac/Safari interpret "12" for month as "0"
         * So December for year X, becomes January for year X+1
         * E.g.: 2011-12-22  would become  2012-01-22
         */
        if(dateP[1].toString() == "12"){
          dateP[1]--;
          isMonthDec = true;
          //'isMonthDec' signifies not to decrement cMonth value for IE and Mac/Safari(see below)
        }
        if(dateP.length==3 && timeP.length==3){
          d =  new Date(dateP[0],dateP[1],dateP[2],timeP[0],timeP[1],timeP[2],0);
        } else{
          d = new Date();
        }
      }  else {
        d = new Date(dateTime); //for FF and Chrome
      }
    }
    if(isNaN(d.getDate()) || d==null || d.length==0){
      console.log("{marketDataModule} Failure while parsing date.");
      d = new Date(); //in case parsing fails, show current datetime
    }

    var tZoneCode = "";
    if(that.configuration.isForexTab){
      if(that.configuration.isDaylightSavingOn){
        tZoneCode = "EDT";
        } else {
          tZoneCode = "EST";
        }
    } else{
      if(that.configuration.isDaylightSavingOn){
          tZoneCode = that.configuration.tzoMappingDayLightOn[offset];
        } else {
          tZoneCode = that.configuration.tzoMapping[offset];
        }
    }

    if(browser.indexOf("chrome")==-1 && !useOffset){
      //for DYLAN call that shows the index market/exchange time, for browsers except Chrome
      offset = 0;
    } else if(browser.indexOf("chrome")!=-1 && !useOffset){
      /* for DYLAN call that shows the index market/exchange time, but Chrome automatically adds
       * the country offset (from GMT) so compensate time for that extra time
       * e.g.: -5.5hours for IST i.e. d.getTimezoneOffset()/60
       */
      offset = d.getTimezoneOffset()/60;
    } else if(useOffset){
      /* for BG data has the offset and it shows the time as per the country from where the module is
       * being accessed. It already contains the country offset from GMT.
       * e.g.: -5.5hours for IST i.e. d.getTimezoneOffset()/60
      */
      offset = parseFloat(offset) + (parseFloat(d.getTimezoneOffset()/60));
    }

    //for EST time for FOREX and 10 YEAR NOTE. EST fixed offset is -5 hours from GMT
    if(that.configuration.isForexTab){
        if(browser.indexOf("chrome")==-1 && !useOffset){
          forexOffset = 0; //now the data from Dylan is in EST
          //forexOffset = -5; //just convert in EST from GMT data in Dylan
        } else if(browser.indexOf("chrome")!=-1 && !useOffset){
          /* for DYLAN call that shows the index market/exchange time, but Chrome automatically adds
           * the country offset (from GMT) so compensate time for EST and for that extra time.
           * e.g. of EXTRA time: -5.5hours for IST i.e. d.getTimezoneOffset()/60
           */
          //now the data from Dylan is in EST
          forexOffset = parseFloat(0) + (parseFloat(d.getTimezoneOffset()/60));
          //forexOffset = parseFloat(-5) + (parseFloat(d.getTimezoneOffset()/60));
        } else if(useOffset){
          /* for BG data has the offset and it shows the time as per the country from where the module
           * is being accessed. It already contains the country offset from GMT.
           * e.g.: -5.5hours for IST i.e. d.getTimezoneOffset()/60
          */
          forexOffset = parseFloat(forexOffset) + (parseFloat(d.getTimezoneOffset()/60));
        }
        offset = forexOffset; //setting the new value for offset for the Forex tab
    }

      d = this.convertToExchangeTime(d.getTime().toString(), offset);

    var dString = "";
    var cDate = d.getDate();
    var cMonth = d.getMonth()+1;
    /* For DYLAN date i.e. useOffset = False
     * IE and Mac/Safari -> d.getMonth() returns the month index from (1-12) so cMonth-1
     * FF/Chrome -> d.getMonth() returns the month index from (0-11) so cMonth
    */
    if(!useOffset && !isMonthDec && (appName.indexOf("internet explorer")!=-1 ||
        (browser.indexOf("safari")!=-1 && browser.indexOf("apple")!=-1 &&
        browser.indexOf("chrome")==-1))){
      cMonth--;
    }
    var cYr = d.getFullYear();
    cYr = cYr.toString().substring(2);
    var cHr = d.getHours();
    var cMin = d.getMinutes();
    if(cMin<10){
      cMin = "0"+cMin; //otherwise it shows only one digit
    }
    var a_p = " PM ";
    if (cHr < 12) {
     a_p = " AM ";
    }
    if (cHr == 0){
      cHr = 12;
    } else if (cHr > 12) {
      cHr = cHr - 12;
    }
    //dString += cMonth + "/" + cDate + "/" + cYr + " " + cHr + ":" + cMin + "." + d.getSeconds() + " " + a_p + " " + tZoneCode;
    dString += cMonth + "/" + cDate + "/" + cYr + " " + cHr + ":" + cMin + " " + a_p + " " + tZoneCode;
    return dString;
  },

  //Date time format and zones for Germany edition
  convertDateTimeGermany : function(dateTime, offset) {
    var that = this;
    var d = "";
    var browser = navigator.userAgent.toLowerCase(); //find the browser agent
    var appName = navigator.appName.toLowerCase(); //find the browser being used
    var useOffset = false; //TRUE for date from Bluegrass
    var isMonthDec = false; //TRUE if month is December (IE and Mac/Safari check)
    if(dateTime!=null && dateTime.toString().toLowerCase().indexOf("date")!=-1){
      dateTime = dateTime.substring(dateTime.indexOf("(")+1,dateTime.lastIndexOf(")/"));
      d = new Date(parseFloat(dateTime,2)); //for numeric date from BG
      useOffset = true;
      /* BG data has the offset and shows the time as per the country from where the module is being
       * accessed i.e. country from where one is checking the data such as India, France, Australia etc.
       */
    } else {
      //for date string from Dylan call -> format received is   yyyy-MM-ddTHH:mm:ss

      //IE and Mac/Safari fails to parse this format so using split to form the date
      if((appName.indexOf("internet explorer")!=-1 ||
          (browser.indexOf("safari")!=-1 && browser.indexOf("apple")!=-1 &&
          browser.indexOf("chrome")==-1))
          && dateTime!=null && dateTime.length>0){
        var dtParams = dateTime.toString().split("T");
        var e1 = dtParams[0];  var e2 = dtParams[1];
        var dateP = e1.split("-");
        var timeP = e2.split(":");
        /* This check is because IE and Mac/Safari interpret "12" for month as "0"
         * So December for year X, becomes January for year X+1
         * E.g.: 2011-12-22  would become  2012-01-22
         */
        if(dateP[1].toString() == "12"){
          dateP[1]--;
          isMonthDec = true;
          //'isMonthDec' signifies not to decrement cMonth value for IE and Mac/Safari(see below)
        }
        if(dateP.length==3 && timeP.length==3){
          d =  new Date(dateP[0],dateP[1],dateP[2],timeP[0],timeP[1],timeP[2],0);
        } else{
          d = new Date();
        }
      }  else {
        d = new Date(dateTime); //for FF and Chrome
      }
    }
    if(isNaN(d.getDate()) || d==null || d.length==0){
      console.log("{marketDataModule} Failure while parsing date for Germany module.");
      d = new Date(); //in case parsing fails, show current datetime
    }

    var tZoneCode = "(CET)"; //that.configuration.tzoMapping[1];
    var adjustOffset = 1; //+1 hour from GMT
    if(that.configuration.isDaylightSavingOn){
      adjustOffset = 2; //+2 hours from GMT
    }

    //for Germany edition all times in CET; fixed offset is +1 hours from GMT, and +2 hours during Daylight saving
    if(browser.indexOf("chrome")==-1 && !useOffset){
      offset = -(offset - adjustOffset); //just convert in CET
    } else if(browser.indexOf("chrome")!=-1 && !useOffset){
      /* for DYLAN call that shows the index market/exchange time, but Chrome automatically adds
       * the country offset (from GMT) so compensate time for EST and for that extra time.
       * e.g. of EXTRA time: -5.5hours for IST i.e. d.getTimezoneOffset()/60
       */
      offset = -(parseFloat(offset) - parseFloat(adjustOffset) - (parseFloat(d.getTimezoneOffset()/60)));
    } else if(useOffset){
      /* for BG data has the offset and it shows the time as per the country from where the module
       * is being accessed. It already contains the country offset from GMT.
       * e.g.: -5.5hours for IST i.e. d.getTimezoneOffset()/60
      */
      offset = parseFloat(adjustOffset) + (parseFloat(d.getTimezoneOffset()/60));
    }

      d = this.convertToExchangeTime(d.getTime().toString(), offset);

    var dString = "";
    var cDate = d.getDate();
    var cMonth = d.getMonth()+1;
    /* For DYLAN date i.e. useOffset = False
     * IE and Mac/Safari -> d.getMonth() returns the month index from (1-12) so cMonth-1
     * FF/Chrome -> d.getMonth() returns the month index from (0-11) so cMonth
    */
    if(!useOffset && !isMonthDec && (appName.indexOf("internet explorer")!=-1 ||
        (browser.indexOf("safari")!=-1 && browser.indexOf("apple")!=-1 &&
        browser.indexOf("chrome")==-1))){
      cMonth--;
    }
    var cYr = d.getFullYear();
    cYr = cYr.toString().substring(2);
    var cHr = d.getHours();
    var cMin = d.getMinutes();
    if(cMin<10){
      cMin = "0"+cMin; //otherwise it shows only one digit
    }
    dString += cDate + "." + cMonth + "." + cYr + ", " + cHr + ":" + cMin + " Uhr";
    return dString;
  },

  convertToExchangeTime: function(utcDateString, offset) {
      if (typeof (offset) != 'undefined')
          offset = offset;
      else
          offset = 0;
      var converted = parseInt(utcDateString);
      if (isNaN(converted)) {
          if (utcDateString.indexOf("-") >= 0 || utcDateString.indexOf("+") >= 0)
              utcDateString = utcDateString.substring(6, utcDateString.length - 7);
          else
              utcDateString = utcDateString.substring(6, utcDateString.length - 2);
          converted = parseInt(utcDateString);
      }
      converted += 3600000 * offset;
      var dateTime = new Date(converted);
      return dateTime;
  },

  setRowSelected : function(target, container) {
    var that = this;
    var tabs = _djl.query("#" + that.configuration.tablePrefix + container + " .mdRow");
    for(var i = tabs.length - 1; i >= 0; i--) {
      _djl.removeClassName(tabs[i], "mdRow-selected");
    }
    _djl.addClassName(target,"mdRow-selected");
  },

  //sets the global data for the default/selected tab - only on page load
  setSelectedTabData: function() {
    var that = this;
    that.configuration.chartsDataArray = [{tbSymbol:"",time:"",flag:false,cData:null}];
    //determine the selected tab
    var sTab = dojo.query("#marketDataContainer .selectedTab");
    if(sTab!=null && sTab.length>0){
        for(var i=0;i<sTab.length;i++){
          var tabId = sTab[i].getAttributeNode('id').nodeValue;
          currentTab = (tabId.split("_"))[1];
          //in the selected tab determine the selected row, and set the data
          if(tabId.toString().indexOf(that.configuration.tabPrefix)!=-1){
            var co = co || dojo.byId(that.configuration.tablePrefix+currentTab);
            var selectedNode = dojo.query('.mdRow-selected', co);
            if(selectedNode!=null && selectedNode.length==1){
              currentTballSymbol = selectedNode[0].getAttributeNode('tballSymbol').nodeValue;
                  currentIndex = selectedNode[0].getAttributeNode('ticker').nodeValue;
                  currentIndxPrevClose = selectedNode[0].getAttributeNode('pc').nodeValue;
                  currentIndexValue =  selectedNode[0].getAttributeNode('last').nodeValue;
                  currentChartContainer = that.configuration.chartContainer + currentTab;
                  currentIndxChartData = null;
                  break;
            }
          }
        }
      }
  },

  /* Renders the chart for selected indexes for all tabs
   * Called on page load/refresh, and on change of chart range value
  */
  renderChartForFirstIndxOfTabs : function(_tab) {
    var that = this;
    //var firstIndexes = dojo.query(".mdTable li:first-child");
    var tab = _tab || '.selectedTab';
	var selectedTab = dojo.query(tab, dojo.byId(that.configuration.container));
    
	  if(selectedTab) {
	  	selectedTab = selectedTab[0].id.split("_")[1] || "";
	  }
	  else {
	  	selectedTab = "";
	  }
	 var firstIndexes = dojo.query('.mdRow-selected', dojo.byId(that.configuration.tablePrefix + selectedTab));//render chart for selected index on selected tab only
    
    var tballSymbol = ""; var ticker = "";
    var date = ""; var offset = 0; var pc = 0; var civ = 0;
    if(firstIndexes!=null && firstIndexes.length>0){
      for(var i = firstIndexes.length - 1; i >= 0; i--) {
        var tabs = firstIndexes[i];
 
        var params = tabs.id.split("_");
        var tab = params[1];
        ticker = tabs.getAttributeNode('ticker').nodeValue;
        offset = tabs.getAttributeNode('timeZoneOffset').nodeValue;
        if(i==0){
          date = tabs.getAttributeNode('timestamp').nodeValue;
        }
        tballSymbol = tabs.getAttributeNode('tballSymbol').nodeValue;
        pc = tabs.getAttributeNode('pc').nodeValue;
        civ = tabs.getAttributeNode('last').nodeValue;
        that.renderChartNow(that.configuration.chartContainer + tab, ticker, tballSymbol, pc, civ);
      }
    }
  },

  //Render the first index of timestamps for all tabs; called on page load only
  renderTimeStamps : function() {
    var that = this;
    //var firstIndexes = dojo.query(".mdTable li:first-child");
    var firstIndexes = dojo.query('.mdRow-selected'); //render timestamps for selected indexes only
    var date = ""; var offset = 0; var id="";
    var defaultTab = that.configuration.tabs[that.configuration.defaultTab-1];
    if(firstIndexes!=null && firstIndexes.length>0){
      var tabs = "";
      for(var i = firstIndexes.length - 1; i >= 0; i--) {
        tabs = firstIndexes[i];
        id = tabs.id;
        var params = id.split("_")
        //gets the timestamp for the default tab
        date = tabs.getAttributeNode('timestamp').nodeValue;
        offset = tabs.getAttributeNode('timeZoneOffset').nodeValue;
        var d = "";
        if(that.configuration.isDEEdition){
        d = that.convertDateTimeGermany(date, offset);
        } else {
          d = that.convertDateTime(date, offset);
        }
        dojo.query("#marketDataPanel_" + params[1] + " .metadataType-timestamp").forEach(function(obj, index){
          obj.innerHTML = d;
        });
      }
    }
  },

  //ON HOLD
  /*updateChartNow: function(tickerRow) {
    var that = this;
      var params = tickerRow.id.split("_");
      var ticker = tickerRow.getAttribute('ticker');
      var tballSymbol = tickerRow.getAttribute('tballSymbol');
      var civ = tickerRow.getAttribute('last');
      currentChartContainer = that.configuration.chartContainer + params[1];
      that.renderChartNow(currentChartContainer, ticker, tballSymbol, civ);
  },*/

  //update timestamp of current tab's selected index
  updateTimeOnBGupdate: function(tickerRow) {
    var that = this;
    var dt = new Date(); var offset = 0;
    var last = tickerRow.getAttributeNode('last').nodeValue;
    if(last!=null){
      currentIndexValue = last;
    }
    var dt = tickerRow.getAttributeNode('timeStamp').nodeValue;
    var offset = tickerRow.getAttributeNode('timeZoneOffset').nodeValue;
    //change time stamp for the selected index only
      var d = "";
      if(that.configuration.isDEEdition){
      d = that.convertDateTimeGermany(dt, offset);
      } else {
        d = that.convertDateTime(dt, offset);
      }
      var co = co || dojo.byId(that.configuration.panelPrefix+currentTab);
    var selectedNode = dojo.query('.metadataType-timestamp', co);
    if(selectedNode!=null && selectedNode.length==1){
      selectedNode[0].innerHTML = d;
      selectedNode[0].reload;
    }
    //update the timestamp for all tabs
    /*dojo.query(".metadataType-timestamp").forEach(function(obj, index){
        obj.innerHTML = d;
        document.getElementById("mdm_timestamp").reload;
      });*/
  },

  //calls the thunderball service to retrieve the chart for that index (based on Thunderball symbol/Rq.Id)
  renderChartNow: function(chartContainer, ticker, tballSymbol, prevClose, civ) {
    var that = this;
    prevClose = parseFloat(prevClose);
    if(isNaN(prevClose)){
      console.error("{marketDataModule} Invalid Previous Close value received for "+tballSymbol);
      prevClose = 0; //in case we receive an invalid value
    }
    var chartUpdateSuccess = that.isChartPresent(chartContainer, ticker, tballSymbol, prevClose, civ);
    if(chartUpdateSuccess){
      return;
    }
    //Chart service called in case of new charts or chart data failure
    //try {
      dojo.xhrPost({
        url : '/thunderball/HistoricChartData.aspx',
        headers : {"Dylan2010.EntitlementToken" : "57494d5ed7ad44af85bc59a51dd87c90"},
        handleAs : 'json',
        load : function(response, xhr){
          var chartData = response;
          var success = that.drawChart(chartContainer, chartData, tballSymbol, prevClose);
          //add the new symbol in charts array, if index not present and only in case of success
          if(success){
            var symbolTimePresentInArray = false; //Thundeball symbol and time of the index
            var chartArrayIndex = ""; var chartArrayLen = that.configuration.chartsDataArray.length;
            var chartArrayT = [{"cDataT":chartData}]; //chart data is added as an array obj
            for(var count = 0; count < chartArrayLen; count++) {
              chartArrayIndex = that.configuration.chartsDataArray[count];
              var arrayTballSymbol = chartArrayIndex.tbSymbol;
                //if symbol present, then check time value
              if(arrayTballSymbol.toLowerCase()==tballSymbol.toLowerCase()){
                  if(chartArrayIndex.time.toLowerCase()==that.configuration.time.toLowerCase()){
                    symbolTimePresentInArray = true;
                    break;
                  }
                }
            }
            if(!symbolTimePresentInArray){ //index not present in array, so add it
              that.configuration.chartsDataArray.push({tbSymbol:tballSymbol, time:that.configuration.time,
                  flag:true, cData:chartArrayT});
            }
          }
          //render current index chart
          that.drawChart(currentChartContainer, currentIndxChartData, currentTballSymbol, currentIndxPrevClose);
        },
        content : {
          Symbol : tballSymbol.toUpperCase(),
          Width : that.configuration.chartWidth,
          Height : that.configuration.chartHeight,
          freq : that.configuration.frequency,
          time : that.configuration.time//,
        }
        /*error : function(error, ioArgs) {
          that.showNoChartMessage(chartContainer, tballSymbol);
        }*/
      });
    /*} catch(e) {
        that.showNoChartMessage(chartContainer, tballSymbol);
    }*/
  },

  isChartPresent : function(chartContainer, ticker, tballSymbol, prevClose, civ){
    var that = this;
    var count = 0; var chartArrayIndex = ""; var chartArrayLen = that.configuration.chartsDataArray.length;
    for(; count < chartArrayLen; count++) {
      chartArrayIndex = that.configuration.chartsDataArray[count];
      var arrayTballSymbol = chartArrayIndex.tbSymbol;
      var arrayTime = chartArrayIndex.time;  //chart time (1dy, 3mo etc.)
      var arrayFlag = chartArrayIndex.flag; //suggests the symbol is already hovered over or not
      if(arrayFlag && arrayTballSymbol.toLowerCase()==tballSymbol.toLowerCase() &&
          arrayTime.toLowerCase()==that.configuration.time.toLowerCase()){
        var chartData = chartArrayIndex.cData[0].cDataT;
        var sessions = chartData[0].Value.Data[0].Value.Sessions;
        if(chartData!=null && sessions!=null){
          var numOfSessions = sessions.length;
          var chartDataHigh = sessions[numOfSessions-1].High.Price; //High Value
          var chartDataLow = sessions[numOfSessions-1].Low.Price; //Low Value
          var chartDataTrades = sessions[numOfSessions-1].Trades; //pick the last session of Trades
          /* check for the last value in the Trades array, if same then don't push it in the
           * Trades array, just render the chart with last available data
          */
          if(parseFloat(civ)!=chartDataTrades[chartDataTrades.length-1]){
            //just get the latest value and add it in the array (of this index)
            chartDataTrades.push(parseFloat(civ));
            sessions[numOfSessions-1].Trades = chartDataTrades;
          }
          if(parseFloat(civ)>chartDataHigh){
            //replace the current High Value with the current value
            chartDataHigh = parseFloat(civ);
            sessions[numOfSessions-1].High.Price = chartDataHigh;
          } else if(parseFloat(civ)<chartDataLow){
            //replace the current Low Value with the current value
            chartDataLow = parseFloat(civ);
            sessions[numOfSessions-1].Low.Price = chartDataLow;
          }
          //set current index chart data
          if(tballSymbol.toLowerCase()==currentTballSymbol.toLowerCase()
              /*&& chartContainer==currentChartContainer*/){
            currentIndxChartData = chartData;
          }
          //now render new chart
          return that.drawChart(chartContainer, chartData, tballSymbol, prevClose);
        }
        return false; //null chart or sessions are empty
      }
    }
    currentIndxChartData = null;
    return false; //index not present in array
  },

  drawChart : function(chartContainer, chartData, tballSymbol, prevClose){
    var that = this;
    if(chartData!=null){
      try{
        var stockchartChart = new EmbeddedChartMDM(chartContainer, WSJIndexChartStyle,
            that.configuration.chartWidth, that.configuration.chartHeight,
            that.configuration.time, that.configuration.frequency, null, null, chartData,
            tballSymbol, prevClose, that.configuration.isDEEdition, '');
        var chartExists = stockchartChart.ShowChart(tballSymbol);
        if(!chartExists) {
        //failure could be due to no chart data present
        console.error("{marketDataModule} Chart does not exist for: "+tballSymbol);
        that.showNoChartMessage(chartContainer, tballSymbol);
        return false; //null chart
        }
      } catch(e) {
        console.error("{marketDataModule} Chart draw failure: "+tballSymbol);
        that.showNoChartMessage(chartContainer, tballSymbol);
          return false;
      }
    }
    return true; //chart update successfull or no update required as last values are same
  },

  //in case the chart is not available
  showNoChartMessage : function(container, tballSymbol) {
    var that = this;
    var href = that.configuration.indexLinkURL + "";
	if(href.indexOf("$symbol$")!==-1) {
		var _sym = tballSymbol.replace(/[uU][sS]:/, "").replace(":", "/");
		href = href.replace("$symbol$", _sym);
	  }

    if(container.indexOf("futures")!=-1){ //for "futures" tab
      href = that.configuration.futuresIndexLinkURL + "";
    }
    //for all editions except DE (Germany)
    var symblHref = that.configuration.symHrefMapping[tballSymbol];
  if(symblHref!=null && symblHref.length>0){
      href += symblHref;
    }
   else {
   		if(that.configuration.isASIAEdition || that.configuration.isHKEdition
           || that.configuration.isSEAEdition){
         href = "http://online.wsj.com/mdc/public/page/marketsdata_asia.html";
       } else if(that.configuration.isEUEdition){
         href = "http://online.wsj.com/mdc/public/page/marketsdata_europe.html";
       } else if(that.configuration.isJPEdition){
         href = "http://jp.wsj.com/public/npage/japan-market-data-center.html";
       } else if(that.configuration.isTREdition){
         href = "http://online.wsj.com/mdc/public/page/marketsdata.html";
       } else{ //default is US edition
         href = "http://online.wsj.com/mdc/public/page/marketsdata.html";
       }
   }

  //for Germany edition
  if(that.configuration.isDEEdition){ //Germany edition URLs
    href = "http://www.finanzen.net/";
    symblHref = that.configuration.symHrefMapping["DE-"+tballSymbol]; //append "DE-" before tabllSymbol
    if(symblHref!=null && symblHref.length>0){
      href += symblHref;
    }
  }
  var linkTarget = "";
  if(that.configuration.isInIframe) {
	linkTarget = " target='_blank'";
  }
  if(that.configuration.isJPEdition){ //JP edition URLs
    href = "http://jp.wsj.com/public/npage/japan-market-data-center.html";    
  }
  if(that.configuration.isTREdition){ //TR edition URLs
    href = "http://tr.wsj.com/public/npage/turkey-markets.html";
  }
  
  if(container!=null){
      var containerObject = _djl.byId(container);      
      if(that.configuration.isDEEdition){
        containerObject.innerHTML = "<p class=\"msg-chart\">Chart verf&#252;gbar bei <a href=\""+ href +"\">Finanzen.net</a></p>";
      } else if (that.configuration.isJPEdition) {
        containerObject.innerHTML = "<p class=\"msg-chart\"><a href=\""+ href +"\">&#12510;&#12540;&#12465;&#12483;&#12488;&#12487;&#12540;&#12479;</a> &#12391;&#21033;&#29992;&#21487;&#33021;&#12394;&#12464;&#12521;&#12501; </p>";
      } else if (that.configuration.isTREdition) {
        containerObject.innerHTML = "<p class=\"msg-chart\">&#304;lgili grafik <a href=\""+ href +"\">Piyasa Veri Merkezi&#8217;nde</a></p>";
      } else {
        containerObject.innerHTML = "<p class=\"msg-chart\">Chart available at <a href=\""+ href +"\"" +linkTarget+ ">Market Data Center</a></p>";
      }      
    }
  },

  //called on selecting a particular time period from the chart range drop-down
  chartRangeChng : function() {
    var that = this;
    //dojo.query("data-widget='mdm_time'").connect("onClick", function(obj){
    dojo.query(".mdm_time").connect("onclick", function(event){ //
      var time = dojo.attr(event.target, 'data-time');// obj.getAttribute('data-time');//this.attributes[2].value;  //"data-time"
      var frequency = dojo.attr(event.target, 'data-frequency');//obj.getAttribute('data-frequency');//this.attributes[1].value;  //"data-frequency"
	  that.dateRange = time;
	  that.updateChgValue();
      currentContext.configuration.time = time;
      currentContext.configuration.frequency = frequency;
      currentContext.renderChartForFirstIndxOfTabs();
      //render the chart for current index now
      currentContext.renderChartNow(currentChartContainer, currentIndex, currentTballSymbol, currentIndxPrevClose, currentIndexValue);
      var newLabel = event.target.innerHTML;
	  dojo.query(".mdRow.rowType-hdr:not(.noUpdate)").forEach(function(e){
	    if(time !== "1dy") {
	  		if(!dojo.hasClass(e, "mdRow-past")) {
				dojo.addClass(e, "mdRow-past"); 
			}
			dojo.query(".marketDelta", e)[0].innerHTML = newLabel.toUpperCase(); 
			dojo.query(".marketValue", e)[0].innerHTML = "CHG";	
		}
		else {
			dojo.removeClass(e, "mdRow-past"); 
			dojo.query(".marketDelta", e)[0].innerHTML = dojo.attr(dojo.query(".marketDelta", e)[0],"data-label") || "CHG"; 
			dojo.query(".marketValue", e)[0].innerHTML = dojo.attr(dojo.query(".marketValue", e)[0],"data-label") || "%CHG";
		}
	  });
      dojo.query(".mdmChartRange .mdmSetting .lblSettingName").forEach(function(e){
      	var delimiter =  that.configuration.delimiter,
      	arr = e.innerHTML.split(delimiter);
		if(arr.length > 1) {
        	e.innerHTML = arr[0] + delimiter + newLabel;
		}
		else {
			e.innerHTML = newLabel;
		}
      });
    });
  },

  //called on the chart range drop-down click
  chartRangeClick : function() {
    dojo.query(".mdmSetting").connect("onclick", function(obj){
      var target = (obj.srcElement || obj.target);
      while(target.tagName.toUpperCase()!=="DIV" && !dojo.hasClass(target, "mdmSetting")) {
        target = target.parentNode;
      }
      if(dojo.hasClass(target, "mdmDropdown-collapsed")){
        dojo.attr(this, "class", "mdmSetting mdmDropdown-expanded");
      } else{
        dojo.attr(this, "class", "mdmSetting mdmDropdown-collapsed");
      }
    });
    if(navigator.userAgent.match(/iPad/i) == null){
      dojo.query(".mdmSetting").connect("onmouseover", function(obj){
        dojo.attr(this, "class", "mdmSetting mdmDropdown-expanded");
      });
      dojo.query(".mdmSetting").connect("onmouseout", function(obj){
        dojo.attr(this, "class", "mdmSetting mdmDropdown-collapsed");
      });
    }
  },
  
  updateChgValue: function() {
    var open, last;
	var pastclose, chg, tab;
	this.oneDecimalTab = [];
	
	if(this.dateRange != "1dy") {
		for (var i=0; i<this.tabTickers.length ; i++) {
			pastclose = dojo.attr(this.tabTickers[i].tickerNode, "data-" + this.dateRange);
			last = dojo.attr(this.tabTickers[i].tickerNode, "last");
			if(pastclose && last && (last - pastclose > 999.99 || last - pastclose < -999.99)) {
				tab = dojo.attr(this.tabTickers[i].tickerNode, "id");
				if(tab) { 
					tab = tab.split("_");
					if(tab.length == 3 && dojo.indexOf(this.oneDecimalTab, tab[1]) == -1) {
						this.oneDecimalTab.push(tab[1]);
					}
				}
			}
		}
	}	
  	for (var i=0; i<this.tabTickers.length ; i++) {
		data = {};
		data.b = {};
		data.b.l = 0;
		last = dojo.query(".marketPrice", this.tabTickers[i].tickerNode);
		if(last.length > 0) {
			data.b.l = last[0].innerHTML;
		}
		data.b.l = parseFloat(data.b.l);
		if(this.dateRange == "1dy") {
		    open = dojo.attr(this.tabTickers[i].tickerNode, "pc");
			data.b.c = data.b.l - parseFloat(open);
		}
        this.tabTickers[i].render(data, true);
      }
  },

  //News ticker caraousel
  initializeNewsTicker : function() {
    if(dojo.byId("newsTickerDiv")) {
      dj.widget.panels.PanelsFactory.create("newsTickerDiv",
          {core: {panelIncrement: 1},
           carousel: {type: "circular"},
           rotator: {rotateTime: 0,rotateIterations: 10}
           }
      );
    }
  },

  //subscribing to bluegrass channels for indexes
  bluegrassSubscribe: function(){
    console.log("{marketDataModule} subscribing to bluegrass channels");
    this.tabTickers = [];
    this.containerObject = this.containerObject || dojo.byId(this.currentContext.configuration.tablePrefix);
    var bgChannelNodes = dojo.query('[bg_channel]', containerObject);
      this.bgChannels = [];
      for (var i=0; i<bgChannelNodes.length ; i++) {
        this.tabTickers[i] = new dj.module.mdm.mdmTabTicker({tickersObject: this.currentContext, tickerNode: bgChannelNodes[i],
          bondsArray: this.currentContext.configuration.bondsArray});
        var viewComp = this.tabTickers[i];
        var channelObject = [{
            channelName : dojo.attr(bgChannelNodes[i],"bg_channel"),
            view : viewComp
          }];
        dj.context.marketdata.bluegrassProvider.dynamicSubscribeChannel(channelObject, viewComp);
      }
	  dj.module.mdm.marketDataModule.tabTickers = this.tabTickers;
  },

  //gets the symbols for the logged-in user (My Markets)
  getPersonalizedSymbols : function(isRefresh) {
    var that = this;
    _djl.xhrGet({
      url: that.configuration.myMarketsURL,
      handleAs: "json",
      preventCache: true,
      headers : {
        "Accept":"application/json"
      },
      load: function(response, ioArgs) {
        that.buildMyMarketSymbols(response, isRefresh);
        return response;
      },

      error: function(response, ioArgs) {
        return response;
      }
    });
  },

  // populte the array with the received user/personalized symbols
  buildMyMarketSymbols : function(data, isRefresh) {
    var that = this;
	that.configuration.myMarketSymbols = [];
    if(!data.indexes) { return; }
    for(var i = 0; i < data.indexes.length; i++) {
       that.configuration.myMarketSymbols[i] = data.indexes[i].id;
    }
	
	that.getMyMarketsData();
	if(isRefresh) {
		that.renderChartForFirstIndxOfTabs();
	}
  },

  // reads the result of the complete Dylan call i.e. one with all the indexes
  getMyMarketsData : function() {
  var that = this;
    _djl.xhrGet({
      url: that.configuration.myMarketsJsonPage,
      handleAs: "text",
      preventCache: true,
      load: function(response, ioArgs) {
      response = response.substring(0,response.indexOf("}}]}")+4);  //trim?
        that.myMarketsData = _djl.fromJson(response);
        that.renderMyMarketsTab();
        that.connectToBluegrass();
        return response;
      },
      error: function(response, ioArgs) {
        console.log(response);
        console.log(ioArgs);
        return response;
      }
    });
  },

  //renders the My Markets tab
  //For Germany edition - LATER as Germany edition is not configured for a SUBSCRIBER
  renderMyMarketsTab : function(count) {
    var that = this;
    var tabContent = "";
    var change = 0; var last = 0; var open = 0; var percentage = 0;
	var price5dy = 0; var price1mo = 0; var price3mo =0; var price6mo = 0; var price1yr = 0;
	var priceytd = 0; var price2yr = 0;
    var channel = ""; var name = ""; var tballSymbol= "";
    var timeStamp = ""; var timeZoneOffset = 0;
    var ddLast = 2; var ddChg = 2; var ddPchg = 2; var pc = 0;
    var ticker = ""; var href = that.configuration.indexLinkURL + "";
    var cHref = that.configuration.indexLinkURL + "";
    /*
     * t: ticker    ch: BG Channel      n: name/display
     * o: open      l: last          c: change
     * p: percentage  sid: symsid        s: sym
     * ts: timeStamp  tzo: timeZoneOffset   tb: tballSymbol
     * ddl: decimalLast  ddc: decimalChange    ddpc: decimalPercent
     * pc: prev close
     */
	var linkTarget = "";
	if(that.configuration.isInIframe) {
		linkTarget = " target='_blank'";
	}
    tabContent += ("    <ul class=\"mdTable\" id=\"marketDataTable_mymarkets\">"+
      "<li class=\"mdRow rowType-hdr\">"+
      "<span class=\"mdData marketName\"></span>"+
      "<span class=\"mdData marketPrice\"> LAST </span>"+
      "<span class=\"mdData marketDelta\" data-label=\"CHG\"> CHG </span>"+
      "<span class=\"mdData marketValue\" data-label=\"%CHG\"> %CHG </span>"+
      "</li>");
  var item = ""; var symblHref = "";
    for(i = 0 ; i<that.configuration.myMarketSymbols.length; i++) {
      change = 0; last = 0; open = 0; percentage = 0; timeStamp = ""; timeZoneOffset = 0;
      channel = ""; name = ""; ticker = ""; href = that.configuration.indexLinkURL + "";
      symblHref = ""; cHref = that.configuration.indexLinkURL + ""; tballSymbol= "";
      ddLast = 2; ddChg = 2; ddPchg = 2; pc = 0;
      item = that.myMarketsData['mymktindx'][0][that.configuration.myMarketSymbols[i]];
        if(item!=null && item.s==that.configuration.myMarketSymbols[i]){
          ddLast = item.ddl;
          ddChg = item.ddc;
          ddPchg = item.ddpc;
          ticker = item.t;
          change = item.c;
          last = item.l;
          open = item.o;
          percentage = item.p;
          channel = item.ch;
          name = item.n;
          timeStamp = item.ts;
          timeZoneOffset = item.tzo;
          tballSymbol = item.tb;
		  price5dy = item.price5dy;
		  price1mo = item.price1mo;
		  price3mo = item.price3mo;
		  price6mo = item.price6mo;
		  price1yr = item.price1yr;
		  priceytd = item.priceytd;
		  price2yr = item.price2yr;
          pc = item.pc;
          //check for special 'Future' indexes - in My Markets tab for chart and index URLs
          for(var x = that.configuration.futuresArray.length - 1; x >= 0; x--) {
            if(name.toLowerCase().indexOf(that.configuration.futuresArray[x].toLowerCase())!=-1){
              href = that.configuration.futuresIndexLinkURL + "";
              cHref = that.configuration.futuresIndexLinkURL + ""; //TODO: chart URL logic
              break;
            }
          }
          if(dojo.indexOf(that.configuration.bonds, name)!==-1) {
            href = that.configuration.bondURL;
          }
          if(item.sid==null || item.sid.length==0){
            item.sid = that.configuration.symHrefMapping[tballSymbol];
          }
          if(href.indexOf("$symbol$")!==-1) {
            var _sym = tballSymbol.replace(/[uU][sS]:/, "").replace(":", "/");
            console.log("_sym: %s", _sym);
            href = href.replace("$symbol$", _sym);
          }
          else {
            href += item.sid;
          }
          symblHref = that.configuration.symHrefMapping[tballSymbol];
          if(symblHref!=null && symblHref.length>0 && !that.configuration.isDEEdition){
              cHref += symblHref;
              //check for DE edition - LATER as Germany edition is not configured for a SUBSCRIBER
            }
          else {
              //check for EU, ASIA, HK, SEA and DE
              if(that.configuration.isASIAEdition || that.configuration.isHKEdition
                  || that.configuration.isSEAEdition){
                cHref = "http://online.wsj.com/mdc/public/page/marketsdata_asia.html";
              } else if(that.configuration.isEUEdition){
                cHref = "http://online.wsj.com/mdc/public/page/marketsdata_europe.html";
              }
              //check for DE edition - LATER as Germany edition is not configured for a SUBSCRIBER
              /*else if(that.configuration.isDEEdition){
                cHref = "http://www.finanzen.net/";
              }*/
              else{ //default is US edition
                cHref = "http://online.wsj.com/mdc/public/page/marketsdata.html";
              }
            }

          var rowType = "";
          var selectedClass = "";
          if(i==0){ //first index to be selected
            selectedClass = "mdRow-selected";
          }
		  var tmpChg = change;
          if(typeof change==="string") {
            tmpChg = parseFloat(change);
          }
		  
          if(tmpChg>0) {
            rowType = "rowType-positive "+selectedClass;
          }
          else if(tmpChg<0) {
            rowType = "rowType-negative "+selectedClass;
          }
          else{
            rowType = "rowType-neutral "+selectedClass;
            tmpChg=0;
            percentage=0;
          }
          
          /*if(i==0){
            to render the date for first index in My Markets tab
            that.configuration.firstIndexes.push({tab:"mymarkets", indx:ticker});
          }*/
		  
          tabContent += "<li id=\"mdm_mymarkets_" + ticker + "\" class=\"mdRow " + rowType+"\" bg_channel=\"" + channel
            + "\" open=\"" + open + "\" last=\"" + last+ "\"tballSymbol=\""+tballSymbol+"\" change=\""+change
            + "\" percent=\""+percentage+"\" timeStamp=\""+timeStamp+"\" ticker=\""+ticker+"\" timeZoneOffset=\""+timeZoneOffset
            + "\" deciDigitsLast=\""+ddLast+"\" deciDigitsChg=\""+ddChg+"\" deciDigitsPchg=\""+ddPchg+"\" pc=\""+pc+"\" data-5dy=\""+price5dy+"\" data-1mo=\""+price1mo+"\" data-3mo=\""+price3mo+"\" data-6mo=\""+price6mo+"\" data-1yr=\""+price1yr+"\" data-ytd=\""+priceytd+"\" data-2yr=\""+price2yr+"\">";
          tabContent += "    <span class=\"mdData marketName\"><a class=\"md_index\" href=\""+href+"\""+linkTarget+">"+name+"</a></span>";
          tabContent += "    <span class=\"mdData marketPrice\">"+last+"</span>";
          tabContent += "    <span class=\"mdData marketDelta\">"+(tmpChg>0?"+":"")+change+"</span>";
          tabContent += "    <span class=\"mdData marketValue\">"+"".concat(percentage).replace("-","")+"%"+"</span>";
          tabContent += "</li>";
        }
    }
    tabContent += "    </ul>";
    //adding DIV for charts
    tabContent += "    <div class=\""+this.configuration.chartContainerClass+"\">";
    tabContent += "      <div class=\"mdmChartRange\">";
    tabContent += "        <div class=\"mdmSetting mdmDropdown-collapsed\">";
    tabContent += "          <span class=\"lblSetting\">Settings</span>";
    tabContent += "          <span class=\"lblSettingName\">Range: 1 Day</span>";
    tabContent += "          <ul class=\"\">";
    tabContent += "            <li><a data-time=\"1dy\" data-frequency=\"1mi\" class=\"mdm_time\">1 Day</a></li>";
    tabContent += "            <li><a data-time=\"5dy\" data-frequency=\"15mi\" class=\"mdm_time\">5 Days</a></li>";
    tabContent += "            <li><a data-time=\"1mo\" data-frequency=\"30mi\" class=\"mdm_time\">1 Month</a></li>";
    tabContent += "            <li><a data-time=\"3mo\" data-frequency=\"1dy\" class=\"mdm_time\">3 Months</a></li>";
    tabContent += "            <li><a data-time=\"6mo\" data-frequency=\"1dy\" class=\"mdm_time\">6 Months</a></li>";
	tabContent += "            <li><a data-time=\"ytd\" data-frequency=\"1dy\" class=\"mdm_time\">YTD</a></li>";
    tabContent += "            <li><a data-time=\"1yr\" data-frequency=\"1dy\" class=\"mdm_time\">1 Year</a></li>";
	tabContent += "            <li><a data-time=\"2yr\" data-frequency=\"1dy\" class=\"mdm_time\">2 Years</a></li>";
    tabContent += "          </ul>";
    tabContent += "        </div>";
    tabContent += "      </div>";
    tabContent += "      <div id=\"marketDataChart_mymarkets\" class=\""+this.configuration.chartClass+"\">";
    tabContent += "        <p class=\"msg-chart\">Chart available at <a href=\""+cHref+"\"" +linkTarget+ ">Market Data Center</a></p>";
    tabContent += "      </div>";
    tabContent += "    </div>";
    //footer check for DE edition - LATER as Germany edition is not configured for a SUBSCRIBER
    tabContent += "    <ul class=\"cMetadata\">";
    if(!this.configuration.myMarketsNoCustomize) {
      tabContent += "     <li class=\"metadataType-settingsLink\"><a href=\"/page/mj-markets.html?mod=WSJ_hps_marketdata\">Customize My Markets</a></li>";
    }
    //tabContent += "      <li>* at close</li>";
    //tabContent += "      <li class=\"metadataType-source\">Data: Dow Jones, Reuters</li>";
    //tabContent += "      <li class=\"metadataType-source\">Source: Dow Jones, <a href=\"javascript:dj.util.Url.openWin('http://www.six-telekurs.com/','Telekurs_Page');\">SIX Telekurs</a>, ICAP plc</li>";
    tabContent += "      <li id=\"mdm_timestamp\" class=\"metadataType-timestamp\">"+that.convertDateTime(timeStamp, timeZoneOffset);+"</li>";
    tabContent += "      <li id=\"linkHelp\" class=\"linkHelp linkHelp-collapsed\"><a class=\"btn_help\" href=\"#\">Help</a></li>";
    tabContent += "    </ul>";
    document.getElementById("marketDataPanel_mymarkets").innerHTML = tabContent;
    document.getElementById("marketDataPanel_mymarkets").reload;
  },

  createPanels : function(container) {
    var that = this;
    return dj.widget.panels.PanelsFactory.create(container, {
      core: {
        panelPrefix:     "marketDataPanel_",
        panels:          that.configuration.tabs,
        enableHistory:   false,
        activePanel:     that.configuration.defaultTab
      },

      tabs: {
        tabPrefix:       "marketDataTab_",
        tabOnStyle:      "selectedTab",
        tabOffStyle:     "deselected"
      }
    });
  },
  
  /* store tab change */
  listenToTabChange : function() {
  	var that = this;
	var tabId, tabIndex;
  	dojo.query("li a", dojo.byId(that.configuration.container)).connect("onclick", function(event){
		tabIndex = "mymarkets";
		tabId = dojo.attr(this.parentNode, "id");
		tabId = tabId.split("_");
		if(tabId[1]) {
			tabIndex = tabId[1];
		}
		
		that.renderChartForFirstIndxOfTabs("#" + that.configuration.tabPrefix + tabIndex);
		
    	if(that.configuration.showMyMarkets) { //for logged in user
			if(prefStore) {
				prefStore.put("mdm_selectedTab", tabIndex);
			}
		}
		else { // pub user
			dj.util.Cookie.setCookie("mdm_selectedTab", tabIndex);
		}
	});
  	
  },
  /* get stored tab */
  getStoredTab :function() {
	var that = this;
	
    if(that.configuration.showMyMarkets) { //for logged in user
		if(prefStore) {
			prefStore.get("mdm_selectedTab", function(val) {
				if(val) {
					that.configuration.defaultTab = dojo.indexOf(that.configuration.tabs, val) + 1;
				}
			});
		}
	}
	else { // pub user
		var selTab = dj.util.Cookie.getCookie("mdm_selectedTab");
		if(selTab !==null) {
			that.configuration.defaultTab = dojo.indexOf(that.configuration.tabs, selTab) + 1;
		}
	}
  }
  
};
dojo.provide("dj.widget.geotargeting.moduleShow");
dojo.require("dj.util.Cookie");

dojo.declare("dj.widget.geotargeting.moduleShow", [], {
  constructor: function (conf) {
    // Default cfx
    this.cfx = {
    //   at : Austria, de: Germany, ch: Switzerland
      countries : ["at", "de", "ch"],
      country : "",
      moduleIds : ["gmHeadlines", "gmSingleHeadline"]
    };

    this.findCountry();
    this.moduleVisibleMaker();    
  },

  findCountry : function() {
    this.cfx.country = dj.util.Cookie.getGroupCookie('DJSESSION','country');
  },

  isInTargetCountries : function() {
    var countries = this.cfx.countries;
    for (var i=0; i<countries.length; i++)
    {
      if(countries[i] == this.cfx.country) {
        return true;
      }
    }
    return false;
  },

  moduleVisibleMaker : function() {
   
    var moduleIds = this.cfx.moduleIds;
    if (this.isInTargetCountries()){
      for (var i=0; i<moduleIds.length; i++)
      {
        if(dojo.query(moduleIds[i])) {
          classname = '.' + moduleIds[i];
          dojo.query(classname).forEach(function(node, index, arr){
            dojo.style(node, "display", "");
            dojo.style(node, "cursor", "pointer");
            dojo.connect(node, "onclick", function() {
              window.location.href = "http://www.wallstreetjournal.de";
             });
          });
        }
      }
    }
  }
  
});
dojo.provide("dj.module.geotargeting.germanyScrim");
dojo.require("dj.lang");
dojo.require("dj.util.Cookie");

dj.module.geotargeting.germanyScrim = {

  init : function(conf) {
    this.cfx = {
      browserLanguage : "en",
      isClickedDESCrimNoThanks : 0,
      isClickedDESCrimNoThanksCookie : 0
    };
    dj.lang.mixin(this.cfx, conf);
    this.findLanguage();
    
    //Get session count
    if(!dj.util.Cookie.getGroupCookie('DJSESSION', 'isClickedDESCrimNoThanks')){
      dj.util.Cookie.setGroupCookie('DJSESSION', 'isClickedDESCrimNoThanks', 0);
      this.cfx.isClickedDESCrimNoThanks = 0;
    } else {
      this.cfx.isClickedDESCrimNoThanks = dj.util.Cookie.getGroupCookie('DJSESSION', 'isClickedDESCrimNoThanks');
    }
    
    //Get lifetime count
    if(!dj.util.Cookie.getGroupCookie('DJCOOKIE', 'isClickedDESCrimNoThanksCookie')){
      dj.util.Cookie.setGroupCookie('DJCOOKIE', 'isClickedDESCrimNoThanksCookie', 0);
      this.cfx.isClickedDESCrimNoThanksCookie = 0;
    } else {
      this.cfx.isClickedDESCrimNoThanksCookie = dj.util.Cookie.getGroupCookie('DJCOOKIE', 'isClickedDESCrimNoThanksCookie');
    }
    
    //Show scrim only once per session and only thrice per lifetime if the browser language is germany
    if(this.cfx.browserLanguage == 'de' || this.cfx.browserLanguage == 'de-at' || this.cfx.browserLanguage == 'de-de' || this.cfx.browserLanguage == 'de-li' || this.cfx.browserLanguage == 'de-lu' || this.cfx.browserLanguage == 'de-ch') {
      if(this.cfx.isClickedDESCrimNoThanks == 0 && this.cfx.isClickedDESCrimNoThanksCookie <= 2){
        this.onLoadHomePage();
        this.onWSJDEClick();
        this.onNoThanksClick();
        this.onCloseButtonClick();
      }
    }
  },

  findLanguage : function() {
    //Get the browser language
    this.cfx.browserLanguage = (window.navigator.userLanguage || navigator.language || navigator.browserLanguage).toLowerCase();
  },

  onLoadHomePage : function() {
    var aUrl = window.location.href;
    
    //Show Germany scrim if the user is not in germany site
    if(aUrl.indexOf('wallstreetjournal.de')) {
      this.showScrim();
    }
  },

  showScrim : function() {
    dojo.query(".scrimWSJ_overlay").forEach(function(node, index, arr) {
      dojo.style(node, "display", "");
    });
  },

  onWSJDEClick : function() {
    dojo.query(".gmDeviceScrimBtn").forEach(function(node, index, arr) {
      dojo.connect(node, "onclick", function(evt) {
        window.location.href = "http://www.wallstreetjournal.de";
      });
    });
  },

  onNoThanksClick : function() {
    var that = this;
    dojo.query(".gmDeviceScrimReadMore").forEach(function(node, index, arr) {
      dojo.connect(node, "onclick", function(evt) {
        that.hideScrim();
      });
    });
  },
  
  onCloseButtonClick : function() {
      var that = this;
      dojo.query(".gmDeviceScrimCloseBtn").forEach(function(node, index, arr) {
        dojo.connect(node, "onclick", function(evt) {
          that.hideScrim();
        });
      });
  },

  hideScrim : function() {
    this.cfx.isClickedDESCrimNoThanks = parseInt(this.cfx.isClickedDESCrimNoThanks) + 1;
    this.cfx.isClickedDESCrimNoThanksCookie = parseInt(this.cfx.isClickedDESCrimNoThanksCookie) + 1;
    dj.util.Cookie.setGroupCookie('DJSESSION', 'isClickedDESCrimNoThanks', this.cfx.isClickedDESCrimNoThanks);
    dj.util.Cookie.setGroupCookie('DJCOOKIE', 'isClickedDESCrimNoThanksCookie', this.cfx.isClickedDESCrimNoThanksCookie, 730);
    dojo.query(".scrimWSJ_overlay").forEach(function(node, index, arr) {
      dojo.style(node, "display", "none");
    });
  }

};
dojo.provide("dj.module.geotargeting.moduleShow");
dojo.require("dj.widget.geotargeting.moduleShow");

dj.module.geotargeting.moduleShow = {
  init: function() {
    this.moduleShow = new dj.widget.geotargeting.moduleShow();     
  }
};
dojo.provide("dj.widget.sitewidget.model.WidgetModel");

dojo.declare('dj.widget.sitewidget.model.WidgetModel', [], {
  /**
   * Allowed: (DASH|POPUP)
   */
  state: 'DASH',

  /**
   * @see dojo.position
   */
  position: {x: 0, y: 60, w: 0, h: 0},

  /**
   * @constructor
   * @param {String} id Widget id. May be page-id.
   * @param {String} title
   * @param {Object} properties
   * @param {String} properties.state (DASH|POPUP)
   * @param {Object} properties.position
   */
  constructor: function (id, title, properties) {
    dojo.safeMixin(this, properties);
    this.id = id;
    this.title = title;
  },

  /**
   * Event that's called whenever one
   * of the parameters is updated.
   *
   * @param {Object} change
   * @param {WidgetModel} change.model
   * @param {String} change.name
   * @param {Number|String} change.prev
   * @param {Number|String} change.curr
   */
  onPropertyChange: function (change) {},

  /**
   * Event that's called whenever
   * the widget is destroyed.
   *
   * @param {WidgetModel} widgetModel
   */
  onDestroy: function (widget) {},

  setTitle: function (state) {
    this.updateProperty('title', state);
  },

  /**
   * @param {WidgetModel.state} state
   */
  setState: function (state) {
    this.updateProperty('state', state);
  },

  setPosition: function (position) {
    this.updateProperty('position', position);
  },

  destroy: function () {
    this.onDestroy(this.id);
  },

  toObj: function () {
    return {
      id: this.id,
      title: this.title,
      state: this.state,
      position: this.position
    };
  },

  /**
   * Updates the property, and calls
   * the onPropertyChange event.
   */
  updateProperty: function (name, value) {
    var prevValue = this[name];
    if (value === prevValue) { return; }
    this[name] = value;
    this.onPropertyChange({
      model: this,
      name: name,
      prev: prevValue,
      curr: value
    });
  },

  __json__: function () {
    return this.toObj();
  }
});

dj.widget.sitewidget.model.WidgetModel.createFromObject = function (obj) {
  return new dj.widget.sitewidget.model.WidgetModel(
    obj.id, obj.title, {
      state: obj.state,
      position: obj.position
    });
};
dojo.provide("dj.widget.sitewidget.view.mixin.WidgetBaseMixin");

dojo.declare('dj.widget.sitewidget.view.mixin.WidgetBaseMixin', [], {
  /**
   * @constructor
   * @param {WidgetModel} widgetModel
   * @param {DashView} dashView
   */
  constructor: function (widgetModel, dashView) {
    this.model = widgetModel;
    this.dashView = dashView;
    this.domNode = null;
  },

  renderDomNode: function () {
    this.domNode = dojo.create('section', {
      'data-widget-id': this.model.id,
      className: 'widget'
    });
  }
});
dojo.provide("dj.widget.sitewidget.view.WidgetPopupOpenView");

dojo.declare('dj.widget.sitewidget.view.WidgetPopupOpenView', [], {
  constructor: function (widgetModel) {
    this.model = widgetModel;
    this.popupFeatures = {
      left: 0,
      top: 60,
      toolbar: 'no',
      location: 'no',
      scrollbars: 'yes',
      resizable: "no",
      width: 300,
      height: 500
    };
  },

  render: function () {
    this.popUpInWindow();
  },

  remove: function () {
    this.window.close();
  },

  popUpEmptyWindow: function () {
    this.window = window.open('about:blank', 'widget', this._toWinFeatures(this.popupFeatures));
    if(dojo.isIE !== 7){
      this.window.document.body.style.backgroundColor = "#777";
    }
  },

  setModel: function (widgetModel) {
    this.model = widgetModel;
  },

  popUpInWindow: function () {
	var pURL;
    var features = {
      left: this.model.position.x,
      top: this.model.position.y,
      width: this.model.position.w + 5,
      height: this.model.position.h,
      toolbar: 'no',
      location: 'no',
      scrollbars: 'yes',
      resizable: "no"
    };
	
	var excPopout = dojo.getObject("dj.context.sitewidgets.staticPopout");

	if(excPopout && excPopout == this.model.id) {
		pURL = dj.context.core.urlPrefix + "/public/page/" + this.model.id + ".html";
	}
	else {
		pURL = (dojo.getObject("dj.context.sitewidgets.popupurl") ||
               (dj.context.core.urlPrefix + "/sitewidgets/popup.html"));
	}
     url = (pURL + '?id=' + this.model.id + '&title=' + this.model.title);  
	
    if (this.window && !this.window.closed && !this.isPopupBlocked()) {
      this.window.resizeTo(features.width, features.height);
      this.window.moveTo(features.left, features.top);
      this.window.location = url;
    } else {
      var windowName = (this.window && this.isPopupBlocked()) ?
        ('force_' + this.model.id)  : this.model.id;
      this.window = window.open(url, windowName, this._toWinFeatures(features));
    }

    // on browsers that will set the window to null when it is
    // blocked by a pop-up, display the message immediately
    if (this.isPopupBlocked()) {
      this.blockedPopupMessage();
      return;
    }

    // on Chrome (and possibly others) check that the
    // window's dimensions are not 0px by 0px
    // and if they are--display the pop-up blocker message
    setTimeout(dojo.hitch(this, function () {
      if (this.isPopupBlocked()) {
        this.blockedPopupMessage();
      } else {
        this.window.focus();
      }
    }), 500);
  },

  isPopupBlocked: function () {
    if (!this.window) { return true; }
    var isBl = false;
    try {
      isBl = ((0 === this.window.outerWidth) &&
             (0 === this.window.outerHeight));
    } catch (e) {
      // FF throws an err on this.window.outerWidth access
    }
    return isBl;
  },

  blockedPopupMessage: function () {
    console.warn('{WidgetPopupOpenView} pop-up blocked: ' + this.model.id);
  },

  _toWinFeatures: function (features) {
    var arr = [],name;
    for (name in features) {
      if (features.hasOwnProperty(name)) {
        arr.push(name + '=' + features[name]);
      }
    }
    return arr.join(',');
  }
});
dojo.provide("dj.widget.sitewidget.view.mixin.WidgetDndMixin");
dojo.require("dojo.dnd.Moveable");

dojo.declare('dj.widget.sitewidget.view.mixin.WidgetDndMixin', [], {
  constructor: function (widgetModel, dashView, config) {
    dojo.connect(widgetModel, 'onDestroy', this, 'remove');
  },

  renderDnd: function () {
    this.updateNodePosition();
    this.addHeaderNode();
    this.connectPopupButton();
    this.connectCloseButton();
    this.addDnd();
  },

  updateNodePosition: function () {
    dojo.style(this.domNode, {
      left: this.model.position.x + 'px',
      top: this.model.position.y + 'px'
    });
  },

  addHeaderNode: function () {
    var header = dojo.create('header', null, this.domNode, 'first');
    dojo.create('span', {className: 'close', innerHTML: '&times;', href: ''}, header);
    dojo.create('span', {className: 'popup', innerHTML: 'o', href: ''}, header);
    dojo.create('h4', {innerHTML: this.model.title}, header);
  },

  connectPopupButton: function () {
    var popupButton = dojo.query('.popup', this.domNode)[0];
    dojo.connect(popupButton, 'onclick', this, function (ev) {
      dojo.stopEvent(ev);
      this.model.setState('POPUP');
    });
  },

  connectCloseButton: function () {
    var closeButton = dojo.query('.close', this.domNode)[0];
    dojo.connect(closeButton, 'onclick', this, function (ev) {
      dojo.stopEvent(ev);
      this.model.destroy();
    });
  },

  addDnd: function () {
    var header = dojo.query('header', this.domNode)[0],
        moveable = new dojo.dnd.Moveable(this.domNode, {handle: header});
    dojo.connect(moveable, 'onMoveStart', this, function (mover) {
      dojo.style(this.domNode, {zIndex: ++this.dashView.zIndex});
    });
    dojo.connect(moveable, 'onMoveStop', this, function (mover) {
      this.model.setPosition(dojo.position(this.domNode));
    });
  },

  remove: function () {
    dojo.fadeOut({
      node: this.domNode,
      duration: 120,
      onEnd: dojo.hitch(this, function () {
        dojo.destroy(this.domNode);
      })
    }).play();
  }
});
dojo.provide("dj.store.Widget");
dojo.require("dojo.store.Memory");
dojo.require("dj.store.Preferences");

dojo.declare("dj.store.Widget", [dojo.store.Memory], {
  namespace: 'store',

  constructor: function (options) {
    this.pref = new dj.store.Preferences({isOnePerScreen: true});
    this._isRetreived = false;
  },

  get: function (id) {
    if (this._isRetreived) {
      return this.inherited(arguments);
    }
    var self = this,
      def = new dojo.Deferred();
    this._setDataFromPref(function () {
      def.callback(self.get(id));
    });
    return def;
  },

  query: function (query, options) {
    var inherited = dojo.hitch(this, this.inherited),
      args = arguments,
      def = new dojo.Deferred();
    this._setDataFromPref(function () {
      var results = inherited(args);
      def.callback(results);
    });
    return def;
  },

  put: function (object, options) {
    this.inherited(arguments);
    this.currentWidgetId = arguments[0].id;
    this._setDataIntoStorage();
  },

  remove: function (id) {
    this.inherited(arguments);
    this._setDataIntoStorage();
  },

  _setDataFromPref: function (cb) {
    var self = this;
    this.pref.get(this.namespace, function (prefs) {
      var serialized =  (null === prefs) ? [] : dojo.fromJson(prefs);
      self.setData(serialized);
      self._isRetreived = true;
      cb();
    });
  },

  _setDataIntoStorage: function () {
    var serialized = this.data;
    if (null !== serialized) {
      //Preserve position data in multiple pop-ups scenario
      if(this.currentWidgetId && serialized.length > 1){
        if(typeof localStorage !== "undefined"){
          serialized = localStorage.getItem(this.namespace + '_' + (window.screen.width * window.screen.height));  
        }else{
          serialized = dj.util.Cookie.getGroupCookie("DJCOOKIE", this.namespace + "_" + (window.screen.width * window.screen.height)); 
        }
        serialized = dojo.fromJson(serialized);
        if(serialized.length > 1){
          for (i = 0, l = serialized.length; i < l; i++) {
            if(this.currentWidgetId === serialized[i].id){
              serialized[i].position.x = this.data[i].position.x;
              serialized[i].position.y = this.data[i].position.y;
              break;
            }
          }
          this.data = serialized;
        }else{
          serialized = this.data;
        }
      }
    }    
    serialized = dojo.toJson(this.data);
    this.pref.put(this.namespace, serialized);
  }
});
dojo.provide("dj.widget.sitewidget.view.mixin.WidgetFragMixin");

dojo.require("dj.util.Region");
dojo.require("dj.util.User");
dojo.require("dj.util.user.EnvironmentDao");

dojo.require("dj.widget.fragmentloader.FragmentLoader");

dojo.declare('dj.widget.sitewidget.view.mixin.WidgetFragMixin', [], {
  /**
   * @constructor
   * @param {WidgetModel} widgetModel
   * @param {DashView} dashView
   * @param {Object} config
   * @param {dj.util.user.Environment} config.userEnv
   * @param {String} config.version
   */
  constructor: function (widgetModel, dashView, config) {
    this.cfg = dojo.delegate({
      userEnv: undefined,
      version: 'v6',
      isLoadHtml: true,
      isLoadJs: true,
      isLoadCss: true,      
      // without a unique _sectionId, a new WidgetView may be
      // created with the same one, which breaks
      // the fragment loader
      sectionId: ('sitewidget_'+parseInt(Math.random()*100, 10)+'_'+widgetModel.id)
    }, config);
  },

  renderContent: function (cb, ctx) {
    this.addContentNode();
    this.populateContent(cb, ctx);
  },

  addContentNode: function () {
    var section  = dojo.create('section', {
      id: this.cfg.sectionId,
      className: 'content'
    }, this.domNode);
  },

  populateContent: function (cb, ctx) {
    this._loadFragment(this.model.id, this.cfg.sectionId, {
      isLoadInlineJs: true,
      isLoadHtml: ctx.cfg.isLoadHtml,
      isLoadJs: ctx.cfg.isLoadJs,
      isLoadCss: ctx.cfg.isLoadCss
    }, ctx, cb);
  },

  _loadFragment: function (pageId, domNodeId, cfg, ctx, cb) {
    var loader = new dj.widget.fragmentloader.FragmentLoader(
            this._getUserEnv(), pageId, this._getVersion(), domNodeId, cfg);
    	dojo.connect(loader, 'onJsLoad', ctx, cb);
    loader.load();
  },

  //TODO: extract to general-purpose util
  _getUserEnv: function() {
    var env = this.cfg.userEnv;
    if (!env) {
      var dao = new dj.util.user.EnvironmentDao(
          dj.util.Region, dj.util.User);
      env = dao.getEnvironment();
    }
    return env;
  },

  /**
   * Cache is a combination of the following:
   *   - dj.context.sitewidgets.version (if set)
   *   - version provided by the user
   *
   * If we're in debugMode (chip or query param),
   * then the current time will be used.
   */
  //TODO: extract to general-purpose util
  _getVersion: function() {
    var d = new Date(), v = "0",
        ctxVersion = (dojo.getObject("dj.context.sitewidgets.fragment.version") || "v");
    v = [ctxVersion, this.cfg.version].join("");
    if (dojo.doc.location.toString().indexOf("debugMode") > -1) {
      v = d.getTime();
    }
    return v;
  }
});
dojo.provide("dj.widget.sitewidget.model.DashModel");
dojo.require("dj.widget.sitewidget.model.WidgetModel");
dojo.require("dojo.store.Memory");
dojo.require("dojo.store.Observable");
dojo.require("dj.util.Page");

dojo.declare('dj.widget.sitewidget.model.DashModel', [], {
  DEFAULT_CONFIG: {
    /**
     * Filter to be used by store.query.
     * Empty by default, to ensure that all
     * widgets in the store are rendered.
     */
    widgetFilter: {}
  },

  /**
   * @constructor
   * @param {dojo.store} store
   */
  constructor: function (store, config) {
    this.widgets = new dojo.store.Memory();
    this.store = dojo.store.Observable(store);
    this.cfg = dojo.delegate(this.DEFAULT_CONFIG, config);
    
    var serialized = localStorage.getItem('sitewidgets_v1_' + (window.screen.width * window.screen.height));
    serialized = dojo.fromJson(serialized);

    if(serialized){
     var _objFound = false; 
    for (var i=0; i < serialized.length; i++){
    if(serialized[i].id === dj.util.Page.getQueryParam('id')){
  _objFound = true;
	    break;
    }
    }
    
    if(!_objFound){
      serialized.push({"id":dj.util.Page.getQueryParam('id'),"title":dj.util.Page.getQueryParam('title'),"state":"POPUP","position":{"x":0,"y":0,"w":577,"h":646}});
      serialized = dojo.toJson(serialized);
      localStorage.setItem('sitewidgets_v1_' + (window.screen.width * window.screen.height), serialized);
    }
    
    }
    
  },

  addStoredWidgets: function () {
    var resultsDef = this.store.query(this.cfg.widgetFilter),
        includeObjectUpdates = true;
    dojo.when(resultsDef, dojo.hitch(this, function (results) {
      dojo.forEach(results, this._addWidgetFromStore, this);
      if (results.observe) {
        results.observe(
          dojo.hitch(this, this._storeChangeHandler), includeObjectUpdates);
      }
    }));
  },

  addWidget: function (widget) {
    dojo.connect(widget, 'onPropertyChange', this, 'changeWidgetProperty');
    dojo.connect(widget, 'onDestroy', this, 'removeWidget');
    this.widgets.add(widget);
    dojo.when(this.store.get(widget.id), dojo.hitch(this, function (storedWidget) {
      if (!storedWidget) { this.store.add(widget.toObj()); }
      this.onAddWidget(widget, this.cfg);
    }));
  },

  removeWidget: function (id) {
    this.widgets.remove(id);
    dojo.when(this.store.get(id), dojo.hitch(this, function (storedWiddget) {
      if (!storedWidget) { this.store.remove(id); }
      this.onRemoveWidget(id);
    }));
  },

  /**
   * @see WidgetModel.onPropertyChange
   */
  changeWidgetProperty: function (propChange) {
    var fromStoreDef = this.store.get(propChange.model.id);
    dojo.when(fromStoreDef, dojo.hitch(this, function (fromStore) {
      if (fromStore[propChange.name] !== propChange.curr) {
        this.store.put(propChange.model.toObj());
      }
      this.onWidgetPropertyChange(propChange);
    }));
  },

  /**
   * Events
   */
  onAddWidget: function () {},
  onRemoveWidget: function () {},
  onWidgetPropertyChange: function () {},

  /**
   * @see http://dojotoolkit.org/reference-guide/dojo/store.html#id5
   */
  _storeChangeHandler: function (obj, removedFrom, insertedInto) {
    if (insertedInto === removedFrom) { this._updateWidgetFromStore(obj); }
    else if (insertedInto > -1) { this._addWidgetFromStore(obj); }
    else if (removedFrom > -1) { this._removeWidgetFromStore(obj); }
  },

  _updateWidgetFromStore: function (obj) {
    var widget = this.widgets.get(obj.id);
    for (var name in obj) {
      if (obj.hasOwnProperty(name)) {
        widget.updateProperty(name, obj[name]);
      }
    }
  },

  _addWidgetFromStore: function (obj) {
    if (!this.widgets.get(obj.id)) {
      this.addWidget(dj.widget.sitewidget.model.WidgetModel.createFromObject(obj));
    }
  },

  _removeWidgetFromStore: function (obj) {
    if (this.widgets.get(obj.id)) {
      this.removeWidget(obj.id);
    }
  }
});
dojo.provide("dj.widget.sitewidget.view.WidgetView");
dojo.require("dj.widget.sitewidget.view.mixin.WidgetBaseMixin");
dojo.require("dj.widget.sitewidget.view.mixin.WidgetDndMixin");
dojo.require("dj.widget.sitewidget.view.mixin.WidgetFragMixin");

dojo.declare('dj.widget.sitewidget.view.WidgetView', [
  dj.widget.sitewidget.view.mixin.WidgetBaseMixin,
  dj.widget.sitewidget.view.mixin.WidgetDndMixin,
  dj.widget.sitewidget.view.mixin.WidgetFragMixin
], {
  // mixins have the features
  render: function () {
    this.renderDomNode();
    this.renderContent(this._contentHandler, this);
    this.renderDnd();
  },

  _contentHandler: function () {
    //TODO: exec js
  }
});
dojo.provide("dj.widget.sitewidget.view.DashView");
dojo.require("dj.widget.sitewidget.view.WidgetView");
dojo.require("dj.widget.sitewidget.view.WidgetPopupOpenView");
dojo.require("dj.lang");

dojo.declare('dj.widget.sitewidget.view.DashView', [], {
  /**
   * Continuously incrementing zIndex of the widgetviews
   */
  zIndex: 1,

  /**
   * @constructor
   * @param {DashModel} dashModel
   */
  constructor: function (dashModel) {
    this.model = dashModel;
    this.domNode = dojo.byId('widgets');
    this.views = [];
    dojo.connect(this.model, 'onAddWidget', this, 'addWidgetView');
    dojo.connect(this.model, 'onRemoveWidget', this, 'removeWidgetView');
    dojo.connect(this.model, 'onWidgetPropertyChange', this, 'updateWidgetView');
    this.listenToArticles();
  },

  listenToArticles: function () {
    dj.lang.addLiveEvent('a', 'click', function (ev) {
      var currLocHref = dojo.doc.location.href;
      if (this.href && this.href !== '' &&
          this.href !== currLocHref &&
          this.href !== currLocHref+'#' &&
          this.href.indexOf("javascript") !==0) {
        dojo.stopEvent(ev);
        window.open(this.href, '_blank');
      }
    });
  },

  addWidgetView: function (widgetModel, config) {
    var view = null;
    if ('DASH' === widgetModel.state) {
      view = new dj.widget.sitewidget.view.WidgetView(widgetModel, this, config);
    } else if ('POPUP' === widgetModel.state) {
      view = new dj.widget.sitewidget.view.WidgetPopupOpenView(widgetModel, this, config);
    }
    this.views.push(view);
    view.render();
    if (view.domNode) {
      dojo.place(view.domNode, this.domNode);
    }
  },

  removeWidgetView: function (id) {
    var view = this._removeViewById(id);
    view.remove();
  },

  /**
   * @see WidgetModel.onPropertyChange
   */
  updateWidgetView: function (propChange) {
    if ('state' === propChange.name) {
      this.removeWidgetView(propChange.model.id);
      this.addWidgetView(propChange.model);
    }
  },

  //TODO: upgrade
  _listenToArticles: function () {
    var self = this;
    dj.lang.addLiveEvent('a', 'click', function (ev) {
      if (/article\/SB.*/.test(this.href)) {
        dojo.stopEvent(ev);
        var id = this.href.match(/article\/(.*)\./)[1];
        dojo.xhrGet({
          url: '/socsvco/articles/v1/Articles/'+id,
          handleAs: 'json',
          load: function (data) {
            //TODO: createwidget?
            var widget = self._createDomNode(id, data.headline, 100, 100);
            dojo.style(widget, {width: '600px', zIndex: self._zIndex++});
            dojo.addClass(widget, 'articleStory');
            var section = dojo.query('section', widget)[0];
            section.innerHTML = '<h1 class="article-headline">'+data.headline+'</h1>';
            section.innerHTML += data.html;
            dojo.place(widget, self.cfg.container);
            self.addDndToAll();
          }
        });
      }
    });
  },

  /**
   * @param {String} id
   * @return {WidgetView|null} null, if one isn't found
   */
  _getViewById: function (id) {
    var found = dojo.filter(this.views, function (v) {
      return id === v.model.id;
    });
    return (found.length > 0) ? found[0] : null;
  },

  /**
   * @param {String} id
   * @return {WidgetView|null} null, if one isn't found
   */
  _removeViewById: function (id) {
    var view = this._getViewById(id);
    this.views.splice(this.views.indexOf(view), 1);
    return view;
  }
});
dojo.provide("dj.module.sitewidget.dashboard");
dojo.require("dj.widget.sitewidget.model.DashModel");
dojo.require("dj.widget.sitewidget.view.DashView");
dojo.require("dj.store.Widget");

dj.module.sitewidget.dashboard = {
  init: function () {
    this.disableDocWrite();

    var version = (dojo.getObject("dj.context.sitewidgets.version") || "1"),
    widgetStorage = 'sitewidgets_v' + version,
      widgetStore = new dj.store.Widget({
        namespace: widgetStorage
      });

    this.model = new dj.widget.sitewidget.model.DashModel(widgetStore);
    this.view = new dj.widget.sitewidget.view.DashView(this.model);

    this.model.addStoredWidgets();
  },

  disableDocWrite: function () {
    // SAY "NO" TO DOC.WRITE!
    document.write = function (c) {
      dojo.create('div', {
        innerHTML: c
      }, dojo.body());
    };
  }
};
dojo.provide("dj.module.sitewidget.popoutWidgetize");
dojo.require("dj.util.User");
dojo.require("dojo.date");

dj.module.sitewidget.popoutWidgetize = {
  init: function (cfg) {
    var version = (dojo.getObject("dj.context.sitewidgets.version") || "1");
    this.storageName = 'sitewidgets_v' + version;
    this.config = dojo.mixin({
      showLaunchMsg: true, //permanent suppression
      migrateData: true,
      skipWgtStatus: false
    },cfg);
    this.launchWidgets();
  },

  connect: function (ev) {
    dojo.stopEvent(ev);
    var el = ev.target || ev.srcElement;
    var id = dojo.attr(el, "data-widget-id");
	this.setWgtStatus(id, "REOPEN"); 
	if(dojo.byId("popoutBox") && !dojo.hasClass(dojo.byId("popoutBox"), "hidden")) {
		this.closePopoutBox();
	}
    this.openWidget(el);
  },

  openWidget: function (el) {
    //this.view might be created, but if popup blocker is on, this.view.window
    //will be null/undefined and cause js error preventing even the manual launch of the widget
    if (this.view && !this.view.isPopupBlocked() && !this.view.window.closed) {
      this.view.window.focus();
    }
	
  var id = dojo.attr(el, "data-widget-id");
	var wgtStatus = this.getWgtStatus(id);
	
	if(this.config.skipWgtStatus || !wgtStatus || (wgtStatus && wgtStatus == "REOPEN")) {
		this.setWgtStatus(id, "OPEN");
	}
	else {
		return;
	}
	

    dojo.require("dj.module.sitewidget.dashboard");
    
    var title = dojo.attr(el, "data-widget-title"),
      width = dojo.attr(el, "data-widget-width"),
      height = dojo.attr(el, "data-widget-height"),
      name = dojo.attr(el, "data-widget-name");
	  
    if (id === null || title === null) {
      console.info("data-widget-id or data-widget-title attributes are not available" + el);
      return false;
    }

    var pStore = new dj.store.Preferences({
      isOnePerScreen: false
    });
    var self = this;
    if (pStore.isLocalCacheExpired()) {
      this.view = new dj.widget.sitewidget.view.WidgetPopupOpenView();
      this.view.popUpEmptyWindow();
    }

    this.store = new dj.store.Widget({
      namespace: this.storageName
    });

    var widgetDef = this.store.get(id);

    dojo.when(widgetDef, dojo.hitch(self, function (widget) {
      if (!widget) {
        widget = this.addWidget(id, title, width, height);
      }
      var model = new dj.widget.sitewidget.model.WidgetModel(widget.id, widget.title, {
        state: widget.state,
        position: widget.position
      });
      if (!this.view || (this.view.model && (this.view.model.id !== model.id))) {
        this.view = new dj.widget.sitewidget.view.WidgetPopupOpenView(model);
      } else {
        this.view.setModel(model);  
      }
      this.view.render();
    }));
  },

  addWidget: function (id, title, width, height) {
    var widget = {};
    widget.id = id;
    widget.title = title;
    widget.position = {
      x: 0,
      y: 60,
      w: (width === null) ? 300 : parseInt(width, 10),
      h: (height === null) ? 500 : parseInt(height, 10)
    };
    widget.state = 'POPUP';
    this.store.add(widget);
    return widget;
  },

  launchWidgets: function () {
    var that = this;
    dj.util.User.isLoggedIn(function (b) {
      if (b !== true) {
        return false;
      }
      dojo.require("dj.store.Preferences");
      var prefStore = new dj.store.Preferences({
        isOnePerScreen: false
      });
      prefStore.get("sitewidgets_auto", function (auto) {
        if (auto && auto === "POPUP") {
          dojo.query(".widgetPopout").forEach(function (selectTag) {
			if(!dojo.hasClass(selectTag, "noAutoLaunch")) {
				that.openWidget(selectTag);
			}
          });
        }
		else {
			if(that.config.showLaunchMsg) {
		      that._showLaunchMessage(prefStore, {migrated:false,stored:false});
		    }
		}
        dojo.query(".widgetPopout").forEach(function (tag) {
          dojo.connect(tag, "onclick", that, that.connect);
        });
		
		var oLogout = dojo.byId("logoutLink");
		if (oLogout !== null) {
			dojo.connect(dojo.byId("logoutLink"), "onclick", this, function(ev) {  
				that.view.remove();
			});
		}
      });
      
    });
  },
  closePopoutBox: function() {
  	var closeBtn = dojo.byId("closePopoutBox");
	if (dojo.isIE){
        closeBtn.fireEvent("onclick");
    }
    else{ 
        var event = document.createEvent("HTMLEvents");
        event.initEvent("click", false, true);
        closeBtn.dispatchEvent(event);
    }  
  },
  setWgtStatus: function(id, status) {
  	if (window.sessionStorage){
		sessionStorage.setItem("sitewidgets_status_"+id, status); 
	}else{
	  dj.util.Cookie.setGroupCookie("SITEWIDGET_STATUS","sitewidgets_status_"+id, status);
	}
  },
  getWgtStatus: function(id) {
  	if (window.sessionStorage){
		return sessionStorage.getItem("sitewidgets_status_"+id); 
	}else{
	  return dj.util.Cookie.getGroupCookie("SITEWIDGET_STATUS","sitewidgets_status_"+id);
	}
	return false;
  },
  _showLaunchMessage: function(prefStore, opt) {
    if(this.config.migrateData && !opt.migrated) {
      this._migrateData(prefStore, dojo.hitch(this, this._showLaunchMessage));
      return;
    }
    if(!opt.stored) {
      var that = this;
  	  var showMsg = true;
  	  var today = new Date();
      prefStore.get(this.storageName, function(val) {
        var obj = {};
        try {
          obj = (val && dojo.fromJson(val)) || {};
        } catch(e) {
          //if val is not in json format
        }
        if(obj.launchMsg && obj.launchMsg==="closed") {
    			var dtLastWeek = dojo.date.add(today, "week", -1);
    			if(obj.launchDt && new Date(obj.launchDt) > dtLastWeek) {
    				return;
    			}
        }

        obj.launchDt = today.toString();
        prefStore.put(that.storageName, dojo.toJson(obj));
	
        var popoutBox = dojo.byId("popoutBox");
        if(popoutBox){
          dojo.removeClass(popoutBox, "hidden");
          dojo.connect(dojo.byId("closePopoutBox"), "click", that, function(ev) {
            dojo.stopEvent(ev);
            dojo.addClass(popoutBox, "hidden");
            obj.launchMsg = "closed";
            prefStore.put(this.storageName, dojo.toJson(obj));
          });
        }
      });
    }
  },
  _migrateData: function(prefStore, cb) {
    var that = this;
    prefStore.get("launchMsg", function(val) {
      if(val && (val==="false" || val==="closed")) {
        prefStore.put(that.storageName, '{"launchMsg":"closed"}');
        prefStore.remove("launchMsg");
        cb(prefStore, {migrated:true,stored:true});
      }
      else {
        cb(prefStore, {migrated:true,stored:false});
      }
    });
  }
};
/*global console,dj,dojo,Error,TypeError,parseInt */
dojo.provide("dj.widget.autocomplete.AutoCompleteView");

dojo.require("dj.lang");
dojo.require("dj.widget.autocomplete.SuggestDisplayModel");
dojo.require("dj.widget.autocomplete.autoCompleteViewTemplate");


(dj.widget.autocomplete.AutoCompleteView = function(cfg, options, suggestDisplayModel) {
  this._cfg = dj.lang.cloneMixin(this.DEFAULT_CONFIG, cfg);
  this._options = dj.lang.cloneMixin(this.OPTIONS_CONFIG, options);
  this._suggestionsContainer = null;
  this._suggestionsContentNode = null;
  this._currentHighlightedItem = null;
  this._content = null;
  this._suggestionBlocks = [];
  this._suggestFooterNode = null;
  this._showAllSymbolsAnchorNode = null;
  this._categoryDisplayDataPointsIndex = [];
  if (typeof suggestDisplayModel === "undefined") {
    this._suggestDisplayModel = new dj.widget.autocomplete.SuggestDisplayModel();
  } else {
    this._suggestDisplayModel = suggestDisplayModel;
  }
}).prototype = {
  DEFAULT_CONFIG : {},
  OPTIONS_CONFIG : {},
  setViewContainer : function(suggestionsContainer) {
    this._suggestionsContainer = suggestionsContainer;
  },
  getViewContainer : function() {
    return this._suggestionsContainer;
  },
  fetchViewTemplate : function() {
    var that = this;
    dj.widget.autocomplete.autoCompleteViewTemplate.getTemplate(function(response) {
      that.handleViewTemplateLoad(response);
    });
  },
  handleViewTemplateLoad : function(response) {
    var autoCompleteContent = dojo.query("div.yui-ac-content", this.getViewContainer())[0];
    autoCompleteContent.innerHTML = response;
    this._buildCategoryDisplay();
    this.indexDataPoints();
  },
  highlightSuggestion : function(suggestionElement) {
    if (this._currentHighlightedItem !== null) {
      dojo.removeClass(this._currentHighlightedItem, "yui-ac-highlight");
    }
    this._currentHighlightedItem = suggestionElement;
    dojo.addClass(suggestionElement, "yui-ac-highlight");
  },
  highlightSuggestionAt : function(categoryIndex, categoryLineItemIndex) {
    //todo : validate indices
    var lineItemElement = this._categoryDisplayDataPointsIndex[categoryIndex].listNodes[categoryLineItemIndex];
    this.highlightSuggestion(lineItemElement);
  },
  _buildCategoryDisplay : function() {
    var ctgCount = this._suggestDisplayModel.getNumberOfCategories();
    var suggestionBlockContainer = dojo.query("div.suggestionblockcontainer", this.getViewContainer())[0];
    for ( var ctgIndex = 0; ctgIndex < ctgCount; ctgIndex++) {
      var noOfColumnsInCategoryDisplay = this._suggestDisplayModel.getNumberOfColumnsInCategory(ctgIndex);
      var templateNode = null;
      if (noOfColumnsInCategoryDisplay === 2) {
        templateNode = dojo.query("div[class~='suggestionblock'][templateType='C2']", this.getViewContainer())[0];
      } else if (noOfColumnsInCategoryDisplay === 1) {
        templateNode = dojo.query("div[class~='suggestionblock'][templateType='C1']", this.getViewContainer())[0];
      } else {
        throw new Error("View not supported for more than 2 columns");
      }
      var templateInstance = templateNode.cloneNode(true);
      //build line items
      var maxNoOfSuggestionsToDisplay = this._suggestDisplayModel.getMaxNoOfSuggestionsToDisplay(ctgIndex);
      var lineItemTemplate = dojo.query("li", templateInstance)[0];
      lineItemTemplate.setAttribute("categoryIndex", ctgIndex);
      lineItemTemplate.setAttribute("categoryItemIndex", 0);
      var lineItemContainer = dojo.query("ul", templateInstance)[0];
      for ( var lineItemCount = 1; lineItemCount < maxNoOfSuggestionsToDisplay; lineItemCount++) {
        //adding one less, there's always one
        var lineItemClone = lineItemTemplate.cloneNode(true);
        lineItemClone.setAttribute("categoryItemIndex", lineItemCount);
        lineItemContainer.appendChild(lineItemClone);
      }
      templateInstance.removeAttribute("templateType");
      dojo.addClass(templateInstance, "concrete");
      templateInstance.setAttribute("categoryIndex", ctgIndex);
      var subHeadingNode = dojo.query("div.subHeading1", templateInstance)[0];
      if (noOfColumnsInCategoryDisplay === 2) {
        var subHeading2Node = dojo.query("div.subHeading2", templateInstance)[0];
        subHeading2Node.setAttribute("categoryIndex", ctgIndex);
        subHeading2Node.innerHTML = this._suggestDisplayModel.getCategorySubHeading2(ctgIndex);
        if (this._suggestDisplayModel.isCategorySubHeading2Visible(ctgIndex)) {
          dojo.removeClass(subHeading2Node, "hidden");
        }
      }
      subHeadingNode.innerHTML = this._suggestDisplayModel.getCategorySubHeading1(ctgIndex);
      if (this._suggestDisplayModel.isCategorySubHeading1Visible(ctgIndex)) {
        dojo.removeClass(subHeadingNode, "hidden");
      }
      suggestionBlockContainer.appendChild(templateInstance);
    }
    var headerBlock = dojo.query("div.yui-ac-hd", this.getViewContainer())[0];
    if (this._suggestDisplayModel.isHeaderVisible()) {
      dojo.removeClass(headerBlock, "hidden");
    }
    var footerBlock = dojo.query("div.yui-ac-ft", this.getViewContainer())[0];
    if (this._suggestDisplayModel.isFooterVisible()) {
      dojo.removeClass(footerBlock, "hidden");
      var footerNode = dojo.query("div.footer", footerBlock)[0];
      footerNode.innerHTML = this._suggestDisplayModel.getFooterText();
    }
  },
  indexDataPoints : function() {
    this._content = dojo.query("div[class~='yui-ac-content']", this.getViewContainer())[0];
    this._suggestionBlocks = dojo.query("div.suggestionblock.concrete", this.getViewContainer());
    var ctgCount = this._suggestDisplayModel.getNumberOfCategories();
    /*
     * ASSUMPTION: dojo.query() fetches the suggestionblocks in the order in which they are in dom tree, which is the
     * order in which they were added
     */
    for ( var ctgIndex = 0; ctgIndex < ctgCount; ctgIndex++) {
      var noOfColumnsInCategoryDisplay = this._suggestDisplayModel.getNumberOfColumnsInCategory(ctgIndex);

      var listNodes = dojo.query("li", this._suggestionBlocks[ctgIndex]);
      var col1Nodes = null;
      if (noOfColumnsInCategoryDisplay === 1) {
        col1Nodes = dojo.query("span.keywordResult", this._suggestionBlocks[ctgIndex]);
        this._categoryDisplayDataPointsIndex.push( {
          "listNodes" : listNodes,
          "col1Nodes" : col1Nodes
        });
      } else if (noOfColumnsInCategoryDisplay === 2) {
        col1Nodes = dojo.query("td.symbolCompleteCol1", this._suggestionBlocks[ctgIndex]);
        var col2Nodes = dojo.query("td.symbolCompleteCol2", this._suggestionBlocks[ctgIndex]);
        var subHeading2Node = dojo.query("div.subHeading2", this._suggestionBlocks[ctgIndex])[0];
        this._categoryDisplayDataPointsIndex.push( {
          "listNodes" : listNodes,
          "col1Nodes" : col1Nodes,
          "col2Nodes" : col2Nodes,
          "subHeading2" : subHeading2Node
        });
      } else {
        throw new Error("Data point indexing supported for 1 and 2 columns only");
      }
    }

    this._suggestFooterNode = dojo.query("div.footer", this.getViewContainer())[0];

  },
  populateCategoryDisplayMetaData : function(ctgIndex, suggestionContext, suggestionObjArray) {
    var noOfColumnsInCategoryDisplay = this._suggestDisplayModel.getNumberOfColumnsInCategory(ctgIndex);
    if (noOfColumnsInCategoryDisplay === 2) {
      //todo hardcoded, take a functoid from client to do this, could be part of SuggestCategoryDisplayModel
      this._categoryDisplayDataPointsIndex[ctgIndex].subHeading2.innerHTML = this._getCategorySubHeading2(ctgIndex,
          suggestionContext, suggestionObjArray);
    }
  },
  populateCategoryData : function(suggestionContext, categoryDataArray, categoryIndex) {
    var noOfColumnsInCategoryDisplay = this._suggestDisplayModel.getNumberOfColumnsInCategory(categoryIndex);
    this.populateCategoryDisplayMetaData(categoryIndex, suggestionContext, categoryDataArray);
    if (noOfColumnsInCategoryDisplay === 1) {
      this.populateSingleColumnSuggestions(categoryIndex, suggestionContext, categoryDataArray);
    } else if (noOfColumnsInCategoryDisplay === 2) {
      this.populateTwoColumnSuggestions(categoryIndex, suggestionContext, categoryDataArray);
    } else {
      throw new Error("View is not supported for more than 2 columns");
    }
  },
  populateTwoColumnSuggestions : function(ctgIndex, suggestionContext, suggestionsObjArray) {
    var maxNoOfSuggestionsToDisplay = this._suggestDisplayModel.getMaxNoOfSuggestionsToDisplay(ctgIndex);
    var column1Accessor = this._suggestDisplayModel.getCategoryColumnValueAccessor(ctgIndex, 0);
    var column2Accessor = this._suggestDisplayModel.getCategoryColumnValueAccessor(ctgIndex, 1);
    if (suggestionsObjArray.length === 0) {
      dojo.addClass(this._suggestionBlocks[ctgIndex], "hidden");
      return;
    } else {
      dojo.removeClass(this._suggestionBlocks[ctgIndex], "hidden");
    }
    for ( var count = 0; count < maxNoOfSuggestionsToDisplay; count++) {
      var suggest = suggestionsObjArray[count];
      if (typeof suggest == "undefined") {
        dojo.addClass(this._categoryDisplayDataPointsIndex[ctgIndex].listNodes[count], "hidden");
      } else {
        dojo.removeClass(this._categoryDisplayDataPointsIndex[ctgIndex].listNodes[count], "hidden");
        var firstColValue = suggest[column1Accessor];
        if (typeof firstColValue == "undefined") {
          firstColValue = "-";
        } /* to do: externalize this so that custom defaults can be used */
        this._categoryDisplayDataPointsIndex[ctgIndex].col1Nodes[count].innerHTML = this._getHighlightedSearchTerm(
            firstColValue, suggestionContext);
        this._categoryDisplayDataPointsIndex[ctgIndex].col2Nodes[count].innerHTML = this._getHighlightedSearchTerm(
            suggest[column2Accessor], suggestionContext);
      }
    }
  },
  _getHighlightedSearchTerm : function(value, suggestionContext) {
    var searchText = suggestionContext.searchText;
    var valueString = "" + value;
    var regex = new RegExp("(" + searchText + ")", "i");
    return valueString.replace(regex, "<span class=\"scResultTerm\">$1</span>");
  },
  populateSingleColumnSuggestions : function(ctgIndex, suggestionContext, suggestionsObjArray) {
    var maxNoOfSuggestionsToDisplay = this._suggestDisplayModel.getMaxNoOfSuggestionsToDisplay(ctgIndex);
    var column1Accessor = this._suggestDisplayModel.getCategoryColumnValueAccessor(ctgIndex, 0);
    if (suggestionsObjArray.length === 0) {
      dojo.addClass(this._suggestionBlocks[ctgIndex], "hidden");
      return;
    } else {
      dojo.removeClass(this._suggestionBlocks[ctgIndex], "hidden");
    }
    for ( var count = 0; count < maxNoOfSuggestionsToDisplay; count++) {
      var suggest = suggestionsObjArray[count];
      if (typeof suggest == "undefined") {
        dojo.addClass(this._categoryDisplayDataPointsIndex[ctgIndex].listNodes[count], "hidden");
      } else {
        dojo.removeClass(this._categoryDisplayDataPointsIndex[ctgIndex].listNodes[count], "hidden");
        this._categoryDisplayDataPointsIndex[ctgIndex].col1Nodes[count].innerHTML = this._getHighlightedSearchTerm(
            suggest[column1Accessor], suggestionContext);
      }
    }
  },
  _getCategorySubHeading2 : function(ctgIndex, suggestionContext, suggestionObjArray) {
    return this._suggestDisplayModel.getCategorySubHeading2(ctgIndex) + "\"" + suggestionContext.searchText + "\"";
  },
  show : function() {
    dojo.removeClass(this.getViewContainer(), "hidden");
  },
  hide : function() {
    dojo.addClass(this.getViewContainer(), "hidden");
  },
  isHidden:function(){
    return dojo.hasClass(this.getViewContainer(), "hidden");
  },
  clearSelection : function() {
    if (this._currentHighlightedItem !== null) {
      dojo.removeClass(this._currentHighlightedItem, "yui-ac-highlight");
      this._currentHighlightedItem = null;
    }
  },
  detach : function(){
    var autoCompleteContent = dojo.query("div.yui-ac-content", this.getViewContainer())[0];
    this._suggestionsContentNode = dojo.query("div:first-child",autoCompleteContent).orphan()[0];
  },
  attach : function(){
    var autoCompleteContent = dojo.query("div.yui-ac-content", this.getViewContainer())[0];
    autoCompleteContent.appendChild( this._suggestionsContentNode);
  }
};
dojo.provide("dj.widget.networkHat.AutoComplete");

dojo.require("dj.widget.networkHat.infocomplete");
dojo.require("dj.lang");

dojo.getObject("dj.context.networkHat", true);

/* global dj, dojo */

/*
 * networkHat object...loads scripts needed for autocomplete only when user interacts with the search box. Traps
 * mouseover and focus events, and then loads and initializes the infocomplete for the
 */

(function() {

  var _dwn = dj.widget.networkHat;  

  (_dwn.AutoComplete = function() {

    this.d = document;
    this.cdnDomain = dj.context.core.cdnPrefix;

    this.uP = "";
    if (typeof uP != 'undefined') {
      this.uP = uP;
    }

    var dt = new Date();
    var dtStamp = "" + dt.getFullYear() + dt.getMonth() + dt.getDay();

    if (this.d.location.host.indexOf('s.dev') != -1 || this.d.location.host.indexOf('idev') != -1) {
      //  A hack until cdnDomain for SAT/IDEV actually wil serve up /djscript URLs
      this.jScript = this.uP + "/djscript/j_networkHat-" + dtStamp + ".js";
    } else {
      this.jScript = this.cdnDomain + "/djscript/j_networkHat-" + dtStamp + ".js";
    }

    // Set the required globals
    var fw = this.d.getElementsByTagName("div")[0];
    var loggedIn = (fw.className.indexOf("subType-subscribed") !== -1);

    //loggedIn = (typeof loggedIn !== "undefined") ? loggedIn : false;
    var searchBoxID = 'hat_input_auto';
    this.inputDefaultText="News, Quotes, Companies, Videos";
    if(dj.autocompletesearch!==undefined && dj.autocompletesearch.inputDefaultText!==undefined){
      this.inputDefaultText=dj.autocompletesearch.inputDefaultText;
    }
    

//  this.inputDefaultText = "";

    // Retrieve the needed dom-elements
    var oHat = dojo.byId("hat_div");
    this.oHatInput = dojo.byId("hat_input_auto");
    var oHatSelect = dojo.query(".hat_select", oHat);
    
    // Set default style
    if (dojo.isIE && (this.d.domain.indexOf('ds.sat.wsj.com') != -1 || this.d.domain.indexOf('ds.wsj.com') != -1)) {
      dj.util.Url.addStylesheet("http://s.wsj.net/css/hatIEPortfolio.css");
    }
    
    this.onfocusLoad = dojo.connect(this.oHatInput, "onfocus", this, this.onHatLoad);
    this.onmouseoverLoad = dojo.connect(this.oHatInput, "onmouseover", this, this.onHatLoad);
    this.onclickClear = dojo.connect(this.oHatInput, "onclick", this, this.clearField);
    this.onkeydownClear = dojo.connect(this.oHatInput, "onkeydown", this, this.clearField);

    if (this.oHatInput.value !== "" && this.oHatInput.value != this.inputDefaultText || 
        dj.context.networkHat.jnetworkHatJsLoaded) {
      //if text already in field, initialize hat.  User got focus or clicked before the hanlder was attached
      this.onHatLoad();
    }
    this.setFieldDefault();

  }).prototype = {
    setFieldDefault: function() {
      /* Add "prompt" text to oHatInput if it's blank, if user has not typed */
      if (this.oHatInput.value === "") {
       this.oHatInput.value=this.inputDefaultText;
      dojo.addClass(this.oHatInput, "unUsed");
    }

  },

  clearField: function() {
    this.stopObservingClick();
    var unUsed = dojo.hasClass(this.oHatInput, "unUsed");
    if (unUsed) {
      this.oHatInput.value = "";
    }
    dojo.removeClass(this.oHatInput, "unUsed");
  },
  stopObservingClick: function() {
    // use dojo.disconnect?
    dojo.disconnect(this.onclickClear);
    dojo.disconnect(this.onkeydownClear);
  },
  onHatLoad: function() {

    dojo.disconnect(this.onfocusLoad);
    dojo.disconnect(this.onmouseoverLoad);

    // if j_networkHat.js already loaded, skip to init
    if (dj.context.networkHat.jnetworkHatJsLoaded) {
      this.initInfoComplete();
      return;
    }

    //load j_networkhat.js
    var hds = this.d.getElementsByTagName('head');
    var hd;
    if (!hds) {
      hd = new Element('head');
      this.d.getElementsByTagName('body')[0].appendChild(hd);
    } else {
      hd = hds[0];
    }
    this.jsNode = this.loadAutoCompleteScript(this.jScript);

  },
  loadAutoCompleteScript: function(jScript) {
    var jsNode = this.d.createElement("script");
    jsNode.type = "text/javascript";
    jsNode.src = jScript;

    if (this.d.getElementsByTagName("head").length === 0) {
      var headNode = this.d.createElement("head");
      this.d.getElementsByTagName("html")[0].appendChild(headNode);
    }

    this.d.getElementsByTagName("head")[0].appendChild(jsNode);
    return jsNode;
  },
  initInfoComplete: function() {

    // Set default style
    if (dojo.isIE && (this.d.domain.indexOf('ds.sat.wsj.com') != -1 || this.d.domain.indexOf('ds.wsj.com') != -1)) {
      dj.util.Url.addStylesheet("http://s.wsj.net/css/hatIEPortfolio.css");
    }

    if(typeof dj.header != "undefined"  && typeof dj.header.autocomplete != "undefined" && dj.header.autocomplete == "NEW"){
      initInfoCompleteNew();
    }else{
      initInfoComplete();
    }
    this.stopObservingClick();

    // Set-up event listeners
    dojo.connect(this.oHatInput, "onfocus", null, function(ev) {

      this.style.backgroundImage = "url('http://s.wsj.net/img/b.gif')";

      searchFieldOnFocus(this);
      setFocused(this);
    });

    dojo.connect(this.oHatInput, "onkeypress", null, function() {
      showHideCRDrpdwn('hide');
    });
    dojo.connect(this.oHatInput, "onblur", null, function() {
      showHideCRDrpdwn('show');
    });

    var textValue = this.oHatInput.value;
    if(InfoComplete.autoComplete.dataSources && InfoComplete.autoComplete.dataSources.length >=2 ){
      InfoComplete.autoComplete.dataSources[1].scriptQueryParam = 'query';
    }
    if (textValue && textValue != this.inputDefaultText) {      
      InfoComplete.autoComplete.sendQuery(textValue);
    }
  }
  };

}());

dojo.provide("dj.module.olympics.articleTools");dojo.require("dj.util.Article");dojo.require("clickability.w-button");dojo.getObject("dj.module.articleTools",true);dojo.declare("dj.module.articleTools",null,{});dojo.declare("dj.module.articleTools.Button",null,{constructor:function(I,H,L){this.id=I;this.clickHandler=H;if(H){this.clickHandler=dojo.hitch(this,this.clickHandler);}
this.isLink=L;return this;},init:function(){if(this.isLink){this.clickHandler();}
else{var oId=dojo.byId(this.id);if(oId&&this.clickHandler){var emailWidgetData={},emailWidgetDataStr='';var x=dj.util.Article.getParentByNodeName(oId,'li');if(x){emailWidgetDataStr=dojo.attr(x,'data-dj-email-widget');try{emailWidgetData=JSON.parse(emailWidgetDataStr);}catch(e){emailWidgetData={};}
if(emailWidgetData.articleUrl){AT_VARS.articleEmailUrl=emailWidgetData.articleUrl;AT_VARS.articleUrl=emailWidgetData.articleUrl;}
if(emailWidgetData.articleTitle){AT_VARS.clickTitle='WSJ.com - '+emailWidgetData.articleTitle;}}
dojo.connect(oId,"onclick",this,this.clickHandler);}}
dojo.connect(document,"onclick",this,function(e){this.handleDocClick(e);});return this;},handleDocClick:function(e){var x=dj.util.Article.getParentByNodeName(e.target,'a');if(x.id==this.id&&!this.isLink){dojo.stopEvent(e);}}});AT_VARS={clickTitle:"",articleUrl:"",articleEmailUrl:""};dojo.provide("dj.module.header2012.autocomplete");

dj.module.header2012.autocomplete = {
  searchExec : function(){
    
    
    var cfgObj = {          
        autocompleteSuggestProvider : 'MWatchWSJHatSearchProvider', 
        autocompleteInputField : 'globalHeaderSearchInput'
    
    };
    var autoCompleteViewCfg = {
      "categoryTypeArr" : ["FEATURES","COMPANIES","PRIVATE_COMPANIES","TOPICS","KEYWORDS"],
      "CategoryDisplayConfigs": [
        {
          "subHeading1": "",
          "subHeading2": "",
          "noOfColumns": 1,
          "columnToObjMap": ["term","url"],
          "subHeading1DisplayFlag": false,
          "name": "suggestedTerms",
          "maxNoOfSuggestionsToDisplay" : 3,
          "subHeading1Class":"",
          "noOfColumnsToObjMap": 2
        },{
          "subHeading1": "COMPANIES & QUOTES",
          "subHeading2": "See all symbol results for ",
          "noOfColumns": 6,
          "columnToObjMap": ["ticker","company","country","exchange","exchangeIsoCode","type"],
          "subHeading1DisplayFlag": true,
          "subHeading2DisplayFlag": false,
          "name": "companies",
          "maxNoOfSuggestionsToDisplay" : 5,
          "subHeading1Class":"hdrSearchListComp",
          "noOfColumnsToObjMap": 6
        },{ 
          "subHeading1": "Private Companies", 
          "subHeading2": "",
          "noOfColumns": 1,
          "columnToObjMap": ["name"],
          "subHeading1DisplayFlag":true,
          "name": "privateCompanies",
          "maxNoOfSuggestionsToDisplay" : 5,
          "subHeading1Class":"hdrSearchListComp hdrSearchListCompPrivate",
          "noOfColumnsToObjMap": 1 
        },{
          "subHeading1": "Topics and People In The News",
          "subHeading2": "",      
          "noOfColumns": 1,
          "columnToObjMap": ["name","code","type"],
          "subHeading1DisplayFlag":true,
          "name": "topics",
          "maxNoOfSuggestionsToDisplay" : 5,
          "subHeading1Class":"hdrSearchListTopicPpl",
          "noOfColumnsToObjMap": 3
        },{
          "subHeading1": "Recent Searches",
          "subHeading2": "",
          "noOfColumns": 1,
          "columnToObjMap": ["keyword"],
          "subHeading1DisplayFlag": true,
          "name": "keywords",
          "maxNoOfSuggestionsToDisplay" : 3,
          "subHeading1Class":"hdrSearchListRecent",
          "noOfColumnsToObjMap": 1
        }
      ]
    };   
   
    var autoComplete = new dj.module.ep.globalheader.wsjAutocomplete(cfgObj.autocompleteInputField, { suggestProvider : cfgObj.autocompleteSuggestProvider, companyResearchBaseUrl : dj.context.core.quotesUrlPrefix }, autoCompleteViewCfg);
    
    
  }
};
/*global document, dj, dojo, dojox, dijit, window, console, unescape, escape*/

dojo.provide("dj.module.header2012.editionSwitcher");

/* Documentation Describing code
 * Make sure this always passes jsHint!
 * Call edition switcher with param override like this:
 * dj.module.initionSwitcher.init({"initial":"and not useful"})
 */

(function() {
  dj.module.header2012.editionSwitcher = {
    init: function(cfg) {

      var defaultConfig = {
        editionTriggerId : "editionPopTrigger",
        editionDDId      : "editionDDTrigger",
        regionCodeToEdition :
            { "na,us"      : "usEdition", 
              "asia"       : "AsiaEdition", 
              "asia,indo"  : "indonesiaEdition", 
              "asia,cn"    : "simChiEdition",
              // "asia,cn"    : "tradChiEdition",  // TODO: fix datamodel issue here
              "asia,kr"    : "koreaEdition",
              "asia,india" : "indiaEdition",
              "asia,jp" : "jpnEdition",
              "europe"     : "europeEdition",
              "europe,tr"  : "turkeyEdition",
              "germany"  : "germanyEdition",
              "na,lat"     : "latinEdition",
              "na,br"      : "brasilEdition"
            }
      };

      this.dropdownCollapsed = true;
      dojo.mixin(defaultConfig, cfg);
      this.config = defaultConfig;
      this._load();
    },

    _load: function() {
      var ddTrigger   = dojo.byId(this.config.editionTriggerId),
          ddContainer = dojo.byId(this.config.editionDDId);

      this.addClickEvents(ddTrigger, ddContainer);
      this.highlightEditionName();
    },

    /**
     * Retrieves weather XHTML for ajax requests
     *
     * @param {String}
     *          aParam, an important param
     */
    addClickEvents: function(ddTrigger, ddContainer) {
      var self = this;

      // hides/shows region dropdown
      dojo.connect(ddTrigger, "click", this, function(ev) {
        dojo.stopEvent(ev);

        if (dojo.hasClass(ddContainer, "popOpen")) {
          dojo.removeClass(ddContainer, "popOpen");
          dojo.addClass(ddContainer, "popClosed");
          self.dropdownCollapsed = true;
        } else {
          dojo.addClass(ddContainer, "popOpen");
          dojo.removeClass(ddContainer, "popClosed");
          self.dropdownCollapsed = false;
        }
      });

      // close the dropdown when a click happens outside of it
      dojo.connect(document, "onclick", function(event) {
        if (self.dropdownCollapsed === false) {
          var isClickInContainer = dj.util.Element.contains(ddContainer, event.clientX, event.clientY);

          if (isClickInContainer === false) {
            dojo.removeClass(ddContainer, "popOpen");
            dojo.addClass(ddContainer, "popClosed");
            self.dropdownCollapsed = true;
          }
        }
      });
    },

    highlightEditionName: function() {
      var region        = dj.util.Region.getViewByRegion(),
          mappedRegion  = "#" + this.config.regionCodeToEdition[region] + " a",
          regionEl      = dojo.query(mappedRegion)[0];
      dojo.addClass(regionEl, "selected");
    }
  };
}());
/*global document, dj, dojo, dojox, dijit, window, console, unescape, escape*/

dojo.provide("dj.module.header2012.messageCenter");

/* Documentation Describing code
 * Passes jsHint!
 * Call edition switcher with param override like this:
 */

(function () {
  dj.module.header2012.messageCenter = {
    init: function (cfg) {
      var defaultConfig = {
        messageSvcUrl : "/community/integration/userinfo.html"
      };

      dojo.mixin(defaultConfig, cfg);
      this.config = defaultConfig;
      this._load();
    },

    _load: function () {
      var count = dj.util.Cookie.getCookie("msgCount");

      if (count=== null) {
        this.getMessages(this.config.messageSvcUrl, "processMessages");
      } else {
        this.displayMessageCount(count);
      }
    },

    processMessages: function (messages) {
      var count = messages.MessagesCount;

      this.setMessageCookie("msgCount", count);
      this.displayMessageCount(count);
    },

    getMessages: function (url, functionName) {
      var self = this;

      return dojo.xhrGet({
        url      : self.config.messageSvcUrl,
        handleAs : "json",
        load     : function (response, ioArgs) {
                     self.processMessages(response);
        },
        error    : function (response, ioArgs) {
          console.error("HTTP status code: ", ioArgs.xhr.status);
          return response;
        }
      });
    },

    setMessageCookie: function (key, value) {
      dj.util.Cookie.setCookie(key, value, (5 / 24 / 60));
    },

    displayMessageCount: function (count) {
      if (count > 0) {
        var messages = dojo.byId("messageCount");
        dojo.removeClass(dojo.byId("showMessages"), "hidden");
        messages.innerHTML = "(" + count + ")";
      }
    }
  };
}());
/*global document, dj, dojo, FB, console */

dojo.provide("dj.module.header2012.userDetails");
dojo.require("dj.module.facebook.connect");

/*
 * Enables login info in Header
 * Make sure this always passes jsHint!
 */

(function() {
  dj.module.header2012.userDetails = {
    init: function(cfg) {

      var defaultConfig = {
        loginDetailsTriggerId   : "userName",
        loginDetailsContainerId : "loginDetailsDDContainer",
        myJournalTriggerId      : "myJournalTrigger",
        myJournalContainerId    : "myJournalContainer",
        avatarId                : "communityAvatar",
        avatarUrl               : "http://cs.wsj.net/community/content/images/misc/members/defaultuser.50x50.png",
        enableFacebookConnect   : true,
        fbConnectAsId           : "facebookConnectedAs",
        fbConnectAsPopup        : "facebookConnectPopup",
        custChatUrl				: dj.context.core.custChatUrl?dj.context.core.custChatUrl:"https://customercenter.wsj.com/livechat/chat?product=WSJ"
      };

      this.loginDropdownCollapsed     = true;
      this.myjournalDropdownCollapsed = true;

      dojo.mixin(defaultConfig, cfg);
      this.config = defaultConfig;
      var self = this;

      // only load user info if logged in
      dj.util.User.isLoggedIn(function (isLoggedIn) {
        if (isLoggedIn) {
          self._load();
        }
      });
      this.showChatWin();//This is outside logged in so as to initialize the chat popup for us footer
    },

    /**
     * Initial lookups and basic logic goes here
     */
    _load: function() {
      var loginDetailsTrigger   = dojo.byId(this.config.loginDetailsTriggerId),
          loginDetailsContainer = dojo.byId(this.config.loginDetailsContainerId),
          myJournalTrigger      = dojo.byId(this.config.myJournalTriggerId),
          myJournalContainer    = dojo.byId(this.config.myJournalContainerId);

      this.addClickEvents(loginDetailsTrigger, loginDetailsContainer, this.loginDropdownCollapsed);
      this.addClickEvents(myJournalTrigger, myJournalContainer, this.myjournalDropdownCollapsed);

      this.showUserName();
    },

    /**
     * Retrieves weather XHTML for ajax requests
     *
     */
    addClickEvents: function(ddTrigger, ddContainer, collapsed) {
      var self = this;

      dojo.connect(ddTrigger, "click", this, function(ev) {
        dojo.stopEvent(ev);

        if (dojo.hasClass(ddContainer, "popOpen")) {
          dojo.removeClass(ddContainer, "popOpen");
          dojo.addClass(ddContainer, "popClosed");
          collapsed = true;
        } else {
          dojo.addClass(ddContainer, "popOpen");
          dojo.removeClass(ddContainer, "popClosed");
          collapsed = false;

          self.setCommunityAvatar();  // lazyload community avatar

          if (self.config.enableFacebookConnect) {
            self.getFacebookStatus();
          }
        }
      });

      // close the dropdown when a click happens outside of it
      dojo.connect(document, "onclick", function(event) {
        if (collapsed === false) {
          var isClickInContainer = dj.util.Element.contains(ddContainer, event.clientX, event.clientY);

          if (isClickInContainer === false) {
            dojo.removeClass(ddContainer, "popOpen");
            dojo.addClass(ddContainer, "popClosed");
            self.collapsed = true;
          }
        }
      });
    },

    setCommunityAvatar: function() {
      var el = dojo.byId(this.config.avatarId);

      if (el.src.length > 0) {
        el.src = this.config.avatarUrl;
      }
    },

    getFacebookStatus: function () {
      if (FB.getUserID() === 0) {
        this.loginFacebookConnect();
      } else {
        this.showFacebookConnectedAs();
      }
    },

    loginFacebookConnect: function () {
      var el = dojo.byId(this.config.fbConnectAsPopup);
      dojo.removeClass(el, "hidden");

      dojo.connect(el, "onclick", function() {
        var self = this;

        FB.login(function(response) {
          if (response.authResponse) {
            dojo.addClass(el, "hidden");
            self.showFaceBookConnectedAs();
          } else {
            console.log('User login not completed.');
          }
        });
      });
    },

    showFacebookConnectedAs: function () {
      var el = dojo.byId(this.config.fbConnectAsId);
      dojo.removeClass(el, "hidden");

      FB.api('/me', function(response) {
        el.innerHTML = "<small>Connected as</small>" + response.name;
      });
    },

    showUserName: function () {
      dojo.removeClass(dojo.query(".uNav")[0], "hidden");
      dj.util.User.renderCallsign("userName");
      dojo.place("<span class='sym'></span>", dojo.byId("userName"));
    },
    
    showChatWin: function(){
    	var self = this;
    	self.custChatWin=null;
    	dojo.forEach(
    	  dojo.query("a.custChatLink"),
    	  function(tag) {
	    	    dojo.connect(tag,"click", this, function(ev){
	    	    	dojo.stopEvent(ev);
		    	    if(self.custChatWin==undefined||self.custChatWin==null||self.custChatWin.closed){
		    	    	self.custChatWin=window.open(self.config.custChatUrl, "DowJones_Live_Chat","width=510,height=420,location=no,menubar=no,status=no,toolbar=no,scrollbars=no,resizable=no");
		    	    }else{
		    	    	self.custChatWin.focus();
		    	    }
	    	   });
    	  }
    	);
    }
    
  };
}());
/*global document, dj, dojo, dojox, dijit, window, console, unescape, escape*/

dojo.provide("dj.module.header2012.sectionMenu");
dojo.require("dj.widget.panel.LiveModalPanel");
dojo.require("dj.util.Element");
dojo.require("dj.lang");
dojo.require("dj.widget.panel.SelectDropdownPanel");

(function () {
  dj.module.header2012.sectionMenu = {
    init: function () {
      var isInitDone = false;
      this.delayedMouseOver("._exp", function (el) {
        if (!isInitDone) {
          this.initializeHeaderPanels();
          this.setEvents();
          isInitDone = true;
        }
        this.initShowData(el);
      }, 250);

      this.fadeInArrows();
    },

    /**
     * Initialize Panels object for menu dropdown
     *
     */
    initializeHeaderPanels: function () {
      var headerMenu = new dj.widget.panel.LiveModalPanel(
      {
        container : ".linklist_dropdown .wsjmn_dropdown_container",
        containerInd : ".linklist_dropdown .wsjmn_dropdown_container .mnExpand",
        dropdownContent : ".wsjmn_dropdownContent",
        actionEvent : "click",
        stateContainer : ".wsjmn_dropdownTree",
        stateCollapsed : "wsjmn_ddState-collapsed",
        stateExpanded : "wsjmn_ddState-expanded",
        navContainer : ".pmMainNav",
        stateHover : "mndd_ddState-hover",
        queryUpClass : "wsjmn_dropdownTree",
        addMouseEvents : false
      });
    },

    initShowData: function (el) {
      var svcUrl = this.getDropdownIndex(el);
      var ddi = dj.util.Element.getDataset(el).dropdownindex;
      var ddiEl = dojo.byId(ddi+"_content");

      this.showData(svcUrl, ddiEl, el);
    },

    showData: function (svcUrl, ddiEl, dataEl) {
      var that = this;
      var initDelay = false;

      initDelay = setTimeout(function () {
        // multiple requests aren't initiated by the click and mouseover events
        if ((dojo.hasClassName(dataEl, "_data") === false)) {
          dojo.addClass(dataEl, '_data');
          that.getHTML(svcUrl, ddiEl, dataEl);  // replaces spinner html with menu content
        }
      });
    },

    getDropdownIndex: function (el) {
      var sEl = dj.util.Element.getDataset(el);
      var svcEl = dj.util.Element.getDataset(dojo.byId(sEl.dropdownindex));
      return svcEl.panelServiceUri;
    },

    setIframeShimHeights: function (el) {
      var elData = dj.util.Element.getDataset(el).dropdownindex;
      var elNum = elData.match(/(\d.*)/)[0];
      var iFrameId = "wsjmn_dropdown_iframe"+elNum;
      var dropdownId = "wsjmn_dropdown"+elNum+"_content";
      var content = dojo.byId(dropdownId);
      var iFrameEl = dojo.byId(iFrameId);

      for (var i=0;i<=content.length - 1;i++) {
        try {
          iFrameEl.offsetHeight = dojo.byId("wsjmn_dropdown_content"+elNum).offsetHeight;
        }
          catch(err) {}
        }

      try {
        iFrameEl.offsetHeight = dojo.byId("wsjmn_dropdown_content"+elNum).offsetHeight;
      }
        catch(e) {}
    },	

    setEvents: function () {
      var that = this;

      dj.lang.addLiveEvent("._exp", "mousedown", function (ev) {
        var el = (ev.target || ev.srcElement);
        that.initShowData(el);
      });

      dj.lang.addLiveEvent(".subExpand", "mousedown", function (ev) {
        var el = (ev.target || ev.srcElement);
        that.subFlyoutToggle("1-3");
      });
    },

    delayedMouseOver: function (containerClass, func, time) {
      var doInit = false, initDelay;
      var that = this;

      var outEvent = dj.lang.addLiveEvent(containerClass, "mouseout", function () { doInit = false; });
      var overEvent = dj.lang.addLiveEvent(containerClass, "mouseover", function (ev) {
      if (initDelay) { clearTimeout(initDelay); }
        doInit = true;
        var el = this;
        initDelay = setTimeout(function () {
          if (!doInit) { 
            return; 
          }

          func.call(that, el);
        }, time);
      });
    },

    getHTML: function (location, el, dataEl) {
      var that = this;

      dojo.xhrGet( {
         url: location,
         headers: {
           Accept: 'application/html'
         },
         handleAs: "text",
         load: function (response, ioArgs) {
           var requestStatus = ioArgs.xhr.getResponseHeader('Status');
           el.innerHTML = response;
           // when the comment below is matched in the request a special panel is initialized 
           if (response.match(/<!--BusinessDropdown-->/)) {
             var panel = new dj.widget.panel.SelectDropdownPanel('subIndDropdown');
           }
         },
         error: function (response, ioArgs) {
           console.error("HTTP status code: ", ioArgs.xhr.status);
           return response;
         }
      });
    },

    subFlyoutToggle: function (n) {
      // Get the dropdown
      var el = dojo.byId("wsjsub_flyout" + n);

      if (el === null) {
        return false;
      }

      var currentClass = el.className;
      // Toggle between the classes mn_ddState-collapsed and mn_ddState-expanded
      if(currentClass.indexOf("wsjsub_ddState-collapsed") !== -1) {
        el.className = currentClass.replace( /wsjsub_ddState-collapsed/, "wsjsub_ddState-expanded");
      } 
      else {
        el.className = currentClass.replace(/wsjsub_ddState-expanded/, "wsjsub_ddState-collapsed");
      }
      return false;	
    },

    fadeInArrows: function () {
      var arrowNodes = dojo.query(".mnExpand._exp");

      for (var i=0;i<=arrowNodes.length - 1;i++) {
        dojo.fadeIn({
          node: arrowNodes[i],
          duration: (1.0 * 1000)
        }).play();
      }
    }
  };
}());
dojo.provide("dj.widget.massrelevance.tweetRiver");
dojo.require("dj.module.massrel.massrel");
dojo.require("dojo.io.script");
dojo.require("dojo.date");
dojo.require("dojo.date.locale");

dojo.declare("dj.widget.massrelevance.tweetRiver", [],
{

      constructor : function(cfg) {
        
        this.conf = dojo.mixin(this.DEFAULT_CONFIG,cfg);
      },
      
      DEFAULT_CONFIG:{
        
        streamCount:1,
        streamRefreshInterval:30,
        twitterStreamName:"dowjonestwo/wsjtest",
        mrJSWidgetToLoad:"https://raw.github.com/MassRelevance/massrel-js/master/massrel.js",
        streamEleClass:".content_section"
      },
      
      getTwitterFeedOldApproach:function(callback, context, divToCreateHTML){
        var that = this;
         
        var jsonArgs = {
            
            url: that.conf.mrJSWidgetToLoad, 
            checkString : "massrel",
            load: dojo.hitch(this, function(){

             //if(typeof this.isRespAvailable != "undefined"){
                 var stream = new massrel.Stream(this.conf.twitterStreamName);
  
                 // list to be used when pruning the stream from being too long
                 var streamContent = [];
                 var that = this;
                 stream.poller({
                   limit: this.conf.streamCount,    // number of tweets per poll
                   frequency: this.conf.streamRefreshInterval // how often to get new tweets
                 }).batch(function(tweets) {
                     // resort so tweets on top are the newest
                     streamContent = [];
                     while(tweets.length > 0) {
                       streamContent.push(tweets.pop());
                     }
                     //callback.apply(context, [streamContent]);
                     that.renderTwitterHTML(callback, context, divToCreateHTML,streamContent);
                     callback.apply(context, [streamContent]);
               
                 }).start();
              //}
            }),
            error: function(error){
              console.error("twitter feed couldn't be laoded");
            }
          };
          dojo.io.script.get(jsonArgs);
      },

      
      
      getTwitterFeed:function(callback, context, divToCreateHTML){
        var stream = new massrel.Stream(this.conf.twitterStreamName);
        
        // list to be used when pruning the stream from being too long
        var streamContent = [];
        var that = this;
        stream.poller({
          limit: this.conf.streamCount,    // number of tweets per poll
          frequency: this.conf.streamRefreshInterval // how often to get new tweets
        }).batch(function(tweets) {
            // resort so tweets on top are the newest
            streamContent = [];
            while(tweets.length > 0) {
              streamContent.push(tweets.pop());
            }
            //callback.apply(context, [streamContent]);
            that.renderTwitterHTML(callback, context, divToCreateHTML,streamContent);
            callback.apply(context, [streamContent]);
      
        }).start();

      },
      
      
      
      renderTwitterHTML:function(callback, context, divToCreateHTML,streamContentArr){
        if(typeof divToCreateHTML != "undefined"  && streamContentArr.length > 0){
            divToCreateHTML.innerHTML = "";
            var contentDivEle = dojo.create("div",{"class":"twtContent"},divToCreateHTML,"last");
  
            var hrefLink ="https://twitter.com/" + streamContentArr[0].user.screen_name; 
            var aEle = dojo.create("a",{"href":hrefLink,"target":"_blank"},contentDivEle,"first");   
            var imgEle = dojo.create("img",{"src":streamContentArr[0].user.profile_image_url,"class":"twtIcon"},aEle,"first");   
  
            var blockquoteEle = dojo.create("blockquote",{"class":"twt"},contentDivEle,"last");   
            var hrefLink2 = "https://twitter.com/" + streamContentArr[0].user.screen_name;
            var aEle2 = dojo.create("a",{"href":hrefLink2,"target":"_blank"},blockquoteEle,"first");
            aEle2.innerHTML = '@'+ streamContentArr[0].user.screen_name ;
            var text = streamContentArr[0].text;
            var textArr = text.split(" ");
            for(var l=0;l<textArr.length;l++){
              var space = " ";              
              var word = textArr[l];
              if(word.indexOf("#") == 0){
                var tag = word.substring(1);                
                var hrefHashLink = "https://twitter.com/search?q=%23" + tag + "&src=hash" ;
                var aEle3 = dojo.create("a",{"href":hrefHashLink,"target":"_blank"},blockquoteEle,"last");                   
                aEle3.innerHTML= space + "#" + tag;
              }else if(word.indexOf("@") == 0){
                var name = word.substring(1);                
                var hrefAtLink = "https://twitter.com/" + name ;
                var aEle4 = dojo.create("a",{"href":hrefAtLink,"target":"_blank"},blockquoteEle,"last");                   
                aEle4.innerHTML=space + "@" + name;
              }
              else{
                blockquoteEle.appendChild(document.createTextNode(space + word));
              }
            }
//            blockquoteEle.appendChild(document.createTextNode(streamContentArr[0].text+ "."));
//            
//            if(typeof streamContentArr[0].entities != "undefined" && typeof streamContentArr[0].entities.hashtags != "undefined" ){
//              var hashLength = streamContentArr[0].entities.hashtags.length;
//              if(hashLength > 0){
//                blockquoteEle.appendChild(document.createTextNode(" In "));
//                 for(var l=0;l<hashLength;l++){
//                   var hashTag = streamContentArr[0].entities.hashtags[l].text;
//                   var hrefHashLink = "https://twitter.com/search?q=%23" + hashTag + "&src=hash" ;
//                   var aEle3 = dojo.create("a",{"href":hrefHashLink},blockquoteEle,"last");                   
//                   aEle3.innerHTML=" #" + hashTag;
//                 }
//              }
//            }
            
            
  
            var spanEle = dojo.create("span",{"class":"twtTime"},contentDivEle,"last");   
  
            var ulEle = dojo.create("ul",{"class":"twtMeta"},contentDivEle,"last");   
            var liEle1 = dojo.create("li",{"class":"twtTime"},ulEle,"first");
            var ts = streamContentArr[0].created_at;
            if(ts !== ""){ // Sat Oct 27 21:48:12 +0000 2012
              try{
                var tsSplitArr = ts.split(" ");
                var tsTime = tsSplitArr[3];
                //["Sat", "Oct", "27", "21:48:12", "+0000", "2012"]
                var tsTimeArr = tsTime.split(":");
                var monthNum = this.getMonthNum(tsSplitArr[1]);
                var dateVal = new Date(tsSplitArr[5],monthNum,tsSplitArr[2],tsTimeArr[0],tsTimeArr[1],tsTimeArr[2]);
                var formattedDate = dojo.date.locale.format(dateVal, {datePattern: "MMM d, yyyy", selector: "date"});
                liEle1.innerHTML = this.getOrdialDate(formattedDate);
              }catch(e1){console.log("error in formatting date" + e1);}
            }            
  
            var tweetURL = "https://twitter.com/intent/";
            var liEle2 = dojo.create("li",{"class":"twtFav"},ulEle,"last");  
            var favVar = tweetURL + "favorite?tweet_id=" + streamContentArr[0].id_str; 
            var aEle3 = dojo.create("a",{"href":favVar},liEle2,"first");   
            aEle3.innerHTML = "Favorite";
  
            var liEle3 = dojo.create("li",{"class":"twtRetwt"},ulEle,"last");  
            var retweetVar = tweetURL + "retweet?tweet_id=" + streamContentArr[0].id_str; 
            var aEle4 = dojo.create("a",{"href":retweetVar},liEle3,"first");   
            aEle4.innerHTML = "Retweet";
  
            var liEle4 = dojo.create("li",{"class":"twtReply"},ulEle,"last");  
            var replyVar = tweetURL + "tweet?in_reply_to=" + streamContentArr[0].id_str; 
            var aEle5 = dojo.create("a",{"href":replyVar},liEle4,"first");   
            aEle5.innerHTML = "Reply";
        
        }

      },
      getOrdialDate:function(formattedDate){
        try{
          var num = formattedDate;
          var commaIndex = formattedDate.indexOf(",");
          num = formattedDate.substring(4,commaIndex);
          
          try{
            num = parseInt(num,10);
          }catch(e){
            console.log("date could not be converted to int " + e);
          }
          var s='th';
          if(num===1 || num==21 || num==31){ s='st';}
          if(num===2 || num==22){ s='nd';}
          if(num===3 || num==23){ s='rd';}
          formattedDate.replace(num,num+s);
          return formattedDate.replace(num,num+s);
        }catch(ex){
          return formattedDate;
        }
      },
      
      getMonthNum:function(mon){
        var months={
          "Jan":0,
          "Feb":1,
          "Mar":2,
          "Apr":3,
          "May":4,
          "Jun":5,
          "Jul":6,
          "Aug":7,
          "Sep":8,
          "Oct":9,
          "Nov":10,
          "Dec":11
        };
        return months[mon];
      }

      
      
});

