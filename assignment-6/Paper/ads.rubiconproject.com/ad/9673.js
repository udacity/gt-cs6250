var rp_account_config=rp_account_config||{rp_feature_set:{}};var RubiconAdServing=RubiconAdServing||{};RubiconAdServing.RubiconAd=function(){this.config={host:"optimized-by.rubiconproject.com",hosts:{beta:"staged-by.rubiconproject.com",prod:"optimized-by.rubiconproject.com"}};this.default_context={rp_adtype:"js",rp_kw:null,rp_gender:null,rp_age:null,rp_age_range:null,rp_age_dob:null,rp_ethnicity:null,rp_xpi:null,rp_page:null,rp_feature_set:{visibility:true,expandable:true,local_storage:true}};this.mergeProperties=function(l,k){if(typeof(l)=="undefined"||!l){return k}for(var m in k){if(typeof l[m]=="undefined"){l[m]=k[m]}}return l};this.init=function(k){try{if(k){this.context=this.mergeProperties(k,this.default_context)}else{this.context=this.default_context}if(this.context.rp_env){this.config.host=this.config.hosts[this.context.rp_env]||this.config.host}if(this.context.rp_host){this.config.host=this.context.rp_host}if(this.context.rp_zonesize){var l=this.context.rp_zonesize.split("-");this.context.rp_zone_id=l[0];this.context.rp_size_id=l[1]}if(this.context.rp_lat&&!this.isValidLat(this.context.rp_lat)){delete this.context.rp_lat}if(this.context.rp_long&&!this.isValidLong(this.context.rp_long)){delete this.context.rp_long}if(this.context.rp_geo&&this.context.rp_geo.latitude&&!this.isValidLat(this.context.rp_geo.latitude)){delete this.context.rp_geo.latitude}if(this.context.rp_geo&&this.context.rp_geo.longitude&&!this.isValidLong(this.context.rp_geo.longitude)){delete this.context.rp_geo.longitude}if(rp_account_config){this.context.rp_feature_set=this.mergeProperties(k.rp_feature_set,rp_account_config.rp_feature_set)}}catch(m){}};this.isValidLat=function(k){return(k!=null)&&k>=-90&&k<=90};this.isValidLong=function(k){return(k!=null)&&k>=-180&&k<=180};this.appendObject=function(l,o,n){if(o){var m;for(var k in o){if(!o.hasOwnProperty(k)){continue}m=o[k];if(m!=null&&(typeof m.length=="undefined"||m.length>0)){if(typeof m=="boolean"){l+="&"+n+"."+k+"="+(m?1:0)}else{l+="&"+n+"."+k+"="+encodeURIComponent(m)}}}}return l};this.start=function(){var w=false;var t;var u=location.href.split(":");var s=u[0]=="https"?"https://":"http://";var k;if(this.context.rp_adtype!="jsonp"){k=s+this.config.host+"/a/$account_id$/$site_id$/$zonesize$.$format$?$cb$$floor$$smart$$smartfile$$fbid$$p_screen_res$$keyword$$gender$$age$$agerange$$agedob$$ethnicity$$p_lat$$p_long$$tracking$$xpi$$p_exp$$p_pos$$localstorage$$storagetype$"}else{k=s+this.config.host+"/a/api/ads.$format$?enc=url&account_id=$account_id$&site_id=$site_id$&zone_id=$zone_id$&size_id=$size_id$&$cb$$floor$$smart$$smartfile$$fbid$$p_screen_res$$keyword$$gender$$age$$agerange$$agedob$$ethnicity$$p_lat$$p_long$$tracking$$xpi$$p_exp$$p_pos$$localstorage$$storagetype$";if(this.context.rp_ae_spoof){k=this.context.rp_ae_spoof}}if(this.context.rp_account&&this.context.rp_site&&this.context.rp_zonesize){k=d("account_id",this.context.rp_account,k);k=d("site_id",this.context.rp_site,k);k=d("zonesize",this.context.rp_zonesize,k);k=d("zone_id",this.context.rp_zone_id,k);k=d("size_id",this.context.rp_size_id,k)}else{return}k=d("format",(this.context.rp_adtype=="iframe"?"html":this.context.rp_adtype),k);var n="";try{if(this.context.rp_page&&this.context.rp_page.length>0){n="&rf="+escape(this.context.rp_page)}else{if(i()){var l=document.referrer;try{if(typeof window.parent.location.href=="string"&&window.parent.location.href.substr(0,4)=="http"){l=top.location.href||l}}catch(v){}if(l&&l.length>0){n="&rf="+escape(l)}}}}catch(v){w=true}k+=n;if(this.context.rp_feature_set.expandable){k=c("p_exp","p_exp",(this.getSupportExpandableAd()?1:null),k)}else{k=c("p_exp","p_exp",null,k)}if(this.context.rp_feature_set.visibility){k=c("p_pos","p_pos",h(),k)}else{k=c("p_pos","p_pos",null,k)}k=c("p_screen_res","p_screen_res",f(),k);k=c("cb","cb",Math.random(),k,true);k=c("keyword","kw",this.context.rp_kw,k);k=c("gender","gender",this.context.rp_gender,k);k=c("age","age",this.context.rp_age,k);k=c("agerange","age_range",this.context.rp_age_range,k);k=c("agedob","age_dob",this.context.rp_age_dob,k);k=c("ethnicity","ethnicity",this.context.rp_ethnicity,k);if(this.context.rp_lat!=null&&this.context.rp_long!=null){k=c("p_lat","p_lat",this.context.rp_lat,k);k=c("p_long","p_long",this.context.rp_long,k)}else{k=c("p_lat","p_lat",null,k);k=c("p_long","p_long",null,k)}k=c("xpi","xpi",this.context.rp_xpi,k);k=c("floor","rp_floor",this.context.rp_floor,k);k=c("tracking","tk_code",this.context.rp_tracking,k);k=c("smart","tk_st",(w?"0":"1"),k);k=c("smartfile","tk_sf",(this.context.rp_smartfile?"1":null),k);k=this.appendObject(k,this.context.rp_inventory,"tg_i");k=this.appendObject(k,this.context.rp_visitor,"tg_v");k=c("fbid","x_fbid",this.context.rp_facebook_device_id,k);k=this.appendObject(k,this.context.rp_app,"p_app");k=this.appendObject(k,this.context.rp_device,"p_device");k=this.appendObject(k,this.context.rp_geo,"p_geo");k=this.appendObject(k,this.context.rp_accept,"p_accept");if(this.context.rp_feature_set.local_storage&&e.detectSafari()){var r=[];data=RubiconAdServing.getStoredData();if(data&&data.fcaps&&data.fcaps.sizes){var z=data.fcaps.sizes;for(var q in z){if(!z[q].ads){continue}for(var o in z[q].ads){r[r.length]="ls_fcap."+q+"="+o+",0x"+z[q].ads[o].count.toString(16)+",0x"+z[q].ads[o].first_seen.toString(16)+",0x"+z[q].ads[o].last_seen.toString(16)}}}if(data&&data.bucket&&typeof data.bucket==="object"){var m=data.bucket;for(var p in m){if(typeof m[p]!=="object"){continue}for(var x in m[p]){r[r.length]="ls_c."+p+"."+x+"=0x"+m[p][x].value.toString(16)+",0x"+m[p][x].first_set.toString(16)+",0x"+m[p][x].last_set.toString(16)}}}k=k.replace(/\$localstorage\$/,!r.length?"":"&"+r.join("&"),k);k=c("storagetype","rp_s","l",k)}else{k=c("localstorage","localstorage",null,k);k=c("storagetype","rp_s","c",k)}if(this.context.rp_adtype=="jsonp"){var y=this;window.rp_onAdResponseLoaded=function(A){y.onAdResponseLoaded(A)}}if(!this.context.rp_debug){if(this.context.rp_adtype=="iframe"){t='<iframe frameborder="0" allowtransparency="true" hspace="0"  vspace="0" marginheight="0" marginwidth="0" scrolling="no"  width="'+this.context.rp_width+'px" height="'+this.context.rp_height+'px" src="'+k+'"></iframe>';document.write(t)}else{t='<script type="text/javascript" src="'+k+'"><\/script>';document.write(t)}}else{document.write(k)}};this.filter_script=function(k){k=k.replace(/\/SCRIPT/g,'/SCR"+"IPT');k=k.replace(/\/script/g,'/scr"+"ipt');return k};this.onAdResponseLoaded=function(k){try{if(k.ads){for(var n=0;n<k.ads.length;n++){ad=k.ads[n];var m=["script","html"];for(var l in m){var o=m[l];if(ad[o]&&typeof ad[o]=="string"){ad[o]=decodeURIComponent(ad[o]);if(typeof this["filter_"+o]=="function"){ad[o]=this["filter_"+o](ad[o])}}}}}if(this.context.rp_callback){if(typeof this.context.rp_callback=="function"){this.context.rp_callback(k)}if(typeof this.context.rp_callback=="string"&&window[this.context.rp_callback]&&typeof window[this.context.rp_callback]=="function"){window[this.context.rp_callback](k)}}}catch(p){}};var c=function(n,o,m,l,p){var k="";if(m!==null&&typeof m!="undefined"){k=(p===true?"":"&")+o+"="+m}return d(n,k,l)};var d=function(l,k,m){if(typeof l==="string"&&l!==null&&l.length>0){return m.replace("$"+l+"$",k)}else{return m}};this.getSupportExpandableAd=function(){return(!i()&&this.context.rp_adtype!="iframe")};var i=function(){return(window!=top)};var j=function(){var k=false;try{window.top.location.href}catch(l){k=true}return k};var h=function(){var s=null;try{if(j()){}else{var n=window;var o=b();var p=90;var r;if(i()){while(window.top!==n.parent){n=n.parent;try{n.location.href}catch(l){return s}}r=g(n.frameElement);p=n.frameElement.clientHeight/2}else{var m=document.createElement("div");var k=a("rubicon_chk_position_");m.setAttribute("id",k);m.style.width="0px";m.style.height="0px";document.body.appendChild(m);r=g(m);document.body.removeChild(m);p=p/2}if(o.y+o.h<(p+r.y)||o.y>(p+r.y)){s="btf"}else{s="atf"}}}catch(q){}return s};var a=function(k){return k+Math.floor(Math.random()*1000000)};var b=function(){if(window.frameElement){return{x:window.top.innerWidth,y:window.top.pageYOffset||window.top.document.body.scrollTop||window.top.document.documentElement.scrollTop,w:(window.top.innerWidth||window.top.documentElement.clientWidth||window.top.getElementsByTagName("body")[0].clientWidth),h:(window.top.innerHeight||window.top.documentElement.clientHeight||window.top.getElementsByTagName("body")[0].clientHeight)}}return{x:window.pageXOffset||document.body.scrollLeft||document.documentElement.scrollLeft,y:window.pageYOffset||document.body.scrollTop||document.documentElement.scrollTop,w:(window.innerWidth||document.documentElement.clientWidth||document.getElementsByTagName("body")[0].clientWidth),h:(window.innerHeight||document.documentElement.clientHeight||document.getElementsByTagName("body")[0].clientHeight)}};var f=function(){try{return window.screen.width+"x"+window.screen.height}catch(k){}};var g=function(l){var k=0,m=0;if(l.offsetParent){do{k+=l.offsetLeft;m+=l.offsetTop}while(l=l.offsetParent)}return{x:k,y:m}};var e={browserVersion:null,browserData:[{string:navigator.vendor,subString:"Apple"}],detectSafari:function(){if(this.browserVersion==null){this.browserVersion=this.checkBrowser()}return this.browserVersion},checkBrowser:function(){for(var k=0;k<this.browserData.length;k++){var l=this.browserData[k].string;if(l&&l.indexOf(this.browserData[k].subString)!=-1){return true}}return false}}};RubiconAdServing.getStoredData=function(){var b=localStorage.rubiconSmartTagData;if(b){try{var a=JSON.parse(b);if(typeof a==="object"){return a}}catch(c){return{}}}return{}};RubiconAdServing.storeData=function(a){var b=localStorage.rubiconSmartTagData||"{}";try{localStorage.rubiconSmartTagData=JSON.stringify(a)}catch(c){}};RubiconAdServing.enforceFCapStructure=function(d,c,a,b){if(!d.fcaps){d.fcaps={}}if(!d.fcaps.sizes){d.fcaps.sizes={}}if(!d.fcaps.sizes[c]){d.fcaps.sizes[c]={}}if(!d.fcaps.sizes[c]["ads"]){d.fcaps.sizes[c]["ads"]={}}if(!d.fcaps.sizes[c]["ads"][a]){d.fcaps.sizes[c]["ads"][a]={count:0,ad_id:a,first_seen:b,last_seen:b}}return d};RubiconAdServing.setFCap=function(c,a,d,b){var e=RubiconAdServing.getStoredData();e=RubiconAdServing.enforceFCapStructure(e,c,a,b);e.fcaps.sizes[c]["ads"][a].count=d;e.fcaps.sizes[c]["ads"][a].last_seen=b;RubiconAdServing.storeData(e)};RubiconAdServing.incFCap=function(c,a,d,b){var e=RubiconAdServing.getStoredData();e=RubiconAdServing.enforceFCapStructure(e,c,a,b);e.fcaps.sizes[c]["ads"][a].count+=d;e.fcaps.sizes[c]["ads"][a].last_seen=b;RubiconAdServing.storeData(e)};RubiconAdServing.decFCap=function(c,a,d,b){var e=RubiconAdServing.getStoredData();e=RubiconAdServing.enforceFCapStructure(e,c,a,b);e.fcaps.sizes[c]["ads"][a].count-=d;e.fcaps.sizes[c]["ads"][a].last_seen=b;RubiconAdServing.storeData(e)};RubiconAdServing.delFCap=function(b,a){var c=RubiconAdServing.getStoredData();c=RubiconAdServing.enforceFCapStructure(c,b,a,0);delete c.fcaps.sizes[b]["ads"][a];if(JSON.stringify(c.fcaps.sizes[b]["ads"])==="{}"){delete c.fcaps.sizes[b]}if(JSON.stringify(c.fcaps.sizes)==="{}"){delete c.fcaps.sizes}RubiconAdServing.storeData(c)};RubiconAdServing.enforceBucketStructure=function(d,c,b,a){if(typeof d.bucket!=="object"){d.bucket={}}if(typeof d.bucket[c]!=="object"){d.bucket[c]={}}if(typeof d.bucket[c][b]!=="object"){d.bucket[c][b]={first_set:a,value:0}}return d};RubiconAdServing.setBucketValue=function(c,b,e,a){var d=RubiconAdServing.getStoredData();d=RubiconAdServing.enforceBucketStructure(d,c,b,a);d.bucket[c][b].value=e;d.bucket[c][b].last_set=a;RubiconAdServing.storeData(d)};RubiconAdServing.incBucketValue=function(c,b,e,a){var d=RubiconAdServing.getStoredData();d=RubiconAdServing.enforceBucketStructure(d,c,b,a);d.bucket[c][b].value+=e;d.bucket[c][b].last_set=a;RubiconAdServing.storeData(d)};RubiconAdServing.decBucketValue=function(c,b,e,a){var d=RubiconAdServing.getStoredData();d=RubiconAdServing.enforceBucketStructure(d,c,b,a);d.bucket[c][b].value-=e;d.bucket[c][b].last_set=a;RubiconAdServing.storeData(d)};RubiconAdServing.delBucketValue=function(b,a){var c=RubiconAdServing.getStoredData();c=RubiconAdServing.enforceBucketStructure(c,b,a,0);delete c.bucket[b][a];if(JSON.stringify(c.bucket[b])==="{}"){delete c.bucket[b]}RubiconAdServing.storeData(c)};(function(){try{var a;var d=new RubiconAdServing.RubiconAd();var c=new Object();var g;g=["rp_account","rp_site","rp_zonesize","rp_height","rp_width","rp_floor","rp_lat","rp_long"];for(var b=0;b<g.length;b++){a=g[b];if((window[a]!=null)&&(typeof window[a]=="string"||typeof window[a]=="number")){c[a]=window[a];window[a]=undefined}}g=["rp_adtype","rp_page","rp_ae_spoof","rp_env","rp_host","rp_facebook_device_id"];for(var b=0;b<g.length;b++){a=g[b];if(window[a]&&typeof window[a]=="string"){c[a]=window[a];window[a]=undefined}}g=["rp_gender","rp_age","rp_age_range","rp_age_dob","rp_ethnicity","rp_xpi","rp_kw","rp_tracking"];for(var b=0;b<g.length;b++){a=g[b];if(window[a]&&((typeof window[a]=="string"&&window[a].substr(0,7)!="[INSERT")||typeof window[a]=="number")){c[a]=window[a];window[a]=undefined}}g=["rp_debug","rp_inventory","rp_visitor","rp_app","rp_device","rp_geo","rp_accept","rp_feature_set"];for(var b=0;b<g.length;b++){a=g[b];if(window[a]&&(typeof window[a]=="object"||typeof window[a]=="boolean")){c[a]=window[a];window[a]=undefined}}g=["rp_smartfile"];for(var b=0;b<g.length;b++){a=g[b];if(window[a]&&(typeof window[a]=="string"&&window[a].substr(0,6)!="[SMART")){c[a]=window[a];window[a]=undefined}}g=["rp_callback"];for(var b=0;b<g.length;b++){a=g[b];if(window[a]&&(typeof window[a]=="function"||typeof window[a]=="string")){c[a]=window[a];window[a]=undefined}}d.init(c);d.start()}catch(f){}})();