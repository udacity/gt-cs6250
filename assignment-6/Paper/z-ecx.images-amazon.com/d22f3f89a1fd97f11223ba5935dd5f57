(function($){if(typeof($.fn.amazonLike)=="function"){return;
}function AmazonLikeStateCache(stateCacheId){var self=this;
self.init=function(){};
self.ready=function(){};
self.get=function(){};
self.set=function(){};
self.getStateWhenReady=function(callback){self.ready(function(){callback((self.get("isLiked")=="true"),parseInt(self.get("customerWhitelistStatus")),parseInt(self.get("likeCount")),self.get("commifiedLikeCount"),self.get("commifiedLikeCountMinusOne"));
});
};
self.getTimestamp=function(){var ts=self.get("ts");
if(ts!=null&&typeof(ts)!="undefined"&&ts.length>0){ts=parseInt(ts);
if(!isNaN(ts)&&ts>0){return ts;
}}return 0;
};
var ephemeralCache={};
if(typeof(sessionStorage)!="undefined"){self.ready=function(onReadyCallback){onReadyCallback();
};
self.get=function(stateName){return sessionStorage.getItem(stateCacheId+"_"+stateName);
};
self.set=function(stateName,stateValue){sessionStorage.setItem(stateCacheId+"_"+stateName,stateValue+"");
};
}else{self.init=function(){ephemeralCache[stateCacheId]={};
};
self.ready=function(onReadyCallback){onReadyCallback();
};
self.get=function(stateName){return ephemeralCache[stateCacheId][stateName];
};
self.set=function(stateName,stateValue){ephemeralCache[stateCacheId][stateName]=stateValue+"";
};
}return this;
}window.AmazonLikeStateCache=AmazonLikeStateCache;
var defaultSettings={context:"unknown",itemId:"0000000000",itemType:"asin",isLiked:false,isOnHover:false,isPressed:false,likeCount:-1,commifiedLikeCount:"",commifiedLikeCountMinusOne:"",sessionId:"0",isSignInRedirect:false,isSubmitSuccess:true,source:null,customerWhitelistStatus:-1,isCustomerSignedIn:false,usePopover:true,popoverWidth:335,popoverAlign:"right",popoverOffset:0,useDynamicPopover:false,shareText:"Share this item",onBeforeSubmitCallback:function(){},onSubmitCallback:function(){},customSignInRedirectURLCreator:null,spriteURL:null,stateCache:null,buttonOnClass:"s_amznLikeButtonOn",buttonOffClass:"s_amznLikeButtonOff",buttonPressedClass:"s_amznLikeButtonPressed"};
function AmazonLikePopover(amznLike){this.isShown=false;
this.likePopoverUI=this.likeBeakUI=this.likeSignInLinkUI=this.unlikeLinkUI=this.likeShareCondoUI=this.likePopoverLoadingIndicatorUI=this.amzPopoverObj=$([]);
var amznLikePopover=this;
this.attachToDOM=function(amzPopoverObj){amznLikePopover.likePopoverUI=amzPopoverObj.find(".amazonLikePopover");
amznLikePopover.likeBeakUI=amzPopoverObj.find(".amazonLikeBeak");
amznLikePopover.likeSignInLinkUI=amznLikePopover.likePopoverUI.find("a.likeSignInLink");
amznLikePopover.unlikeLinkUI=amznLikePopover.likePopoverUI.find(".amazonUnlikeLink");
amznLikePopover.likeShareCondoUI=amznLikePopover.likePopoverUI.find(".amazonLikeShareCondo");
amznLikePopover.likePopoverLoadingIndicatorUI=amznLikePopover.likePopoverUI.find(".likeCountLoadingIndicator");
amznLikePopover.amzPopoverObj=amzPopoverObj;
if(amznLike.spriteURL){amznLikePopover.likeBeakUI.css("background-image","url("+amznLike.spriteURL+")");
}amznLikePopover.unlikeLinkUI.click(function(){amznLike.onUnlike();
return false;
});
amznLikePopover.likeSignInLinkUI.click(function(){amznLike.redirectToAmznSignIn();
return false;
});
};
this.showShareCondo=function(){amznLikePopover.likeShareCondoUI.find(".tafShareText").html(amznLike.shareText);
amznLikePopover.likeShareCondoUI.show();
};
this.clearContent=function(){amznLikePopover.likePopoverUI.children().hide();
};
this.fixupAmzPopover=function(){if(amznLikePopover.amzPopoverObj&&amznLikePopover.amzPopoverObj.backing){amznLikePopover.amzPopoverObj.backing.refreshBounds();
}};
this.onPopoverFilled=function(amzPopoverObj){amznLikePopover.attachToDOM(amzPopoverObj);
amznLikePopover.amzPopoverObj=amzPopoverObj;
amznLikePopover.clearContent();
amznLikePopover.onLikeCountUpdate();
amznLikePopover.likePopoverUI.find("."+(amznLike.isLiked?"likeOn":"likeOff")+"PopoverContent").show();
if(amznLike.isLiked){amznLikePopover.showShareCondo();
}amznLikePopover.fixupAmzPopover();
amznLikePopover.isShown=true;
};
this.onPopoverHide=function(){amznLikePopover.isShown=false;
};
this.onLikeCountUpdate=function(){amznLikePopover.likePopoverUI.find(".likeCount").html(amznLike.commifiedLikeCount);
var commifiedYouCount=(amznLike.customerWhitelistStatus==1)?amznLike.commifiedLikeCountMinusOne:amznLike.commifiedLikeCount;
amznLikePopover.likePopoverUI.find(".likeYouCount").html(commifiedYouCount);
amznLikePopover.updateCountText();
};
this.onLike=function(success){amznLikePopover.clearContent();
amznLikePopover.onLikeCountUpdate();
if(success){if(amznLike.customerWhitelistStatus==0){amznLikePopover.likePopoverUI.find(".likeOnNoPurchase").show();
}else{amznLikePopover.likePopoverUI.find(".likeOnNoPurchase").hide();
}amznLikePopover.likePopoverUI.find(".likeOnSavedPopoverContent").show();
amznLikePopover.showShareCondo();
}else{amznLikePopover.likePopoverUI.find(".likeOffPopoverContent").show();
amznLikePopover.likePopoverUI.find(".likePopoverError").show();
}amznLikePopover.fixupAmzPopover();
};
this.onUnlike=function(success){amznLikePopover.clearContent();
amznLikePopover.onLikeCountUpdate();
if(success){amznLikePopover.likePopoverUI.find(".likeOffSavedPopoverContent").show();
}else{amznLikePopover.likePopoverUI.find(".likeOnPopoverContent").show();
amznLikePopover.likePopoverUI.find(".likePopoverError").show();
amznLikePopover.showShareCondo();
}amznLikePopover.fixupAmzPopover();
};
this.updateCountText=function(){amznLikePopover.likePopoverUI.find(".likeCountText").hide();
if(amznLike.likeCount<0){amznLikePopover.likePopoverUI.find(".likeCountFallback").show();
}else{var likeCountIncludingYou=amznLike.likeCount;
if(!(amznLike.customerWhitelistStatus==1)&&amznLike.isLiked){likeCountIncludingYou+=1;
}if(likeCountIncludingYou>2){amznLikePopover.likePopoverUI.find(".likeCountText.likeCountGT2").show();
}if(likeCountIncludingYou==2){amznLikePopover.likePopoverUI.find(".likeCountText.likeCount2").show();
}if(likeCountIncludingYou>1){amznLikePopover.likePopoverUI.find(".likeCountText.likeCountGT1").show();
}if((likeCountIncludingYou<2&&amznLike.isLiked)||likeCountIncludingYou==1){amznLikePopover.likePopoverUI.find(".likeCountText.likeCount1").show();
}if(likeCountIncludingYou==0){amznLikePopover.likePopoverUI.find(".likeCountText.likeCount0").show();
}}};
}function AmazonLike(likeContainer,settings){this.likeContainer=likeContainer;
$.extend(this,settings);
var amznLike=this;
this.showUI=function(){amznLike.likeContainer.find(".hideUntilJSReady").removeClass("hideUntilJSReady");
};
this.attachToDOM=function(){amznLike.likeButtonUI=amznLike.likeContainer.find(".amazonLikeButton");
amznLike.unlikeLinkUI=amznLike.likeContainer.find(".amazonUnlikeLink");
amznLike.likeCountUI=amznLike.likeContainer.find(".amazonLikeCount");
amznLike.likePopover=new AmazonLikePopover(this);
amznLike.likeButtonUI.hover(function(){amznLike.onHover();
},function(){amznLike.offHover();
});
amznLike.likeButtonUI.click(function(){amznLike.onLike();
return false;
});
amznLike.unlikeLinkUI.click(function(){amznLike.onUnlike();
return false;
});
if(amznLike.spriteURL){amznLike.likeButtonUI.css("background-image","url("+amznLike.spriteURL+")");
}};
this.onLikeCountUpdate=function(newCount,commifiedCount,commifiedCountMinusOne){if(typeof(newCount)!="undefined"&&newCount!=null){newCount=parseInt(newCount);
if(!isNaN(newCount)&&newCount>=0){amznLike.likeCount=newCount;
amznLike.commifiedLikeCount=commifiedCount;
amznLike.commifiedLikeCountMinusOne=commifiedCountMinusOne;
amznLike.likeCountUI.html(commifiedCount);
}}};
this.onPopoverHide=function(){amznLike.likePopover.onPopoverHide();
};
this.onHover=function(){amznLike.isOnHover=true;
};
this.offHover=function(){amznLike.isOnHover=false;
};
this.onPress=function(){amznLike.isPressed=true;
amznLike.likeButtonUI.addClass(amznLike.buttonPressedClass);
};
this.offPress=function(){amznLike.isPressed=false;
amznLike.likeButtonUI.removeClass(amznLike.buttonPressedClass);
};
this.updateStateCache=function(){if(amznLike.stateCache){amznLike.stateCache.set("isLiked",amznLike.isLiked);
amznLike.stateCache.set("customerWhitelistStatus",amznLike.customerWhitelistStatus);
amznLike.stateCache.set("likeCount",amznLike.likeCount);
amznLike.stateCache.set("commifiedLikeCount",amznLike.commifiedLikeCount);
amznLike.stateCache.set("commifiedLikeCountMinusOne",amznLike.commifiedLikeCountMinusOne);
}};
this.updateState=function(isLiked,customerWhitelistStatus,likeCount,commifiedLikeCount,commifiedLikeCountMinusOne){amznLike.isLiked=isLiked;
amznLike.customerWhitelistStatus=customerWhitelistStatus;
if(amznLike.isLiked){amznLike.likeButtonUI.removeClass(amznLike.buttonOffClass);
amznLike.likeButtonUI.addClass(amznLike.buttonOnClass);
amznLike.unlikeLinkUI.parent().css("visibility","");
}else{amznLike.likeButtonUI.removeClass(amznLike.buttonOnClass);
amznLike.likeButtonUI.addClass(amznLike.buttonOffClass);
amznLike.unlikeLinkUI.parent().css("visibility","hidden");
}amznLike.onLikeCountUpdate(likeCount,commifiedLikeCount,commifiedLikeCountMinusOne);
amznLike.updateStateCache();
};
this.onLikeSubmit=function(response){if(response.success){amznLike.updateState(true,response.whitelistStatus,response.tally,response.commifiedTally,response.commifiedTallyMinusOne);
amznLike.likePopover.onLike(1);
amznLike.onSubmitCallback("like",1);
}else{amznLike.likePopover.onLike(0);
amznLike.onSubmitCallback("like",0);
}};
this.onLike=function(){amznLike.onBeforeSubmitCallback("like");
if(amznLike.isCustomerSignedIn&&!amznLike.isLiked){amznLike.onPress();
amznLike.submit("like",function(response){amznLike.offPress();
amznLike.onLikeSubmit(response);
});
}};
this.onUnlike=function(){amznLike.onBeforeSubmitCallback("unlike");
amznLike.submit("unlike",function(response){if(response.success){amznLike.updateState(false,response.whitelistStatus,response.tally,response.commifiedTally,response.commifiedTallyMinusOne);
amznLike.likePopover.onUnlike(1);
amznLike.onSubmitCallback("unlike",1);
}else{amznLike.onSubmitCallback("unlike",0);
amznLike.likePopover.onUnlike(0);
}});
};
this.redirectToAmznSignIn=function(){var postSubmitRedirectPath;
if(typeof(amznLike.customSignInRedirectURLCreator)=="function"){postSubmitRedirectPath=amznLike.customSignInRedirectURLCreator();
}else{var currentSearch=window.location.search;
if(currentSearch.length==1&&currentSearch.indexOf("?")==0){currentSearch="";
}var currentHash=window.location.hash;
postSubmitRedirectPath=window.location.pathname;
postSubmitRedirectPath+=currentSearch;
postSubmitRedirectPath+=currentHash;
}var submitRefTag="pd_like_submit_like_unrec_"+amznLike.context;
var postSignInRedirectPath="/gp/like/external/submit.html/ref="+submitRefTag+"?sessionId="+amznLike.sessionId+"&itemId="+amznLike.itemId+"&itemType="+amznLike.itemType+"&action=like"+"&redirect=1"+"&redirectPath="+escape(postSubmitRedirectPath)+"&source="+amznLike.context;
var signInRefTag="pd_like_unrec_signin_"+amznLike.context;
var amznURL=window.location.href;
var baseAmznURL=amznURL.substring(0,amznURL.indexOf("/",8));
var signInPath="/gp/like/sign-in/sign-in.html/ref="+signInRefTag+"?location="+escape(postSignInRedirectPath)+"&useRedirectOnSuccess=1"+"&redirectProtocol="+(window.location.protocol=="http:"?"http":"https");
window.location.href=baseAmznURL+signInPath;
};
this.getTally=function(callback){var url="/gp/like/external/get-tally.html/ref=pd_like_unrec_tally_"+amznLike.context+"?_cachebust="+Math.random();
var postData={"itemId":amznLike.itemId,"itemType":amznLike.itemType,"sessionId":amznLike.sessionId};
$.ajax({type:"POST",cache:false,dataType:"json",timeout:5000,url:url,data:postData,success:function(response){callback(response);
},error:function(xmlHttpRequest,textStatus,errorThrown){callback({});
}});
};
this.submit=function(action,callback){var url="/gp/like/external/submit.html/ref=pd_like_submit_"+action+"_"+amznLike.context+"?_cachebust="+Math.random();
var postData={"action":action,"itemId":amznLike.itemId,"itemType":amznLike.itemType,"sessionId":amznLike.sessionId,"context":amznLike.context};
if(amznLike.source!=null){postData.source=amznLike.source;
}$.ajax({type:"POST",cache:false,dataType:"json",timeout:5000,url:url,data:postData,success:function(response){callback(response);
},error:function(xmlHttpRequest,textStatus,errorThrown){callback({});
}});
return true;
};
amznLike.attachToDOM();
return this;
}$.fn.amazonLike=function(customSettings){var settings=$.extend({},defaultSettings,customSettings);
var amznLike=new AmazonLike($(this),settings);
amznLike.attachPopover=function(){if(settings.usePopover){if(typeof(settings.onBeforeAttachPopoverCallback)=="function"){settings.onBeforeAttachPopoverCallback();
}var popoverSettings={showOnHover:true,showCloseButton:false,hoverShowDelay:50,hoverHideDelay:500,width:amznLike.popoverWidth,followLink:true,location:"bottom",locationMargin:10,align:amznLike.popoverAlign,locationOffset:[amznLike.popoverOffset,0],onHide:amznLike.onPopoverHide,additionalCursorRects:amznLike.likeBeakUI};
if(settings.useDynamicPopover){popoverSettings.literalContent=amznLike.popoverHTML;
var fetchTallyIfFirstTime=true;
popoverSettings.onFilled=function(){if(fetchTallyIfFirstTime){amznLike.likePopover.likePopoverLoadingIndicatorUI.show();
amznLike.getTally(function(response){amznLike.likePopover.likePopoverLoadingIndicatorUI.hide();
if(response.success){amznLike.onLikeCountUpdate(response.tally,response.commifiedTally,response.commifiedTallyMinusOne);
}else{amznLike.onLikeCountUpdate(-1,"","");
}amznLike.updateStateCache();
});
fetchTallyIfFirstTime=false;
}};
}else{popoverSettings.literalContent=settings.popoverHTML;
popoverSettings.onFilled=amznLike.likePopover.onPopoverFilled;
}var checkAmznLikeSignInRedirectPopoverShownHashTag=function(){var hash=window.location.hash;
var isPopoverShown=(hash&&hash.indexOf("al_rp")>=0);
return isPopoverShown;
};
var addAmznLikeSignInRedirectPopoverShownHashTag=function(){window.location.hash="al_rp";
};
if(settings.isSignInRedirect&&!checkAmznLikeSignInRedirectPopoverShownHashTag()){var staticPopoverSettings=$.extend({},popoverSettings,{showCloseButton:true,closeEventInclude:"CLICK_OUTSIDE",closeEventExclude:"MOUSE_LEAVE",onFilled:function(amzPopoverObj){amznLike.likePopover.onPopoverFilled(amzPopoverObj);
amznLike.onLikeSubmit({success:settings.isLiked,tally:settings.likeCount,commifiedTally:settings.commifiedLikeCount,commifiedTallyMinusOne:settings.commifiedLikeCountMinusOne,whitelistStatus:settings.customerWhitelistStatus});
addAmznLikeSignInRedirectPopoverShownHashTag();
},onHide:function(){amznLike.onPopoverHide();
amznLike.likeButtonUI.removeAmazonPopoverTrigger();
amznLike.likeButtonUI.amazonPopoverTrigger(popoverSettings);
}});
jQuery.AmazonPopover.displayPopover(staticPopoverSettings,amznLike.likeButtonUI);
}else{amznLike.likeButtonUI.amazonPopoverTrigger(popoverSettings);
}}};
if(settings.stateCache){settings.stateCache.getStateWhenReady(amznLike.updateState);
}amznLike.showUI();
amznLike.attachPopover();
return amznLike;
};
amznJQ.declareAvailable("amazonLike");
})(amznJQ.jQuery||window.jQuery);
