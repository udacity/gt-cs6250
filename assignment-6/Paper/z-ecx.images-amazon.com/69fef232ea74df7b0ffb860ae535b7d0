(function(){jQuery.fn.amazonImmersiveView=function(){var oTitle;
var oProductGroupID;
var oImageSet;
var oVideoSet;
var oMediaUrls;
var oCurrentImgSetID=-1;
var oCurrentImgID=-1;
var oFullImageFit;
var oIV;
var oRightCol;
var oLeftCol;
var cursorStart=[0,0];
var initialOffset={left:0,top:0};
var oCurrentVideoSetID=0;
var oCurrentVideoID=-1;
var widthAdjustment=42;
var heightAdjustment=125;
var thumbSectionHeightAdjustment=210;
var thumbSectionWidth=220;
var videoListHeightAdjustment=30;
var oFullImageLarge;
var isLargeMode=false;
var maxOffset={};
var DEFAULT_FULL_SCREEN_MOVE_FACTOR=4;
var fullScreenMoveFactor=DEFAULT_FULL_SCREEN_MOVE_FACTOR;
var dpPlayers={mediaIDs:[],playerDivs:[]};
var playerOnIV=new Object();
var stopVideo=true;
var oSwatchImages;
var oVisualKeys;
var oDonsBoxes=new Array();
var oMasterDim=-1;
var isTwisterDetailPage=false;
var oSelectionVariations={};
var oFullImageHeight=0;
var oFullImageWidth=0;
var goEVDD=new EnhancedVariationsDropDown();
var isPlayingVideo=false;
var oImageLoadState={};
var useThisDPImage=0;
var oSingleton=0;
var noImageChidlASINs;
var isIVOpened=false;
var videoHolderMarginLeft=0;
var videoHolderMarginTop=0;
var nSpinnerWidth=80;
var nSpinnerLength=104;
var isImageLoading=false;
var isVideoDisabled=false;
var parentVideos;
var isSupportedTablets=0;
this.setIsSupportedTablets=function(supportedTablets){isSupportedTablets=supportedTablets;
};
this.setTitle=function(title){oTitle=title;
};
this.disableVideo=function(){isVideoDisabled=true;
oVideoSet=null;
updateMediaSelection();
};
this.setProductGroupID=function(productGroupID){oProductGroupID=productGroupID;
};
this.setMediaUrls=function(mediaUrls){oMediaUrls=mediaUrls;
};
this.changeImageSet=function(newImages){oImageSet=newImages;
};
this.changeVideoSet=function(newVideos){if(isVideoDisabled){return;
}oVideoSet=newVideos;
};
this.setInitialIDs=function(setID,mediaID,isImage){if(isImage){oCurrentImgSetID=oCurrentVideoSetID=new String(setID);
oCurrentImgID=mediaID;
oCurrentVideoID=-1;
}else{oCurrentImgSetID=oCurrentVideoSetID=new String(setID);
oCurrentVideoID=mediaID;
oCurrentImgID=-1;
stopVideo=false;
}};
this.setVariationProperties=function(visualKeys,swatchImages){oVisualKeys=visualKeys;
oSwatchImages=swatchImages;
};
this.setItems=function(itemList){oItemList=itemList;
};
this.setIVRepresentativeAsin=function(ivRepresentativeAsin,preferChildVideos){oIVRepresentativeAsin=ivRepresentativeAsin;
oPreferChildVideos=preferChildVideos;
};
this.isIVOpen=function(){return isIVOpened;
};
var isCSSLoaded=0;
this.loadCSS=function(){if(isCSSLoaded){return isCSSLoaded;
}var DonsBoxCSS='<style type="text/css">';
jQuery.ajax({url:"/gp/twister/dynamic-update/DonsBox-css.html",dataType:"html",timeout:40000,async:false,success:function(data,status,xhr){DonsBoxCSS+=data+"</style>";
jQuery(DonsBoxCSS).appendTo("head");
isCSSLoaded=1;
}});
return isCSSLoaded;
};
this.createImmersiveView=function(e,isTwisterDP){isTwisterDetailPage=isTwisterDP&&oVisualKeys&&oVisualKeys.length>0;
doBrowserAdjustment();
oIV=jQuery('<div style="display:none;height:'+(jQuery(window).height()-heightAdjustment)+'px; width:100%; padding: 0px 15px 15px 15px;" id="IV-Main"></div>');
constructLeftCol();
constructRightCol();
oIV.append('<div style="clear:both"/>');
jQuery("#prodImageCell").before(oIV);
this.createIVTrigger();
oIV.find("#iv-large-image").click(function(e){if(isPlayingVideo){return;
}if(isImageLoading){return;
}if(isLargeMode){imageFit();
}else{initialOffset=getFullScreenOffset(initialOffset);
if((oFullImageWidth>=1000)||(oFullImageHeight>=1000)){var largeImage=oLeftCol.find("#iv-large-image");
largeImage.empty().append(oFullImageLarge);
oIV.find(".fullScreen").load(function(){largeMode();
positionImage(e);
});
}}});
oIV.find("#iv-first-column").mousemove(function(e){if(isLargeMode){positionImage(e);
}});
prefetchResources();
addHandlers();
};
function positionImage(e){var newLeft=initialOffset.left-(e.pageX-cursorStart[0])*fullScreenMoveFactor;
var newTop=initialOffset.top-(e.pageY-cursorStart[1])*fullScreenMoveFactor;
var newOffset=getFullScreenOffset({left:newLeft,top:newTop});
oIV.find(".fullScreen").css({"left":newOffset.left,"top":newOffset.top});
}this.getIVPopoverOptions=function(){return{localContent:"#IV-Main",width:(jQuery(window).width()-widthAdjustment),location:function(popover,settings){return{left:20,top:28};
},zIndex:999,paddingLeft:0,paddingRight:0,paddingBottom:0,closeText:ivStrings["close"],modal:true,group:"ImmersiveView",onShow:updateIV,onHide:resetDP};
};
this.createIVTrigger=function(){var options=this.getIVPopoverOptions();
amznJQ.available("popover",function(){var triggers="#see-x-more,.internal_image";
if(!isSupportedTablets){triggers+=",.prod_image_selector,#original_image,[id^=alt_image_],[id^=video_image_],.alt_image_selector,#prodVideoClick";
}jQuery(triggers).removeAmazonPopoverTrigger();
if(jQuery("#prodImageOverlay").css("visibility")=="visible"){triggers="#see-x-more,.internal_image";
if(!isSupportedTablets){triggers+=",#original_image,[id^=alt_image_],[id^=video_image_],.alt_image_selector,#prodVideoClick";
}}jQuery(triggers).amazonPopoverTrigger(options);
});
};
function constructLeftCol(){var imgContainer;
var vidContainer;
oLeftCol=jQuery('<div id="iv-first-column" style="float: left; width:'+(jQuery(window).width()-widthAdjustment-330)+'px;height:100%; margin-right: 15px;"/>');
var currentDetailImageUrl="";
if(oImageSet&&oImageSet[oCurrentImgSetID]){if(oCurrentImgSetID.charAt(0)=="x"){currentDetailImageUrl=oImageSet[oCurrentImgSetID].images.zoomImages[0];
}else{if(oCurrentImgID!=-1){currentDetailImageUrl=oImageSet[oCurrentImgSetID].images.zoomImages[oCurrentImgID];
}}imgContainer=jQuery('<div width="100%" id="iv-large-image" style="overflow: hidden; width: 100%; height: '+(jQuery(window).height()-heightAdjustment-15)+'px;align:center; position:relative; top:0px; left:0px;"/>');
vidContainer=jQuery('<div width="100%" id="iv-large-video" style="overflow: hidden; width: 100%; height: 100%;align:center; display:none;"/>');
oLeftCol.append(imgContainer);
oLeftCol.append(vidContainer);
oIV.append(oLeftCol);
}else{if(oCurrentVideoID!=-1){imgContainer=jQuery('<div width="100%" id="iv-large-image" style="overflow: hidden; width: 100%; height: '+(jQuery(window).height()-heightAdjustment-15)+'px;align:center; display:none;position:relative; top:0px; left:0px;"/>');
vidContainer=jQuery('<div width="100%" id="iv-large-video" style="overflow: hidden; width: 100%; height: 100%;align:center; "/>');
oLeftCol.append(imgContainer);
oLeftCol.append(vidContainer);
oIV.append(oLeftCol);
return;
}}}function constructRightCol(){var rightColHtml='<div style="float: left; width: 235px;" id="iv-sec-column"></div>';
oRightCol=jQuery(rightColHtml);
constructTitle();
constructVarSelection();
constructMediaSelection();
constructThumbs();
oIV.append(oRightCol);
}function constructTitle(){var style='<style type="text/css">a.iv-title-link:link {text-decoration: none;}a.iv-title-link:visited {text-decoration: none; color: #003399}a.iv-title-link:hover {text-decoration: underline; color: orange;}</style>';
jQuery(style).appendTo("head");
var titleHtml;
titleHtml='<div style="text-align: left; margin-top: 10px; font-family: verdana, arial, helvetica, sans-serif; font-size: 14px; font-weight: bold; '+'word-wrap: break-word; width: 235px;" id="iv-prod-title" title="'+oTitle+'">'+'<a class="ap_custom_close iv-title-link" href="">'+trimWithEllipsis(oTitle,45)+"</a></div>";
var titleBar=jQuery(titleHtml);
oRightCol.append(titleBar);
}function constructVarSelection(){if(!isTwisterDetailPage||oVisualKeys.length==0){return;
}var varSelectionHtml='<div style="text-align: left;"  id="iv-variation-selection">';
var pageState=DetailPage.StateController.getState();
var labels=pageState["variation_display_labels"];
var labelCount=0;
for(var i in labels){var index=getIndex(i,oVisualKeys);
if(index<0){continue;
}oDonsBoxes[labelCount++]=index;
if(oMasterDim==-1){oMasterDim=i;
}var label=labels[i];
var selIndex=pageState["selected_variation_values"][i];
oSelectionVariations[i]=selIndex;
varSelectionHtml+='<div style="padding-top:10px; padding-bottom:3px; font-family: verdana, arial, helvetica, sans-serif; font-size:11px; color:#666">'+label+':</div><div style="margin:0px 10px;" id="'+i+'IVDonsBoxParent">';
varSelectionHtml+='</div><br clear="both">';
}varSelectionHtml+="</div>";
var variationSelection=jQuery(varSelectionHtml);
oRightCol.append(variationSelection);
}function constructThumbs(){var style='<style type="text/css">.iv_thumbs { border:1px solid #C9E1F4;width:220px;height:200px;padding-left:15px;padding-top:15px;padding-bottom:15px; overflow-y:auto; border-top:0px;position:relative; top:0px; left:0px; }.iv_thumb_videos {  border:1px solid #C9E1F4;width:235px;height:230px;padding:0px; overflow-y:auto; border-top:0px; }.iv_thumb_video_outer { float:left; width:100%; padding-top:5px; padding-bottom:5px;cursor:pointer}.iv_thumb_video_outer_hover { background-color: #EAF3FD }.iv_thumb_video { border: 1px solid #ddd;float:left; margin-left:10px;margin-right:10px;cursor:pointer; }.iv_thumb { border: 1px solid #ddd;float:left; margin-right:12px; margin-bottom:20px; cursor:pointer; }.iv_thumb_selected { border: 2px solid #E47911; }.iv_thumb_hover { border: 2px solid #004B91; }.iv_thumb_inner { padding: 1px;float:left; }.iv_thumb_inner_selected { padding: 0px; }.iv_thumb_image { float:left;position:relative;width:50px; height:50px; background-color:#ffffff}.iv_thumb_text { float:left; word-wrap:break-word; width:130px; margin-top:10px; font-family:verdana, arial, helvetica, sans-serif; font-size:11px }.iv_thumb_text_popover { font-family: verdana, arial, helvetica, sans-serif; font-size:11px }.iv_thumb_text_hover { background-color: #EAF3FD }</style>';
jQuery(style).appendTo("head");
var thumbHtml="<div class='iv_thumbs'>";
thumbHtml+="</div>";
thumbHtml+="<div class='iv_thumb_videos'>";
thumbHtml+="</div>";
var thumbs=jQuery(thumbHtml);
oRightCol.append(thumbs);
}function constructThumbnails(){var thumbnails;
var videoThumbnails,videoTitles,videoDurations,videoIDs;
if(oImageSet&&oImageSet[oCurrentImgSetID]){thumbnails=oImageSet[oCurrentImgSetID].images.thumbnails;
}if(oVideoSet&&oVideoSet[oCurrentVideoSetID]){videoThumbnails=oVideoSet[oCurrentVideoSetID].videos.slateImages;
videoTitles=oVideoSet[oCurrentVideoSetID].videos.titles;
videoDurations=oVideoSet[oCurrentVideoSetID].videos.durations;
videoIDs=oVideoSet[oCurrentVideoSetID].videos.mediaIDs;
}var thumbHtml="";
var thumbnailNumPerRow=3;
var thumbnailIndex=0;
var thumbnailCount=(thumbnails)?thumbnails.length:0;
thumbnailCount+=(videoThumbnails)?videoThumbnails.length:0;
if(thumbnails){var length=thumbnails.length;
for(var i=0;
i<length;
i++){if(thumbnailIndex%thumbnailNumPerRow==0){thumbHtml+="<div style='height:75px;'>";
}if(i!=oCurrentImgID||useThisDPImage){thumbHtml+="<div class='iv_thumb' id='ivimage_"+i+"'>";
thumbHtml+="<div class='iv_thumb_inner'>";
}else{thumbHtml+="<div class='iv_thumb iv_thumb_selected' id='ivimage_"+i+"'>";
thumbHtml+="<div class='iv_thumb_inner iv_thumb_inner_selected'>";
}thumbHtml+="<div class='iv_thumb_image' style=\"background:url("+getResizedThumbnailURL(thumbnails[i])+') center no-repeat">';
thumbHtml+="</div>";
thumbHtml+="</div>";
thumbHtml+="</div>";
if((thumbnailIndex+1)%thumbnailNumPerRow==0||thumbnailIndex==thumbnailCount-1){thumbHtml+="</div>";
}thumbnailIndex++;
}}if(videoThumbnails){var length=videoThumbnails.length;
for(var i=0;
i<length;
i++){if(thumbnailIndex%thumbnailNumPerRow==0){thumbHtml+="<div style='height:75px;'>";
}if(i!=oCurrentVideoID){thumbHtml+="<div class='iv_thumb iv_type_video' id='ivvideo_"+i+"'>";
thumbHtml+="<div class='iv_thumb_inner'>";
}else{thumbHtml+="<div class='iv_thumb iv_thumb_selected iv_type_video' id='ivvideo_"+i+"'>";
thumbHtml+="<div class='iv_thumb_inner iv_thumb_inner_selected'>";
}thumbHtml+="<div class='iv_thumb_image' style=\"background:url("+getResizedVideoThumbURL(videoThumbnails[i])+') center no-repeat">';
thumbHtml+="</div>";
thumbHtml+="</div>";
thumbHtml+="</div>";
if((thumbnailIndex+1)%thumbnailNumPerRow==0||thumbnailIndex==thumbnailCount-1){thumbHtml+="</div>";
}thumbnailIndex++;
}}return thumbHtml;
}function constructVideoList(){var videoThumbnails,videoTitles,videoDurations,videoIDs;
if(oVideoSet&&oVideoSet[oCurrentVideoSetID]){videoThumbnails=oVideoSet[oCurrentVideoSetID].videos.slateImages;
videoTitles=oVideoSet[oCurrentVideoSetID].videos.titles;
videoDurations=oVideoSet[oCurrentVideoSetID].videos.durations;
videoIDs=oVideoSet[oCurrentVideoSetID].videos.mediaIDs;
}var thumbHtml="";
if(videoThumbnails){var length=videoThumbnails.length;
for(var i=0;
i<length;
i++){thumbHtml+="<div class='iv_thumb_video_outer' id='ivvideolist_"+i+"'>";
thumbHtml+="<div class='iv_thumb_video'>";
thumbHtml+="<div class='iv_thumb_inner'>";
thumbHtml+="<div class='iv_thumb_image' style=\"background:url("+getResizedVideoThumbURL(videoThumbnails[i])+') center no-repeat">';
thumbHtml+="</div>";
thumbHtml+="</div>";
thumbHtml+="</div>";
thumbHtml+="<div class='iv_thumb_text'><b>"+videoTitles[i]+"</b><br>"+videoDurations[i]+"<div style='clear:both'></div></div>";
thumbHtml+="</div>";
}}return thumbHtml;
}function constructMediaSelection(){var tabHtml='<div style="width:235px; border:1px solid #C9E1F4; background-color:#EAF3FD; padding-top: 5px; padding-bottom: 5px; margin-top:15px; display: none" id="iv-tabbing">';
tabHtml+='<select id="iv_media_select" style="position:relative;left:65px">';
tabHtml+='<option id="all" value="all" selected>'+ivStrings["allMedia"]+"</option>";
tabHtml+='<option id="images" value="images">'+ivStrings["images"]+"</option>";
tabHtml+='<option id="videos" value="videos">'+ivStrings["videos"]+"</option>";
tabHtml+="</select>";
if(jQuery.browser.msie){tabHtml+='<span class="swSprite s_boxLeft" style="top: -14px; left: -102px; display: none;"> </span>  <span class="swSprite s_boxRight" style="top: -14px; left: 111px; display: none;"> </span>';
}else{tabHtml+='<span class="swSprite s_boxLeft" style="top: -12px; left: -102px; display: none;"> </span>  <span class="swSprite s_boxRight" style="top: -12px; left: 108px; display: none;"> </span>';
}tabHtml+="</div>";
var mediaSelection=jQuery(tabHtml);
oRightCol.append(mediaSelection);
}function updateIV(){isIVOpened=true;
jQuery(document.body).css("opacity","");
var bStyle=document.body.style;
if(jQuery.browser.msie&&bStyle&&bStyle.filter==""){bStyle.removeAttribute("filter");
}jQuery("#IV-Main").parents(".ap_popover").css({"top":(jQuery("body").scrollTop()+28)+"px"});
if(isTwisterDetailPage){setImmersiveViewContext();
jQuery(document).trigger("evdd_initialized");
updateVarSelection();
fetchVideoData();
}else{setImmersiveViewContext();
updateMediaSelection();
}resizeIV();
}function resetDP(){jQuery("#iv-large-image").empty();
jQuery(document.body).css("overflow","auto");
jQuery("#ap_container").unbind("keydown");
if(isTwisterDetailPage){EnhancedVariationsDropDown.prototype.hasMadeInitialSelections=0;
if(typeof(goTwisterCore)!="undefined"){for(var dimLabel in oSelectionVariations){goTwisterCore.performManualSelect(dimLabel,oSelectionVariations[dimLabel]);
}}else{if(typeof(twisterController)!="undefined"){for(var dimLabel in oSelectionVariations){twisterController.performManualSelect(dimLabel,oSelectionVariations[dimLabel]);
}}}}if(!isVideoDisabled){var length=dpPlayers.mediaIDs.length;
for(var i=0;
i<length;
i++){dpPlayers.playerDivs[i].css("top","");
dpPlayers.playerDivs[i].css("left","");
dpPlayers.playerDivs[i].css("z-index","");
if(videoMarginSet){if(window.ImageBlockWeblabs&&window.ImageBlockWeblabs.swipe&&!jQuery.browser.msie){dpPlayers.playerDivs[i].css({"margin-left":videoHolderMarginLeft,"margin-top":videoHolderMarginTop,"position":"static"});
}else{dpPlayers.playerDivs[i].css({"margin-left":videoHolderMarginLeft,"margin-top":videoHolderMarginTop});
}}AmznVideoPlayer.players[dpPlayers.mediaIDs[i]].resizeVideo(300,300);
}if(oVideoSet){if(AmznVideoPlayer.players[AmznVideoPlayer.lastPlayedId]){try{AmznVideoPlayer.players[AmznVideoPlayer.lastPlayedId].stop();
}catch(e){}}AmznVideoPlayer.hideAll();
}var DPMediaId=getCurrentMediaId();
if(DPMediaId!=null){AmznVideoPlayer.players[DPMediaId].showPreplay();
}videoStateChange("paused");
videoHolderMarginLeft=0;
videoHolderMarginTop=0;
videoMarginSet=false;
}isIVOpened=false;
jQuery(document).trigger("closed.IV");
}function updateVarSelection(){var pageState=DetailPage.StateController.getState();
var labels=pageState["variation_display_labels"];
for(var index in oVisualKeys){var label=oVisualKeys[index];
var selIndex=pageState["selected_variation_values"][label];
var selection=jQuery("#"+label+"DonsBox").val();
}}function updateMediaSelection(){var imageCount=(oImageSet&&oImageSet[oCurrentImgSetID])?oImageSet[oCurrentImgSetID].images.thumbnails.length:0;
var videoCount=(oVideoSet&&oVideoSet[oCurrentVideoSetID])?oVideoSet[oCurrentVideoSetID].videos.slateImages.length:0;
var ivThumbs=jQuery(".iv_thumbs");
var ivTabbing=jQuery("#iv-tabbing");
ivThumbs.html(constructThumbnails());
ivThumbs.css({"width":thumbSectionWidth+"px"});
jQuery(".iv_thumb_videos").html(constructVideoList());
addThumbHandlers();
jQuery(".iv_thumb_videos").hide();
var mediaSelection=jQuery("#iv_media_select");
mediaSelection.find("#all").text(ivStrings["allMedia"]+" ("+(imageCount+videoCount)+")");
mediaSelection.find("#videos").remove();
mediaSelection.find("#images").remove();
if(imageCount>0){mediaSelection.append('<option id="images" value="images">'+ivStrings["images"]+" ("+(imageCount)+")</option>");
}if(videoCount>0){mediaSelection.append('<option id="videos" value="videos">'+ivStrings["videos"]+" ("+(videoCount)+")</option>");
ivTabbing.show();
ivThumbs.css({"margin-top":"0px","border-top":"0px"});
}else{ivTabbing.hide();
ivThumbs.css({"margin-top":"15px","border-top":"1px solid #C9E1F4"});
}mediaSelection.val("all");
mediaSelection.change();
if(useThisDPImage){changeMainImage();
}}function fetchVideoData(){if(isVideoDisabled||(oVideoSet&&oVideoSet[oCurrentVideoSetID]&&(oVideoSet[oCurrentVideoSetID].videosFetched==1))){updateMediaSelection();
return;
}var asinList=getReachableAsins();
if(asinList.length>0){var argString="json=1";
argString+="&asinList=";
for(var i=0;
i<asinList.length;
i++){argString+=(i>0?",":"")+asinList[i];
break;
}argString+="&currentAsin="+getCurrentAsin(null);
videoAjaxFetch(argString,false,oCurrentVideoSetID);
}else{updateMediaSelection();
fetchParentVideoData(oCurrentVideoSetID);
}}function fetchParentVideoData(currentVideoSetID){if((!oVideoSet||!oVideoSet[currentVideoSetID]||oVideoSet[currentVideoSetID].length==0)&&isTwisterDetailPage){if(parentVideos&&(parentVideos.videosFetched==1)){if(!oVideoSet){oVideoSet=new Object();
oVideoSet[currentVideoSetID]=new Object();
}else{if(!oVideoSet[currentVideoSetID]){oVideoSet[currentVideoSetID]=new Object();
}}oVideoSet[currentVideoSetID].videos=parentVideos.videos;
updateMediaSelection();
return;
}var dpState=DetailPage.StateController.getState();
if(dpState){var argString="json=1&asinList="+dpState["parent_asin"];
argString+="&currentAsin="+getCurrentAsin(dpState);
videoAjaxFetch(argString,true,currentVideoSetID);
}else{updateMediaSelection();
}}}function videoAjaxFetch(argString,isParentFetch,currentVideoSetID){jQuery.ajax({url:"/gp/twister/dynamic-update/videos.html",data:argString,dataType:window.jqupgrade?"text":"json",timeout:40000,error:function(){updateMediaSelection();
},success:function(data,status,xhr){if(window.jqupgrade){data=eval("("+data+")");
}var length=data.length;
if(length>0){if(!oVideoSet){oVideoSet=new Object();
}if(!oVideoSet[currentVideoSetID]){oVideoSet[currentVideoSetID]=new Object();
}oVideoSet[currentVideoSetID].videos={mediaIDs:[],slateImages:[],titles:[],durations:[]};
for(var i=0;
i<length;
i++){oVideoSet[currentVideoSetID].videos.mediaIDs[i]=data[i].videoID;
oVideoSet[currentVideoSetID].videos.slateImages[i]=data[i].slateImage;
oVideoSet[currentVideoSetID].videos.titles[i]=data[i].title;
oVideoSet[currentVideoSetID].videos.durations[i]=data[i].duration;
}oVideoSet[currentVideoSetID].videosFetched=1;
if(isParentFetch){parentVideos=oVideoSet[currentVideoSetID];
}updateMediaSelection();
}else{if(isParentFetch){if(!oVideoSet){oVideoSet=new Object();
}if(!oVideoSet[currentVideoSetID]){oVideoSet[currentVideoSetID]=new Object();
}oVideoSet[currentVideoSetID].videosFetched=1;
oVideoSet[currentVideoSetID].videos={mediaIDs:[],slateImages:[],titles:[],durations:[]};
parentVideos=oVideoSet[currentVideoSetID];
}else{fetchParentVideoData(currentVideoSetID);
}}}});
if(!isParentFetch){updateMediaSelection();
}}function prefetchImages(){for(var i=-3;
i<=3;
i++){var id=parseInt(oCurrentImgID)+i;
if(id<0){continue;
}var imgURL=(oImageSet&&oImageSet[oCurrentImgSetID])?oImageSet[oCurrentImgSetID].images.zoomImages[id]:"";
if(imgURL&&oImageLoadState[imgURL]==undefined){var imgObject=jQuery("<img>").attr("src",imgURL);
imgObject.load(function(){oImageLoadState[jQuery(this).attr("src")]=1;
});
}else{if(!imgURL){break;
}}}}var videoInfoPopover;
function addThumbHandlers(){jQuery(".iv_thumb").click(function(event){useThisDPImage=0;
jQuery(".iv_thumb").removeClass("iv_thumb_selected");
jQuery(".iv_thumb").removeClass("iv_thumb_hover");
jQuery(".iv_thumb").find(".iv_thumb_inner").removeClass("iv_thumb_inner_selected");
jQuery(this).addClass("iv_thumb_selected");
jQuery(this).find(".iv_thumb_inner").addClass("iv_thumb_inner_selected");
if(jQuery(this).hasClass("iv_type_video")){oCurrentVideoID=jQuery(this).attr("id").split("_")[1];
playVideo();
}else{oCurrentImgID=jQuery(this).attr("id").split("_")[1];
changeMainImage();
}});
jQuery(".iv_thumb_video_outer").click(function(event){jQuery(".iv_thumb_video").removeClass("iv_thumb_selected");
jQuery(".iv_thumb_video").removeClass("iv_thumb_hover");
jQuery(".iv_thumb_video").find(".iv_thumb_inner").removeClass("iv_thumb_inner_selected");
jQuery(this).find(".iv_thumb_video").addClass("iv_thumb_selected");
jQuery(this).find(".iv_thumb_inner").addClass("iv_thumb_inner_selected");
oCurrentVideoID=jQuery(this).attr("id").split("_")[1];
playVideo();
});
jQuery(".iv_thumb").mouseover(function(event){if(videoInfoPopover){videoInfoPopover.close();
}if(!jQuery(this).hasClass("iv_thumb_selected")){jQuery(this).addClass("iv_thumb_hover");
jQuery(this).find(".iv_thumb_inner").addClass("iv_thumb_inner_selected");
}if(jQuery(this).hasClass("iv_type_video")){var videos=oVideoSet[oCurrentVideoSetID].videos;
var videoID=jQuery(this).attr("id").split("_")[1];
var videoContent="<span class='iv_thumb_text_popover'><b>"+videos.titles[videoID]+"</b><br>"+videos.durations[videoID]+"</span>";
var leftOffset=(oCurrentVideoID!=-1&&(jQuery(this).offset().left-jQuery(".iv_thumbs").offset().left)<=30)?-27:-50;
var topOffset=-11;
if(jQuery.browser.msie&&parseInt(jQuery.browser.version)==6){topOffset=-16;
}videoInfoPopover=jQuery.AmazonPopover.displayPopover({literalContent:videoContent,width:180,location:["top"],locationElement:this,locationAlign:"middle",locationOffset:[leftOffset,topOffset],zIndex:1000,hoverShowDelay:300,hoverHideDelay:300,showCloseButton:false,attached:true,modal:false});
if(jQuery.browser.msie&&parseInt(jQuery.browser.version)==6){videoInfoPopover.find(".ap_footer").find(".ap_middle").css({position:"relative",height:"30px",width:"112px",top:"-2px",background:"url("+oMediaUrls["arrow"]+") -343px -40px"});
}else{videoInfoPopover.find(".ap_footer").find(".ap_middle").css({position:"relative",height:"30px",width:"112px",top:"-3px",background:"url("+oMediaUrls["arrow"]+") -343px -43px"});
}}});
jQuery(".iv_thumb_video_outer").mouseover(function(event){jQuery(this).addClass("iv_thumb_video_outer_hover");
jQuery(this).find(".iv_thumb_text").addClass("iv_thumb_text_hover");
if(!jQuery(this).find(".iv_thumb_video").hasClass("iv_thumb_selected")){jQuery(this).find(".iv_thumb_video").addClass("iv_thumb_hover");
jQuery(this).find(".iv_thumb_inner").addClass("iv_thumb_inner_selected");
}});
jQuery(".iv_thumb").mouseout(function(event){if(!jQuery(this).hasClass("iv_thumb_selected")){jQuery(this).removeClass("iv_thumb_hover");
jQuery(this).find(".iv_thumb_inner").removeClass("iv_thumb_inner_selected");
}if(videoInfoPopover){videoInfoPopover.close();
}});
jQuery(".iv_thumb_video_outer").mouseout(function(event){jQuery(this).removeClass("iv_thumb_video_outer_hover");
jQuery(this).find(".iv_thumb_text").removeClass("iv_thumb_text_hover");
if(!jQuery(this).find(".iv_thumb_video").hasClass("iv_thumb_selected")){jQuery(this).find(".iv_thumb_video").removeClass("iv_thumb_hover");
jQuery(this).find(".iv_thumb_inner").removeClass("iv_thumb_inner_selected");
}});
jQuery("#ap_container").keydown(function(event){if(event.keyCode==37||event.keyCode==38||event.keyCode==39||event.keyCode==40||event.keyCode==33||event.keyCode==34){return false;
}});
}function addHandlers(){jQuery("#IV-Main").click(function(){jQuery(".DonsBoxRows").css("display","block").hide();
jQuery("#iv_media_select").css("visibility","visible");
});
jQuery(window).resize(function(){resizeIV();
});
jQuery("#iv_media_select").change(function(){if(jQuery(this).val()=="all"){jQuery(".iv_thumb_videos").hide();
jQuery(".iv_thumbs").show();
jQuery(".iv_type_video").show();
}else{if(jQuery(this).val()=="images"){jQuery(".iv_thumb_videos").hide();
jQuery(".iv_thumbs").show();
jQuery(".iv_type_video").hide();
}else{if(jQuery(this).val()=="videos"){jQuery(".iv_thumb_videos").show();
jQuery(".iv_thumbs").hide();
}}}clearAllSelections();
selectCurrentImage();
});
}function resizeIV(){var height=jQuery(window).height()-heightAdjustment;
var width=(jQuery(window).width()-widthAdjustment);
if(height>230){jQuery("#IV-Main").css({"height":(height)+"px"});
jQuery("#iv-large-image").css({"height":(height-15)+"px"});
var thumbsSecHeight=(height-thumbSectionHeightAdjustment);
jQuery(".iv_thumbs").css({"height":(thumbsSecHeight)+"px"});
jQuery(".iv_thumb_videos").css({"height":(thumbsSecHeight+videoListHeightAdjustment)+"px"});
}if(width>500){jQuery("#IV-Main").parents(".ap_popover").css({"width":(width)+"px"});
jQuery("#iv-first-column").css({"width":(width-330)+"px"});
}if(isPlayingVideo&&oVideoSet&&oCurrentVideoSetID&&oVideoSet[oCurrentVideoSetID]){var currMediaID=oVideoSet[oCurrentVideoSetID].videos.mediaIDs[oCurrentVideoID];
if(AmznVideoPlayer.players[currMediaID]){AmznVideoPlayer.players[currMediaID].resizeVideo(oLeftCol.width(),oLeftCol.height());
AmznVideoPlayer.players[currMediaID].showFlash();
}}else{imageFit();
}}function changeMainImage(){if(oVideoSet&&AmznVideoPlayer.players[AmznVideoPlayer.lastPlayedId]){AmznVideoPlayer.players[AmznVideoPlayer.lastPlayedId].pause();
}if(oVideoSet){AmznVideoPlayer.hideAll();
}jQuery("#iv-large-video").css("display","none");
jQuery("#iv-large-image").css("display","block");
var currentDetailImageUrl="";
if(useThisDPImage){currentDetailImageUrl=oImageSet[useThisDPImage].images.zoomImages[oCurrentImgID];
if(!currentDetailImageUrl){playVideo();
return;
}}else{if(oImageSet&&oImageSet[oCurrentImgSetID]){currentDetailImageUrl=oImageSet[oCurrentImgSetID].images.zoomImages[oCurrentImgID];
}}if(!currentDetailImageUrl){return;
}oFullImageLarge="<img src='"+currentDetailImageUrl+"'class='fullScreen'/>";
var oFullImageFit=jQuery("<img>").attr("src",currentDetailImageUrl);
oFullImageFit.addClass("fullScreen");
var largeImage=jQuery("#iv-large-image");
largeImage.animate({opacity:0.4},200,function(){oFullImageFit.load(function(){loadImage();
});
jQuery(oFullImageLarge).load(function(){loadImage();
});
if(!oImageLoadState[oFullImageFit.attr("src")]){isImageLoading=true;
largeImage.empty();
var top=(oLeftCol.height()-nSpinnerLength)/2;
var left=(oLeftCol.width()-nSpinnerWidth)/2;
jQuery("#iv-large-image").append("<img src='"+oMediaUrls["spinner"]+"' style='position:relative;top:"+top+"px;left:"+left+"px;' />");
}else{loadImage();
}});
oFullImageFit.load(function(){oImageLoadState[oFullImageFit.attr("src")]=1;
prefetchImages();
});
jQuery(oFullImageLarge).load(function(){oImageLoadState[oFullImageFit.attr("src")]=1;
prefetchImages();
});
function loadImage(){isImageLoading=false;
if((useThisDPImage&&oImageSet[useThisDPImage].images.zoomImages[oCurrentImgID]!=oFullImageFit.attr("src"))||(!useThisDPImage&&oImageSet[oCurrentImgSetID].images.zoomImages[oCurrentImgID]!=oFullImageFit.attr("src"))){return;
}largeImage.css("visibility","hidden");
largeImage.empty();
largeImage.animate({opacity:1},200);
largeImage.append(oFullImageFit);
imageFit();
isPlayingVideo=false;
oImageLoadState[oFullImageFit.attr("src")]=1;
}}var videoMarginSet=false;
function playVideo(){if((!oVideoSet||!oVideoSet[oCurrentVideoSetID])&&!useThisDPImage){return;
}var mediaID="";
if(useThisDPImage){mediaID=getCurrentMediaId();
}else{mediaID=oVideoSet[oCurrentVideoSetID].videos.mediaIDs[oCurrentVideoID];
}var holderID="holder"+mediaID;
var lastVideo=AmznVideoPlayer.players[AmznVideoPlayer.lastPlayedId];
if((jQuery("#"+holderID).length>0)&&!(playerOnIV[mediaID])){playerOnIV[mediaID]=false;
jQuery("#iv-large-image").css("display","none");
jQuery("#iv-large-video").css("display","block");
jQuery("#iv-large-image").empty();
playerDiv=jQuery("#"+holderID);
if(!(window.ImageBlockWeblabs&&window.ImageBlockWeblabs.swipe)||jQuery.browser.msie){playerDiv.css("z-index","2000");
playerDiv.css("top",jQuery("#iv-large-video").offset().top);
playerDiv.css("left",jQuery("#iv-large-video").offset().left);
}if(!videoMarginSet){videoHolderMarginLeft=playerDiv.css("margin-left");
videoHolderMarginTop=playerDiv.css("margin-top");
videoMarginSet=true;
}playerDiv.css({"margin-left":0,"margin-top":0});
if(lastVideo&&stopVideo){lastVideo.pause();
}AmznVideoPlayer.hideAll();
if(window.ImageBlockWeblabs&&window.ImageBlockWeblabs.swipe&&!jQuery.browser.msie){playerDiv.css({zIndex:"2000",top:jQuery("#iv-large-video").offset().top-jQuery("#main-image-wrapper").offset().top,left:jQuery("#iv-large-video").offset().left-jQuery("#main-image-wrapper").offset().left,position:"absolute"});
}AmznVideoPlayer.players[mediaID].resizeVideo(oLeftCol.width(),oLeftCol.height());
AmznVideoPlayer.players[mediaID].showFlash();
var currID=dpPlayers.mediaIDs.length;
dpPlayers.mediaIDs[currID]=mediaID;
dpPlayers.playerDivs[currID]=playerDiv;
isPlayingVideo=true;
stopVideo=true;
}else{if(!AmznVideoPlayer.players[mediaID]){playerOnIV[mediaID]=true;
jQuery("#iv-large-image").css("display","none");
jQuery("#iv-large-video").css("display","block");
jQuery("#iv-large-image").empty();
var placeHolder=jQuery("<div style='position:absolute' id='holder"+mediaID+"'></div>");
jQuery("#iv-large-video").append(jQuery(placeHolder));
if(!window.players){window.players=new Array();
}var mediaObject={mediaObjectId:mediaID,slateImageUrl:oVideoSet[oCurrentVideoSetID].videos.slateImages[oCurrentVideoID]};
window.players[oCurrentVideoID]=new AmznVideoPlayer(mediaObject,holderID,oLeftCol.width(),oLeftCol.height());
AmznVideoPlayer.hideAll();
if(lastVideo){lastVideo.pause();
}AmznVideoPlayer.players[mediaID].resizeVideo(oLeftCol.width(),oLeftCol.height());
AmznVideoPlayer.players[mediaID].showFlash();
isPlayingVideo=true;
}else{AmznVideoPlayer.hideAll();
if(lastVideo){lastVideo.pause();
}jQuery("#iv-large-image").css("display","none");
jQuery("#iv-large-video").css("display","block");
jQuery("#iv-large-image").empty();
AmznVideoPlayer.players[mediaID].resizeVideo(oLeftCol.width(),oLeftCol.height());
AmznVideoPlayer.players[mediaID].showFlash();
isPlayingVideo=true;
}}}function prefetchResources(){jQuery("<img>").attr("src",""+oMediaUrls["arrow"]+"");
jQuery("<img>").attr("src",""+oMediaUrls["zoomIn"]+"");
jQuery("<img>").attr("src",""+oMediaUrls["zoomOut"]+"");
}function doBrowserAdjustment(){if(jQuery.browser.msie){thumbSectionWidth=235;
heightAdjustment=123;
videoListHeightAdjustment=0;
thumbSectionHeightAdjustment=isTwisterDetailPage?115+(oVisualKeys.length*50):95;
}else{thumbSectionHeightAdjustment=isTwisterDetailPage?125+(oVisualKeys.length*50):125;
}}function imageFit(){isLargeMode=false;
var ww=oLeftCol.width();
var wh=oLeftCol.height();
var fullImageFit=oIV.find(".fullScreen");
fullImageFit.removeAttr("style");
oFullImageWidth=fullImageFit.width();
oFullImageHeight=fullImageFit.height();
oLeftCol.css({"cursor":"auto"});
if(((oFullImageWidth>=1000)||(oFullImageHeight>=1000))){if(jQuery.browser.mozilla){oLeftCol.css({"cursor":"-moz-zoom-in"});
}else{oLeftCol.css({"cursor":"url('"+oMediaUrls["zoomIn"]+"'), auto"});
}}oFullImageWidth=oFullImageWidth==0?1:oFullImageWidth;
oFullImageHeight=oFullImageHeight==0?1:oFullImageHeight;
var scale=Math.min(ww/oFullImageWidth,wh/oFullImageHeight);
var fitHeight=oFullImageHeight*scale;
var fitWidth=oFullImageWidth*scale;
var imgHeight;
if(fitHeight<oFullImageHeight){imgHeight=fitHeight-20;
}else{imgHeight=oFullImageHeight;
}fullImageFit.css("height",imgHeight);
fullImageFit.css("width",Math.min(fitWidth,oFullImageWidth));
var left=((ww-fullImageFit.width())/2);
var top=((wh-fullImageFit.height())/2);
fullImageFit.css("margin-top",top);
fullImageFit.css("margin-left",left);
jQuery("#iv-large-image").css("visibility","visible");
}function setupMaxOffset(){var fullImageFit=oIV.find(".fullScreen");
oFullImageWidth=fullImageFit.width();
oFullImageHeight=fullImageFit.height();
maxOffset.left=oLeftCol.width()-oFullImageWidth;
maxOffset.top=oLeftCol.height()-oFullImageHeight;
}function getIndex(label,obj){var length=obj.length;
for(var i=0;
i<length;
i++){if(obj[i]==label){return i;
}}return -1;
}function getReachableAsins(){var aAsinList=new Array();
var count=0;
var dpState=DetailPage.StateController.getState();
if(!dpState){return;
}var sLookup="";
if(typeof gIsNewTwister!="undefined"&&gIsNewTwister!=0){if(oPreferChildVideos){var val="";
for(var index in oVisualKeys){var label=oVisualKeys[index];
val+=(parseInt(oSelectionVariations[label])+1);
if(index<(oVisualKeys.length-1)){val+="-";
}}aAsinList.push(oIVRepresentativeAsin[val]);
return aAsinList;
}else{for(var color in oItemList){if(oItemList.hasOwnProperty(color)){if(oItemList[color]["asin"]){aAsinList.push(oItemList[color]["asin"]);
}}}return aAsinList;
}}else{for(var sVarKey in dpState["selected_variation_values"]){if(sVarKey in oSelectionVariations){if(oSelectionVariations[sVarKey]!=-1){sLookup+=(oSelectionVariations[sVarKey]+" ");
}else{sLookup=null;
break;
}}else{sLookup+="-1 ";
}}}if(sLookup!=null){var oItems=oItemList[sLookup];
for(var nVarValue in oItems){aAsinList[count]=oItems[nVarValue];
count++;
}}return aAsinList;
}function getCurrentAsin(dpState){if(!dpState){dpState=DetailPage.StateController.getState();
}var currentAsin=null;
if(dpState){currentAsin=dpState["current_asin"];
}return currentAsin;
}function getResizedThumbnailURL(url){url=url.replace(/'/g,"").replace("._SL75_","").replace(/\._(AA|SS)\d+_/,"").replace(/\._SX\d+_SY\d+_CR,0,0,\d+,\d+_/,"");
var index=url.lastIndexOf(".");
url=url.substring(0,index)+"._AA50_"+url.substring(index);
return url;
}function getResizedVideoThumbURL(url){url=url.replace(/'/g,"").replace("._SL75_","").replace(/\._(AA|SS)\d+(?!_PImini-player-shuttle-50px,BottomLeft,0,3)_/,"").replace(/\._SX3\d+_SY\d+_CR,0,0,\d+,\d+_/,"");
if(url.search("_SS50_")<0){var index=url.lastIndexOf(".");
url=url.substring(0,index)+"._SS50_PImini-player-shuttle-50px,BottomLeft,0,3_"+url.substring(index);
url=url.replace("_._","._");
}return url;
}function trimWithEllipsis(str,maxCharacters){str=new String(str);
var trimmedStr=str;
if(str.length>maxCharacters){try{var index=-1;
for(var i=0;
i<str.length;
i++){var c=str.charAt(i);
if(c==" "||c=="."||c=="?"||c==";"||c==","||c==":"){index=i;
}if(i==maxCharacters-4){var trimIndex=(index==-1?i:index);
trimmedStr=str.substring(0,trimIndex);
break;
}}}catch(e){trimmedStr=str.substring(0,maxCharacters-3);
}trimmedStr+="...";
}return trimmedStr;
}function clearAllSelections(){jQuery(".iv_thumb").removeClass("iv_thumb_selected");
jQuery(".iv_thumb").removeClass("iv_thumb_hover");
jQuery(".iv_thumb_video").removeClass("iv_thumb_selected");
jQuery(".iv_thumb_video").removeClass("iv_thumb_hover");
}function selectCurrentImage(){if(jQuery("#iv_media_select").val()=="videos"){oCurrentVideoID=(oCurrentVideoID!=-1)?oCurrentVideoID:0;
oCurrentImgID=-1;
jQuery(".iv_thumb_video_outer:eq("+(oCurrentVideoID)+")").click();
}else{if(jQuery("#iv_media_select").val()=="images"){oCurrentImgID=(oCurrentImgID!=-1)?oCurrentImgID:0;
}if(oCurrentImgID!=-1&&!useThisDPImage){jQuery(".iv_thumb:eq("+oCurrentImgID+")").click();
}else{if(oCurrentVideoID!=-1){var firstVideoID=jQuery("[id^=ivimage_]").length;
var vidID=parseInt(oCurrentVideoID)+firstVideoID;
jQuery(".iv_thumb:eq("+(vidID)+")").click();
}}}}function getFullScreenOffset(offset){var newOffset=offset;
if(maxOffset.left>0){newOffset.left=maxOffset.left/2;
}else{if(offset.left<maxOffset.left){newOffset.left=maxOffset.left;
}else{if(offset.left>0){newOffset.left=0;
}}}if(maxOffset.top>0){newOffset.top=maxOffset.top/2;
}else{if(offset.top<maxOffset.top){newOffset.top=maxOffset.top;
}else{if(offset.top>0){newOffset.top=0;
}}}return newOffset;
}function largeMode(){if(!((oFullImageWidth>=1000)||(oFullImageHeight>=1000))){return;
}if(jQuery.browser.mozilla){oLeftCol.css({"cursor":"-moz-zoom-out"});
}else{oLeftCol.css({"cursor":"url('"+oMediaUrls["zoomOut"]+"'), auto"});
}isLargeMode=true;
var largeImage=oLeftCol.find("#iv-large-image");
setupMaxOffset();
var centerHeight=oLeftCol.height()/2;
var centerWidth=oLeftCol.width()/2;
cursorStart=[largeImage.offset().left+centerWidth,largeImage.offset().top+centerHeight];
initialOffset.top=centerHeight-oFullImageHeight/2;
initialOffset.left=centerWidth-oFullImageWidth/2;
oLeftCol.find(".fullScreen").css({position:"relative",left:initialOffset.left,top:initialOffset.top});
fullScreenMoveFactor=Math.max(oFullImageHeight/oLeftCol.height(),oFullImageWidth/oLeftCol.width());
fullScreenMoveFactor=Math.max(fullScreenMoveFactor,DEFAULT_FULL_SCREEN_MOVE_FACTOR);
}function EnhancedVariationsDropDown(){EnhancedVariationsDropDown.prototype.DonsBoxes=new Object();
EnhancedVariationsDropDown.prototype.initialized=0;
EnhancedVariationsDropDown.prototype.initialize=function(){if(EnhancedVariationsDropDown.prototype.initialized){return;
}jQuery(document).bind("evdd_initialized",function(){if(!EnhancedVariationsDropDown.prototype.initialized){for(var i in oVisualKeys){var label=oVisualKeys[i];
var dropDownRows=EnhancedVariationsDropDown.prototype.getDropDownRowsMatrix(label,false);
var previewRows=EnhancedVariationsDropDown.prototype.getDropDownRowsMatrix(label,true);
oSingleton=(oVisualKeys.length==1&&dropDownRows.length==1);
var donsBoxArgs={defaultMessage:ivStrings["pleaseSelect"],id:label+"_IV_DonsBox",dropDownRowsMatrix:dropDownRows,previewRowsMatrix:previewRows,locationElement:"#"+label+"IVDonsBoxParent",onSelect:function(donsBox,index){var varKey=-1;
varKey=donsBox.getId().substring(0,donsBox.getId().lastIndexOf("_IV_DonsBox"));
EnhancedVariationsDropDown.prototype.onSelect(varKey,index);
},onOpen:function(donsBox,index){var isIE6=jQuery.browser.msie&&parseInt(jQuery.browser.version)==6&&!window["XMLHttpRequest"];
if(isIE6){jQuery("#iv_media_select").css("visibility","hidden");
}},onClose:function(donsBox,index){jQuery("#iv_media_select").css("visibility","visible");
},width:215,singleRowBehavior:(oVisualKeys.length>1)?"AUTO_SELECT":"LABEL"};
EnhancedVariationsDropDown.prototype.DonsBoxes[i]=new DonsBox(donsBoxArgs);
}}var initialSelection=oCurrentImgSetID.split("-");
if(initialSelection[0]=="x"){if(EnhancedVariationsDropDown.prototype.DonsBoxes[0]){EnhancedVariationsDropDown.prototype.DonsBoxes[0].selectRow(0);
}else{updateMediaSelection();
}}else{for(var box in oDonsBoxes){var i=oDonsBoxes[box];
var imageSetIndex=initialSelection[i]-1;
if(imageSetIndex>=0){EnhancedVariationsDropDown.prototype.DonsBoxes[i].selectRow(imageSetIndex);
}}}EnhancedVariationsDropDown.prototype.hasMadeInitialSelections=1;
EnhancedVariationsDropDown.prototype.initialized=1;
});
};
}this.initialize=function(){EnhancedVariationsDropDown.prototype.initialize();
};
EnhancedVariationsDropDown.prototype.getDropDownRowsMatrix=function(varKey,isPreview){var output=new Array();
var dimensionValues=DetailPage.StateController.getState()["variation_values"][varKey];
if(!dimensionValues){return output;
}var hasSwatches=false;
for(var i=0;
i<dimensionValues.length;
i++){if(oSwatchImages[varKey+"-"+dimensionValues[i]]){hasSwatches=true;
break;
}}var swatchSize=((isPreview||!hasSwatches)?"20px":"30px");
for(var i=0;
i<dimensionValues.length;
i++){var varValueDiv=new String('<div style="width: 190px; height: '+swatchSize+'; overflow:hidden" class="DonsBoxNotHighlighted" '+'title="'+dimensionValues[i]+'">'+dimensionValues[i]+"</div>");
output[i]=new Array();
if(hasSwatches){var swatchURL=oSwatchImages[varKey+"-"+dimensionValues[i]];
if(swatchURL){var index=swatchURL.indexOf("25px");
if(index>=0){if(isPreview){swatchURL=swatchURL.replace(/25px/g,swatchSize);
varValueDiv=varValueDiv.replace(/190px/g,"165px");
}else{swatchSize="25px";
varValueDiv=varValueDiv.replace(/190px/g,"160px");
varValueDiv=varValueDiv.replace(/30px/g,"25px");
}}else{varValueDiv=varValueDiv.replace(/190px/g,(isPreview)?"155px":"150px");
}swatchURL=swatchURL.replace(/20px/g,swatchSize);
}swatchURL=swatchURL||'<div style="margin: 0px 5px; width: '+swatchSize+"height: "+swatchSize+';"></div>';
output[i][0]=swatchURL;
output[i][1]=varValueDiv;
}else{output[i][0]=varValueDiv;
}}return output;
};
EnhancedVariationsDropDown.prototype.onSelect=function(varKey,nVarVal){var lastMasterFound=false;
var asinValues=DetailPage.StateController.getState()["asin_variation_values"];
if(noImageChidlASINs==undefined){noImageChidlASINs=new Array();
for(var childASIN in asinValues){var oCurrentImgSetIDTemp="";
for(var index in oVisualKeys){var key=oVisualKeys[index];
oCurrentImgSetIDTemp+=(+asinValues[childASIN][key]+1)+"-";
}oCurrentImgSetIDTemp=oCurrentImgSetIDTemp.substring(0,oCurrentImgSetIDTemp.length-1);
if(!oImageSet[oCurrentImgSetIDTemp]){noImageChidlASINs.push(childASIN);
}}}var invalidChildASINs=new Array();
jQuery.extend(invalidChildASINs,noImageChidlASINs);
for(var box in oDonsBoxes){var key=oVisualKeys[oDonsBoxes[box]];
var selID=key+"_IV_DonsBox";
var selection=jQuery("#"+selID).val();
jQuery("tr[id^='"+key+"_IV_DonsBox_DonsBoxRow_']").css("display","none");
if(lastMasterFound||oVisualKeys.length==1){var minIndex=-1;
for(var childASIN in asinValues){if(getIndex(childASIN,invalidChildASINs)>=0){continue;
}if(minIndex==-1||asinValues[childASIN][key]<minIndex){minIndex=asinValues[childASIN][key];
}jQuery("tr#"+key+"_IV_DonsBox_DonsBoxRow_"+asinValues[childASIN][key]).css("display","");
}if(minIndex!=-1&&varKey!=key&&minIndex!=selection){EnhancedVariationsDropDown.prototype.DonsBoxes[oDonsBoxes[box]].selectRow(minIndex);
}}else{for(var childASIN in asinValues){if(getIndex(childASIN,invalidChildASINs)>=0){continue;
}jQuery("tr#"+key+"_IV_DonsBox_DonsBoxRow_"+asinValues[childASIN][key]).css("display","");
if(asinValues[childASIN][key]!=selection){invalidChildASINs.push(childASIN);
}}if(key==varKey){lastMasterFound=true;
}}}oCurrentImgSetIDTemp="";
for(var index in oVisualKeys){var selID=oVisualKeys[index]+"_IV_DonsBox";
oSelectionVariations[oVisualKeys[index]]=jQuery("#"+selID).val();
oCurrentImgSetIDTemp+=(+jQuery("#"+selID).val()+1)+"-";
}oCurrentImgSetIDTemp=oCurrentImgSetIDTemp.substring(0,oCurrentImgSetIDTemp.length-1);
if(useThisDPImage){useThisDPImage=oCurrentImgID=0;
}if(oImageSet&&oImageSet[oCurrentImgSetIDTemp]&&oCurrentImgSetIDTemp!=oCurrentImgSetID){useThisDPImage=(oCurrentImgSetID.charAt(0)=="x"&&!oSingleton)?oCurrentImgSetID:0;
if(EnhancedVariationsDropDown.prototype.hasMadeInitialSelections||useThisDPImage){oCurrentVideoSetID=oCurrentImgSetID=new String(oCurrentImgSetIDTemp);
if(!useThisDPImage){oCurrentImgID=0;
}oCurrentVideoID=-1;
fetchVideoData();
}}};
EnhancedVariationsDropDown.prototype.initialize();
return this;
};
if(typeof(gIsNewTwister)!="undefined"&&gIsNewTwister){amznJQ.available("DonsBoxJS",function(){amznJQ.available("newTwister",function(){amznJQ.declareAvailable("immersiveView");
});
});
}else{if(typeof(isTwisterPage)=="undefined"||!isTwisterPage){amznJQ.declareAvailable("immersiveView");
}else{amznJQ.available("twister",function(){amznJQ.declareAvailable("immersiveView");
});
}}})();
